# 开发者，当心:你不能忽视的 3 个 API 安全风险

> 原文：<https://thenewstack.io/developer-beware-the-3-api-security-risks-you-cant-overlook/>

API 不仅仅是使应用程序和数据库无缝协作的结缔组织。它也是黑客访问组织的应用程序和敏感数据的途径，通常在视线之外，无法检测到。

拉维·巴卢帕里

Ravi 是一名安全研究员和工程师，在网络安全领域拥有 20 多年的经验。Balupari 共同创建了 Netskope 的工程团队，后来又共同创建了 CloudVector，后者被 Imperva 收购。他在网络安全、云安全和勒索软件检测等领域获得了 11 项专利。他拥有俄亥俄大学的硕士学位和贾瓦哈拉尔·尼赫鲁科技大学的学士学位。

由 [Forrester](https://www.imperva.com/resources/resource-library/white-papers/improve-api-performance-with-a-sound-api-security-strategy/) 进行的一项调查发现，大多数组织(60%)已经发布了 25 到 500 个公共 API。在接下来的一年中，开发人员将编写和发布更多的 API 来提供新的应用程序功能，并改进集成或服务交付。然而，开发发生得如此之快，以至于在 API 被发布到产品中之前，它往往还没有被仔细审查、编目和评估安全问题。

是时候积极主动地将安全性嵌入到开发生命周期中了。根据同一项调查，56%的开发人员认为 API 安全性是他们未来 12 个月的首要任务。随着易受攻击或配置不当的 API 导致的安全事故数量成倍增加，开发人员需要了解风险以及它们是如何工作的。

下面是你需要熟悉的三大 API 安全风险，以及如何保护你的 API 免受这些攻击。

## **中断对象级授权(BOLA)**

对象级授权是一种在代码级实现的访问控制机制，用于验证授权用户是否可以访问他们**应该**有权访问的对象。

BOLA 是一种复杂的威胁，攻击者识别用作数据源的 API 端点及其规范和数据模式。攻击者利用操纵数据的简单脚本来利用 API 端点，替换 API 端点参数中的值，以获得对 API 返回的敏感数据的访问权限。这些事件会导致数据泄露，甚至会导致数据被修改或破坏。

### 如何预防:

*   基于用户角色和策略设计和实现授权。构建一个所有应用服务都可以使用的基于角色的分层模型。
*   在复杂的基于微服务的架构中，将经过身份验证的用户的角色、特权和权利传递给内部 API 调用中的每个后续下游服务非常重要。
*   每个服务都必须在对 API 中的请求采取行动之前实现授权检查，尤其是在返回任何数据之前。
*   在大多数 BOLA 利用中，攻击者迭代可预测的序列模式，如一系列数字。在设计和实现 API 时，可以考虑使输入随机化，例如对数字 id 使用全局唯一标识符(GUIDs)。
*   随着 API 的实施，纳入针对 BOLA 问题的特定测试。

## **过多的数据暴露**

根据设计，大多数 API 将数据从数据存储发送到客户端。当 API 被设计为向客户端返回大量数据时，会导致过多的数据暴露。攻击者可以从这样的 API 响应中收集敏感数据。

例如，一个团体健身应用程序显示该团体参与者的家庭位置。位置显示在地图上，使用每个运动员的纬度和经度。一个设计良好的 API 旨在只返回每个运动员的纬度和经度。相反，设计糟糕的 API 会返回每个运动员的用户信息，包括他们的全名、地址、电子邮件、电话号码、纬度和经度等等。这是一个过度暴露数据的例子，因为 API 返回的数据比设计的要多。

当一个设计不良的 API 从数据库中提取一条记录并将其完整地返回给客户端，从而暴露文件中的所有数据时，可能会发生这种情况。在这种情况下，真正的业务用例在开发过程中没有被完全理解。

### 如何预防:

*   考虑为特定用例创建 API 的设计理念。这允许将来对数据实施授权控制。
*   不要依赖客户端过滤掉敏感数据。
*   检查所有 API，确保它们的响应只返回预期的数据。
*   审核使用现有 API 过度暴露数据的业务用例。
*   在代码审查期间，测试 API 以确保在数据存储和客户端之间交换预期数量的数据。
*   避免从数据存储中读取记录，并在 API 中直接将它们作为响应返回。
*   定期对您的 API 进行审计，并根据流经 API 的数据的敏感性对它们进行分类。
*   如果您的 API 提供了提供过滤器的灵活性(比如 GraphQL)，那么就实现一个基于模式的响应验证。

## **中断功能级授权(BFLA)**

简而言之，在这些事件中，普通用户可以执行管理员的任务。这是由复杂、不完整或不完整的访问控制策略造成的。具有普通或基本角色/权限的攻击者可以利用这些功能级授权问题，获得对其他资源和/或管理功能的访问权限。

具有跨授权层次结构的复杂权限和用户角色的 API 容易受到此漏洞的攻击。这个问题通常发生在 API 端点——在某些情况下被认为提供了一个函数——或者用于访问 API 端点的方法。

例如，一个普通用户正在查看他们的员工详细信息。在应用程序端，这意味着对 API 端点(如`/api/v1/employeeDetails`)发出 GET 请求。管理员可以对这些细节进行修改，并被允许对同一个端点`/api/v1/employeeDetails`使用 PUT 请求。如果 API 没有在函数级别实现适当的授权，普通用户可能有权限发出 PUT 请求，并随后更改他们自己的员工详细信息。与 BOLA 类似，当从客户端收到函数级请求时，实现授权检查。

### 如何预防:

*   基于用户角色和策略设计和实现授权。构建一个所有应用服务都可以使用的基于角色的分层模型。
*   将经过身份验证的用户的角色、特权和权利传递给内部 API 调用中的每个后续下游服务非常重要。
*   每个服务在 API 中处理请求之前都必须实现授权检查。作为一般规则，考虑默认情况下拒绝所有访问，并授予特定角色访问权限。
*   审查和审计具有多个函数或方法的 API，以识别任何授权问题。
*   预测复杂的用户角色和组层次结构。实现特定的测试，作为你的开发过程的一部分，模仿 BFLA。

## **通过实施正确的防御来阻止 API 安全风险**

要解决这些复杂而精密的 API 安全风险，首先要在开发和生产运行时清楚地评估这些风险。评估从自动发现和不断适应每个 API 变化的最新 API 目录开始。

按特定类别对 API 进行分类，例如处理敏感数据的 API、返回过多数据的 API 或允许普通用户和管理员用户操作不同功能的 API。接下来，应用自动化和机器学习来评估 API 行为，最好是在开发和测试阶段的早期。根据基于风险的策略对此进行评估，并确定缓解威胁的适当措施，尤其是数据交换模式，以便能够基于始终最新的行为基准启用运行时保护。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>