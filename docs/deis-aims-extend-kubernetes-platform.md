# Deis 的目标是将 Kubernetes 扩展成一个平台

> 原文：<https://thenewstack.io/deis-aims-extend-kubernetes-platform/>

在短短的几个月内，Google 围绕其 Kubernetes orchestrator 建立了一个开放联盟，将平台的焦点从容器转移到了容器 orchestrator 上。

或许这种转变的最大迹象来自于上周在旧金山的 KubeCon，在那里，Deis——现在是发动机场的闪亮新部门——向[推出了一个名为 Helm](https://helm.sh/) 的工作负载包管理器。

首席架构师 Jason Hansen 和 Matt Butcher 表示，Helm 将采用一种全新的方法，以类似 PaaS 的方式部署工作负载，这些部署的对象是 Kubernetes，而不是 Docker。Deis 团队发现，没有哪两个数据中心或云环境的工作方式是相同的，因此没有哪种部署一种类型甚至一种身份的工作负载的技术可以像标准化模板一样在平台之间完美转换。

因此 Helm 将真正采取众包的方法来解决这个问题，让用户能够针对特定的工作负载试验部署模式，同时筛选出成功部署之间的通用模式。这些模式将有效地创建最新的最佳实践，随着时间的推移，Helm 用户可以利用这些最佳实践。

## 社区契约

“这个想法是，人们可以共同定义将应用部署到 Kubernetes 的最佳实践，”平台架构师 Butcher 解释说，“通过构建这些 Kubernetes 清单文件——也就是合同。与此同时，在定义它们的同时，他们也在构建有用的东西——为任何想使用 NGINX 复制控制器的人定义一个 NGINX 复制控制器，或者为任何想运行数据库的人定义一个 Postgres 复制控制器。

“这成为微服务理念的一个实验场，”Butcher 继续说道。“如果我们做得对，那么我们就在建立合同，允许这些东西以几乎任意、令人惊讶的方式进行组装。”

他说，Kubernetes 的首要任务也是最普遍的任务是迫使开发人员和开发者想出如何让东西在 Kubernetes 上运行。Deis 团队比任何人都清楚这一点:他们正在积极地将 Deis 版本 2 改造成一个运行在 Kubernetes 平台之上的系统。

因此，他们首先在让 Deis 本身在 Kubernetes 上运行的背景下，着手解决 Deis 在 Kubernetes 上“让东西运行”的问题。Butcher 说，正是通过这个过程，他的团队意识到开发人员和 DevOps 专业人员缺少一种引导过程来获得第一个应用程序——大多数人都需要的应用程序——部署到 Kubernetes。

“第二，如果我们有团队一起工作，有一个工具来帮助他们合作开发 Kubernetes 的东西，这将是很好的，”他补充说。“我们越深入了解这一点，我们就越开始谈论软件包管理——比如 OS X 的[home brew，或者 Linux 的 apt-get 或 yum。我们意识到，本质上，这是我们的愿景，我们认为我们可以帮助个人开发者学习，以及那些团队，克服他们在 Kubernetes 上遇到的一些常见障碍。”](http://brew.sh/) [杰森·汉森和马特·布彻，DEIS:](https://thenewstack.simplecast.com/episodes/jason-hansen-and-matt-butcher-deis-at-kubecon)

请听 TNS 对杰森·汉森和马特·布彻的采访。

## 半确定图表

在上周 Deis 的一篇博客文章中，Butcher 展示了运行和使用 Helm 的基本原则。在通过 Linux 命令行第一次运行之后，Helm 为它运行的主机更新和配置自己，然后基于该主机创建基本的配置文件。应用程序包的配置文件被称为图表，继续航海的比喻——尽管它们实际上不是可视化的，而是 YAML 文件。

图表不是应用程序的默认清单，而是最终发展成配置文件的胚胎。虽然图表存储在 GitHub 的中央存储库中，但每一个图表都被设计成带到一个工作区中，在那里针对其应用程序将要部署到的 Kubernetes 平台进行调整。

Butcher 写道:“将 Helm 视为一个补充的 Kubernetes 工具，它为您的 DevOps 团队铺平了一条可预测的、协作的、版本维护的道路。”“掌舵工作区是你的游乐场。您不仅可以修改现有的图表，还可以在那里创建自己的图表。您可以添加版本控制，并将您的工作区作为它自己的存储库进行跟踪。我们甚至为您提供了创建和提交图表的工具！”

Hansen 将 Helm 图表描述为包含关于应用程序的元数据，加上关于其特定版本的描述性参数，以及潜在的多个清单(例如，pod 清单、复制控制器或服务定义)和组成文件的已知资源位置。可以为图表中包含的组件定义任意标签。

“应用程序开发人员的生活已经够艰难了，”Butcher 说。“然后还有一个典型的问题，我称之为‘把它扔过墙’，你有负责在生产中运行所有这些东西的 DevOps 人员，你有负责构建它的开发人员，而且总是有这个移交过程，这往往会变成把一些东西扔过墙。”

Butcher 说，当开发人员构建容器时，抽象层提供了一定程度的保证，即这些容器在生产阶段和开发阶段的运行方式基本相同。这已经减轻了开发人员的许多头痛，他们理解容器的基本工具，但最终做得更少。容器化已经提供了这种保证级别，但 Helm 可以通过将这种关系作为一种契约在团队之间进行展示来帮助进一步形式化这种关系——这种契约不是“扔过墙”，而是直接穿透它。

汉森说，他的团队对 Deis 版本 2 的设计目标是“在不包装的情况下，尽可能多地暴露 Kubernetes。”他的意思是为开发人员和 DevOps 团队提供一种更简单的方法来访问 orchestrator，而不用将其隐藏在另一个进程中，或者嵌入到另一个平台中。

## 模式匹配

“赫尔姆是一种积极的实验，”布彻说。“如果社区共同致力于此，并且我们为运行 MySQL 和运行 WordPress 和 HAProxy 定义了一个好的模式，所有这些都在 Kubernetes 内部，那么如果我们做得对，并且如果整个微服务架构都是我们所希望的，那么人们应该开始从 Helm 中取出这些组件，或者使用 Helm 将它们安装到 Kubernetes 中，并构建一些相当好的应用程序，与他们手动组装这些组件相比，他们需要做的工作要少得多。”

“除此之外，这确实是社区的一个问题:作为 Kubernetes 运营商的社区，我们希望建立什么样的合同？”汉森说。“我们如何给东西贴标签？我们有几个猜想，一个是在 Kubernetes 的上下文中，服务定义的责任在消费者一方，而不是生产者一方。这是一个让应用程序配置对我们来说更容易的问题，但也是我们希望看到社区验证的想法。”

这是汉森承认的方式，不仅建立标签和标记规范的问题尚未确定，但它可能不是 Deis 或 Engine Yard 的角色来确定它们。Hansen 和 Butcher 真诚地相信，只要 Helm 为开发人员和 DevOps 专业人员提供足够的机制来定制他们自己的工作负载处理过程，他们就会为自己提出一个绰绰有余的解决方案。

通过这种方式处理问题，Butcher 建议 Helm 可以将 devs 和 DevOps 更紧密地结合在一起——甚至可能将两个团队嫁接或合并在一起。“我认为我们热衷的事情之一，我认为 Kubernetes 的许多人都热衷于此，”他说，“是我们将找出某种社区，事实上使用这些标签的方法，这样我们可以在更有意义的意义上谈论它们，而不是它们只是完全任意的标签。

“如果赫尔姆要成功，”他补充说，“部分取决于人们开始进行那种特定的讨论。”

《书库》的新任主编亚历克斯·威廉姆斯为这个故事做出了贡献。

Docker 是新堆栈的赞助商。

专题图片:“荷兰船只在远离荷兰海岸的公海上”，作者 Ludolf Backhuysen(1630–1708)，由[Walters 艺术博物馆](http://art.thewalters.org/detail/37794/storm-at-sea/) 提供，在知识共享许可下使用。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>