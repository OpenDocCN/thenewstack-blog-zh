# 基于跟踪的测试对 SREs 重要的 5 种方式

> 原文：<https://thenewstack.io/5-ways-trace-based-testing-matters-to-sres/>

虽然开发和 QA 人员主要负责测试，但现场可靠性工程师(SREs)通常负责整个系统及其可用性。

单元测试通常是在单个团队的筒仓中创建和运行的，但是集成、端到端和系统测试必须在一个更完整的环境中进行，该环境结合了多个团队的工作、技术和更现实的部署环境。这种更完整的环境是 SRE 工程师的领域。

SRE 团队的任务是创建和实现提高站点可靠性和性能的工具，他们在实现对整个分布式系统的测试中扮演着重要的角色。

专注于帮助 SRE 工程师管理大规模分布式应用的工具在过去十年里经历了一场彻底的革命，这主要是由于必要性。日志文件在只有一个用户的单一环境中非常有用，但是当您有一个有许多用户的分布式系统时，它们很快就变得不适用了。

这场革命改变了日志和指标的处理方式，但最大的不同是分布式跟踪的出现。能够在单笔交易流经整个系统时对其进行全面跟踪，查看交易过程中每一步的时间和关键信息，这是一种改变游戏规则的能力。它已经成为 SRE 社区理解和调试其环境中复杂事务的核心工具。

## 什么是基于痕迹的测试？

基于跟踪的测试使用包含在[分布式跟踪](https://thenewstack.io/trace-based-testing-the-next-step-in-observability/)的跨度和属性中的数据来断言预期的系统行为。传统的 API 工具断言系统调用的响应，而基于跟踪的测试断言响应和跟踪结果。

你可以把它想象成拥有 x 光视觉的邮递员，不仅可以看到并允许测试调用的明显结果，还可以测试整个流程，确保完成请求所涉及的每个微服务都以预期的方式运行。对于分布式世界中的测试来说，这是一个自然的解决方案，因为它建立在[分布式可观测性](https://thenewstack.io/why-distributed-testing-is-the-best-way-to-test-microservices/)工具上，即分布式跟踪。

很好，但是基于跟踪的测试对 SREs 有什么帮助呢？

## 第一:它为不同角色带来了更多的价值

实现分布式跟踪被描述为高承诺、高努力、低价值的故事(参见伊恩·史密斯在底特律的 KubeCon 的演讲"[分布式跟踪——斗争是真实的](https://www.youtube.com/watch?v=Q5Vf8bpTDlI)),但是为什么会这样呢？高级用户，通常是 sre，是组织中唯一使用[跟踪工具](https://thenewstack.io/distributed-tracing-is-a-hassle-heres-why/)的人。然而，其他人不得不花费时间在他们的代码中实现跟踪，维护它，等等。与此同时，采用滞后，从未达到多个利益相关者的临界质量，因此实施跟踪主要被视为其成本。

然而，将测试建立在你的痕迹上，会逆转这种趋势。开发人员和 QA 工程师都积极地创建和维护测试，而为分布式系统构建测试是众所周知的困难。基于跟踪的测试是“简单的按钮”，因为它依赖于您的组织通过实现分布式跟踪已经完成的工作。能够在整个组织中利用您的投资来支持测试增加了更多的价值，并且这个价值是由多个利益相关者实现的。

## 第二:基于跟踪的测试导致更好的可观察性

这是给你的，SRE 队。基于跟踪的测试提高了可观察性，帮助您更快地诊断问题并减少平均修复时间(MTTR)。因为开发和 QA 团队依赖于在跟踪中的属性中捕获的业务数据来形成他们的断言，所以当查看跟踪时，您也将“观察”关键的业务数据。好的测试所需的信息通常与调试所需的信息相同，基于跟踪数据的测试确保了跟踪中的数据是丰富的。

## 第三:分布式系统的传统测试被打破了

您希望在代码通过测试在管道中移动时发现问题，但是用于编写端到端测试的传统方法本身就有缺陷。它们很难构建，维护成本也很高，所以许多组织都放弃了。你，SRE，最终在凌晨 3 点用你的观察工具捕捉到了问题

基于跟踪的测试使用现代可观察性技术来实现现代测试。有了它，开发人员和 QA 工程师就有了一个跟踪，作为他们创建测试的基础。它固有地显示了在系统的特定触发中所采用的路径和系统。有了地图，我们都可以更好地导航，而追踪是您在创建基于追踪的测试时所依赖的地图。

## 第 4:基于跟踪的测试可以在 Prod 中运行

您的 CI/CD 流程中使用的同一组测试可以在生产中运行。想要验证生产中的订单是否得到正确处理？通过提供来自生产环境的跟踪，在部署环境中使用您的测试。同一套规则和验证可以应用于生产跟踪，测试结果突出了整个流程中的问题。你也可以在生产中直接运行测试的子集，只要它们是无害的，并且不会最终将玩具发送给随机的客户。

## 第五:这让 SRE 队成为了英雄

谷歌 SRE 工作手册将 SRE 团队的[角色定义为:](https://sre.google/workbook/engagement-model/#:~:text=Simply%20put%2C%20SRE%20principles%20aim,and%20good%20for%20the%20company.)

*“简单地说，SRE 原则旨在最大化开发团队的工程速度，同时保持产品的可靠性。这个双重目标对产品用户和公司都有好处。”*

通过为开发团队提供一种更快地编写大量测试的方法，实现基于跟踪的测试满足了 SRE 任务的原则，提高了测试覆盖率和开发速度。更好的测试会带来更好的可靠性，因为代码正在进入您的生产环境，从而为您的客户带来更可靠的产品。

## 好奇吗？

准备好开始了吗？ [Tracetest](https://tracetest.io/) 是一个开源解决方案，使您能够构建和执行基于跟踪的测试。您不需要更改您的应用程序或任何代码，也不需要更换您的可观察性供应商。该工具有两个集成点:它需要能够触发您的系统，并且它需要能够访问结果跟踪。就是这样！Tracetest 可以安装在 Docker 或 Kubernetes 中；它在您的环境中运行，并立即开始提供价值。

Tracetest 团队可以为您提供帮助。你可以通过[我们的不和谐频道](https://discord.com/channels/884464549347074049/963470167327772703)联系我们，你可以[添加问题](https://github.com/kubeshop/tracetest/issues/new/choose)来帮助指导 GitHub 中的项目进程。如果你喜欢 Tracetest，请在我们的 GitHub [Repo](https://github.com/kubeshop/tracetest) 中给我们一颗星！

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>