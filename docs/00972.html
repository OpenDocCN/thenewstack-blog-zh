<html>
<head>
<title>Off-The-Shelf Hacker: Showtime with a Linux Wearable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现成的黑客:Linux可穿戴设备的展示时间</h1>
<blockquote>原文：<a href="https://thenewstack.io/off-the-shelf-hacker-showtime-with-a-linux-wearable/#0001-01-01">https://thenewstack.io/off-the-shelf-hacker-showtime-with-a-linux-wearable/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">我正在狂热地准备我的蒸汽朋克会议徽章(v5 ),以迎接即将于7月在OSCON举行的技术演讲。<a href="https://conferences.oreilly.com/oscon/oscon-or/public/schedule/detail/67363" class="ext-link" rel="external ">我的演讲</a>涵盖了徽章制作细节、各种功能以及我对设计的思考过程。我会戴着它在会议上走来走去，在演讲前播放一段简短的“Torq博士”宣传片。</p>
<p class="translated">戏剧性的开场白是一种由来已久的开始会话的方式，尤其是当它涉及到硬件的时候。让它令人难忘对于积极的观众体验很重要。</p>
<h2 class="translated">要么做大，要么回家</h2>
<p class="translated">我想出的计划是站在房间的后面，穿着我的蒸汽朋克大礼帽、粗花呢夹克和佩斯利领带，在与会者进来演讲时向他们打招呼。在放映的时候，我会走到房间的前面，从脖子上取下徽章，然后把它插到投影仪上。在快速重启和几句鼓舞人心的话之后，我们将开始我的节目。</p>
<p class="translated">你认为有人会注意到我刚刚佩戴的徽章上的图书馆幻灯片吗？</p>
<p class="translated">经验表明，有很多事情可能会出错，导致我拿着徽章四处摸索，耽误了整个操作。这不是吸引观众的积极方式。</p>
<p class="translated">我决定使用一点自动化魔法，从徽章模式变形到桌面模式，以避免爆发成一个巨大的表象火球。你必须喜欢可穿戴设备上的Linux。</p>
<h2 class="translated">在LCD和HDMI之间切换</h2>
<p class="translated">徽章有一个树莓Pi 2，<a href="https://www.adafruit.com/product/2441" class="ext-link" rel="external ">，一个3.5英寸的彩色液晶触摸屏</a>，一些传感器和一个蒸汽朋克主题的底盘和铭牌。您可以将大屏幕或投影仪插入HDMI连接器。</p>
<p class="translated">我发现在Raspberry Pi上的3.5英寸显示器和HDMI端口之间来回切换的最可靠的方法是在目录之间移动配置文件并重新启动。</p>
<p class="translated">很长一段时间，我使用两个小的命令行脚本来完成这项工作。在查看LCD或HDMI连接的显示器时，我会使用无线键盘键入适当的命令，徽章会以正确的模式重新启动。它的工作原理是将framebuffer配置文件(用于LCD)复制到/etc/X11目录，然后重新启动。LCD的X11目录中没有配置文件，HDMI的X11目录中没有配置文件。</p>
<p class="translated">这里是代码lcd.sh代码。<br/></p>
<div id="crayon-642311b7ce24b783192570" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-e">sudo </span><span class="crayon-i">cp</span><span class="crayon-h"> </span>/<span class="crayon-i">home</span>/<span class="crayon-i">pi</span>/<span class="crayon-cn">99</span>-<span class="crayon-i">fbdev</span><span class="crayon-st">.</span><span class="crayon-i">conf</span><span class="crayon-h"> </span>/<span class="crayon-i">etc</span>/<span class="crayon-i">X11</span>/<span class="crayon-i">xorg</span><span class="crayon-st">.</span><span class="crayon-i">conf</span><span class="crayon-st">.</span><span class="crayon-m">d</span>/
<span class="crayon-e">sudo </span><span class="crayon-i">shutdown</span><span class="crayon-h"> </span>-<span class="crayon-r">r</span><span class="crayon-h"> </span><span class="crayon-v">now</span>
</pre>
</div>
</div>

<p class="translated"><br/>这里是hdmi.sh的代码<br/></p>
<div id="crayon-642311b7ce250689146314" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-e">sudo </span><span class="crayon-i">mv</span><span class="crayon-h"> </span>/<span class="crayon-i">etc</span>/<span class="crayon-i">X11</span>/<span class="crayon-i">xorg</span><span class="crayon-st">.</span><span class="crayon-i">conf</span><span class="crayon-st">.</span><span class="crayon-m">d</span>/<span class="crayon-cn">99</span>-<span class="crayon-i">fbdev</span><span class="crayon-st">.</span><span class="crayon-i">conf</span><span class="crayon-h"> </span>/<span class="crayon-i">home</span>/<span class="crayon-e">pi</span>
<span class="crayon-e">sudo </span><span class="crayon-i">shutdown</span><span class="crayon-h"> </span>-<span class="crayon-r">r</span><span class="crayon-h"> </span><span class="crayon-v">now</span>
</pre>
</div>
</div>

<p class="translated"><br/>它们从命令行运行如下:<br/></p>


<p class="translated"><br/>或<br/></p>


<p class="translated">当然，这种方法也有缺点。你看起来有点傻，带着一个可佩戴的Linux会议徽章，在键盘上走来走去。不仅要无头(没有显示器)，挂在脖子上也要无键盘。</p>
<p class="translated">如果我只想关闭徽章，而手边没有键盘，会发生什么？我们不想通过拔掉插头来破坏Pi上的SD卡。</p>
<p class="translated">不仅如此，使用“-r”，重新启动选项不允许在Linux再次启动备份之前拔下或插入监视器。</p>
<h2 class="translated">一键解决方案</h2>
<p class="translated">一个非常实用的解决方案是使用几个按钮来运行适当的脚本。我们还应该用“-h”选项将其更改为暂停系统，这样我就有机会更换电缆或打包徽章以便运输。</p>
<p class="translated">在当前配置中，Raspberry Pi使用SPI引脚以及GPIO引脚#24和#25来控制LCD屏幕(SCK、MOSI、MISO、CE0、CE1)。我们也可以使用GPIO #18来调暗显示器。这仍然留下20个GPIO引脚供可能的按钮使用。</p>
<p class="translated">我选择GPIO #16和GPIO #20作为关机按钮。按钮通过1K欧姆的电阻器从地连接到每个相应的引脚。我在Pi中使用了内置的上拉电阻，这样就不会因为浮动(随机电压)引脚读数而产生奇怪的行为。</p>
<p class="translated">一旦硬件引脚准备就绪，我就使用Python脚本来检测按钮何时被按下。</p>
<p class="translated">下面是switch-down.py代码。<br/></p>
<div id="crayon-642311b7ce253696874236" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-e">import </span><span class="crayon-i">RPi</span><span class="crayon-st">.</span><span class="crayon-e">GPIO </span><span class="crayon-e">as </span><span class="crayon-e">GPIO</span>
<span class="crayon-e">import </span><span class="crayon-e">time</span>
<span class="crayon-e">import </span><span class="crayon-e">os</span>
 
<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">setmode</span>(<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-i">BCM</span>)
 
<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">setup</span>(<span class="crayon-cn">16</span>,<span class="crayon-h"> </span><span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-i">IN</span>,<span class="crayon-h"> </span><span class="crayon-i">pull_up_down</span>=<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-i">PUD_UP</span>)
<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">setup</span>(<span class="crayon-cn">20</span>,<span class="crayon-h"> </span><span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-i">IN</span>,<span class="crayon-h"> </span><span class="crayon-i">pull_up_down</span>=<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-i">PUD_UP</span>)
 
<span class="crayon-e">while </span><span class="crayon-i">True</span>:
<span class="crayon-h">    </span><span class="crayon-p"># USB side button</span>
<span class="crayon-h">    </span><span class="crayon-i">input_state16</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">input</span>(<span class="crayon-cn">16</span>)
<span class="crayon-h">    </span><span class="crayon-p"># ultrasonic sensor side button</span>
<span class="crayon-h">    </span><span class="crayon-i">input_state20</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">input</span>(<span class="crayon-cn">20</span>)
 
<span class="crayon-h">    </span><span class="crayon-e">if </span><span class="crayon-i">input_state16</span><span class="crayon-h"> </span>==<span class="crayon-h"> </span><span class="crayon-i">True</span>:
<span class="crayon-h">        </span><span class="crayon-e">print</span>(<span class="crayon-s">'Button 16 Pressed'</span>)
<span class="crayon-h">        </span><span class="crayon-i">os</span><span class="crayon-st">.</span><span class="crayon-e">system</span>(<span class="crayon-s">"sudo cp /home/pi/99-fbdev.conf /etc/X11/xorg.conf.d/"</span>)
<span class="crayon-h"> </span><span class="crayon-i">os</span><span class="crayon-st">.</span><span class="crayon-e">system</span>(<span class="crayon-s">"sudo shutdown -h now"</span>)
<span class="crayon-h"> </span><span class="crayon-p"># os.system("./test.sh")</span>
<span class="crayon-h">        </span><span class="crayon-i">time</span><span class="crayon-st">.</span><span class="crayon-e">sleep</span>(<span class="crayon-cn">0.2</span>)
 
<span class="crayon-h">    </span><span class="crayon-e">if </span><span class="crayon-i">input_state20</span><span class="crayon-h"> </span>==<span class="crayon-h"> </span><span class="crayon-i">True</span>:
<span class="crayon-h">        </span><span class="crayon-e">print</span>(<span class="crayon-s">'Button 20 Pressed'</span>)
<span class="crayon-h">        </span><span class="crayon-i">os</span><span class="crayon-st">.</span><span class="crayon-e">system</span>(<span class="crayon-s">"sudo mv /etc/X11/xorg.conf.d/99-fbdev.conf /home/pi"</span>)
<span class="crayon-h">        </span><span class="crayon-i">os</span><span class="crayon-st">.</span><span class="crayon-e">system</span>(<span class="crayon-s">"sudo shutdown -h now"</span>)
<span class="crayon-h">        </span><span class="crayon-i">time</span><span class="crayon-st">.</span><span class="crayon-e">sleep</span>(<span class="crayon-cn">0.2</span>)
 
<span class="crayon-i">GPIO</span><span class="crayon-st">.</span><span class="crayon-e">cleanup</span>()<span class="crayon-h">          </span><span class="crayon-p"># clean up GPIO on CTRL+C exit</span>
</pre>
</div>
</div>

<p class="translated"><br/>为了让方案在重启后自动工作，我在/etc/rc.local文件中添加了Python脚本执行。编辑文件时你必须使用sudo，因为普通用户没有适当的权限。<br/></p>
<div id="crayon-642311b7ce254249954095" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-e">sudo </span><span class="crayon-i">vi</span><span class="crayon-h"> </span>/<span class="crayon-i">etc</span>/<span class="crayon-i">rc</span><span class="crayon-st">.</span><span class="crayon-v">local</span>
</pre>
</div>
</div>

<p class="translated"><br/>这是我的/etc/rc.local文件。<br/></p>
<div id="crayon-642311b7ce255323442639" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-p">#!/bin/sh -e</span>
<span class="crayon-p">#</span>
<span class="crayon-p"># rc.local</span>
<span class="crayon-p">#</span>
<span class="crayon-p"># This script is executed at the end of each multi-user runlevel.</span>
<span class="crayon-p"># Make sure that the script will "exit 0" on success or any other</span>
<span class="crayon-p"># value on error.</span>
<span class="crayon-p">#</span>
<span class="crayon-p"># In order to enable or disable this script just change the execution</span>
<span class="crayon-p"># bits.</span>
<span class="crayon-p">#</span>
<span class="crayon-p"># By default this script does nothing.</span>
 
<span class="crayon-i">python</span><span class="crayon-h"> </span>/<span class="crayon-i">home</span>/<span class="crayon-i">pi</span>/<span class="crayon-i">py</span>-<span class="crayon-i">scripts</span>/<span class="crayon-i">switch</span>-<span class="crayon-i">down</span><span class="crayon-st">.</span><span class="crayon-i">py</span><span class="crayon-h"> </span><span class="crayon-sy">&amp;amp;</span>
 
<span class="crayon-i">exit</span><span class="crayon-h"> </span><span class="crayon-cn">0</span>
</pre>
</div>
</div>

<p class="translated"><br/>在bootup上，switch-down.py Python脚本在后台永远循环，等待两个按钮中的一个被按下。</p>
<p class="translated">现在，当我走到房间前面并按下HDMI按钮时，徽章将切换到桌面模式。我会拔掉电池，插上投影仪，用壁式电源插座通电。</p>
<p class="translated">演示结束后，我将按下LCD按钮，徽章将恢复到“走动”(徽章)模式。我会拔掉墙上的电源插头和投影仪。我会把徽章重新挂在脖子上，用电池组重新供电。</p>
<h2 class="translated">后续步骤</h2>
<p class="translated">我已经测试了几次LCD/HDMI切换过程，效果非常好。当然，程序和时间安排会在彩排中进行微调。</p>
<p class="translated">我认为在徽章模式下重新开机时，在3.5英寸的液晶屏幕上自动播放宣传片视频可能会很好。</p>
<p class="translated">徽章模式界面使用按钮有很多可能性。我们不局限于微型开关。笔和隐形眼镜有用吗？不知道。或者，磁簧开关怎么样。多按钮有线吊坠有意义吗？也许我们可以用它来控制幻灯片。我们可以使用Python脚本甚至处理语言以多种方式感知按钮的按下。</p>
<p class="translated">走出去，在你的下一个可穿戴项目中利用Linux自动化的力量。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>