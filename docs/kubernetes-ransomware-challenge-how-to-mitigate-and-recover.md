# Kubernetes 勒索软件挑战:如何减轻和恢复

> 原文：<https://thenewstack.io/kubernetes-ransomware-challenge-how-to-mitigate-and-recover/>

[](https://www.linkedin.com/in/maziartamadon)

[Maziar tama don](https://www.linkedin.com/in/maziartamadon)

[Maziar 是 Veeam 在 Kasten 的产品和解决方案营销总监。他是一名经验丰富、充满激情的技术专家，拥有超过 25 年的行业经验，在数据中心和云技术方面拥有全面的专业知识，例如存储、网络、计算、虚拟化和安全性。他曾在美国和法国的 Scality、Seagate、Broadcom、Emulex、Brocade 和 Hewlett-Packard 担任产品营销、产品规划和战略、产品管理和工程职位。他拥有法国格勒诺布尔国立理工学院的电气工程和计算机科学硕士学位。](https://www.linkedin.com/in/maziartamadon)

[](https://www.linkedin.com/in/maziartamadon)[](https://www.linkedin.com/in/maziartamadon)

Kubernetes 在容器化环境中的大规模软件交付、部署和管理的自动化方面越来越受欢迎。但许多组织认为勒索软件攻击的威胁是采用它的绊脚石。Red Hat 对 500 多名开发人员、工程和安全专业人员的调查发现，其中 55%的人因为安全问题而推迟了 Kubernetes 应用程序的生产部署。

虽然对安全的担忧可能会推迟 Kubernetes 的推出，但勒索软件的威胁似乎并没有抑制 Kubernetes 的采用。在 Red Hat 的调查中，88%的受访者表示他们的组织使用 Kubernetes 进行容器编排，74%的受访者在生产环境中采用了 Kubernetes。

随着 Kubernetes 部署的不断增加，攻击媒介的数量在理论上也在扩大，这有助于部分解释勒索软件攻击的激增以及对这些环境造成的损害。Kubernetes 集群和一般容器一样，很容易成为试图策划勒索软件攻击的入侵者的切入点，这主要是因为它们的高度分布式性质。随着规模的扩大，部署的微服务数量会导致许多可以利用的相互依赖性。

可以理解的是，勒索软件攻击引起了美国政府的关注，最终导致白宫在 2021 年 6 月发布了一份官方备忘录，敦促公司高管和商业领袖采取具体措施保护他们的资产。7 月，美国国家安全局(NSA)发布了一份针对 Kubernetes 安全的[报告](https://media.defense.gov/2021/Aug/03/2002820425/-1/-1/1/CTR_KUBERNETES%20HARDENING%20GUIDANCE.PDF)。每个都提供了大量关于如何保护 Kubernetes 集群免受勒索软件攻击的信息，并有大量重叠的指导。

白宫的报告明确指出，勒索软件攻击通常是可以预防的。一旦了解了 Kubernetes 勒索软件风险，组织就可以采取具体而合理的措施进行保护。

## 最薄弱的环节

勒索软件攻击者利用的 Kubernetes 环境中的漏洞与其他类型的攻击非常相似。它们通常会导致数据盗窃和破坏、通过云提供商帐户盗窃昂贵的计算资源、非法开采加密货币、拒绝服务攻击(DoS)和其他与安全相关的事件。具体来说，勒索软件涉及攻击者阻止对数据和应用程序的访问(通常通过加密)，并勒索组织支付赎金以恢复访问。

Kubernetes 集群的底层框架在 Kubernetes 组件中有许多攻击入口:

*   Kubernetes API 服务器。
*   用于键值存储的 etcd 服务器客户端。
*   用于节点管理的 Kubelet。
*   一个 kube 调度程序，用于将 pod 分配给节点。
*   kube-控制器-管理器。
*   对于那些依赖云提供商的人来说，这是一个针对云环境的独立 kube 控制器管理器。

虽然实施和管理起来不太复杂，但虚拟机(VM)并没有 Kubernetes 在开发和管理应用程序方面的巨大优势，但它们更容易锁定，因为运行 Linux、Windows 或其他操作系统的 VM 在很大程度上是自我隔离的。它们不共享基础操作系统，而在 Kubernetes 部署中，每个节点中运行的所有容器都共享。

如果 Kubernetes 节点遭到破坏，该节点上的所有 pod 都会受到影响，这可能会使该节点所属的整个集群面临风险。因此，该集群中的所有容器都可以被利用，因为与虚拟机不同，它们共享同一主机的同一内核。

在 Kubernetes 的世界中，每个节点、集群和容器都可以共享一些资源和漏洞，此外还有一个通用的操作系统。只需一个微服务就能在多个容器中引入漏洞。潜伏在集装箱供应链中的潜在攻击媒介与连接集装箱化环境的微服务一样多。

Kubernetes 集群固有的另一个问题是:秘密管理。用于为 API、密码和其他敏感数据提供令牌，secrets 有其自身的漏洞。例如，入口控制器和其他组件被配置为访问整个集群内的秘密。此外，机密在很大程度上是未加密的。虽然确实存在一些加密方案——包括 Kubernetes 提供的加密秘密的选项——但这些替代方案仍在测试中，或者不是 100%安全的。DevOps 团队对在生产环境中使用它们保持谨慎是正确的。

## 潜伏的掠食者

试图利用 Kubernetes 环境中的漏洞的勒索软件攻击者可能会使用自动化工具来扫描漏洞。许多扫描工具可以从暗网上买到，有时甚至通过 Reddit 等公共论坛，只需几百美元。攻击者找到了一种渗透集群的方法，然后等待他们的自动扫描工具发现攻击的角度。

勒索软件攻击者有更多直接获取数据的途径。在该漏洞最近被广泛披露之前的八年多时间里，一个简单的扫描工具可以寻找和发现 MongoDB 数据库的标准端口，这些端口在默认情况下暴露了几年。在此期间，任何 MongoDB 客户管理员(或者伪装成管理员的入侵者)都可以通过未加密的端口对这些 MongoDB 数据库进行读写访问。这意味着一个在 Kubernetes 或容器化环境(例如，Amazon Web Services (AWS ))中部署了 MongoDB 数据库的组织可以通过不需要凭据的命令向外界公开数据库。

## 内部挑战

甚至安全和 IT 人员也可能被网络钓鱼诈骗所迷惑。只要拥有高级网络访问权限的人不经意地点击一个恶意链接，就可以为攻击者提供潜在勒索金的直接链接。潜在的致命目标包括管理员，尤其是那些拥有控制平面 API 访问权限的管理员。

由于管理 Kubernetes 集群需要这些权限，因此很容易受到勒索软件的攻击，例如，诱骗管理员向主机提供对终端的访问。这种访问会危及基础操作系统，从而危及特定的容器或箱。在某些情况下，如果 root 用户访问权限受到保护，攻击者可以获得对 pod 的访问权限，并进一步提升他们的权限以进行 pivotal 攻击。他们可以通过 etcd 服务器客户端访问和控制扩展到本地数据存储或云上的关键数据。通过提升访问权限，攻击者可以进入本地和基于云的数据存储。

Siloscape 是勒索软件攻击者如何获得 Microsoft Windows 容器访问权限的最新例子。使用 Tor 代理和。洋葱域，Siloscape 通过远程代码执行(RCE)利用漏洞。从容器内部，攻击者运行一个二进制程序来访问整个集群。通过这种方式，勒索软件攻击者可以访问群集中存储的任何数据，包括密码和客户信息。在许多情况下，由分布在多云环境中的容器组成的集群可能会引发更大规模的供应链攻击。

## 不变性:勒索软件就绪的黄金标准

有防止 Kubernetes 勒索软件攻击的关键最佳实践和工具。适当的修补和更新以及通过可靠的第三方委托安全管理(更简单的 API 安全管理解决方案已经出现)可以提供针对本文所述攻击的保护。对于集群环境中的基础设施保护，服务网格除了帮助协调集群内服务之间的流量之外，还可以提供边车模型，以通过验证容器的入站和出站流量的相邻代理守护程序来防止勒索软件或其他攻击。

损害控制——限制攻击的横向扩散——可以说是抵御勒索软件攻击的最佳屏障。使用微分段，可以对某些数据和应用程序授予有限的访问权限，而环境的其余部分可能被认为是不安全的，尽管有一致的修补和其他安全最佳实践。这种做法称为零信任，它限制管理员或用户对一系列 API 的访问权限，同时限制对可能包含直接对象存储组件的更敏感和任务关键的数据存储的访问。

备份组件(通常是组织的命脉，包含其运行所需的数据和应用程序)可以受益于不变性:一旦创建，就无法修改。直接对象存储备份中的数据保持只读和加密，因此即使攻击者获得访问权限，数据也不会被攻击者获取，因此可以用于安全地从恢复，从而挫败勒索软件。

如果确实发生了勒索软件攻击，应准备一个可行的备份和恢复系统，在几分钟内恢复数据和应用程序—同样，数据和应用程序保持不变。允许此恢复过程发生的解密密钥在网络外部被锁定，无论是在云中还是在内部，勒索软件攻击者都无法获得它。通过这种方式，Kubernetes 中部署的任何数据都尽可能保持最低特权。在前面描述的 MongoDB 攻击中，攻击者不可能简单地通过 API 控制直接对象存储组件。

不变性提供了免受勒索软件攻击的保护。能够访问 AWS 容器的备份管理员或攻击者将无法删除任何数据。根据组织的要求，可以按设定的时间间隔备份数据。如果需要数据恢复和复制，真正的不变性将允许回滚到不同时间戳的不同备份版本。虽然有抱负的勒索软件攻击者可能能够控制系统的一部分，但一切都将在几分钟内恢复到以前的时间戳，几乎就像组织回到了攻击之前。

## 立即行动

防止 Kubernetes 勒索软件攻击需要了解攻击的性质和涉及 Kubernetes 的安全限制。然而，意识只是第一步；必须实施缓解策略和最佳实践。

*   **不变性**是在 Kubernetes 环境中准备勒索软件攻击的黄金标准。如果没有它，如果您的数据在攻击期间被锁定或删除，您的组织可能会停止运营和/或不得不支付赎金，而且永远无法绝对保证您能够找回您的数据。

*   **直接对象存储不变性**使您的组织能够简单快速地恢复数据、应用和集群，就像攻击从未发生过一样。如果攻击者获得了访问权限并能够删除集群基础架构，组织还应该能够调用灾难恢复，包括将数据和工作负载恢复到全新的集群。组织还应该准备好合适的工具，以便在需要时可以将新集群放置在不同的公共云或位置。

*   **灾难恢复**必须扩展到所有类型的 Kubernetes 部署和用例，包括边缘环境。应该定期将数据快照导出到对象存储中，以便应用了保留的对象不能被访问。遭受攻击后，组织必须能够使用凭据恢复加密数据。作为最后的保护措施，应该定期测试备份及其不变性。

防范勒索软件需要重大的改变和持续的工作，但随着勒索软件攻击的增加，这将是值得的。有一天，如果运营突然停止，并且收到一条消息说要花 1 亿美元才能取回您的客户数据，只需几分钟，您就可以像往常一样恢复业务，而无需向攻击者支付一分钱。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>