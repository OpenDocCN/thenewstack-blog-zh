# 即将推出的 Linux 5.5 内核改进了实时补丁、调度

> 原文：<https://thenewstack.io/upcoming-linux-5-5-kernel-improves-live-patching-scheduling/>

Linux 5.5 内核将于 2020 年初推出，我们开始对这个内核将会给开源平台带来什么有了清晰的认识。虽然您可能找不到任何交易制造者或破坏者的添加，但是这个内核确实有一些非常有趣的特性和改进。

5.4 内核的发布正式拉开了 5.5 合并窗口的序幕，所以在未来几周我们可能会看到更多新的选项登陆。与此同时，让我们来看看我们目前对这个即将发布的版本的了解。

## 实时修补

5.5 内核最大的新特性之一就是实时补丁。这个特性允许修补正在运行的内核，而不需要重新启动。实时补丁成为 Linux 内核的一部分已经有一段时间了，但是，多亏了 SUSE 内核开发者 [Petr Mladek](https://github.com/pmladek) ，5.5 版带来了一个新的系统状态 API。随着 5.5 版本的发布，实时补丁将跟踪系统状态，从而大大改进内核补丁的处理。

这一新的系统状态功能将能够存储必要的数据，使其更善于恢复补丁。系统状态还将能够使用变更 id 和版本信息来定义实时补丁之间的兼容性。这种新系统状态的原因是影子变量和回调可能会出现问题，这样它们可能会改变系统行为和/或状态，从而不再可能使用旧的实时补丁或原始内核代码。

根据 Mladek 的说法，实时补丁兼容性的规则是:

*   允许任何全新的系统状态修改。
*   对于已经修改的系统状态，允许使用相同或更高版本的系统状态修改。
*   累积的实时补丁必须处理已安装的实时补丁的所有系统状态修改。
*   允许非累积的实时补丁接触已经修改的系统状态。

以下是 5.5 内核的一些其他新特性:

### 并行 CPU 微码更新

这一特性应该会让云提供商满意，他们一直希望找到并行应用的最新 CPU 微码更新，以减少具有众多内核的系统的停机时间。由于 Spectre 漏洞，这个特性已经从 Linux 内核中删除，转而支持顺序 CPU 微码更新。

借助新的并行 CPU 微码更新，该过程被并发处理(只要每个内核的第一个线程被更新，而同级线程等待更新完成)。虽然早期加载仍将存在，但那些使用云服务器的人将希望利用这一回归的特性，因为他们希望不惜一切代价避免重启(因为当*他们*重启，*每个人*重启)。

### 完全公平的调度返工

完全公平的调度程序负载平衡逻辑已经重写。这种重组的原因是发现使用当前算法的任务布局不佳。根据 Red Hat 的内核工程师 Ingo Molnar 的说法:

“… *它用一种自上而下的负载平衡算法取代了引入毛皮指标后变得不那么有意义的旧试探法。因此，这并不是一个真正的迭代系列，而是用新的负载平衡逻辑替换了旧的负载平衡逻辑。我们希望不会出现性能倒退，但从统计数据来看，很有可能会有一些工作负载受到这些变化的影响。”*

测试发现:

*   使用双四核 ARM64 系统的性能提升从 1%到 10%不等(使用 Hackbench)。
*   使用 224 核 ARM64 服务器，使用 Hackbench 时性能提升 1%至 12%，使用 Dbench 时性能提升高达 33%。

### 支持 Coreboot 的笔记本电脑的 System76 ACPI 驱动程序

系统建造商 [System76](https://system76.com/) 将 Coreboot 引入其两款笔记本电脑( [Galago Pro](https://system76.com/laptops/galago) 和 [Darter Pro](https://system76.com/laptops/darter) )。Coreboot 是大多数计算机中专有 BIOS 的开源替代品。这些笔记本电脑需要一个新的 ACPI 驱动程序，而 kernel 5.5 将最终提供这个驱动程序。这个新的 ACPI 驱动程序将支持 Fn 和 Fx 键控制、键盘背光控制、飞行模式 led 等功能。

### 新 WFX Wi-Fi 驱动

用于硅实验室 WF200 ASIC 收发器的新 WFX Wi-Fi 驱动程序即将进入 Linux 内核 5.5。这款特殊的无线收发器面向低功耗物联网设备，使用 2.4 GHz 802.11b/g/n 无线电，针对拥挤的射频环境中的低功耗射频性能进行了优化。这款新驱动器可以通过串行外设接口(SPI)和安全数字输入输出(SDIO)进行接口。

### HVMe 驱动温度支持

在内核 5.5 之前，Linux 内核只通过 *nvme* 实用程序(必须以 root 用户身份运行)来支持对非易失性快速内存(NVMe)驱动器温度的监控。随着内核 5.5 的发布，由于 HWMON 基础设施，将内置对 NVMe 温度报告的支持。虽然 NVME_HWMON Kconfig 开关是可选的，但是大多数 Linux 发行版都支持它。

### KVM 虚拟化改进

内核虚拟机(KVM)实现将在 5.5 内核中看到许多改进。这些改进包括:

*   XSAVES 对 AMD 处理器的支持。
*   针对 Spectre 缓解偏移的重新极化优化。
*   嵌套的五级页表支持(这将允许访问更多的系统内存)。
*   PMU 虚拟化优化。
*   IOAPIC 优化。
*   ARM 的数据中止报告和注入。
*   TSX_CTRL 虚拟化让 TAA 更加幸福。
*   改进了服务器的分配和刷新。

Linux 基金会和 Red Hat 是新堆栈的赞助商。

图片由黛博拉·布林·怀汀拍摄

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>