# 服务网格为 Kubernetes 增加了安全性、可观察性和流量控制

> 原文：<https://thenewstack.io/service-mesh-adds-security-observability-and-traffic-control-to-kubernetes/>

本周和下周，News Stack 将发布一系列关于服务网格给 Kubernetes 部署带来的价值的帖子。这是第一部分。请经常回来查看更多更新。

当我们探索补充 Kubernetes 的所有工具和附加基础设施层时，重要的是要记住:这并不意味着 Kubernetes 缺乏。Kubernetes 是一个强大的工具，可以极大地简化容器化应用程序的运行，但是有很多事情它从来没有打算去做。服务网格是基础设施补充部分的一个例子，处理 Kubernetes 不能也从未打算做的事情。

“谷歌的 Kubernetes 团队和谷歌的 Istio 团队是邻居，他们正在讨论这些事情，” [Tetrate](https://www.tetrate.io/) 的首席执行官 [Varun Talwar](https://www.linkedin.com/in/varuntalwar/) 解释道，他也是 [Istio 服务网](https://istio.io/)的创始人之一。

“服务网格可以做一系列事情，但这并不是因为 Kubernetes 很烂，”为开源服务网格 Linkerd 提供商业支持的[浮力](https://buoyant.io/)的首席执行官[威廉·摩根](https://www.linkedin.com/in/wmorgan/)解释道。“这是因为 Kubernetes 真的很好，但它有一个明确的范围。”

服务网格通常由附属于应用程序中所有 pod 的 sidecar 代理组成，管理服务之间的通信——因此得名。服务网格是一种处理 Kubernetes 角色之外的功能的方式——特别是安全性、可观察性和路由。还有其他方法可以实现所有这些目标——通常是在代码和/或库中。这两种技术都适用于较小的组织，但是对于需要集中控制的组织来说，服务网格是一种确保内部治理策略由集中平台团队执行的方式。"真正的问题是你的系统有多复杂？" [Solo.io](https://www.solo.io/) 的 CEO[艾迪·莱文](https://www.linkedin.com/in/iditlevine/)说道。如果它小而简单，服务网格就没有必要了。如果它很大很复杂，那就很重要。

事实上， [Envoy 数据平面](https://www.envoyproxy.io/)的创建者 [Matt Klein](https://www.linkedin.com/in/mattklein123/) 会鼓励组织只在真正需要时才使用服务网格。“简单总是更好，”他说。“然而，如果一个组织已经决定继续采用微服务架构，那么服务网格可以解决许多关于可观察性和联网的挑战。”

下面是服务网格如何通过使用带有 Kubernetes 的服务网格来帮助组织获得更好的安全性、可观察性和对路由/负载平衡的控制。

## 安全性

安全性不在 Kubernetes 的范围之内，默认配置会使组织容易受到攻击。单个应用程序开发人员可以通过代码和手动管理配置来控制诸如加密和访问控制之类的事情，但是这种相对特别的方法使组织容易出错。

有了服务网格，就有可能确保加密和粒度访问控制规则在组织范围内以一种可以集中控制的方式得到实施。

“我们在 Kubernetes 上的不足之处是实际的网络方面，确保所有这些东西都可以通过非常复杂的政策和安全程序快速地相互通信，”专注于安全的服务网络 [greymatter.io](http://greymatter.io) 背后的[解密技术工作室](https://deciphernow.com/grey-matter)的首席技术官 [Jonathan Holmes](https://www.linkedin.com/in/jonathan-holmes-3213b32/) 解释道。因为虽然公司需要将安全性纳入其中，但它必须以一种与分布式、短暂的体系结构协同工作的方式进行，最好不要减慢开发或部署过程。

服务网格使得控制和加密东西向流量或集群内服务之间的流量成为可能。一个 API 网关，一个经常被比作技术服务网格的网关，只控制南北流量。控制东西向和南北向流量的能力比只控制其中一个流量创造了更好的安全态势。

“大约 60%的客户会说他们使用服务网格的主要原因是安全，”Levine 说。"另外的 40%会说是可观察性."

## 可观察性

Talwar 解释说:“默认情况下，Kubernetes 会向您提供 pod 的健康状况以及 pod 和节点的 CPU 内存利用率，这有利于基础设施人员了解这些信息。“是的，Kubernetes 已成功安装，并且没有消耗太多资源。但它并没有告诉客户谁部署了他们的应用程序，情况如何？这是他们寻求的首要目标。”

服务网格是一种更好地了解应用程序级别上发生的事情的方式。“当一个请求到达你的集群时，你并不知道发生了什么，”Levine 说。“每一次爆发都是一个谋杀悬疑系列。人们不知道从哪里开始寻找问题所在。”

Kubernetes 本身将提供对第三层和第四层的可见性，但服务网格带来了对应用层的可见性，因此组织不仅可以获得关于 Kubernetes 健康状况的信息，还可以获得关于每个服务和整个应用程序健康状况的信息。

## 按指定路线发送

安全性和可观察性可能是组织实现服务网格的最常见原因，但它也有助于控制负载平衡和路由。Vanilla Kubernetes 入口控制器将管理 L3 和 L4 负载平衡，但在没有服务网格的情况下，管理第七层路由和负载平衡的责任将由应用程序开发人员承担。

像可观察性和安全性一样，可以将路由信息打包到代码中，但是服务网格将它从服务中取出，并使集中管理和组织治理策略成为可能。

服务网格使得对安全性、可观察性或路由规则进行舰队级的改变成为可能。由边车代理控制的任何东西都可以很容易地由一个中心团队为成千上万的服务进行更改，而如果路由、安全性和可见性是用代码控制的，那么相同的更改基本上不可能以相同的规模进行。单靠 Kubernetes 是无法在整个舰队范围内做出这些改变的。

另一件要记住的事情是，Kubernetes 本质上使服务网格成为可能。Kubernetes 使得部署服务网格所依赖的 sidecar 代理变得非常容易。“我们可以在过去的厨师和木偶时代这样做，”摩根解释说。“我们可以说，‘我要部署 10，000 个代理。’但这太疯狂了。有了 Kubernetes，你只需简单地说，嘿，把这个边车放在每个豆荚旁边。"

来自 Pixabay 的 mikegi 的特写图片。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>