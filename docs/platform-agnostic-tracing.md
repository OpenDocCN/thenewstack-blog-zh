# 平台无关的跟踪

> 原文：<https://thenewstack.io/platform-agnostic-tracing/>

[桑德拉](https://www.thundra.io/)赞助了这篇文章。

 [埃姆拉·萨姆丹

艾姆拉是桑德拉公司的产品副总裁。他热衷于无服务器、可观测性和混沌工程。](https://www.linkedin.com/in/emrahsamdan/) 

经典力学的三个基本定律之一是牛顿第一定律，该定律认为，除非受到力的作用，否则物体将保持静止或继续匀速运动。

我们生活在一个不完美的世界里，在这个世界里，没有任何东西是运动的，也没有任何东西是静止的。大自然充满了各种力量，有时会违背我们的意愿。作为工程师，我们还没有找到让应用程序永远无故障运行的魔法。

相反，我们学会了构建可观察的应用程序，因为我们知道坏事迟早会发生。当它发生时，我们必须知道“是什么”和“为什么”,以便快速恢复。在分布式系统中，浏览日志可能会令人望而生畏。同样，度量也有局限性。它们可以显示出有问题，但是祝你好运找到“什么”和“哪里”这就是跟踪的用武之地。

跟踪是一种在请求传输多个服务时将请求缝合在一起的方法。它帮助您观察分布式系统，查明次优性能和故障的原因。

微服务应用程序由相互连接的系统、服务或功能组成，它们协同工作以满足请求。例如，微服务应用程序可能包括订单服务、购物车服务、支付服务和目录服务。每个服务都被一个网络边界隔离开来，这些服务可以在不同的平台上托管。微服务的分布式本质使得有必要有一种方法来跟踪请求如何通过您的整个服务生态系统。

跟踪整合数据以定位故障、关联错误报告、识别单个服务中的问题如何影响其他服务，并提供对影响应用程序整体性能的服务的洞察。

## 痕迹的结构

从根本上来说，跟踪从单个请求开始，代表了请求在分布式系统的所有服务中传递的整个过程。每个轨迹由一系列标记的时间间隔或跨度组成。

您可以将跨度视为分布式跟踪的基本元素，表示分布式系统中单个服务完成的工作单元。span 可以有唯一的 ID、时间戳、名称和元数据。span 还可能包含日志——以键值对的形式，这对于捕获特定于 span 的信息或调试输出以及记录消息非常有用。

一个跟踪覆盖几个跨度或段，当请求通过每个服务时，您可以从应用程序的流程和组件中访问上下文数据。这些数据有助于您分析和监控微服务架构，定位问题和故障，并诊断性能问题。

## 什么是平台无关的跟踪？

“平台不可知”的概念指的是一套工具或软件的设计理念和属性。当软件是平台无关的时，它就不依赖于特定的平台或系统。平台无关的云工具能够在多个平台上以相同的方式运行。它不在乎你的应用是运行在 AWS、GCP 还是 Azure 云平台上。它以相同的方式运行，与云提供商或您使用的语言无关。

构建跨越一个平台(web、移动或桌面)的应用程序需要一种工具适用于所有的跟踪。与平台无关的跟踪使您能够从头到尾有效地分析和监控单个请求，而无需关注“在哪里”或“做什么”

## 为什么跟踪应该是平台无关的？

您可能想知道为什么跟踪必须与您使用的平台无关。以下是您应该拥有一个对您的架构不敏感的跟踪工具的几个原因。

### 从模块化单片到微服务架构的转变

你可能从一个单一的架构开始，但是它会随着你的成长而发展，并且你会到达分解这个怪物是唯一选择的地步。您将添加更多系统或服务。复杂性会增加。许多在进程内通信的模块或服务将被隔离，独立运行，并跨网络同步或异步交互。

随着您的体系结构的发展和变得更加多样化，您的跟踪工具应该对您内部的体系结构变化视而不见，并且应该增强您的敏捷性而不会束缚您。与平台无关的工具不会将您限制在特定的平台或语言上。

### 现代应用程序越来越复杂

云平台彻底改变了应用程序的开发、交付和操作方式，但也带来了不同的问题。将单一应用程序重构为微服务或无服务器架构会增加风险。相互作用的系统数量越多，一个组件出现故障的可能性就越大，你的担忧也就越多。

您的开发团队已经有足够多的复杂性需要担心。追踪不应该是其中之一。与平台无关的跟踪允许团队集成并专注于重要的事情，而不管平台或服务的性质。

### 调试成本

在微服务应用程序中完成单个终端用户请求的工作分散在多个服务中，这些服务可以在各种平台上托管，并以各种语言和框架实现。当每个服务实现或使用不同的适合平台或编写语言的跟踪工具时，调试变得更加困难，成本效益也更低。平台无关的跟踪为您节省了跨不同平台和工具集成和整理跟踪的成本。

### 工具太多

应用程序开发涉及到大量的工具，工程师们已经有太多的工具了。工程师用来完成工作的工具越少，他们的工作效率就越高。在几个跟踪工具之间切换以解决问题，或者查找和分析最重要的数据，需要花费大量时间，而工程师不想浪费时间。

## 平台无关的跟踪工具

有几个免费的开源跟踪工具可以用来分析和监控微服务应用程序。每个工具的核心是为各种平台和编程语言提供 API 的库。

下面是一些常见的平台无关的跟踪工具:

### 贼鸥

[Jaeger](https://www.jaegertracing.io/) 允许您对复杂的微服务环境进行故障排除和监控。它使您能够快速检查微服务中发生的整个动作或事件链。

Jaeger 是由优步技术公司在 2015 年作为开源项目创建的，然后在 2017 年捐赠给 CNCF。Jaeger 是用 Go 编写的，它提供了一些功能，让您可以优化延迟和性能，监控分布式事务，并执行根本原因分析、服务依赖关系分析和分布式上下文传播。

### OpenTracing

[OpenTracing](https://opentracing.io/) 允许您跨不同的服务和组件分析和监控应用程序。

OpenTracing 的一个好处是，您可以跨各种库和工具应用它。OpenTracing API 还支持不同的编程语言——包括 JavaScript、Go、C#、C++、Objective-C、PHP、Ruby、Python 和 Java。

OpenTracing 开源项目由[云本地计算基金会](https://www.cncf.io/) (CNCF)创建。在其核心，OpenTracing 旨在标准化分布式跟踪和检测的方法。

### 桑德拉

目前，桑德拉是众所周知的无服务器和容器化应用程序中的跟踪，但它将在未来几个月内变得完全平台无关。

桑德拉的跟踪解决方案通过提供运行时工具库使自动生成跟踪成为可能。然而，没有任何自动跟踪工具能够知道分布式应用程序的内部细节。这就是为什么桑德拉也提供了一个手动工具 SDK，与 OpenTracing 标准兼容，让用户[注入他们自己的跨度](https://blog.thundra.io/fine-grain-tracing-with-thundra)以及自动跨度。

从 IT 运营到 SRE，从开发人员到软件开发人员，应用程序团队都依赖该工具来运行快速调试和故障排除，通过快速查明分布式体系结构中的错误和/或性能瓶颈来缩短解决问题的平均时间。

### 齐普金

Zipkin 提供了存储、发送、接收和可视化跟踪的机制。

Zipkin 有一个[简单的架构](https://github.com/openzipkin/zipkin)，它是最早的追踪系统之一。它由 Twitter 开发，用 Java 编写。它支持大多数编程语言，具有本机 OpenTracing 扩展点或对多种编程语言跟踪功能的工具支持，包括 Go、Scala、Python、Javascript、Java、C#、C++、C 等等。该工具还支持主要的云提供商:Google Cloud、Azure 和 AWS。

Zipkin 有一个[开源社区](https://github.com/openzipkin/)，在那里你总能找到关于新数据格式、库和 API 的出版物。Zipkin 也有一个客户端-服务器架构，使用 Thrift 作为其通信协议，并支持 Elasticsearch 和 Cassandra 作为存储跟踪数据的后端。

## 不要被束缚住

如果您不能有效地将应用程序的组件检测为可观察的，您将很难在生产中调试问题。在您寻求可观察性的过程中，您应该避免被主要为支持单一平台而构建的跟踪工具所束缚。

如果你担心处理开源解决方案的采用和管理，你可以用像桑德拉这样的管理工具开始你的追踪之旅。这将使您熟悉一些核心概念——比如跨度、跟踪和执行上下文——以及桑德拉控制台上自动生成的跟踪。桑德拉很灵活，并为手动跟踪留出了空间，与 OpenTracing 标准兼容。

亚马逊网络服务和云本地计算基金会是新堆栈的赞助商。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>