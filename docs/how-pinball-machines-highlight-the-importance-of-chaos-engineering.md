# 弹球机如何凸显混沌工程的重要性

> 原文：<https://thenewstack.io/how-pinball-machines-highlight-the-importance-of-chaos-engineering/>

[Gremlin](https://www.gremlin.com/) 赞助本帖。

 [马修·赫尔姆克

Matthew Helmke 是 Gremlin 的技术作家，现在是 Grafana Labs 的高级技术内容开发人员。自从 1981 年买了第一台电脑，他就一直坐在键盘前，自从 1985 年在 VAX 上学习 LISP 语言，他就喜欢用大型电脑做事情。他写过关于 Linux、VMware 和其他主题的书。马修总是喜欢那些没有人注意到某件事情已经失败的时刻，因为缓解方案按照设计的那样工作。](https://www.linkedin.com/in/matthewhelmke/) 

现代计算系统是复杂的，并且处于不断变化的状态，这是采用云原生技术和分布式系统设计的直接结果。这些技术和设计可以节省资金，并可以通过自动响应变化的系统条件来增加弹性，但代价是有时难以预测的失败可能性。Gartner 最近发布的题为 [*混沌工程*](https://www.gartner.com/document/3981050) 的创新洞察力的报告强调了这一点，首先将今天的系统比作弹球机。从这里开始，报告进入实施和使用的实际方面，以便有效地识别系统故障模式，帮助您提高可靠性。

我们知道，并不是每个人都可以访问 Gartner research。我们被允许从弹球类比开始提取关键的引用，这有助于澄清关于混沌工程和可靠性的概念(整篇文章中所有用*斜体*表示的文字都直接取自报告)。

## 混沌工程和可预测性

自 19 世纪以来，弹球机就存在了，最初是高度机械化的游戏，后来是投币式的，到了 20 世纪 30 年代，游戏变得电气化了。弹球游戏本身通常有一个英雄角色或主题，并且通常在游戏板上有目标或得分区域，以跟随角色的动机。这一切听起来很简单，但当你连续玩两个游戏时，你永远不会有完全相同的体验。这样，我们可以很容易地把弹球机看作一个复杂的确定性混沌系统。

为什么我们期望拥有所有权和复杂性远远超过怀旧游戏的数字系统能提供如此一致的体验？我们正在处理确定性的(图表化的和文档化的)和混乱的(不可预测的)系统，并且我们需要测试它们。协作和团队精神将是这一努力成功的关键。很可能开发团队和运营团队都无法完全理解代码构造、应用程序和系统依赖性、弹性架构、监控和自动化补救技术。这些都是制定攻击计划时需要考虑的输入和参数。

混沌工程是必要的，因为现代系统是混乱和不可预测的。随着服务和节点根据系统负载出现和消失，我们永远无法准确地陈述我们的架构包含什么。我们可以猜测和近似，但不能肯定地陈述。

弹球类比是可行的，因为你永远不会玩两次完全相同的游戏。你可以学习如何更有效地使用脚蹼，瞄准你的投篮和得分奖金，但即使是优秀的弹球运动员也不会保证。有时球会在鳍状肢之间滑动，有时整个机器会亮起来并发出奇妙的声音，即使你认为你的行为完全相同。

同样，与上周、昨天甚至几分钟前相比，我们的系统从来没有处于完全相同的状态。对于两个不同的用户，数据可能会经过不同的路径，因为负载平衡器将他们的请求发送到不同的处理节点。在这种混乱的环境中，我们怎么可能测试我们的系统呢？传统的单元测试对我们没有帮助。压力测试甚至好的集成测试也是如此。

我们只能通过使用混沌工程来发现我们的系统是如何工作的，混沌工程可以安全地重现故障模式条件，这样我们就可以观察系统是如何响应的。这防止了我们需要通过自发的故障意外地学习这些教训，这些故障往往会级联成更大的问题，如停机。例如，要了解系统将如何响应每秒接收的请求数高于平时的数据库，或者负载平衡器将如何响应由于 CPU 负载过大而突然停止通信的计算节点，我们的最佳选择是使用混沌工程进行模拟。

用混沌工程测试你的系统是你如何发现你的自我修复、自动伸缩设计是否如预期的那样减轻预期的问题。这也是你如何找到你没有预料到的故障模式，以便你可以使你的系统对那些以前未知的问题有弹性。这就是我们建立可靠性的方式。

## 混沌工程需要专注

*让你的团队专注于理解用户的旅程、他们的体验和停机驱动因素，以提高系统可靠性并最大限度地减少摩擦。*

*为您的团队提供时间和资源支持，通过在您的预生产环境中主动安全地参与混沌工程并采用测试优先的方法来评估您系统的弹性和可靠性。*

*通过识别对故障至关重要的组件和系统、攻击和改进其安全机制来实现容错。*

混沌工程在系统化使用时效果最好。我们的意思是测试和混沌实验是以一种系统的方式进行的。它本身并不混乱，而是试图控制由系统混乱和持续变化导致的故障模式。

我们从思考我们的系统开始。已知的弱点在哪里？系统的哪些部分导致了最多的面向用户的问题？我们能做些什么让我们的客户对我们的系统更满意？我们如何一个接一个地专注于这些问题，并设计实验来帮助我们准确地发现哪里出了问题，但又不会导致真正的问题？

我们所做的是设计具有有限爆炸半径的实验，有意识地限制我们的系统的哪些部分会受到我们将要执行的故障注入测试的影响。我们还限制我们将要导致的失败的程度，将其保持在我们认为对我们有益的水平，但低于我们认为会导致整个系统出现任何问题的水平。

随着我们获得经验，了解我们的系统，修复和缓解问题，并实现以可靠性为中心的功能，我们可以将测试范围扩大到最初的爆炸半径和强度之外，了解我们的系统。

设计并相信我们有适当的系统安全性和可靠性已经不够了。我们必须测试一下才能确定。当我们确认像自动伸缩这样的东西运行良好时，我们会经常意外地发现问题和故障模式。这种额外的好处使得混沌工程更有价值，因为我们可以减少或防止我们从未预料或预期的失败。这就是我们创建容错的方式。

## 实施混沌工程时，社会因素很重要

*重要的是要认识到实践是一个社会工程，以及可靠性工程。您是否质疑团队中的知识孤岛，或者您的系统文档的范围或充分性？可以利用混沌工程来利用这些问题，或者把这些问题放在过去，或者建立能够满足未来学习和知识需求的计划。从这个角度来看，混沌工程致力于在团队、知识和系统中建立信任。*

混沌工程作为社会工程和可靠性工程的一个方面的想法是可靠的。实践的良好实施将有助于发现事件操作手册或行动手册中的漏洞，发现团队中的哪些人知道尚未记录并可能导致单点故障的事情，并随着知识的传播和吸收建立跨团队和团队内的信任。正如 Target 的 IT 弹性工程支持总监 Lenny Sharpe 所解释的那样，“使用 Gremlin 进行混沌工程帮助我们打破了知识垄断，验证了我们的操作手册，极大地改善了我们的事件响应时间和生产环境。”

当每个人都更多地了解系统如何工作以及出现问题时首先检查什么时，每个人都会受益。当他们刚刚开始工作时，给一个新的初级员工一个寻呼机并告诉他们他们在接下来的 24 小时内随叫随到是远远不够的。混沌工程可以帮助你测试你的操作手册，并且是训练新人的好方法。

让一个有经验的工程师将类似于过去发生过的类型的故障注入系统，并让你的初级工程师使用操作手册来学习如何修复该故障，这是在增强系统理解的同时建立肌肉记忆的好方法。像这样的事件被称为[消防演习](https://www.gremlin.com/blog/ensuring-runbooks-are-up-to-date/#use-firedrills)，因为它们教会我们在紧急情况下保持冷静，并以智慧和效率采取行动。

同样，运行一个[游戏日](https://www.gremlin.com/community/tutorials/introduction-to-gamedays/)有助于我们建立对我们系统的信心，因为我们使用模拟过去事件的故障模式进行戳戳和测试——特别是我们认为已经修复并且不应该再发生的问题。我们不能确定我们的缓解方案是有效的，直到我们对它们进行测试，看看系统现在是否在导致它失败的相同条件下是可靠的。

## 信任是混沌工程成功的关键

*信任仍然是采用混沌工程的最大因素，它是构建的现有基础，也是公司文化的基石。这始于一个混沌工程供应商，他不仅提供了一个工具，还帮助美国航空公司在实践中建立了信任。他们选择的供应商在现场接受培训，当时他们运行了第一次 chaos 攻击，也是他们的一个灾难恢复(DR)日(IT 领导层将这一天的所有工作专门用于 DR 改进)。他们的供应商关系已经不仅仅是购买工具，而是帮助建立专业知识。*

无论您使用 Gremlin 还是其他混沌工程解决方案，重要的是您不仅获得了一个伟大的工具，而且获得了伟大的服务。混沌工程是一种实践，也是一门学科，如果你还没有建立起良好的习惯和肌肉记忆，出去打破生产中的东西并不是最好的主意。

在 2017 年推出后，我们很快意识到我们需要提供更多的指导，这促使我们[建立一个社区](https://www.gremlin.com/community/)，提供专业知识作为我们产品的一部分，并在我们的产品中构建更多的模板(例如[场景](https://www.gremlin.com/blog/introducing-scenarios/))。

Gremlin 工具有一个清晰的 [web UI](https://www.gremlin.com/product/) ，一个有用的 CLI，和一个强大的 [API](https://www.gremlin.com/community/tutorials/getting-started-with-gremlins-api/) 。您可以在系统中的一个节点或多个节点上运行实验。当你从各种可能的故障注入[攻击](https://www.gremlin.com/docs/infrastructure-layer/attacks/)中进行选择时，你可以很容易地限制爆炸半径。所有这些都与使用一个红色大暂停按钮或 API 调用立即停止任何实验的能力相结合，使得在出现比预期更大的问题时安全而容易地回滚测试。我们还宣布了[状态检查](https://www.gremlin.com/blog/announcing-status-checks-to-ensure-safe-chaos-engineering-scenarios/)，这将自动确保您的系统健康并准备好进行实验——我们相信这些功能有助于建立我们用户的信任。

最后，我们有一些创始人已经从事混沌工程超过十年，他们来自网飞和亚马逊等地。我们从谷歌、Dropbox 和优步等公司聘请了 SREs 和混沌工程师。我们致力于与我们的客户一起进行[游戏日](https://www.gremlin.com/community/tutorials/how-to-run-a-gameday/)和[消防演习](https://www.gremlin.com/blog/prepare-your-team-to-handle-incidents-remotely/)，以确保他们不仅有合适的工具来完成工作，还有合适的专业知识！

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>