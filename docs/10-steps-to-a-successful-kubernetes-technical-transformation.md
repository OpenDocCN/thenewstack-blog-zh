# 成功实现 Kubernetes 技术转型的 10 个步骤

> 原文：<https://thenewstack.io/10-steps-to-a-successful-kubernetes-technical-transformation/>

今年早些时候，Fairwinds 发布了 [Kubernetes 成熟度模型](https://www.fairwinds.com/kubernetes-maturity-model)来帮助人们确定他们在 Kubernetes 成熟度方面取得的进展。这种模式有助于处于 Kubernetes 采用水平的各个组织了解他们的现状和未来，从考虑是否采用 Kubernetes 一直到成熟环境的持续优化。

## Kubernetes 成熟度模型的阶段

 [安迪·苏德曼

安迪是 Fairwinds 的 R&D 和技术总监。](https://www.linkedin.com/in/sudermanjr/) 

Kubernetes 成熟度模型的第一阶段实际上[关注 K8s 采用的技术转化](https://www.fairwinds.com/kubernetes-maturity-model/phase-2-transform)部分。在这一阶段，您将开始您的初始实现，并专注于将工作负载转移到 Kubernetes。如果您的应用程序还没有在容器中运行，您也可以将它们容器化。

要成功完成这一技术转型，您需要采取 10 个主要步骤。请记住，下面概述的基本步骤是对每个步骤的高度概括，该流程中的每个步骤都需要大量时间。

## 10 个步骤

### 1.深入了解您的技术堆栈

无论您是在本地、数据中心还是云中部署，都要确保研究堆栈的所有方面。例如，当您迁移到 Kubernetes 时，是否需要考虑与您的配置、安全工具或应用程序相关的任何依赖性？

这一步对于确定您的技术需求并确保您不会遗漏任何东西至关重要。它还可以帮助您制定一个项目计划，作为迁移的路线图。

### 2.容器化应用

您可能已经将您的应用程序容器化了；如果是，请跳到下一步。如果不是，是时候根据 [12 因素应用方法论](https://12factor.net/)来分解你的应用了。仔细研究这种方法非常重要，因为您需要确保您的应用程序能够经受住破坏。(别忘了你的容器随时都有可能被干掉)。您还需要能够干净地备份您的应用程序和容器。作为这一步的一部分，您应该从您的构建工件中提取您的秘密和配置。

Kubernetes 是短暂的，所以提取秘密和配置将帮助您维护您的标准和安全性，然后在容器运行时注入它们。

### 3.构建云基础架构

如果你还没有在云中运行，是时候选择你的云提供商了。亚马逊网络服务(AWS)、谷歌云平台(GCP)和微软 Azure 都是众所周知、声誉良好的选择。此外，您可以选择这些提供商之一的托管 Kubernetes 服务，如亚马逊弹性 Kubernetes 服务(亚马逊 EKS)、谷歌 Kubernetes 引擎(GKE)或 Azure Kubernetes 服务(AKS)。

如果您决定使用托管的 Kubernetes 服务，它将减少您在构建 Kubernetes 基础设施时需要做的工作量。您还需要设置底层云配置、虚拟私有云(VPC)、安全组、身份验证、授权等等。

### 4.建设 Kubernetes 基础设施

为了避免做出导致耗时的集群重建或重大网络和成本影响的选择，您需要考虑:

*   您需要多少个集群？哪些地区需要它们？您需要多少个可用性区域(az)？
*   需要多少独立的环境、集群和名称空间？
*   服务将如何相互通信或发现彼此？
*   如何在 VPC、集群或单元级别处理安全性？

基于重复性考虑做出这些决定。使用基础设施即代码(IaC)来构建集群，这样您就可以一次又一次地这样做。另外，要注意您的配置选项，并使用您在步骤 1 中深入研究的基础上建立的项目计划。这将有助于确保您不会错过任何应用程序需求。

### 5.写 YAML 或舵图

现在是定义 Kubernetes 对象并将它们部署到集群中的时候了。您可以编写 Kubernetes YAML 文件，但是许多人更喜欢使用掌舵图来将应用程序部署到 Kubernetes 中。您需要为您的部署、配置图、机密和任何特殊的应用要求编写 YAML 或舵图。

### 6.探测外部云依赖关系

您的应用程序可能有外部依赖项，包括数据库、对象存储等等。让这些依赖者住在 Kubernetes 不是一个好主意。相反，应该在 Kubernetes 之外管理有状态依赖。

例如，在 Amazon 关系数据库服务(Amazon RDS)中建立数据库，然后将其接入 Kubernetes。然后，您的应用程序可以在 Kubernetes 的 pod 中运行，并与这些有状态依赖项进行对话。

### 7.定义 Git 工作流

Kubernetes 的一个主要优点是，它允许您在没有人工干预的情况下以可重复的方式部署代码。在常见的工作流中，通常通过 Git 将源代码提交给存储库，Git 启动事件并与分支合并，分支将这些更改移动到非生产集群。接下来，测试和 QA 您的代码，并将其合并到主分支。这会将您的代码部署到登台或生产环境中。在这个阶段，您将定义您的 Git 工作流是什么样子，因此您知道当开发人员推送代码时 Kubernetes 中会发生什么。

### 8.构建您的 CI/CD 渠道

在定义了 Git 工作流之后，是时候使用诸如 Jenkins 或 CircleCI 之类的自动化工具来设置您的持续集成和持续交付(CI/CD)平台了。这将您定义的工作流转换成实际的构建管道。

### 9.在非生产环境中部署和测试

完成步骤 1-8 后，您将部署到非生产环境中。在这里，您需要测试应用程序是否运行，是否有足够的资源和限制，密码是否正确配置，应用程序是否可访问，如果您关闭 pod，它是否会重新启动。这是你在进入生产之前检验轮胎的机会。如果你正在运行一个单一的应用程序，你可以很快地通过这个阶段。如果您正在部署微服务应用架构，请为每个服务完成步骤 1-8，并部署到非生产环境。一旦所有服务都在该环境中，您就可以看到它们是如何协同工作的。这样，您就可以确保在部署到生产环境时，您的应用程序作为一个整体能够正常工作。

### 10.提升到生产

一旦在非生产环境中彻底测试了应用程序，就可以将应用程序部署到生产环境中。确保生产环境的构建方式与暂存环境相同，否则以后会遇到问题。要向您的应用程序发送流量，只需更改您的负载平衡器或 DNS。有了 DNS，如果需要，您可以轻松地回滚。

在这个技术转换阶段，过程的一部分包括清理技术债务、围绕工具做出决策、调查生产力的收益和损失，以及开始考虑灵活性和控制。希望这 10 个步骤能帮助你开始技术转型，这是任何采用 Kubernetes 的组织的关键一步。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>