# CNAB 简化了分布式应用的容器式部署

> 原文：<https://thenewstack.io/microsoft-cnab-simplifies-container-deployment-to-distributed-applications/>

容器变得如此流行的原因之一是易于部署，但今天的分布式应用程序并不局限于单一运行时或单一云提供商。如果你在应用程序中使用云数据库服务和无服务器功能，你会失去 Docker 体验的简单性，即把应用程序打包成一个包，并将其推送到 repos 供人们取出，因为你需要 Terraform 和 Azure Resource Manager 模板和 Ansible 等工具来处理所有不同组件的供应。

“今天，如果你只使用基于容器的应用程序，你可能正在构建 Helm 工件，或者对于 Azure，你的目标是一个[Azure Resource Manager]工件或类似 Terraform 的东西，”微软云原生计算团队负责人 Gabe Monroy 告诉新堆栈。“当你正在构建的应用程序是这些东西的混合时，问题就来了，所以它有，比如说，Terraform、容器和功能，因为我们开始看到不同运行时和云 API 的多样性正在出现。你如何把它包装起来，并把它变成像一个简单的应用程序一样可以管理的东西呢？我们能否围绕可重复性、不变性和加密保证提供熟悉的体验，确保工作负载在一个有容器的世界中没有被修改……或者根本没有容器？”

微软和 Docker 周二在微软的 [Connect()](https://www.microsoft.com/en-us/connectevent/) 开发者大会上发布的开源[云原生应用捆绑包](https://www.youtube.com/watch?v=26e5-UK4YRA)是一个包管理规范，它建立在[开放容器倡议](https://www.opencontainers.org/)的基础上，为分布式应用创建一个清单，并将在 Docker 的公共中心得到支持。

“我们的想法是尝试并定义一种模式，让人们可以构建这些不同的捆绑包，这些捆绑包具有与之相关的管理生命周期，因此您可以安装、更新和卸载它们，并拥有与确保这些捆绑包安全相关的所有加密技术，能够推拉它们等等，”Monroy 解释道。

CNAB 还可以帮助开发人员在越来越多的云环境中工作。“我们希望保持规范的灵活性，以便您可以跨不同的云提供商对解决方案进行建模。即使是主要使用 Azure 的客户，他们可能在 AKS 中有一些容器，他们可能有一些 Cosmos DB，然后他们希望使用像 Dyn DNS 这样的第三方 DNS 服务来缝合 DNS 记录。CNAB 允许他们对所有这些进行建模，并构建一个他们能够以很高的可重复性管理的应用程序。”

> CNAB 的参数化基于 Azure 资源管理器(ARM)模板语言。“这意味着，当您使用 CNAB 安装软件包时，您可以提示输入内容，并立即对这些条目进行强验证。”——加布·蒙罗伊。

CNAB 使开发人员能够定义资源，这些资源可以部署到运行时环境的任何组合中，在云中，在本地环境中，如 on-premise OpenStack 或 Kubernetes(或开发人员的笔记本电脑)，在受限的物联网环境中，或者在断开连接的边缘和空气间隙环境中，您无法调用云来下载容器。“在一个断开的环境中，你不能假设你可以访问基于云的容器注册，所以关键的设计目标之一是确保我们可以有一个可以序列化为‘厚’包的包版本，”Monroy 解释道。“这个厚厚的包包括所有容器图像和您需要的一切，以便将它放在 u 盘上，带到一个有空气间隙的环境中，合并容器注册表等，并获得在离线环境中运行的应用程序的全保真版本。”

即使只使用容器构建的应用程序也将受益于离线选项，以及 CNAB 使用参数进行配置的方式，因此更改现有应用程序的网络配置并不意味着复制 Docker compose 文件和编辑 YAML，这是一个很容易导致错误的手动过程。它还对 Helm 进行了改进，Helm 使用参数，因此您可以放入块来标记防火墙配置，但没有结构化模式或强类型来验证字段内容，因此安装后很容易出错。Monroy 说，CNAB 的参数化基于 Azure 资源管理器(ARM)模板语言。“这意味着，当您使用 CNAB 安装软件包时，您可以提示输入内容，并立即对这些条目进行强验证。”

## 分布式资源管理

CNAB 还可以简化云资源的审计和成本控制，并解决容器蔓延问题，方法是让哪些资源与哪些应用程序相关联变得更加清晰，让开发人员更容易采用不同的服务和平台，而不会因管理它们而不堪重负。

“现在，如果你打开你的 Azure 订阅，看看所有正在运行的东西，这些东西可能是成百上千的资源，并且能够区分这些资源中的哪些是哪个逻辑应用程序的一部分，这在今天是很难做到的。Monroy 承认:“公共云和不同资源的爆炸式增长确实提高了灵活性，但钟摆还没有摆回到围绕所有这些资源的良好管理结构上。像 CNAB 这样的现代工具将使跟踪和审计您已经部署的资源变得更加容易。“您不能通过 GUI 手动点击来管理云资源，否则您最终会面临这种无序蔓延的管理。作为代码，你需要更仔细地考虑工具和基础设施，以避免落入这些陷阱。”

除了 CNAB 规范，微软还宣布了一套初始工具，包括用于构建 CNAB 捆绑包的 Visual Studio 代码扩展和 CNAB 客户端的跨平台开源参考实现 Duffle。这是一个 Docker 风格的 CLI 工具，用于创建捆绑包、加密签名和验证捆绑包，以及推拉捆绑包来安装、升级和卸载它们。还有一个跨平台的电子安装程序，它将一个图形化的前端放到 CNAB 包中，用于安装、升级或安装应用程序。

“一旦你建立了一个这样的包，电子安装程序允许你把它放在 u 盘上，在笔记本电脑上双击它，它会带你完成一个安装程序，”他解释道。“这将允许您使用标准的[桌面安装程序]向导，从您的桌面执行这些基于云的分布式应用程序之一的生命周期管理。”

该接口依赖于在 CNAB 完成的参数验证，该规范足够灵活，允许安装和管理桌面资源，为本地应用程序安装开辟了有趣的可能性。

微软还与 Docker 合作创建了一个捆绑存储库服务器的示例实现。“为此，我们需要一套围绕 Docker 注册 API 和 OCI 发布 API 的新 API，”他说。“计划是在标准的 Docker 兼容注册表中将其作为一个附加组件或一组替代 API 推出。”随着时间的推移，通过开放集装箱倡议与社区合作，蒙罗伊预计 CNAB 的支持将变得更加一体化。“Docker 已经承诺在公共 Docker hub 中支持 CNAB，这非常令人兴奋。”

编写分布式应用程序和创建 CNAB 捆绑包仍然需要专业知识，但蒙罗伊认为，这将极大地简化通过软件市场和边缘场景安装和管理它们。“我认为我们在这里所做的就是让人们消费这种东西变得完全无关紧要。如果你现在想安装一个复杂的 Kubernetes-plus-containers-plus-Cosmos DB-plus-functions 应用程序，你将会在不同的 ARM 模板或 Terraform 和 Ansible 以及混合工具中摸索。现在，您可以轻松安装他人预先构建的软件包，并在几分钟内为您搭建好整个环境。”

[https://www.youtube.com/embed/26e5-UK4YRA?feature=oembed](https://www.youtube.com/embed/26e5-UK4YRA?feature=oembed)

视频

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>