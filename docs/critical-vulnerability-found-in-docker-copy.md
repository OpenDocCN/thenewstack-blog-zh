# Docker 副本中发现严重漏洞

> 原文：<https://thenewstack.io/critical-vulnerability-found-in-docker-copy/>

[Unit 42](https://unit42.paloaltonetworks.com),[帕洛阿尔托网络](https://www.paloaltonetworks.com/)的威胁情报团队发布了一项概念证明研究，该公司称这可能是尚未发现的最严重的 Docker copy 命令(*Docker CP)*漏洞。这个新漏洞使得攻击者能够完全控制主机和其中的任何/所有容器。

漏洞 [CVE-2019-14271](https://nvd.nist.gov/vuln/detail/CVE-2019-14271) 已经被修改，正在等待重新分析，这可能会导致已知信息的进一步变化。此漏洞的基本分数为 9.8，因此非常严重。

该漏洞集中在 *docker cp* 命令上，该命令允许在主机和容器之间以及容器之间复制文件。命令语法类似于标准的 Linux *cp* 命令，所以:

```
docker cp container:/source_directory  /target_directory

```

其中 *container* 是容器的名称， *source_directory* 是数据将被复制到的目录， *target_directory* 是数据将被复制到的目录。为了实现复制，docker 使用了 *docker-tar* 助手进程，该进程的工作方式是将 *chrooting* 放入容器，归档请求的文件，并将生成的 tar 文件传递给 Docker 守护进程，后者将其提取到目标目录中。

帕洛阿尔托网络公司的高级安全研究员 Yuval Avrahami 称，正是 *chrooting* 过程允许 Unit 42 发现漏洞。docker-tar 实用程序“错误地从容器而不是从主机加载了库，特别是 libnss 库。”

“发现该漏洞是因为一名用户在 Docker GitHub 问题中抱怨他在 docker *cp* 命令中遇到的一个错误，而不知道其根本原因是一个严重的漏洞。”Avrahami 指出，“用户试图从一个 *debian:buster-slim* 容器中复制文件，这是少数不包括 libnss 库的映像之一。因此，当 docker-tar 进程试图从容器中加载库时，它未能找到它们并崩溃。”

这一发现让处理 GitHub 问题的 Docker 维护人员意识到用户 bug 的原因是一个严重的漏洞，迅速修补并分配了 CVE。

## 开发者能做什么？

当被问及开发人员和管理员应该做些什么来保护自己免受这些问题的影响时，Avrahami 说，“首先，确保你没有运行易受攻击的 Docker 版本。Docker 版本 19.03.01 及更新版本中包含了该修复程序。Avrahami 还补充道，“以非 root 用户身份运行容器也可以缓解这种攻击。”因为大多数突破漏洞需要容器中的 root 访问权限，所以如果容器作为非 root 用户运行，攻击者很难达到这样的状态。Avrahami 继续说道，“除此之外，永远不要运行来自不可信来源的图像，因为它们可能是恶意的，并试图接管您的主机。”

当然，这让我们不禁要问 Docker 容器的最大弱点是什么:共享内核，Avrahami 总结道，这“很难保证安全”。“与传统虚拟机不同，容器与主机共享内核。这意味着内核中的漏洞允许容器危害整个主机。”

“尽管有限制这种攻击面的方法，”他说。“最好的方法是以非根用户的身份运行容器。”为什么？因为以非根用户身份运行容器减少了很大一部分可利用的内核漏洞。

Palo Alto Networks 是新堆栈的赞助商。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>