# 面向浏览器开发人员的无服务器 WebAssembly

> 原文：<https://thenewstack.io/serverless-webassembly-for-browser-developers/>

WebAssembly(通常简称为 Wasm)是为 web 浏览器而构建的。但是，一项技术的发展经常超出其创造者的意图。Wasm 就是一个很好的例子。Wasm 展示前景的一个地方是云中。这是一个运行无服务器功能的绝佳平台。

在本文中，我们将了解 Wasm 的设计意图，以及它如何改进浏览器。然后我们将看到 Wasm 是如何向通用技术飞跃的。

最后，我们将看看云中的一个特殊问题——执行无服务器功能——并看看 Wasm 如何解决这个问题。

## 移动小程序、Flash 和 Silverlight！

2015 年，Mozilla [向世界介绍了 WebAssembly](https://blog.mozilla.org/luke/2015/06/17/webassembly/) 。在这篇博文中，Luke Wagner 这样描述 WebAssembly:

WebAssembly…定义了一个可移植的、大小和加载时间高效的格式和执行模型，专门设计用作 web 的编译目标

目标是构建一种可以在所有主流 web 浏览器中执行的二进制格式。这种格式的特征使得许多不同的语言，从 C 到 Python，都可以在浏览器中运行。代码用一种支持的语言编写，编译成 Wasm 格式，然后在浏览器中执行。JavaScript 代码控制 Wasm 的执行，甚至可以通过调用 Wasm 库中的函数与 Wasm 进行交互。

这已经不是第一次尝试类似的事情了。浏览器中添加了一些其他语言(后来又删除了)。Java 小程序是第一个。VBScript 在微软浏览器中有过短暂的生命。Silverlight 和 Adobe Flash 也来来去去。但是这一次，Mozilla 的人做了一些不同的事情:

他们没有支持一种语言，而是定义了一种现有语言可以编译成的二进制格式。

Mozilla 没有单干，而是与谷歌、微软、苹果和其他公司联手。他们承诺在 W3C 的支持下完成这项工作。

Wasm 没有像 Flash、Silverlight 和 Java 那样专注于增强用户界面，而是专注于库的使用和代码共享。

Wasm 团队试图解决的用例不是小部件和流媒体播放器，而是将代码从其他地方移植到浏览器。例如，考虑一下破旧 C 库，它多年来尽职尽责地完成了一些重要的工作，但是每个人都害怕接触它，因为害怕破坏它。可以编译成 Wasm 在浏览器中享受新的用法吗？或者考虑需要高效计算的复杂问题，如图形处理。高性能代码可能更容易用 Rust 这样的语言来表达。Wasm 允许开发人员用自己喜欢的语言编写代码，然后在浏览器的范围内使用它。

## 超越意图

纵观计算的历史，我们发明技术来解决一个狭窄的问题，后来才意识到这个工具有更广泛的应用。互联网是为美国国防部的通信而建立的。网络是用来交换物理论文的。Java 是用于嵌入式计算的。JavaScript 现在是世界上最流行的语言，最初是一种在浏览器中弹出警告的“玩具”语言。这些技术中的每一项都从利基解决方案跃升为通用工具。

Wasm 现在就在那一刻。

它在浏览器中获得了成功。但是人们正在发现 Wasm 的各种其他用途。从编译器工具链到数据库中的用户定义函数，Wasm 正在一些引人注目的领域出现。

但是有一个用例让我感到特别兴奋。WebAssembly 似乎非常适合云计算。要理解为什么，我们先来看看当今云的核心技术之一:无服务器功能。

## 无服务器功能 v1

无服务器功能，有时称为功能即服务(FaaS)，旨在提供一种简单的方法来创建小型云服务。通过与服务器进行对比，最容易理解无服务器功能。Web 服务器软件监听套接字上的 HTTP 请求，解析每个请求，然后处理这些请求。在 web 服务器的进程生命周期中，它可能会处理成千上万个单独的 HTTP 请求。典型的 HTTP 服务器还必须管理 SSL 连接、系统进程、线程池和并发性，以及各种其他低级任务，所有这些都是为了响应 HTTP 请求。

无服务器功能旨在尽可能多地去除“服务器性”。相反，编写无服务器功能的开发人员应该只关注一件事:响应 HTTP 请求。没有联网，没有 SSL 配置，也没有请求线程池管理——所有这些都由平台处理。无服务器功能启动，回答一个请求，然后关闭。

这种紧凑的设计不仅减少了我们必须编写的代码量，还降低了运行无服务器功能的操作复杂性。我们不必保持我们的 HTTP 或 SSL 库是最新的，因为我们不直接管理那些东西。平台有。从错误处理到升级，一切都应该——事实上也确实是——更容易。

鉴于对简单性的不懈关注，无怪乎[420 万开发人员](https://www.cncf.io/wp-content/uploads/2022/05/Q3-2021-State-of-Cloud-Native-development_FINAL.pdf)说他们已经编写了至少一个无服务器功能。亚马逊报告说他们[执行 10](https://youtu.be/0_jfH6qijVY) 万亿(是的，那是 *10 万亿*！)无服务器功能一个月。

虽然编程范例很吸引人，但是无服务器功能的早期迭代有几个缺点。他们开始得很慢。打包和部署无服务器功能的体验很麻烦。调试和故障排除非常困难。然而，这些问题背后的原因既容易理解又令人惊讶。

这个关于无服务器功能的绝妙新想法运行在错误的技术堆栈之上——笨重的虚拟机。每种语言的运行时和包管理器。为另一类计算构建的云基础设施被重新用于一种技术，事后看来，它并不适合这种技术。

事实证明，我们将无服务器从优秀提升到卓越所需的技术存在于浏览器中。我们只需要从那里摘下 Wasm，把它种在云中。

## Wasm 为无服务器做了什么

如果我们试图改善无服务器功能的状态，有一些高优先级的位需要改善。我们需要无服务器环境非常快，非常安全，我们希望它尽可能隐藏“服务器”的细节。也就是说，从我们开始要求用户选择操作系统或 CPU 类型的那一刻起，我们就在强迫用户做出服务器决策，而不是无服务器决策。当涉及到部署无服务器功能时，定义良好的包格式的较小二进制文件使我们更容易发布。

正是在这一点上，Wasm 的传统使其非常适合无服务器功能。当我们谈到 Wasm 是“为浏览器而构建”时，我们实际上是在谈论使 Wasm 非常适合浏览器模型的几个关键特性:

*   快速启动时间。没有人愿意等待页面加载。
*   跨架构、跨操作系统。“需要 Internet Explorer 才能查看此页面”的日子已经一去不复返了
*   压缩二进制文件。当我们在互联网上移动代码时，我们不想发送大文件。
*   安全沙盒。浏览器每天都在运行不可信的代码。我们依靠浏览器来保护我们免受病毒和黑客的攻击。

这四个特性恰好是无服务器功能平台所需要的特性。我们希望零延迟启动时间。我们不想知道或关心我们的函数运行的架构或操作系统。(这就是无服务器的乐趣吧？我们一点也不需要关心底层的服务器！)我们希望我们的二进制文件是紧凑的，这样我们就可以快速打包并上传它们。我们想知道在多租户云中运行我们的功能是否安全。

运行在 Wasm 上的无服务器功能平台可以轻松构建各种各样的应用程序，包括高度响应的 HTTP 应用程序，然后满怀信心地部署它们。这正是我们在 Fermyon 构建开源 Spin 框架时所考虑的用例。

## 结论

我们的许多关键技术开始于利基市场，后来发展成为通用工具。Wasm 现在正在经历这样的转变，因为我们发现了网络浏览器之外的新应用。无服务器功能已经取得了很大的成功。但是要向前飞跃，这项技术需要更快、更强大的基础。Wasm 就是这样一种技术。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>