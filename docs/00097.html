<html>
<head>
<title>Building Microservices, Toiling With the Monolith and What it Takes to Get it Right</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建微服务，努力打造独石，以及如何让它变得正确</h1>
<blockquote>原文：<a href="https://thenewstack.io/building-microservices-toiling-with-the-monolith-and-what-it-takes-to-get-it-right/#0001-01-01">https://thenewstack.io/building-microservices-toiling-with-the-monolith-and-what-it-takes-to-get-it-right/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="p1 translated">"并不是所有的大型系统都设计得很好."</p>
<p class="p1 translated"><span class="s1"><a href="https://vimeo.com/12674642" class="ext-link" rel="external "><span class="s2">Eric Evans</span></a>的话在这篇文章中回荡，因为我们了解到一家公司如何做出战略设计决策，将部分整体代码迁移到微服务和有界上下文中。</span></p>
<p class="p1 translated">微服务是热门的新事物…至少在理论上是这样。在实践中仍然没有很多关于它们的故事，即使有，也更多的是关于<span class="s2"> <a href="https://thenewstack.io/agile-management-how-to-manage-microservices-with-your-team/" class="local-link">微服务建议</a>、</span>以及相当多的关于组织陷阱的故事，这两者都是值得谈论的重要话题。但是如果一切顺利呢？这篇文章向我们展示了一个中型商业网站向微服务转型的过程。</p>
<h2 class="p1 translated"><span class="s1">当你的团队需要做出改变的时候</span></h2>
<p class="p1 translated">大约一年半前，Carlos Buenosvinos加入了Atrapalo团队。他说，Atrapalo和巴塞罗那的许多公司一样，不仅单一，而且有糟糕的团队实践:不执行测试，不适合扩展。受欢迎的餐馆、活动和旅游交易网站 正经历着高流动率，每一两周就有人离开，因为公司“缺乏创新”。</p>
<p class="p1 translated">Buenosvinos在他的前一家公司<a href="http://emagister.com" class="ext-link" rel="external "><span class="s3"/></a>分类网站集团经历了类似的过程，他认识到有必要打破这种垄断，以激发创新，通过更快的交付更具竞争力，这反过来会创造更好的团队团结和保留。</p>
<p class="p1 translated">按照他在eMagister的工作模式，Atrapalo领导层决定在微服务的有限环境中使用RESTful和领域驱动的设计。</p>
<p class="p1 translated">他解释说:“微服务对于技术领导者、首席技术官等来说是一个很好的工具，可以提高大型团队的生产力，并投资于开发人员的职业生涯，因为他们将学习新的架构和新的技术。”</p>
<p class="p1 translated"><span class="s1">但是Buenosvinos并不认为微服务适合所有人，他也不推荐小团队使用。</span></p>
<blockquote>
<p class="p1 translated">“你可以在小团队中应用微服务，但一般来说，主要目标是最大化团队的生产力，这样他们就可以专注于任务。”</p>
</blockquote>
<p class="p1 translated">他继续说道，“如果你有一个10人的小团队在开发，你可以去微服务，但是我不建议你去。”</p>
<p class="p1 translated">相反，Atrapalo的整体架构带来的麻烦比它的价值更大。</p>
<p class="p1 translated"><span class="s1">“对于70名开发人员，分支机构，你的团队必须表现良好，才能与不同的团队和项目以及所有以同步和异步方式连接的产品融为一体。”他说，随着他们脱离微服务，“所有这些冲突都消失了。”</span></p>
<p class="p1 translated"><span class="s1">如果团队在微服务上比在整体服务上更有效率，Buenosvinos推荐你去做；但是，“如果你在合并、开发、部署的时候能处理好一些冲突，还是可以的。与其去一个分配系统，不如留在这个整体中。”</span></p>
<p class="p1 translated"><span class="s1">这并不意味着你必须进行微服务或破产。在一种情况下，整块石头的某些部分不值得搬走，或者另一方面，搬走也是有益的。</span></p>
<p class="p1 translated">另外，一旦你开始脱离，并不意味着你已经和这个想法结婚了。“如果事情不尽如人意，你只能呆在一个整体系统中，但有一些微服务，并且你要处理单独的项目。”</p>
<h2 class="p1 translated"><span class="s1">如何开始向微服务转移</span></h2>
<p class="p1 translated"><span class="s1">不能只是闭上眼睛，交叉双臂，许愿，晦气！你的巨石已经神奇地断裂成微服务。这种转变可能是一个漫长的过程，随着团队和职责的转移，这一过程本身就很痛苦。</span></p>
<p class="p1 translated"><span class="s1">与所有影响团队动态的转变一样，你需要投入大量时间和耐心来传达行动计划，并向你的团队解释他们没有分手，只是“我做这个，你做那个”然而，并不是每个人都会喜欢它。</span></p>
<p class="p1 translated">在阿特拉帕洛，情况也是如此。Buenosvinos说，“大多数人真的很乐意学习新东西，也有一些人对此不太高兴，但他们离开了公司。”</p>
<p class="p1 translated"><span class="s1">在最初的流失之后，Atrapalo在实施微服务的第一年几乎没有营业额。他认为那是因为:</span></p>
<blockquote>
<p class="p1 translated">“你必须向开发人员解释，无论我们在这里做什么，主要目标都是尽快向用户释放价值，以更高的质量更快地将东西推向生产。”</p>
</blockquote>
<h2 class="p1 translated"><span class="s1">决定在哪里拆分你的团队和你的代码</span></h2>
<p class="p1 translated">Buenosvinos说你必须始终专注于“团队分裂，而不是代码分裂”。只有一个存储库，所有的东西都是同时部署的”，包括对飞机旅行、酒店等的修复。</p>
<p class="p1 translated"><span class="s1">他应用了<a href="https://mikadomethod.wordpress.com/" class="ext-link" rel="external "> <span class="s2">天皇法</span> </a>进行实验，学习如何重组:</span></p>
<ol>
<li class="p1 translated"><span class="s1"> <b>设定目标</b>:你对自己的未来有什么设想？</span></li>
<li class="p1 translated"><span class="s1"> <b>实验</b>:寻找先决条件。</span></li>
<li class="p1 translated"><span class="s1"> <b>可视化</b>:绘制出第一步和第二步。</span></li>
<li class="p1 translated"><span class="s1"> <b>撤销</b>:在你发现哪个目标或先决条件破坏了你的系统后，回滚它。</span></li>
</ol>
<p class="p1 translated">他说，首先，看看你拥有的团队，以及谁最适合维持这个团队。然后问，“最容易拆分和训练团队打破巨石的部分是什么？”</p>
<p class="p1 translated"><span class="s1">他谈到亚马逊如何拥有一百名致力于评论和结账的开发人员，但是拥有一个大约70人的团队，Atrapalo必须更有创造力。</span></p>
<p class="p1 translated"><span class="s1">“你不能让开发人员专注于一个特定的产品，”他说他会将一些产品分配给一些团队，而三个项目可以由一个人维护。“sprint中的一些依赖项需要服务工程和前端或其他方面的更多资源，所以我们转移了(团队成员)。”然后，如果他们需要新的技能，他们会雇佣合同工，或者培训团队成员。</span></p>
<p class="p1 translated">在Atrapalo，“我们开始研究整个Atrapalo的东西，然后寻找可以分离出来给小团队的小部分。”</p>
<p class="p1 translated"><span class="s1">对于这个旅游网站，他们首先隔离和断绝的是用户的身份访问。接下来是结帐和目录；其次是酒店目录、飞机和火车旅行；然后是评论。Atrapalo现在为每个产品——三个或四个——以及六个微服务中的每一个都有一个API(应用编程接口),每个都同步基于RESTful APIs。</span></p>
<p class="p1 translated">布埃诺斯维诺斯说,“那块巨石还在那里工作得很好。每一个还在运行的产品，我们都必须拿走。最终目标是当你拥有一个上下文受限的网站。”</p>
<h2 class="p1 translated"><span class="s1">如何决定您的微服务语言</span></h2>
<p class="p1 translated">微服务的一个重要原则是任何微团队都可以自由使用他们需要的语言来完成工作。然而，大多数时候，公司并没有重新发明轮子，而是尽可能多地使用monolith的语言。</p>
<p class="p1 translated">Buenosvinos认为，当微服务用同一种语言开发时，就容易多了。“说‘嘿，伙计们，我们的主要技术是’很正常，但(然后)最多可能使用两三种语言。”Atrapalo主要使用PHP，然后是一些Node和Java，用于流媒体视频之类的东西。</p>
<p class="p1 translated"><span class="s1">其他像网飞这样的微服务先行者，一般只用Java，用一些Python和Node。Buenosvinos说，“他们已经决定在80%到90%的情况下使用这种技术。”</span></p>
<p class="p1 translated">Buenosvinos建议，当你正在寻找一种语言来开始脱离大一统，或者仅仅是当你正在开发一种新的服务时，你需要考虑你所服务的社区，你所提供的支持，以及它是否容易招募。Atrapalo选择了PHP，因为在薪水较低的巴塞罗那，PHP比学习起来更复杂、因而更昂贵的Java更容易招到人。</p>
<p class="p1 translated"><span class="s1">“想象一下，你有一些人在研究巨石柱。“你可以把它们放在不同的服务上，”他说，“你可以继续使用与monolith相同的语言。”</span></p>
<h2 class="p1 translated"><span class="s1">Scrum对于微服务来说是必不可少的吗？</span></h2>
<p class="p1 translated"><span class="s1">“人可能是最难处理的部分。总有人不喜欢改变。正如我的首席执行官告诉我的那样，‘你不是被雇来和开发者做朋友的。’”</span></p>
<p class="p1 translated"><span class="s1">然而，管理团队当然是微服务过渡中最重要的部分。Buenosvinos说，这就是为什么已经是一个Scrum，或者至少是一个敏捷公司在进行这种转变之前更容易。</span></p>
<p class="p1 translated"><span class="s1">“这不是必需的，但确实很有帮助，但你可以用瀑布运行微服务，应用任何敏捷方法发布和测试，”他说Scrum是“最简单的方法，因为我们在敏捷结构之上运行微服务。”</span></p>
<p class="p1 translated">Buenosvinos警告说:“很多人都在谈论Scrum，但却没有在艰苦的环境中应用它……在大型团队中。他说微服务和Scrum都是关于细节的。" Scrum大师如何能注意到什么时候事情变成了问题."他说，特别是当你过渡到微服务时，你需要一个强有力的Scrum领导者，他可以观察团队并提出正确的问题:</p>
<ul>
<li class="p1 translated">有多少人可以从事这项工作？</li>
<li class="p1 translated"><span class="s1">我们的用户故事是什么？</span></li>
<li class="p1 translated"><span class="s1">我们将如何管理发布和团队合作？</span></li>
</ul>
<p class="p1 translated">另外，现有的敏捷方法通常会影响你如何组织团队。“正如Scrum所说，6到8人的小团队比12人的团队工作效率更高，”Buenosvinos说。</p>
<blockquote>
<p class="p1 translated">“我们正试图将公司分成更小的团队，以便走得更快，独立部署，使用不同的技术，雇佣不同的人。”</p>
</blockquote>
<p class="p1 translated">他说，在开始实施微服务的六个月内，“剩下的事情自然会发生——开始每周部署，然后每周两次。”</p>
<h2 class="p1 translated"><span class="s1">有界上下文如何带来微服务转型</span></h2>
<p class="p1 translated">Buenosvinos认为微服务可能是一个时髦的词和热门的标签，但它不是一个新概念，他说它实际上可以追溯到2004年左右，当时它的名字是<span class="s2"> <a href="http://martinfowler.com/bliki/BoundedContext.html" class="ext-link" rel="external ">、有界上下文</a>、</span>，以及它如何与领域驱动的设计交互。</p>
<p class="p1 translated">他说微服务基本上是一样的。</p>
<blockquote>
<p class="p1 translated"><span class="s1">“领域驱动设计是关于解释你的公司在孤立的部分做什么，在执行这些特定的部分，你可以有一个专门的团队来做这些事情，你可以为不同的团队使用不同的工具。”</span></p>
</blockquote>
<p class="p1 translated"><span class="s2"> <a href="https://en.wikipedia.org/wiki/Domain-driven_design#Strategic_domain-driven_design" class="ext-link" rel="external ">领域驱动设计的战略设计原则</a> </span> <span class="s1">着眼于跨多个模型保持模型的升华:</span></p>
<ul>
<li class="p1 translated"><span class="s1"> <b>有界上下文</b>:当你有多个代码库的时候，你最终会变得不可靠和烦人。对于像微服务这样的情况，情况会变得更糟，人们使用不同的技术和编程来完成这一切。有界环境原则确保你为团队组织划定了明确的界限，谁负责应用程序的哪一部分。</span></li>
<li class="p1 translated"><span class="s1"> <b>持续集成</b>:微服务有助于限制康威定律，以及同一有界环境中更多人会分裂的事实，但另一方面，你想防止更多分裂。为了防止这种情况，经常合并所有代码并自动测试以捕捉错误。</span></li>
<li class="p1 translated"><span class="s1"> <b>语境图</b>:“当不同的语境之间必须建立联系时，它们往往会相互渗透。”绘制现有地形图，突出任何共享并阐明任何有界的上下文。</span></li>
</ul>
<p class="p1 translated">Buenosvinos继续说“微服务是一个很酷的词，但是有界环境在讨论方面更成熟。”他将Atrapalo正在经历的旅程描述为更加有界的上下文和领域驱动的设计。“领域驱动的设计促进了不与框架耦合的架构，因此人们可以从一个框架转移到另一个框架。”</p>
<h2 class="p1 translated"><span class="s1">你如何衡量微服务的成功？</span></h2>
<p class="p1 translated"><span class="s1">“去微服务一点都不便宜。不太好理解。它不适合所有人，也不适合所有开发者。你必须具备中高级技能，”布埃诺斯说。</span></p>
<p class="p1 translated"><span class="s1">本质上，这个故事的寓意是，微服务并不适合所有人，但当它奏效时，你会以更快的部署和创新、行动更快的团队走出另一面。</span></p>
<p class="p1 translated">大约70名开发人员组成的Atrapalo团队已经经历了一年多向微服务的转变。“在这段时间里，他们从每两周部署一次减少到每天大约三次。”</p>
<p class="p1 translated"><span class="s1">当然，对于Buenosvinos来说，成功的衡量标准是不同的:</span></p>
<blockquote>
<p class="p1 translated"><span class="s1">“带领一个大团队，让他们按照最佳实践工作，这是你最自豪的事情。”</span></p>
</blockquote>
<p class="p1 translated"><span class="s1">你试过微服务吗？请在下面评论您的流程是如何工作的(或不工作的)。)</span></p>
<p class="p1 attribution translated">专题图片:<a href="https://www.flickr.com/photos/osamukaneko/" class="ext-link" rel="external "> Osamu Kaneko </a>的<a href="https://www.flickr.com/photos/osamukaneko/8727599001/in/photolist-eiee7R-w1CmCy-vMXN6z-o3XRzw-8YS2mF-8YV59S-evsSDx-6kjHYx-8YV5ih-8YS6b8-8YRZbD-8YRYMz-4FG8eM-8YS1rk-8YS17D-4FLhSY-8YV9gC-rn4gxJ-aa26rT-9YN21s-drCVqc-daUrSk-8YVyYb-rHxG14-azWMxq-dvfAV2-dp9GwB-dAX1Vc-o15RUw-dmtF9N-aDYqZq-drov8q-aNhZmR-eiBPTP-azMAPm-e7i5S2-4vunAg-arM7Z5-78oLbC-9jUXSJ-pKCmEn-pFrv6s-pZEah6-pmqgnp-gaCWG2-eHPo9e-9y95hY-azMEDo-7V81YJ-pLNxp3" class="ext-link" rel="external ">巴萨</a>由2.0 在<a href="https://creativecommons.org/licenses/by/2.0/" class="ext-link" rel="external "> CC下授权。</a></p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>