# 从企业服务总线到微服务

> 原文：<https://thenewstack.io/esb-migration-qa/>

[](https://tanzu.vmware.com/)

 [迈克尔·科特

迈克尔·科特在 Pivotal 从事技术营销工作。他曾是 451 Research 和 RedMonk 的行业分析师，曾在戴尔软件和云部门从事企业战略和并购工作，在此之前曾做过十年的程序员。他在 Cote.io 上写博客和播客，在 Twitter 上是@cote。](https://tanzu.vmware.com/) [](https://tanzu.vmware.com/)

处理遗留问题是我们围绕“云原生”和 Pivotal [Cloud Foundry](https://www.cloudfoundry.org/) 最常见的话题之一。去年，作为我的云原生之旅系列文章的一部分，我写了一篇关于如何看待遗留应用的基本框架文章，在回顾即将到来的 SpringOne 平台会议的演讲时，我注意到这将是今年 8 月活动的主题之一。

[Pivotal](https://tanzu.vmware.com/) 架构师 [Rohit Kelapure](http://cloud.rohitkelapure.com/) 一直致力于这一主题，并撰写了[关于从基于企业服务总线(ESB)的遗留架构迁移的白皮书](https://tanzu.vmware.com/content/white-papers/migrating-an-esb-to-a-cloud-native-platform)。在和他一起写了一点论文后，我有几个问题，我想这些问题的答案会对那些询问这个话题的人有所帮助。

技术选择往往始于最好的意图。很少有人想做一个“坏”的系统。是什么驱使如此多的组织选择 ESB？

**Rohit:**ESB 是对围绕服务集成、审计、转换、业务影响可跟踪性、可组合性、数据转换的企业需求的响应，是治理的中心点。SOA 的承诺将由 ESB 来实现。不幸的是，ESB 最终被企业供应商所取代，这些企业供应商创建了开发人员讨厌的部署和操作单一软件设备的昂贵的“吃到饱”软件。ESB 被证明是 Gregory Hohpe 和 Bobby Woolf 提出的有用的[企业集成模式](http://www.enterpriseintegrationpatterns.com/gregor.html)模式的错误体现。

***Coté:*** 在微服务中，总是有很多关于使用[康威定律](http://www.melconway.com/Home/Conways_Law.html)——“一个系统的设计是一个组织的通信结构的副本”——对你有利的谈论。如果你的软件最终模仿了你的组织结构(以及“沟通结构”)，为什么不组织团队来匹配你想要的设计呢？因此，如果您有一个“目录”和“客户”微服务，您将有团队来负责其中的每一项。首先，你见过这种情况真的发生吗？第二，你如何看待组织的转变——他们只是在一夜之间重新安排人员，还是更加渐进？

组织以各种方式过渡，大多数是以渐进的方式进行的。只有在最高管理层买入的情况下，反康威策略才会奏效。许多公司，尤其是中层管理人员说的是正确的事情；然而，在执行过程中，他们会退回到更老、更传统的孤岛式方法和基于票证的流程。企业需要一个真正的颠覆者，这个颠覆者导致并证明组织层级的改变是合理的。破坏越严重，转变越快。

过渡到基于微服务的无共享架构的人员和流程部分是最困难的。通常需要注入外部变革剂来实现变革，并作为变革的催化剂。影响这种变化的一种方式是通过孤岛部署，即创建一个卓越中心，该中心没有母公司的任何包袱，可以为所有技术创造自己独特的文化。

> 结构化平台上的一种语言(Java)、一个运行时(Tomcat)和一个 CI/CD 流程带来了缩短价值实现时间和提高效率的圣杯——Rohit Kelapure

在你的论文中，你说 ESB 比微服务更擅长“编排”:“当一个业务系统被设计成一套微服务，而这些微服务更喜欢编排而不是编排时，该架构的倡导者应该提供实现抽象的最佳实践和模式。”首先，你说的“编排”是什么意思，你能举个例子吗？第二，为什么微服务方法有缺点(例如，它缺少什么？)

**Rohit:**[Steve Johns](https://www.infoq.com/news/2008/09/Orchestration)对这种差异做了最好的解释:“编排是‘固定的’，因为有一套描述的步骤和决策。舞蹈设计应该更加以目标为导向，应该是为了实现目标而对资源进行协调。

当微服务被编排时，它们相互协作以实现特定的业务功能。需要清楚地定义和理解服务的交互模型。所有故障模型和一致性模型都需要正确地实现，以确保维护数据的事务性和一致性。当没有中央控制器时，服务需要一起协作。服务之间的交互模型从命令控制风格转变为迭代协作模型。没有合适的参与规则和习惯用法，协作式的互动将会失败。

**Coté:** 什么时候应该有人留在 ESB？或者，他们应该总是从 it 迁移吗？

这是一个商业决定。这是对锁定在 ESB 中的代码和业务逻辑是否是战略性的，是否对修改和扩展开放的成本效益分析。另一方面，如果 ESB 逻辑和代码已经稳定，并且分离它们没有战略优势，那么就没有必要进行迁移。根据我的经验，如果您的代码需要更加灵活，并且能够快速更改——您希望“更加敏捷”——微服务方法会比传统的 ESB 有更好的效果。

**Coté** :您描述了从 ESB 方法迁移到微服务方法的五个阶段。看起来前三个阶段主要是改变底层的 ESB 实现，但是在代码中保持相同的行为。因此，在您进入替换代码，然后完全替换 ESB 的后期阶段之前，几乎没有什么实际的好处。这是正确的吗？或者说，在迁移过程中，您会立即看到哪些好处？

**Rohit:** 您将开始看到更快的部署和更好的弹性带来的运营优势。随着越来越多的 ESB 逻辑被迁移，您开始获得微服务的优势，在微服务中，开发人员可以更快地提升、快速开发和交付代码，并且服务逻辑可以放在一个头中。因此，运营优势让位于微服务提供的简单性带来的更大优势。

**Coté:** 在某一点上，您键入“一种语言(Java)、一个运行时(Tomcat)和一个 CI/CD 流程在一个结构化的平台上产生了缩短价值实现时间和提高效率的圣杯。”对我来说，这读起来好像你有更少的移动部件，你的系统有更少的可变性。您希望减少可变性，这样您就可以快速移动，更加敏捷(担心的事情越少，您就越不用担心会让您慢下来)。组织如何确保在转换到微服务的过程中尽可能少地保留移动部件，从而实现这一目标？

Rohit: 将一种语言、一个运行时和一个 CI/CD 过程的这些原则编成代码。提供代码库和附属管道，从一开始就采用这些习惯用法，即默认做正确的事情。如果开发人员想要偏离默认设置，他们就要承担起操作服务的责任，并根据团队制定的正确的习惯用法和指导方针来开发服务。

如果您希望通过微服务提高架构的灵活性，请务必阅读 Rohit 的全文。此外，在今年 8 月 1 日至 2 日的 [SpringOne 平台大会上，你将有机会听到他和其他许多正在经历这种转型的人的声音，并与他们交谈。希望我们能在那里见到你！](https://springoneplatform.io/)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>