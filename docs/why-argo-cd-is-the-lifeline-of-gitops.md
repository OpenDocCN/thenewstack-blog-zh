# 为什么 Argo CD 是 GitOps 的生命线

> 原文：<https://thenewstack.io/why-argo-cd-is-the-lifeline-of-gitops/>

Intuit 公司正处于一年中最繁忙的时候——纳税季。但对于这个报税巨人来说，在一个月内满足数百万客户需求的能力并不是在一夜之间在自己的围墙内成长起来的。

 [亚历克斯·汉迪

亚历克斯是红帽公司的技术营销经理。在他之前的生活中，他报道了第一台 iMac 的发布，然后开始了 20 多年的科技记者生涯。](https://www.linkedin.com/in/alhandy/) 

Intuit 非常依赖开源软件来完成这项工作。该公司运行数百个 Kubernetes 集群来满足其客户的需求，通过这样做，Intuit 也成为了云原生计算基金会孵化器项目 [Argo CD](https://www.cncf.io/blog/2020/04/07/toc-welcomes-argo-into-the-cncf-incubator/) 的头号贡献者。

这是怎么发生的？几乎同样重要的是，为什么会发生这种情况？答案相当简单——复杂性。

“Kubernetes 采纳者的成熟度提高了。如今，大多数组织都更愿意使用 Kubernetes，所以他们提供了大量的 Kubernetes。随之而来的是如何配置所有这些集群的挑战。如果您配置一个应用程序，您通常会将其部署到一个或两个集群。现在，您部署到 50 个集群。它变得非常复杂，”Red Hat OpenShift 的持续集成/持续交付(CI/CD)产品经理 [Siamak Sadeghianfar](https://github.com/siamaksade) 说。

运行单个集群是一项巨大的工作，但是该集群的复杂性仅限于其自身。一个供应商、一个管理层、一个集群，很可能是一个数据中心或云。然而，当集群开始激增时，管理员面临一个独特的挑战:保持集群与标准操作模型同步。

毕竟，每个集群都有自己的世界，有自己的服务器、基础设施，甚至可能有自己的 Kubernetes 发行和开发团队。一些公司甚至为公司内部的每个团队部署一个集群。由于有如此多不同的移动部件，很难保持所有这些集群的合规性、安全性和绝对安全性。

例如，如果恶意行为者进入集群，他们可以用自己的被黑图像替换容器图像，这可能包括从比特币矿工到中间人攻击软件的任何东西，以及任何你可以想象不希望在你的资产中运行的东西。

然而，通过仔细应用 GitOps 和 Argo CD，这种不可接受的违规结果是可以避免的。

## 什么是 Argo CD？

Argo CD 始于几年前的 Intuit，当时 Intuit 收购了一家名为 Applatix 的初创公司，并要求其团队开发一种新的自助式开发平台，以提高敏捷性和创新性，并降低复杂性。Applatix 已经有了 Argo Workflows，一个工作流编排引擎，但是在构建这个新平台的过程中，我们意识到需要一个持续部署产品。基于 cloud native 和 GitOps 的最佳实践和原则，Argo CD 应运而生。

根据 Sadeghianfar 的说法，Argo CD 启用的工作流已经存在很长时间了，但这里的关键变化是将其积极应用于集群配置。

Sadeghianfar 说，开发者已经使用 git 作为他们应用程序更新的基础。管理员一直使用供应软件来创建部署脚本，使用 git 作为部署这些资产的位置。

但是对于管理多个集群来说，GitOps 模型特别有效，这不仅是因为 Argo CD 的操作模型非常简单，而且缺乏智能逻辑。

正如 Red Hat 的技术营销经理 Christian Hernandez 所说，Argo CD 并不“聪明”其实是故意装聋作哑。

Argo CD 做了两件事，它根本不会去想它们——它只是做了它们。首先，它将最新的 YAML 从 git 推送到您的集群。其次，它将最新的 YAML 从 git 拉到集群中。

稍微解析一下这个诗意的许可，Argo CD 是双向的——它允许您将 Kubernetes 配置更改推送到 git，然后自动让它连接的每个集群使用那个新的 YAML 文件。如果集群突然使用其他 YAML 配置文件，Argo CD 会直接从 git 中获取正确的 YAML 文件。

事实上，Argo CD 有效地锁定了集群，因此在没有 git 推送的情况下无法更改集群。Hernandez 讲述了试图向客户展示如何在集群上做一些事情的故事，但是当他的更改从控制台到达集群时，Argo CD 立即删除了它，并用 git 中的原始内容替换了更改后的 YAML。它的配置相当于一个带有开关的盒子，可以关闭开关。

![](img/5cd8139894e6a2b4337e07a68dbdad77.png)

## 数字安全

与 git 类似，Argo CD 的简单性实施了一个严格的策略:如果不通过 git，任何集群配置更改都不会发生。这为集群管理增加了 git 的所有安全优势，而几乎没有额外的开销。

首先，git 在默认情况下是安全的。Linus Torvalds 在架构级别构建了大量内置于 git 的安全优势。例如，存储库中每个文件内部使用的 ID 实际上只是文件本身的散列。以任何方式改变文件，文件的 ID 也会改变。因此，如果没有变更的记录，就不可能进行秘密的变更或者毒化存储库。

此外，git 已经绑定到身份验证系统中，使用令牌进行用户识别，并保存对任何文件所做的每次更改的明确历史记录，以及更改者的记录。

通过将所有集群配置转移到这个安全的中央存储库中，Intuit 能够大幅降低部署复杂性。正如赫尔南德斯所说，“我是愚蠢的简单软件的粉丝。这就是为什么我喜欢我们的身份管理，因为它是如此愚蠢和简单。阿尔戈光盘是一个无脑光盘系统。一旦你建立了 Argo，我的 CD 就变得愚蠢简单了。CI/CD 流程的最后一英里由我负责。这是将我的 800 个脚本替换成一个系统，让它为我做所有的事情。”

Sadeghianfar 对此表示赞同，他说:“GitOps 已经开始获得很多关注，因为它是解决这个问题的一种简单方法。Kubernetes 与客户一起经历的这一演变至关重要。GitOps 并不新鲜，但现在它突然变成了组织的加速器。”

Argo CD 即将从 CNCF 孵化器中毕业，并且已经获得了开放源码开发者的健康支持。Intuit 仍然是这个重要项目的最大贡献者，Red Hat 也增加了参与，占据了第二的位置。

“Intuit 坚信开源，回馈是我们的核心价值观之一，”Blixt 说。“但我们不是供应商。我们需要合作伙伴来帮助推动和发展社区，还需要能够支持希望在其环境中部署这一技术的企业客户的人。Red Hat 在帮助推动和发展社区方面有着悠久的历史，尤其是在云原生领域，而这正是我们所寻求的。他们真的把阿尔戈带到了一个新的高度。他们在各个层面都做出了贡献，在工程、产品管理和市场营销方面紧密合作。我真的很兴奋红帽正在帮助阿尔戈和社区到一个新的水平。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>