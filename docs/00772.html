<html>
<head>
<title>Testing Developer Velocity: AWS EC2 vs Lambda vs Lambda on Stackery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试开发速度:AWS EC2 vs Lambda vs Lambda on stack ery</h1>
<blockquote>原文：<a href="https://thenewstack.io/testing-developer-velocity-aws-ec2-vs-lambda-vs-lambda-on-stackery/#0001-01-01">https://thenewstack.io/testing-developer-velocity-aws-ec2-vs-lambda-vs-lambda-on-stackery/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="attribution translated">Stackery 赞助了这篇文章。</p>
<p class="translated">Lambdas比传统的托管虚拟机(VM)如亚马逊的EC2提供更好的速度。但是到底多高的速度呢？我决定找出答案。</p>
<h2 class="translated">遇见你的赛车手</h2>
<a href="https://www.stackery.io/" class="clearfix infoBlock " target="_blank">

<div class="infoBlockTextBlock">
<p class="infoBlockTitle translated">托比·费</p>
<p class="infoBlockText translated">Toby是Stackery的社区开发人员。她的角色和经历结合了软件工程师、作家和技术讲师的工作，用新兴工具构建有趣的项目，并与世界分享她的发现。在加入Stackery之前，Toby是NWEA、瓦卡萨和新遗迹公司的工程师。</p>
</div>
</a>
<p class="translated">我是一个聪明的开发人员:我已经做了几年的web应用程序和前端工作。我家里的机器运转良好。但我绝不是一个Linux呆子——我知道六个命令，当人们开始谈论*nix的许多风格时，我的眼睛变得呆滞。</p>
<p class="translated">为了支持我，我有一个很棒的Stackery团队，他们所有人都可能更有资格，因为他们从事与AWS接口的产品。但我是他们的社区开发者，这意味着我希望能站在普通web开发者的角度。</p>
<p class="translated">我没有固定的规则，但一般来说，我会得到我需要的任何级别的帮助，除了让像<a href="https://twitter.com/txase" target="_blank" class="ext-link" rel="external ">蔡斯·道格拉斯</a>这样真正聪明的人在整个过程中坐在我旁边。正如我将多次提到的，这不是测量完成每一步所花费的原始时间，而是web开发人员计算菜单、配置和文档所花费的时间。</p>
<h2 class="translated">EC2服务:<em> 5小时15分钟</em></h2>
<p class="translated">我确信有Linux书呆子，或者AWS书呆子，他们可以在仅仅一个小时内运行EC2服务。但同样，这里的目标是测量web开发人员启动和运行这些服务所需的实际时间。我们来看看时间细分:</p>
<ol>
<li class="translated">创建并启动服务器:<em> 1小时10分钟。</em></li>
<li class="translated">挑选一个实例——我没有这个项目的预算，所以我花了一分钟来确定一个绝对免费的亚马逊机器映像(AMI)。我还需要一些时间来确保这个Linux版本不会离我习惯的拱门太远。</li>
<li class="translated">添加存储— 8GB似乎很多…对吗？</li>
<li class="translated">配置安全组。该映像默认启用SSH访问，但是这默认抛出一个警告，如果我们真的想要服务HTTP请求，我们需要做一些配置。由于我的应用程序涉及敏感数据，我不能只设置0.0.0.0/0就让任何IP地址通过。</li>
<li class="translated">启动—咖啡休息时间！这最后一步花了10-12分钟。重复几次后，部分原因可能是界面延迟，页面内的“刷新”并不像描述的那样工作…</li>
<li class="translated">进入服务器:<em> 1小时15分钟。</em></li>
<li class="translated">设置我的本地密钥。花了这么长时间，我感到很尴尬。我以前从来没有这样设置过权限！但是我在一台新机器上，忘记了我必须<strong> chmod </strong> 400我的钥匙，当我试图使用它时，我得到的错误信息是……不清楚。</li>
<li class="translated">实际登录。我一直使用默认的<strong> ssh -i </strong>命令，没有用户名，以root用户身份登录。这在AWS实例上显然是不允许的。</li>
<li class="translated">安装节点:<em> 15分钟。</em></li>
<li class="translated">我开始尝试直接抓取节点。那对我不起作用，所以我需要获得节点版本管理器(NVM)并从那里安装。这似乎不是一个常见的问题，但我仍然建议从一开始就使用NVM！</li>
</ol>
<p class="translated">在这篇文章和其他文章中，我取笑虚拟机系统是快速建立web服务的糟糕工具。我第一个承认，一个专家在EC2实例上完成所有这些工作所需的时间不到我所花时间的一半。我只想提一下，在使用无服务器函数时，之前的所有步骤(实际编写一些Javascript)都是零时间的。</p>
<ol start="11">
<li class="translated">安装包:<em> 1小时45分钟。</em></li>
</ol>
<p class="translated">为什么花了这么长时间？交换空间。事实证明，试图在nano实例上运行npm install来获取几个基本包(包括express)实际上会填满内存。令我惊讶的是，你不能在没有<a href="https://aws.amazon.com/premiumsupport/knowledge-center/resize-instance/" class="ext-link" rel="external ">清除实例存储</a>的情况下，仅仅拉动滑块来增加内存。通过一次只安装几个包，我设法达到了内存限制。我认为这种策略比在内存更大的实例上重新开始要快，但是？‍♀️.</p>
<ol start="12">
<li class="translated">实际写点Javascript: <em> 15分钟。</em></li>
</ol>
<p class="translated">我没有为我的IDE找一个合适的连接，而是直接复制/粘贴到SSH终端中。对于简短的服务器代码，我没有使用样板文件。但是我后来意识到我需要解除安全组配置中端口3000的阻塞，</p>
<ol start="13">
<li class="translated">连接我的数据库:<em> 30分钟。</em></li>
</ol>
<p class="translated">对于这一点，我能够逐字使用<a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Tutorials.WebServerDB.CreateVPC.html#CHAP_Tutorials.WebServerDB.CreateVPC.DBSubnetGroup" class="ext-link" rel="external "> AWS指南</a>，但天哪，这仍然需要时间。我本以为会有一个简单的用户界面，因为这是一个如此普通的任务，但遗憾的是没有！</p>
<ol start="14">
<li class="translated">回去连接我的JavaScript代码:<em> 20分钟。</em></li>
</ol>
<p class="translated">这部分没多久！我必须添加一些新的依赖项，配置连接，瞧。我真的不喜欢任何特殊的秘密配置，但是我不认为任何人可以访问这个实例。值得注意的是，这是EC2具有直接优势的一个领域:Lambda代码隐藏得不那么安全，所以一个简单的实现(密钥/秘密就在源代码中)在EC2上更安全一点！</p>
<h2 class="translated">由AWS控制台配置的lambda:<em>1小时16分钟</em></h2>
<ol>
<li class="translated">创建API端点和lambda: <em> 35分钟。</em></li>
<li class="translated">创建一个API端点。请记住，lambda没有任何“在线”存在——没有IP地址，没有URL——没有连接到它的API端点。这里唯一的问题是获得一个域名。</li>
<li class="translated">创造一个λ:<em>1分钟。</em></li>
<li class="translated">创建关系数据库服务(RDS)实例。没有一个选项提供任何真正的机会来做一些不可行的事情，所以我坚持使用默认设置，并很快设置好。</li>
<li class="translated">连接并填充数据库:<em> 40分钟。</em></li>
</ol>
<p class="translated">连接到我的RDS实例只需要一点时间，但是之后，我写了一些SQL，准备好了。为了走这条路，我不得不将RDS凭证硬编码到我的lambda中，这并不理想，但我不知道在我的Lambda代码中包含auth数据会有什么太大的安全风险，前提是该代码不在公共repo中。</p>
<ol start="6">
<li class="translated">写代码:<em> 10分钟。即使是这个非常简单的例子，为lambda编写的代码也比EC2上的express服务少得多。</em></li>
</ol>
<h2 class="translated">由Stackery配置的lambda:<em>14分钟</em></h2>
<ol>
<li class="translated">创建所有资源并连接:<em> 5分钟。</em></li>
<li class="translated">所有的创建和配置都是从Stackery仪表板中的一个画布视图中处理的。</li>
<li class="translated">这五分钟中的四分钟被用来等待三资源堆栈通过CloudFormation进行部署。</li>
<li class="translated">写代码:<em> 5分钟。</em> <br/>由于我可以在自己的IDE中工作，并将更改从GitHub推送到我的堆栈中，这部分比其他路径要快一点。</li>
<li class="translated">配置/填充数据库:<em> 4分钟。</em></li>
</ol>
<p class="translated">我在这里最大的挫折是，我想用可爱的SAM CLI进行本地开发，但RDS实例还不被支持(这似乎是一个很大的任务。)我不想浪费时间来设置本地RDS工具和连接SAM CLI本地映像。</p>
<p class="translated">6.因为Stackery Lambdas会自动获得访问RDS所需的所有参数和配置，所以我可以只做一次lambda来填充DB。</p>
<h2 class="translated">这不是一场公平的战斗</h2>
<p class="translated">我们试图衡量交付相同服务之间的差异，但有一个问题我们还没有解决:我们的EC2服务目前是一个黑箱。</p>
<p class="translated">我们的Lambda将产生非常详细的信息，包括它的执行时间、遇到了多少错误，以及它已经运行了多长时间。相比之下，EC2只会从OS层自动报告:内存使用和正常运行时间。</p>
<p class="translated">从基本差异中更容易预测的是管理和动态加载。我们需要手动关闭EC2实例，或者在管理程序工具上投入更多时间。</p>
<p class="translated">这些都不是障碍:EC2是一张空白的画布，我们完全可以添加观察和监控工具。我在New Relic的时候，随着我们交付越来越多的高级应用程序性能监控工具来检测应用程序代码的各个行，我们最畅销的工具一直是服务器监控，它不会告诉你比Amazon CloudWatch更多的关于EC2实例的信息。</p>
<p class="translated">关键是所有这些在EC2上都是可能的，但这是一场速度的竞赛，所以任何需要额外开发时间的东西都被忽略了。我只想说:这些特性已经内置到我们的Lambda堆栈中了。</p>
<h2 class="translated">结果呢</h2>
<p class="translated">Lambdas确实显著提高了开发人员的速度，Stackery使这些任务更快。这些影响只会被更复杂的堆栈放大，这种比较忽略了在EC2实例上实现除关闭端口之外的任何安全措施。</p>
<p class="translated">如果你使用Stackery，你能在1/7的时间内完成团队的任务吗？不。交付一个特性的大部分时间都花在了编码上，而编写实际的JaveScript所花时间的差异并没有显示出太多的变化。</p>
<h2 class="translated">下一步是什么？</h2>
<p class="translated">我的下一篇文章将在生命周期的六个月后比较这三种设置:当我们的简单服务停止工作时，我们需要探索哪里出错了。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>