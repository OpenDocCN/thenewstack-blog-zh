# Apache Flink 1.4 为统一流和批处理奠定了基础

> 原文：<https://thenewstack.io/apache-flink-1-4-lays-groundwork-better-future/>

Apache Flink 开源流处理软件正在经历一次重大的革新，从下周发布的 1.4 版本开始。这种迭代包括依赖结构的主要重组，并增加了反向类加载。这个版本的 Flink 做了大量工作，让用户为即将到来的 1.5 版本做好准备，该版本旨在将流处理和批处理作业统一在一个 API 下。

“我们一直致力于使[Flink]的流处理功能更加强大。我们一开始是一个带有事件流窗口模型的数据流 API，” [dataArtisans](https://data-artisans.com/) 的首席技术官 [Stephan Ewen](https://twitter.com/stephanewen) 说，该公司提供 Flink 培训和商业支持。“在最近的版本中，我们用 [Stream-SQL](http://flink.apache.org/news/2016/05/24/stream-sql.html) 扩展了[Flink],并用一个 API 使它更低级，在这个 API 中，您可以随着时间的推移对状态进行更细粒度的控制。”

Ewen 说，许多 Flink 用户来自批处理世界，使用 Flink 处理批处理和流处理作业。他说，Flink 的能力使它能够像处理流式作业一样处理批量作业。Ewen 表示，Flink 正在成为许多企业数据处理应用的关键部分。

“我们也看到使用[Flink]的用户构建独立的应用程序，他们开始在流处理器上构建这些应用程序，并在流处理器上构建他们的业务逻辑。他们需要一个更底层的接口来说，‘给我一个事件，我有逻辑来应用它。’”Ewen 说。

Ewen 说，Apache Flink 的一大优势是它能够提供增量检查点来保持流处理器中的状态。在一个普遍认为状态应该从可扩展的基于云的应用程序中抽象出来的世界里，Flink 持相反的观点。可以这么说，Ewen 觉得这个行业正处于一种国家对国家的否认中。

“也许它在云的某些部分有效。你假装在一个无状态的世界里，说状态是由别人处理的，比如云服务。“最终，”埃文说，“它仍然是国家。如果你把它变成别人的问题，你必须担心他们如何处理数据，保持数据的一致性。只应用一次更新很难。将状态放在流中是一个非常自然的答案。如果你有合适的工具，那是很有可能的。这是非常强大的，也是我们在 Flink 一直追求的重要事情。”

Ewen 说，Flink 使用的方法是部署分布式快照或检查点，这在保持容错的同时提供了处理的完全解耦。Ewen 说，这种方法使它“易于集成，以便为不太容易记录变化的数据结构增加容错能力。它们可能来自传统图书馆。如果你能说，‘把那个检查点的状态序列化给我’，你就能让这个东西容错。”

## 现在就为未来做计划

Ewen 说 1.4 版本和计划于明年推出的 1.5 版本是孪生版本。在两种趋势的推动下，Flink 即将发生一系列重大变化。一个是 Flink 和流处理通常面临的用途多样化，Ewen 阐述道。另一个是批处理和流处理的统一。

Ewen 说，dataArtisans 和 Apache 的团队决定将这个版本分散到两个版本中，这样就不会因为一次大规模的改变而使用户群过载。版本 1.4”有一系列非常重要的修复、其他工具和特性。我们还不想推动这些更大的变化，因为更大的变化很难被采纳。”

在为 1.5 做准备时，Flink 的 1.4 版本包括了 Stream-SQL 中的大量工作，Stream-SQL 是一种查询语言，它用处理实时数据流的能力扩展了 SQL。Flink 的这个版本增加了流连接，一个连接器 API，与 Kafka 的更高版本的集成，以及[它们的事务一次性能力](https://thenewstack.io/apache-kafka-1-0-released-exactly/)。

“我们已经对依赖结构做了很大的修改，”Ewen 说。这包括对 Flink 如何进行类加载到类解析的重大修改，以解决用户看到的依赖版本冲突。

> “实际上，许多系统即使统一了 API，也仍然在底层运行两个不同的批处理和流引擎。我们认为将这些更深层次的东西结合在一起是很有潜力的”——Stephan Ewen

这个修正意味着团队可以在他们的核心 Flink 安装中使用一个版本的 [Akka](https://akka.io/) 分布式消息平台，同时在它的基础上使用另一个版本来构建应用程序。这种返工也扩展到包括 Flink 的库。例如，以前，Flink 包含了许多 Hadoop 库，但现在这些库已经作为依赖项被删除了，并且完全是可选的。

对于下一个版本 1.5，Apache Flink 团队有一个大计划。首先是一个重写分布式流程的项目。目前，Flink 提供主进程、客户端进程和工作进程。这些将由新的类型来补充，比如 dispatcher 进程。这些改变将有助于 Flink 在由 [Kubernetes](/category/kubernetes/) 管理的环境中运行得更好。

“基本原则中要求最大程度采用的是容器基础设施，比如 Kubernetes。他们引入了一些有趣的东西，如覆盖网络和不同的协调方式，但他们也需要框架来采用这种思维方式，”Ewen 说。

以前，Flink 可以使用 YARN 或 Mesos 来安排工作和管理员工，但迁移到 Kubernetes 后，该平台需要进行重大转变。“我们不相信弯曲纱线是正确的事情，因为这是一种不同的使用情况，”Ewen 说。“从 Kubernetes 的角度来看，这来自于用户构建最初的无状态和后来的有状态应用程序容器。应用程序获得的资源数量不是由应用程序框架控制的，而是由 Kubernetes 控制的。Kubernetes 说，“我给你五个容器，让它与五个容器一起工作，”而以前 Flink 会说，“给我八个来自 Mesos 的容器。”"

Ewen 说，Flink 1.5 的另一个工作领域是批处理和流的统一。“从两个层面来考虑。对于编程抽象，我们已经做了很多工作:当前的数据流 API 处理有限和无限程序。Flink 有一个专用的批处理 API still，它有一些特殊的结构来运行不能自然转换成流的循环程序。在流式 API 方面，我们正在开发越来越多的统一 API。”

“下一步更多的是统一到运行时，”Ewen 说。“实际上，许多系统即使统一了 API，也仍然在底层运行两个不同的批处理和流引擎。我们认为，在更深层次上统一这些标准有着巨大的潜力。如果您在流中处于追赶模式，您可以利用批处理的相同优势。为了做这些事情，你需要更深层次的整合。这些系统传统上是不同的，Flink 一直试图让它们保持紧密，但我们需要更深入地统一它们。”

![](img/ab2d93ae308f27465bb0f36106f05ddc.png)

由 [Ludovic Fremondiere](https://unsplash.com/@ludovicphoto) 通过 Unsplash 提供的专题图片。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>