# 管理 Kubernetes 成本的 5 个基本技巧

> 原文：<https://thenewstack.io/5-essential-tips-to-manage-kubernetes-costs/>

[Circonus](https://www.circonus.com/) 赞助了这篇帖子。

如果您在 Kubernetes 部署上的花费超出了预期，您并不孤单。许多 Kubernetes 运营商正在经历比他们预测的更高的 Kubernetes 成本。这是因为，像 Kubernetes 的许多方面一样，确定如何管理或降低成本可能具有挑战性。在本文中，我们提供了如何实现更具成本效益的 Kubernetes 部署的五个基本技巧。

## **1。决定该工作负载是否适合 Kubernetes**

 [贾斯汀·德弗兰克

贾斯汀是 Circonus 的销售工程师。他从事软件工作已经 7 年了，在销售工程和产品管理方面都担任过职务。他持有经过认证的 Kubernetes 管理员证书，对大规模分布式系统充满热情。](https://www.linkedin.com/in/justin-defrank-6a255b62/) 

Kubernetes 可以为许多工作负载提供显著的成本优势，但不一定是所有工作负载。如果你简单地把所有东西都扔进 Kubernetes 并期望省钱，你可能最终会造成技术债务，或者运营噩梦。您需要决定该工作负载是否适合 Kubernetes。

需要考虑的关键问题有:

*   "这个工作负载需要保存状态吗(像一个数据库)？"
*   "它是否提供了上下旋转的容忍度和它被创造的额外实例？"

如果将工作负载转移到 Kubernetes 会降低运营速度，并需要雇用额外的资源，那么在 Kubernetes 上运行工作负载可能并不划算。

## **2。了解工作负载的一般资源需求**

在将工作负载转移到 Kubernetes 之前，您需要做一些功课。您必须决定在集群中使用何种大小和类型的节点，因此必须清点所有工作负载的资源需求，主要是 CPU 和内存。对于有状态的工作负载，您还需要考虑需要多少存储。在需要扩展之前，对资源消耗和它可以处理的负载量有所了解，将有助于总体成本估算。

好的一面是，大多数(如果不是全部的话)编程语言都有某种形式的分析支持来了解资源消耗。将分析工具与负载测试工具配对，您将会很好地了解应用程序在压力下的表现。一些开发人员可能不愿意迈出这一步，因为到目前为止工作负载表现良好。但是这种方法会导致额外的成本。在这一过程中收集的信息将为您在 Kubernetes 之旅中做出的许多决定提供信息。

## **3。选择合适大小的节点**

不幸的是，没有选择正确大小节点的灵丹妙药。更困难的是，Kubernetes 允许您混合节点大小以适应您的工作负载。这在很大程度上取决于您必须部署的应用程序数量、它们的资源需求以及它们的规模/复制因素。归根结底，请记住，主要目标是减轻操作负担，并利用容器及其编排所提供的更高的利用率。

其他需要考虑的事情:在云提供商内部或外部设置某种类型的可观察性和警报。这可以让您知道:您当前的支出是多少，并且当有额外的节点联机时，它会向您发出警报—可以是由运营工程师手动添加的，也可以是在启用了群集垂直扩展的情况下自动添加的。将该事件与 Kube-Scheduler 的日志联系起来，可以让您了解需要部署什么，从而触发对更多节点的需求。评估节点大小和应用的节点-pod 关联性是一项应经常进行的练习，以管理云 Kubernetes 的成本。

## **4。正确设置您的资源请求和限制**

根据对工作负载的资源消耗分析，花时间相应地正确设置资源请求和限制。这体现了容器编排带来的利用率提高的附加值。当掌握了资源需求的知识后，Kubernetes 可以更有效地打包您的节点，从而避免资源浪费。

一旦设置了限制并部署了工作负载，您就可以实施更多高级功能，如水平机架自动缩放器(HPA)。HPA 是 Kubernetes 中自动伸缩的核心组件，它可以根据需要放大或缩小 pod。HPA 可以按照现成的 CPU 和内存等指标运行，也可以配置为按照自定义指标运行。

## **5。对您的应用具有可观察性**

如果你只是在监控 Kubernetes，而实际上并没有观察到运行在那里的应用程序，那么你只能看到画面的一半。除了了解每个单元占用的 CPU、内存、网络和存储容量之外，您还需要了解对您的组织至关重要的底层应用程序指标，例如每秒请求数、每分钟新用户数等。

HPA 可以配置为根据自定义收集的指标运行，如下所示。如果您需要扩展一些不直接公开的利用模式，如 CPU 或内存，这可能会很有用。这将允许您的组织对集群大小和未来的可变性做出更明智的决策。其他可观察性途径将与您的云提供商直接相关——密切关注与您的 Kubernetes 集群相关的支出、针对添加到您的 Kubernetes 集群的额外节点的警报等。

无论您正在考虑部署 Kubernetes、刚刚开始部署还是已经开始部署了一段时间，在您的组织中设置这些指导原则都有助于优化您的 Kubernetes 性能和成本。首先，通过实施这些建议，你可以快速节省大量成本，并更准确地预测成本，以避免那些令人惊讶的账单。虽然可能需要一些工作来开始，但这方面的努力会有很大的回报。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>