# 通过秘密管理保护管道

> 原文：<https://thenewstack.io/securing-pipelines-through-secrets-management/>

机密管理在保持管道和应用安全方面发挥着关键作用。虽然机密管理工具有所帮助，但您需要实施最佳实践和流程来成功管理 DevOps 环境中的机密。这些流程的标准化、自动化和集成也有助于通过减少人为错误的机会来保护机密。

在本文中，我们关注秘密管理，并讨论如何使[持续集成和持续交付(CI/CD)管道更加安全](https://circleci.com/blog/secure-ci-pipeline/)，确保系统受到保护和安全。

## 什么是秘密管理？

 [罗恩·鲍威尔

罗恩有空间物理学的背景，曾作为卡西尼小组成员分析土星磁层中的等离子体。他现在在旧金山的 CircleCI 公司工作，是一名开发人员，倡导开发内容，使开发人员能够更快地构建、测试和部署他们的项目。](https://www.linkedin.com/in/powellronald/) 

简而言之，机密管理使用组织内的工具、实践和流程来保护非人类身份。这确实需要一点工作来开始。一旦您有了自己的秘密管理系统，您就有了一个更加安全的环境，而不会阻塞那些可以并且应该自动运行的系统。您确保只有您信任的人才能访问您的资源；撤销访问权就像授予权限一样简单。

管理机密与特权用户访问和管理重叠。然而，为了避免长期的混乱，你不应该混合他们的管理。重叠的方面包括:访问请求认证；通过分配所需的最低特权来实现基于角色的访问；确保秘密和凭证是复杂的并且经常轮换；审计账户和秘密的使用和管理；以及从代码、配置和其他不安全的领域中移除秘密。

您应该在哪里使用机密管理？答案就在你能找到的任何地方。然而，容器、虚拟机和 CI/CD 管道是最好的起点。这使得应用程序能够在伸缩或弹性环境中检索和使用机密。

## 创造强大的秘密

确保质量秘密管理实践的第一步是确保秘密本身是强有力的。像基于用户的密码一样，强密码很长、很复杂并且经常更改。确保这些秘密定期改变——越频繁越好——也可以防止任何意外泄露的秘密长期有用。

您的应用程序和基础设施也使用 API 和 SSH 密钥之类的秘密。然而，与普通用户密码不同，应用程序、管道和容器中使用的帐户可能是孤立的，很难跟踪。

这里最重要的因素是人与人之间的互动。人们直接或间接地导致秘密泄露。这意味着像直接将你的秘密放入开源项目的源代码控制中这样的事情(是的，开发者已经这样做了)。

创建和保护组织机密的第一步是建立流程——创建机密、跟踪机密和确保机密安全的流程。例如，您可以采用要求甚至测试程序来帮助防止将纯文本密码放入配置文件，并将其保存到可以通过其他方式访问的应用程序、虚拟机、服务器或容器中。

## 自动化机密管理

为了解决人为错误的问题，让我们来谈谈自动化秘密管理。目标是在引入策略和自动化以消除手动检索和使用需求的同时，将对 DevOps 资源的影响降至最低。这降低了创建不一致的风险，遵守了策略并保护机密不被泄露。

虽然机密管理应用广泛，但是您可以并且确实应该将您的机密管理直接集成到您可能已经采用自动化的工作流程元素中: [CI/CD 管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)。

自动化消除了秘密管理中的人为因素。然而，计算机不是不会犯错的；他们依靠人类来使用他们的工具。

一旦您的机密管理、策略和集成就绪，机密维护就会变得容易得多，机密轮换也会变得更加频繁。自动化对于企业级的组织尤其重要，否则就需要整个团队单独监控和管理机密。

## 机密管理工具

既然您正在考虑自动化您的秘密管理，让我们来看看秘密管理工具。

所有主要的云服务提供商都有秘密管理器，如 Azure Key Vault、亚马逊网络服务(AWS)秘密管理器和谷歌秘密管理器。这些产品的独特优势在于嵌入到他们自己的云环境中。例如，如果你只使用 Azure，那么 Key Vault 就适合你。这些工具易于开箱即用，并使用云提供商的访问条款来获取和管理机密。

但是，如果您有多个云服务提供商、复杂的 CI/CD 管道、混合环境或没有内置机密管理器的环境，会发生什么情况呢？你需要一种不同的方法。外部工具，如 HashiCorp Vault、Akeyless Vault、CyberArk Enterprise Password Vault 和其他工具，支持全面的单一管理系统。

大多数 [CI/CD](https://circleci.com/continuous-integration/) 工具集成了当今大多数(如果不是全部)机密管理工具。这使您能够在 CI/CD 过程中从 vault 中检索机密，同时独立于 CI/CD 过程管理这些机密。这些集成还可以将 CI/CD 管道从代码中发现的任何秘密转移到秘密管理器中。

定期循环您的机密是一个好主意，根据您的策略和程序，您的策略可能是在发布时循环机密。为此，您可以指示 CI/CD 进程在发布期间在保管库中生成新的机密。当这完全自动化时，你不仅生成了一个新的秘密，没有人知道这个秘密是什么，而且你还可以完全控制这个秘密启用的特权。这大大降低了秘密泄露和成为公共令牌的风险。

## 包裹

机密管理是保护系统安全的关键部分。如果你还没有设置好，越快越好。除了管理您的机密，自动化机密管理是降低安全风险的重要一步。

您可以通过机密管理自动访问机密，包括在 CI/CD 管道中。当你的团队可以创造新的创新时，他们不再需要花时间管理秘密。初始设置完成后，无需人工干预，进一步提高了安全性。

CI/CD 改变开发团队文化。当谈到开发团队的成功时，找到正确的 [DevOps 度量标准来衡量](https://circleci.com/blog/engineering-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q2---blogSecureSecrets)是至关重要的。了解[如何在软件交付的](https://circleci.com/blog/how-to-measure-devops-success-4-key-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q2---blogSecureSecrets) [2020 年阶段用四个关键基准来衡量 DevOps 的成功](https://circleci.com/resources/2020-state-of-software-delivery/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q2---blogSecureSecrets):工程团队的数据支持基准。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>