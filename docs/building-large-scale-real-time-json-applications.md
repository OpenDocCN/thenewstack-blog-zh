# 构建大规模实时 JSON 应用程序

> 原文：<https://thenewstack.io/building-large-scale-real-time-json-applications/>

*“实时”描述在[规定的时间间隔](https://en.wikipedia.org/wiki/Real-time)内对输入做出可靠响应的各种操作或过程—维基百科*

 [尼尔·法德尼斯

尼尔是 Aerospike 公司开发人员参与部的主任。他是一名技术专家，在构建创新产品并将其推向市场方面拥有丰富的领导经验。他曾在 Tealeaf、Efficient Frontier、AOL 和 Netscape 担任高级工程管理职务。Neel 拥有波士顿大学的 MBA 学位、威斯康星大学麦迪逊分校的计算机科学硕士学位以及马德拉斯印度理工学院的 B.Tech 学位。](https://www.linkedin.com/in/neel-phadnis/) 

实时数据必须在生成后立即进行处理，否则，其价值就会降低，实时应用程序必须在很短的时间内做出响应，否则用户体验和业务成果都会受到影响。实时应用程序必须能够可靠、快速地访问所有数据，无论是实时数据还是其他数据。

人与设备之间的实时交互数量持续增长。利用实时数据在某些领域仍然是一种竞争优势，但它的使用在其他领域也是意料之中的。最新的相关信息有望提供最佳的客户体验或业务决策。

如今，许多数据都是以 JSON 格式生成、传输、存储和消费的，包括来自物联网传感器和社交网络的实时数据，以及用户资料和产品目录等先前数据。

因此，JSON 数据无处不在，并且在使用中不断增长。越来越基于人工智能/机器学习(AI/ML)算法的最佳可能实时决策将通过不断更新的海量数据集来实现。

## 概观

本文从数据库的角度讨论构建大规模实时 JSON 应用程序，并涉及以下关键主题:

*   在实时数据平台中寻找什么。
*   如何组织 JSON 文档以提高速度？
*   易于开发所需的核心 JSON 功能。

## 大型 JSON 应用程序的数据库

下面描述了构建此类应用程序对数据库的关键要求。

### 大规模可靠快速随机访问

任何规模和任何读写工作负载组合的读写操作都需要可靠快速的响应时间，以满足实时合同。这通过以下方式实现:

*   向所有节点快速、统一地分发基于哈希的数据，以实现最佳资源利用率

*   在 DRAM、SSD 和其他设备的最佳组合中经济高效地存储索引和数据
*   优化写入和垃圾收集处理，实现可预测的响应
*   对应用程序中所有数据的一跳访问
*   透明地处理群集转换和数据移动的智能客户端
*   用于快速访问的主索引和辅助索引
*   异步和后台处理模式可提高效率
*   在一个请求中自动执行许多单记录操作的多操作请求

### 快速摄取速率

数据库必须支持快速接收速度，以便实时数据馈送的激增不会淹没系统或导致数据丢失。

数据库必须支持读取、写入、删除和用户定义逻辑的批处理操作，以便摄取可以实现必要的高吞吐量。

### 快速查询

数据库必须有效地处理大型数据上的并发查询，并提供各种索引，最好是对查询并行处理的粒度控制。

### 方便的基于 JSONPath 的访问

基于 JSONPath 的文档 API 提供了一种方便的方法来访问和修改文档中的特定元素，这将在下面讨论。

### 丰富的文档功能

JSON 文档以必须提供丰富功能的数据类型存储在数据库中，如下所述。

### 高效存储和转移

内部格式必须允许文档有效地存储和传输。

### 丰富的 API

API 必须支持服务器端的复杂处理，以消除客户端的数据检索。

### 很好地集成到其他性能特性中

文档数据类型必须很好地集成到各种性能特性中，包括服务器端处理、[批处理请求](https://developer.aerospike.com/blog/batch-operations-in-aerospike)、多操作请求和二级索引。

*   文档可以用在提供高效服务器端执行的[表达式](https://developer.aerospike.com/tutorials/java/expressions)中。
*   可以对多个文档执行批量请求。
*   多操作请求允许在一个请求中对一个文档执行多个操作。例如，在同一个请求中，您可以向 JSON 数组中添加条目，对其进行排序，获得新的大小和前 N 个条目。
*   任何嵌套级别的文档元素都可以被索引，以便快速方便地访问，这将在下面进一步描述。

### 与其他系统同步数据

数据库必须能够控制通过[跨数据中心复制(XDR)](https://aerospike.com/resources/tech-videos/xdr/) 将全部或部分数据高效复制到其他集群。边缘-核心同步通常对于收集实时数据以及在边缘提供实时用户体验是必要的。如下所述，各种连接器有助于方便快速地与其他系统同步。

### 易于与实时数据流集成

数据库必须提供[流连接器](https://docs.aerospike.com/connect)来与 Kafka、Pulsar 和 JMS 等标准流平台集成，并允许 CDC 流被传送到任何 HTTP 端点。

### 从数据处理和分析平台快速访问

数据库必须提供从 [Spark](https://docs.aerospike.com/connect/data-processing) 和 [Presto (Trino)](https://docs.aerospike.com/connect/data-access) 等平台的快速访问，以在各自的平台上实现分析、AI/ML 和其他处理。

## 为规模和速度而组织

构建大规模 JSON 应用程序的一个关键部分是确保在数据库中高效地组织 JSON 对象，以实现最佳的存储和访问。
文档可以通过一个或多个名称空间(数据库)在数据库中组织成一个或多个专用集合(表),以反映摄取、访问和移除模式。多个文档可以被分组并存储在一个记录中，或者存储在单独的箱(列)中，或者作为容器组文档中的子文档。

记录键被构造为集合 id 和组 id 的组合，以提供快速的逻辑访问和面向组的文档枚举。例如，股票的报价机数据可以组织在多个记录中，其关键字由股票代码(集合 id) +日期(组 id)组成。可以使用带有过滤表达式(谓词)的扫描和/或对辅助索引的查询来访问多个文档。

过滤器表达式由 JSON 中元素的值和属性组成。例如，子树中存在大于特定大小或值的数组。在基本类型或集合类型上定义的辅助索引提供了快速的基于值的查询，如下所述。

## 示例:实时事件数据

实时事件流可以作为 JSON 文档接收并存储在数据库中。为了允许通过`event-id`和时间戳进行访问，它们可以组织如下:

```
Record key:(namespace,  set,  <event_id>)
JSON bin:
{  
 id:  <event-id>,
 timestamp:  <ts>,
 …  
}

```

基于事件 id 的文档访问是简单的记录访问，通过在记录关键字中加入事件 id。通过定义整数索引，可以对时间戳进行精确匹配或范围查询。

为了获得更大的可伸缩性，可以将多个事件对象分组到一个文档中:

```
Record key:(namespace,  set,  <group-id>)
JSON bin:
{
events:  [  
 {
      id:  <group-id,  event-num>,
      timestamp:  <ts>,
      …  
 },
 …
]
}

```

事件 id `id`包含组内唯一的组 id 和事件编号。标识记录的组 id 可以是时间段标识符，例如覆盖记录中所有事件的一年中的日、周或月，或者是用于所有记录事件的另一个逻辑标识符，例如传感器 id。

为了通过事件 id 直接访问事件，从事件 id 中提取组 id，通过组 id 访问记录，然后对匹配的`id`字段发出 JSONPath 查询。对时间戳的精确匹配或范围查询可以通过在记录中的各个字段上创建整数索引来执行。

资源:

## 使用 JSONPath 的 CRUD 操作

数据库必须提供存储 JSON 文档、检索它们以及对 JSONPath 标识的元素执行 CRUD 操作(创建、读取、更新和删除)的能力。

可以找到关于文档 API 的更多详细信息:

## 查询 JSON 文档

数据库必须提供快速有效的文档查询。对性能敏感的操作也可能需要对查询的并行处理进行控制。

在 [Aerospike Database 6.1+](https://aerospike.com/blog/query-and-data-distribution/) 中，任何 JSON 元素都可以被索引以支持精确匹配和范围查询。在 6.0 和更高版本中，并行分区粒度二级索引查询可用于提高大规模应用程序的吞吐量。在博文“[更快地查询 JSON 文档](https://developer.aerospike.com/blog/query-json-documents-faster)”中可以找到更多关于索引 JSON 文档的细节，在 [CDT 索引教程](https://developer.aerospike.com/tutorials/java/cdt_indexing)中可以找到代码示例。

实时大规模 JSON 应用程序需要可靠、快速的数据访问、高接收速率、强大的查询、丰富的文档功能、没有实际限制的可伸缩性、始终在线的操作以及与流和分析平台的集成。他们需要低成本的这一切。

[Aerospike 实时数据平台](https://aerospike.com/)提供了所有的功能，使其成为构建此类应用的良好选择。Aerospike 的集合数据类型(CDT)提供了强大的建模、组织和查询大型 JSON 文档存储的能力。访问[开发者中心](https://developer.aerospike.com/)上的[教程](https://developer.aerospike.com/tutorials)和[代码沙箱](https://developer.aerospike.com/tutorials/sandbox)，探索平台的功能，并体验 JSON 的文档 API 和查询功能。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>