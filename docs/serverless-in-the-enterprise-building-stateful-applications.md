# 企业中的无服务器:构建有状态应用程序

> 原文：<https://thenewstack.io/serverless-in-the-enterprise-building-stateful-applications/>

[](https://www.linkedin.com/in/andythurai/)

 [安迪·图雷

安迪·图雷(Andy Thurai)是一位专注于云、aiOps、AI、ML、DL、Edge、IoT 等新兴技术的技术影响者和思想领袖。他是许多初创公司和企业高管值得信赖的顾问，擅长向 cxo 出售复杂的技术。他的网站是 TheFieldCTO.com。](https://www.linkedin.com/in/andythurai/) [](https://www.linkedin.com/in/andythurai/)

云原生应用允许企业以更加敏捷、灵活的方式设计、构建、部署和管理整体应用。这些应用程序通过容器、现收现付模式和分布式运行时来加速业务价值，同时推动更高的运营效率和成本节约。

然而，当前的无服务器实现(即功能即服务，简称 FaaS)无法完全管理分布式云原生解决方案中的业务逻辑和状态，这导致了超大规模应用程序的低效率。无服务器应用程序设计需要一种“有状态”的方法。

在其核心，无服务器计算拥有巨大的前景，因为它帮助企业:

*   专注于应用程序开发，而不是担心基础架构。使用无服务器，云运行时将根据需要自动扩展。
*   只需编写一次，就可以在任何地方运行，而不用担心操作整个堆栈。雇用和保留全栈工程师非常昂贵。
*   以接近零的延迟为高强度云工作负载扩展基础架构，并按使用时间付费。

也就是说，最广泛使用的无服务器模式——FaaS——有其局限性。当无服务器函数执行时，它们通常会丢失需要恢复的计算上下文。在数百万个短暂的、无服务器的超大规模实例中分发这种上下文极其困难，可能需要持久的外部数据存储或消息队列。因此，在应用层模拟超大规模是一个很难解决的问题。如果不能解决这个问题，应用程序的扩展就不能自动化，这就限制了应用程序的真正弹性。

不幸的是，许多企业用例需要有状态——例如长期运行的工作流、人工批准的流程和电子商务购物车应用程序。一般来说，工作流需要某种与之相关的状态。纯粹的无服务器功能不能提供这些，因为它们存在的时间很短。获取应用程序状态最常见的方法是频繁访问数据库或将状态保存在客户端。但是从安全的角度，以及从扩展数据库实例的角度来看，这两种方法都不是好主意。

## 什么是有状态无服务器？

想象一下这个场景:你的组织建立了一个电子商务平台，开发者可以在这个平台上专注于库存管理、竞争性定价、交付管理和客户体验；而不是编写大量的基础设施代码来管理季节性、区域性和情境性的使用高峰。

听起来不可思议，对吧？让这一切成为可能的是一个有状态的无服务器模型，它可以扩展应用层并保留云原生应用的状态，而不是像 FaaS 提供的那样，只扩展基础架构层。分发状态的一个聪明的方法是复制和持久化数据(即状态和行为共存)。不仅仅是当前状态，而是导致当前状态的所有状态和事件的全部历史。

因此，在出现故障的情况下，服务可以通过重放事件从任何以前的状态恢复到当前状态来进行自我修复。特别是， [Cloudstate](https://cloudstate.io/) 版本的有状态无服务器模型——它是有状态无服务器、事件源和 Akka 的组合——不仅在任何给定时刻都是有状态的，而且是自我修复的，可以从任何灾难中快速恢复到当前状态，而无需任何外部模拟。

扩展数据库或复制缓存系统可能会很快触及大量数据。通过事件源，函数可以在启动时水合(或赶上)到当前状态。这意味着不需要为每个事件处理往返于外部的、持久的数据存储——它可以自给自足。这些分布式功能成为 ZeroOps 应用程序的真正扩展。根据需求，应用程序现在可以真正具有弹性，并在云中无限扩展。

## 管理状态:云中企业的银弹

有状态无服务器方法允许企业构建复杂的工作流，而不需要往返数据库。如果您在无服务器设计中使用一系列拼凑的函数链，让函数触发其他函数，在工作流中有很多队列，或者频繁的数据库连接，那么您需要重新考虑使用有状态无服务器的设计。在撰写本文时，有几个流行的框架可以考虑，包括 [Cloudstate](https://cloudstate.io/) ，Azure Durable Functions(基于 [Dapr](https://dapr.io/) ，以及 [RIFF](https://projectriff.io/) 。

即使这些函数被设计为保持更长的时间——几天甚至几个月——您将只为函数执行的时间付费，而不是在它等待某件事情发生的时候。这些功能执行速度也很快，因为没有按需配置开销。它们将在“睡眠模式”下运行，当编排功能调用它时被唤醒，在工作流周期中执行其工作，保持状态，并转换回睡眠状态。计费是基于它执行的时间和使用的内存，而不是在它处于睡眠模式时，这是一个真正的基于消耗的定价模型。

## 结论

有状态无服务器可以让企业在云原生环境(公共云和私有云变体)中毫不费力地快速扩展其应用层，与当前无服务器模型扩展基础架构层的方式非常相似。虽然由云提供商实施的特定于云的实施可以帮助实现特定的云，但是您需要选择工具，例如上面提到的那些工具，它们可以在混合环境中提供帮助。

是时候将您的云原生企业应用提升到下一个级别了。分布式企业应用程序需要维护状态、自我修复、快速从灾难中恢复，并在基础架构和应用程序层进行扩展，而对集中式数据库的依赖性最小。这将消除应用程序流中的瓶颈，并允许您的应用程序超大规模运行。

如果您想更详细地探索这个架构，请下载由 Akka 的创建者和 Lightbend 的 CTO Jonas bonér 撰写的[构建有状态的应用程序](https://www.lightbend.com/ebooks/build-stateful-applications)，并开始构建有状态的企业应用程序。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>