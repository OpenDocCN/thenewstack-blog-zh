# 基础设施即代码和不可变基础设施带来的新安全挑战

> 原文：<https://thenewstack.io/new-security-challenges-with-infrastructure-as-code-and-immutable-infrastructure/>

[](https://www.dome9.com)

 [罗伊·费恩图奇，Dome9 安全

罗伊·费恩图奇是 Dome9 安全的联合创始人兼 CTO。自 2011 年以来，Roy 已经为一些最大的 AWS 部署提供了增强的网络安全性和身份访问管理保护。作为一名经验丰富的技术领导者，他已经花了十多年的时间在各种以色列高科技创业公司中管理研发。此前，他曾在 DV-Tel 担任首席架构师，专注于 IT 安全管理解决方案和 IP 视频开发，并在 IDF C4I 军团担任队长(预备役)。](https://www.dome9.com) [](https://www.dome9.com)

在过去的 10 年里，我们已经看到软件应用程序的开发、部署和管理方式发生了巨大的变化。对快速创新和更短周期的需求导致了持续集成/持续交付(CI/CD)和 DevOps 实践和工具的兴起，以使交付更快、更一致和无错误。许多变化来自谷歌、脸书和亚马逊的超大规模环境，这些环境管理着巨大的基础设施足迹，每天推动数百个软件变化。由于公共云的兴起和 DevOps 运动的出现，这些实践现在广泛适用于所有构建应用程序的企业。公共云服务已经发展到支持这些敏捷实践，允许 API 支持的自动化以及资源的快速供应和取消供应。

作为一家提供 AWS 上托管的 SaaS 产品的云安全公司的首席技术官，我亲眼目睹了我们自己的进步以及我们的客户进入 DevOps、基础设施即代码(IaC)和不可变基础设施的旅程。

## 基础设施即代码

IaC 的概念是通过使用机器可读的蓝图，而不是手动摆弄物理硬件或云提供商的 UI 控制台，以自动化的方式部署和配置 IT 基础架构。AWS 本地格式被称为云形成模板(CFT)；Google 和 Azure 提供了自己的实现。Hashicorp 的 Terraform 是一个多供应商解决方案，正在获得发展势头。

IaC 加速了基础设施的部署，并允许快速迭代。它还消除了一次性的非标准配置(雪花),并建立了基础设施开发/部署流程的一致性和可重复性。

基础架构部署流程的自动化增加了安全性和合规性测试的重要性，就像使用 IaC 一样，只需按一下按钮，您就可以对您的云环境进行极具影响力的更改。这是敏捷的另一面。在公共云中，简单的配置更改可能会将敏感数据和私有服务器暴露给外界，自动化的安全影响是深远的。

另一个有趣的变化与现在驱动基础设施的角色有关。在传统模式中，网络团队控制网络和网络安全设备，应用团队开发软件，而运营团队部署和维护软件。现在，在 JSON 文件中定义了整个基础设施的地方，DevOps 人员已经开始使用键盘了。这将安全人员置于一个奇怪的新地方——他们现在试图跟上变化，而不是成为一个瓶颈。有时追溯既往。

在机会方面，IaC 允许团队采用成熟的软件开发实践，并将它们带入基础设施领域。在这个勇敢的软件定义的新世界中，基础架构模板被登记到源代码控制系统中，在源代码控制系统中，每个基础架构更改都可以被审计、测试、恢复并合并到[软件协作/批准工作流](https://www.hashicorp.com/blog/version-controlled-infrastructure-with-github-and-terraform)中。

从成熟度的角度来看，我们可以看到组织正在经历几个阶段:

1.  **手动安全评估**:这种方法包括在部署之后手动检查活动的基础设施，并在将其部署到活动环境之前检查架构/模板。虽然 DevOps 团队是创建 CFT 和 Terraform 模板的专家，但大多数传统安全团队并不熟悉这些技术。检查这些 CFT 的安全状况是一个缓慢的手动过程，需要在运营部门和安全部门之间来回进行大量工作，从而限制了 CI/CD 渠道。
2.  **对实时环境的持续监控**:在这种方法中，实时生产环境被持续监控是否有违反安全性和合规性的情况。这通常是通过专用的云安全服务来实现的，这些服务提供持续的安全性和合规性测试。虽然本质上是反应性的，但这种类型的监控确实涵盖了自动更改以及手动/定期更改。
3.  **在沙盒环境中部署和测试**:IaC 的可重复性是这种新方法的促成因素，模板首先被部署到临时环境中。自动化(有时是手动)测试验证在将变更推向生产环境之前没有安全性和合规性倒退。所有这一切都由自动 CI/CD 管道来协调，然后该管道会终止临时环境。虽然这种方法在确保部署到生产环境的代码满足安全性和合规性要求方面是有效的，但是在时间、资源和解决方案复杂性方面可能是昂贵的。
4.  **部署前的静态(基础设施)代码分析**:在这种方法中，我们像对待任何其他软件代码一样对待模板，并在代码提交后执行安全性和合规性单元测试，作为标准 CI 流程的一部分。这是一种非常有前途的新方法，可以将安全&合规性尽可能地带到源头，大幅缩短检测时间，并降低方法#1 和#3 的操作复杂性。

## 不变的基础设施

不可变基础设施将 IaC 带到了下一个层次。这是基础设施部署和维护的范例，其中服务器在部署后从不修改。为了对软件进行任何更新或修复，需要部署根据修改后的基本映像构建的新服务器，并取消对旧服务器的配置。不可变的基础设施源于对基础设施中更大的可预测性和可靠性的需求。通过消除修补和就地服务器升级的需要，不可变基础架构通过消除部署的服务器占用空间中的死角和不一致简化了维护。

不可变的基础设施有许多积极的安全含义。例如:

*   不再有一次性和配置漂移。确保实时服务器没有变化意味着我们了解该服务器的一切。没有惊喜/意想不到的瑕疵。这还意味着该服务器的准确状态(操作系统版本、修补级别、应用程序版本)可以总结为一个参数，即该服务器的映像 ID。这带来了额外的价值，因为现在很容易推断没有复杂库存管理系统的环境(例如:未打补丁的服务器都是具有两周前或之前映像的服务器)
*   无需在服务器上保持管理端口(ssh、rdp)开放，这大大减少了环境中可能的攻击面。

另一方面，IaC 和不可变基础设施带来的额外灵活性也会给传统的安全系统带来挑战，这些系统不是为这种动态用例设计的。

想象一下，例如主机漏洞扫描或文件完整性系统，当他们扫描完一个实例时，它可能已经消失了，并被新版本所取代。

这些挑战需要一种范式的转变，我们将扫描“主”主机作为映像烘焙过程的一部分，而不是扫描活动服务器的漏洞(容器也是如此)。因为我们知道服务器映像是干净的，并且服务器没有被修改，并且被及时回收，所以我们可以保证它的完整性。

## 结论

随着变革的步伐和对组织敏捷性的要求不断增加，以及像 IaC 和不可变基础设施这样的开发运维实践成为新的规范，我们对现有流程以及如何更好地协调安全性和开发运维进行一些批判性思考至关重要。

我希望这篇文章强调了一些需要重新审视的实践，以及新的、更好的范例的机会。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>