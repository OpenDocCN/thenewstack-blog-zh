# 新的堆栈制作者:Dreamhost 联合创始人 Sage Weil 谈 Ceph、新存储和回归开源

> 原文：<https://thenewstack.io/the-new-stack-makers-dreamhost-co-founder-sage-weil-on-ceph-software-defined-storage-and-getting-back-to-open-source/>

Sage Weil 是一名技术专家，他最近将软件定义的存储公司 Intank 出售给了 Red Hat。在采访中，Weil 谈到了他是如何成为一名开发人员的，以及对构建开源社区的一些见解。

[贤者韦伊访谈](https://thenewstack.simplecast.com/episodes/sage-weil-interview)

**亚历克斯·威廉姆斯:**我和 Sage Weil 在一起，他是 Inktank 的联合创始人之一，也是 Ceph 的创始人之一。我想我们应该谈谈他的生活和他现在在做的事情，以及 Ceph 的背景。很高兴见到你。

很高兴来到这里。谢谢你邀请我。

我们以前尝试过一次这样的采访，但也许这次我们会成功。告诉我一点关于你在哪里长大以及你是如何对技术感兴趣的。

**贤者:**当然。实际上，我在俄勒冈长大——俄勒冈南部和加利福尼亚北部。我第一次接触计算机是在学校——

**俄勒冈州南部的哪里？**

**贤者:**俄勒冈州阿什兰。我母亲住在那里，我父亲住在北加州洪堡县，所以我在两个地方生活。但是，在小学的某个时候，我的保姆开始教我基础知识，从那以后一切都失去了控制——Turbo Pascal，然后我最终在高中的某个时候得到了一个 C 编译器。然后在高中中期的某个时候，大概是 94 年，镇上有一家本地化的 P 初创公司，我开始接触互联网。我开始和他们一起工作，编写 Perl，这是当时的热门话题。非常令人兴奋。

**…肯定是早期的供应商之一。**

是的，这是该地区的第一家 ISP，所以这很令人兴奋。那时候分数 T-1 线是件大事，28.8 拨号。我的第一个大项目是一个叫 WebRing 的网站(我猜是在 1996 年)，它可以让你将网站链接到主题类别中。这在早期变成了互联网上的一件事。我在大学的第一年一直忙于维护所有的服务器。

**你在维护哪些服务器？**

Sage: 它最初运行在 FreeBSD 上，后来有人说服我买了一个 Spark 克隆版或者我们用过的东西——那就是 Linux。最终，我们在圣何塞有了机架式服务器，在过去有 MAE-West 的大楼里，但最终我们卖掉了它，回去做正常的学校工作。

那是在哪里？

那是哈维·马德学院。这是一所南加州理工学院。

**许多有趣的工程师都来自哈维·马德——一些 GitHub 创始人，至少其中一位……**

**贤者:**有意思，真没想到。这是一所非常有趣的学校。这是一所硬核技术工程学校，但它很好，因为它与其他克莱蒙特学院位于同一地点，所以你不只是被科学家和计算机人员包围。这对整件事都有帮助。在大学期间，我与几个人合作，共同创立了一家名为 DreamHost 的虚拟主机公司，我们在大学期间一直合作，后来也继续合作。今天仍然存在；公司做得相当好。在建立一家完全靠自己创业的公司的过程中，这是一种略有不同的体验。我们从未接受任何外部资助。它是由创始人和员工共同拥有的。创建一家不同类型的科技公司是一次不错的经历。

**当你进入大学时，你发现什么是你真正的兴趣，就你今天看到的自己而言，你画了一条回去的路？**

Sage: 我一直对构建互联网上复杂的分布式服务感兴趣，将许多机器拉到一起，让它们构建更高级别的服务。当然，我在 WebRing 的很多工作都是关于如何协调所有这些网站，并建立一个让你将它们链接在一起的服务。使用 DreamHost，它围绕着构建所有后端基础架构，自动部署和供应数百台主机；这都是全自动的。我在加州大学圣克鲁斯分校读研究生时，对分布式系统的兴趣使我开始涉足存储领域，我想那是在 2003 年或 2004 年。

WebRing 是一项互联网规模的业务。

**贤者:**当时，耶。我忘了它有多少用户，但它让服务器非常繁忙。我们当时看到的流量水平与今天的互联网规模相比根本不算什么，但我们肯定花了很多时间试图让它工作起来，走得更快。这最终成为雅虎！在他们获得了所有的技术之后。

然后，DreamHost 成为分布式系统兴趣的延伸。

**Sage:** 是的，我在构建基础设施的过程中获得了很多乐趣。最终，Perl 中有太多的编码，需要处理自动化系统和管理员的任务；我想做一些更令人兴奋的事情，这让我回到了加州大学圣克鲁斯分校的研究生院，并加入了他们的存储研究小组。他们得到了美国能源部(Los Alamos National Labs，Lawrence Livermore，Sandia)的几笔拨款，专门用于为他们的大型超级计算机研究 Pb 级文件系统，这些大型计算机中有数万或数十万个节点，它们都在同一个目录中打开文件，向系统中写入和铲取数据，并进行扩展，同时研究当时基于对象的存储设备范式。最初，我参与了那个项目，研究可扩展的元数据问题——如何处理跟踪文件系统主空间、文件和目录、索引节点、创建和 readdir 以及所有这些内容的元数据服务器，如何在许多节点上实现扩展。当时，实验室正在部署 Lustre，这是目前每个人都在使用的 HPC 开源产品，但它仍然只有一个元数据服务器，这是这些大型计算机的薄弱环节。无法扩展系统的特定部分会降低性能。我专注于找出如何做到这一点。

在这个项目的过程中，我与研究小组中的所有其他人一起工作，他们对如何分布数据有很好的想法——散列放置和构建专门的文件系统来管理单个磁盘——我们将所有这些想法汇集到一个连贯的分布式文件系统中，我们将其命名为 Ceph。

**你对储物的哪些方面感兴趣？**

**贤者:**起初，这听起来一点也不有趣。我特别记得和我未来的顾问的一次谈话，他试图向我推销这个项目。我认为他说的是真的:你有很多不同的计算机科学核心领域的有趣组合。它是关于分布式系统的推理，是网络、性能、优化和数据结构的交叉，所有这些计算机科学的核心领域都非常有趣地交叉在这个听起来很无聊的东西上，叫做“存储”事实是，要做出一些实际可行、可扩展和可操作的东西。你真的需要很好地解决所有这些问题。我发现这是一个非常有趣的领域。

**那么，你是如何设想 Ceph 架构的？**

圣人:…小心不要说这都是我的主意，因为它肯定不是…

**你和你的团队是如何…**

这个小组产生了一些重要的想法，并导致了 Ceph 的诞生。其中一部分是如何分配名称空间的管理，元数据部分，这是我的工作。其中一部分是如何使用基于散列的放置来分发对象，让您能够理解它并在事后进行迁移。碾压算法就是这么来的。这是基于 R.J. Honicky 在团队中的工作。

**那是什么？**

**Sage:** 这里的想法基本上是，不需要某种索引或元数据服务器来跟踪所有数据存储在哪里，你只需要一个确定性的算法，让你计算数据存储在哪里。RUSH 有一个很棒的想法，可以进行基于哈希的放置，当您添加 storapatterns 时，它会修改放置策略，并移动适量的数据。有几个不同的变体被提出…

**这就是存储协调…**

是的，但这都受到特定增长模式的限制。我们将其概括为一种叫做 CRUSH 的东西，它将所有小的低级散列技巧放在一个分层框架中，让您可以编写关于如何分发东西的通用策略。我添加了其中的一部分，即所谓的“稻草放置”政策，它在计算和再平衡之间的权衡中实现了两全其美。把它包装起来，并有一个通用的策略来计算如何存储数据，这是使系统能够很好地扩展的关键因素。您可以有数千个节点，客户端可以有少量元数据。这足以计算出任何对象在创建时的存储位置或将要存储的位置。这是关键的使能技术。另一部分是执行所谓的“去集群复制”的一般策略不是将一个磁盘上的数据镜像到另一个磁盘上，而是实际上将其分成块，即我们称之为“放置组”的数据子集这些数据会在不同的磁盘上随机复制，因此，如果您丢失了系统中的一个节点或一个磁盘，该数据的额外副本实际上会分布在大约 100 个其他节点上，因此会发生这种大规模并行恢复。

**在许多不同的技术中，这已经成为一种真正的方法。**

**Sage:** 许多 it 都是你在许多分布式系统中看到的相同的技巧。基于散列的放置并不新鲜，有一种叫做“一致散列”的东西…

你会看到更新的事物在这样做。我的意思是，你们在早期开发了它，现在它似乎已经成为一种普遍的做法。

圣人:是的，当然。这是现在人们如何构建这些分布式系统的一种艺术状态。现在人们称之为“分片”，基于哈希的放置就是基于哈希的放置，等等。在接下来的几年中，我们对 Ceph 所做的关键事情，我相信其他系统已经复制了它，但你在开源空间中很少看到它，是弄清楚如何提供一个分片的对象存储(我们称之为 RADOS)，其中数据存储在许多不同的节点上，这给了你强大的写后读一致性(这是做文件系统语义或块设备所需要的)， 并且处理围绕如果节点关闭和启动然后数据迁移会发生什么的所有复杂性(然后您会有这些复杂的状态变化，因为它是一个固有的动态系统，开关打开和关闭等等)，并且设法维护脆弱的一致性保证，而不依赖于可伸缩性问题(在这种情况下，您都回到一个服务器来询问数据存储在哪里)。

一旦我们有了基础的、可伸缩的、有弹性的、底层的对象源服务，我们就可以在上面构建很多东西。我们从分布式文件系统服务开始。我们后来构建了一个 block 设备，现在在云领域广泛使用。RADOS gateway 为您提供了与亚马逊 S3 和 OpenStack Swift 兼容的高级 restful 对象服务，为您提供了这些语义。我们的客户正在建造全新的东西。他们正在构建 Dropbox 类型的东西，并使用底层对象服务来保存所有数据。

**你一直都参与开源项目吗？或者当你开始开发技术的时候，开源项目真的没有任何名称吗？**

**Sage:** 我一直——嗯，不总是——参与开源是一个持续的发展过程。在我早期，我使用 FreeBSD 和 Linux 等等，所以我一直是开源的忠实用户。直到最近，我才真正写了很多。事实上，Ceph 是我做的第一个真正的开源项目。这是让它成为我真正有成就感的项目的原因之一。我遇到的普遍问题是，你知道，从研究生院出来，你看到你所有的同龄人都在做这些令人惊叹的项目，设计这些非常酷的系统，这些系统完全是独特的和不同的设计，但他们中的绝大多数人，当他们毕业时，需要去找工作。唯一的工作是为 EMC、NetApp 和 Data Domain 等公司工作，以及所有这些人。因此，许多这些伟大的想法已经存在了足够长的时间，学生可以写一篇论文并发表一些成果，也许代码就在某个存储库中，并且是“开放的”，但它在某种程度上死了。所有的人才似乎都在继续流向专有供应商。

**……谁能出大钱……**

**贤者:**是啊。他们的报酬很高。我是说这些工作很棒，对吧？你在建立很酷的系统。当我们设计 Ceph 时，让我感到沮丧的是(特别是在我们有自己的基础架构问题的 DreamHost 中——我们是 NetApp 的客户，而且它太贵了——除了拥有一个可扩展的、可靠的存储系统，您实际上可以支持企业类型的操作，没有任何 OpenLog 替代方案——这似乎是一个巨大的差距),我以前有 DreamHost 和 WebRing， 在那里，我不需要马上找工作，可以继续从事 Ceph——这个崇高的目标是制造第一个开源的、企业可扩展的分布式文件系统，这将改变世界——我天真地认为，当我把它发布到网上并宣布我的计划时，每个人都会说，“是的，这太棒了！” 并开始发送补丁，这将是一帆风顺的。原来建立社群其实是一个很漫长很艰难的过程。

因此，我们在 DreamHost 内部建立了一个小型的工程师团队，从事 Ceph 的工作。在接下来的四五年里，人数增长到了 10 到 12 人。我们致力于 block 设备、风险网关、身份验证、一般鲁棒性等方面的工作，从可以在谨慎场景中运行的原型到更真实的东西，建立 QA 流程等等。然后，在 2011 年左右，我们意识到 Ceph 是一件大事，但组织很难真正使用它。没有公司支持它。DreamHost 很难在工程上投入足够的资金，将它变成一个健壮可用的东西。那时，我们决定成立一家新公司，专门致力于 Ceph 的技术和工程建设。当时在 DreamHost 的联合创始人布莱恩·博根斯伯格(Bryan Bogensberger)整理了商业计划，并与 DreamHost 首席执行官西蒙·安德森(Simon Anderson)合作，在 2012 年初实现了这一目标。我想剩下的就是历史了。在过去的几年里，我们建立了一个 50 人的团队——我们需要所有的专业服务和支持来支持真正的客户，以及销售、营销和品牌，以成长为一个真正的公司，不仅仅是一个项目，而是一个实际的产品。

**社区早期的建设对你有帮助吗？**

**贤者:**是的。这是一条漫长的道路，那是我们作为 DreamHost 的一部分工作的阶段。很多人听说了 Ceph，认为它真的很棒，想订婚。我们有一些开发者贡献者和许多做了一些测试的人。早期的里程碑之一是在 2010 年将原生内核客户端实现引入 Linux 内核。这多少提高了知名度。我正在参与内核社区；我开始参加 Linux 存储和文件系统研讨会，并与这些人一起工作。当我们在做 Inktank 的时候，给 Ceph 可信度的一件事是我们已经有了一个社区。这不是一个全新的项目，也就是说，“我们有一个很棒的想法，我们应该构建这个软件定义的存储系统，我们现在要去写一些代码。”代码是从架构和学术的角度编写和验证的。它实际上只是强化它并将其转化为产品，然后建立业务关系，以便组织可以采用它或作为合作伙伴推动技术向前发展。

**那么，展望未来，你如何看待开源？Ceph 仍然是一个开源项目，但是总的来说，如果你展望未来，你如何看待开源社区的发展？**

**Sage:** 我认为开源是行业内的一股变革力量，在整个计算领域，甚至在非计算领域，因为同样的想法可以应用于其他种类的东西。尤其是存储，颠覆的时机已经成熟。二十年前，我们看到 Linux 彻底改变了服务器行业。过去，SGI、DEC 和 Sun 销售的 Linux 版本都是完全专有的，而且都是专有硬件，所以，如果你愿意的话，你可以为服务器购买全套设备。现在完全变了。我们已经将服务器市场商品化，并完全开放了该行业，但同样的事情还没有在存储领域发生。Ceph 团队和其他在开放空间中从事“软件防御存储”工作的人的目标是对存储做同样的事情。总会有人出售交钥匙解决方案，但需要将您想要运行的软件集与您运行它的硬件分离，以便您可以构建自己的系统并真正开放该基础架构。

**…而且价格更实惠。**

**Sage:** 没错，降低价格，转向更高效的开发模式，这样你就不必让所有这些孤立的组织一遍又一遍地构建同样的东西。

这样你所有的朋友都可以回来设计他们在 Harvey Mudd 做的很酷的东西。

**贤者:**是啊是啊。总的来说，在学术领域，我很想看到的一件事是让学生，无论是本科生还是研究生，更容易从在学术领域构建系统过渡到开源世界，并把这些想法带到公司。需要注意的一件事是，如今许多开源项目都被公司严重控制，因为公司试图控制这些项目。都是围绕着它的营销资金。这是好事，因为你有很多资源，但这也是危险的，因为试图使用这些产品来制造和销售产品的公司的利益，并不总是与用户的自由或行业的更大利益相一致。所以，这是需要注意的。

**Sage，非常感谢您抽出时间与我们交谈。**

**贤者:**谢谢邀请我。很好。

**太好了。谢了。**

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>