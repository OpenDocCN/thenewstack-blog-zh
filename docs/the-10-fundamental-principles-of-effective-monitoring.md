# 有效监控的 10 项基本原则

> 原文：<https://thenewstack.io/the-10-fundamental-principles-of-effective-monitoring/>

无论您是刚刚开始监控之旅，还是经验丰富的专业人士，记住监控的核心原则仍然很有帮助。根据我自己作为一名前站点可靠性工程师的经验，以及我从 Circonus 的客户那里看到的情况，以下是 10 个基本的监控租户。

## **1。不测量利率**

 [西奥·施洛斯纳格勒

西奥于 2010 年创建了 Circonus，并继续担任其首席架构师。20 年来，他一直在设计、编码、构建和操作可扩展系统。作为一名连续创业者，他已经创建了四家公司，并帮助发展了无数的工程组织。西奥是《T2》可扩展互联网架构(T3)的作者，是《T4》网络运营(T5)和《寻找 SRE》(T7)的撰稿人，也是全球 IT 会议的常客。他是 IEEE 会员和 ACM 杰出会员。](https://www.linkedin.com/in/postwait/) 

*您可以在查询时导出随时间的变化率。*

监控的第一条规则是永远不要测量速度，测量数量。

例如，如果您正在跟踪每秒钟从某个接口发出的数据包，而错过了每秒钟的测量值，那么您就处于黑暗之中。但是，如果您正在测量数据包总数，前一秒钟您有 7000 亿个数据包，后一秒钟您有 700，000，000，012 个数据包，那么您知道已经过去了 12 个数据包。这意味着，如果您错过了测量，您不知道在该时间范围内您发送了多少，但您知道在扩展的时间范围内您总共发送了多少。您始终可以从实际仪表值计算速率，但不能倒退。

再举个 CPU 的例子。如果您的系统显示 CPU 利用率为 35%,但实际上却超过了 30%,那么您得到的答案是错误的。您需要跟踪 CPU 时间。举个例子，Linux 就是这样做的，它跟踪在状态中花费的毫秒数，然后一个接一个地计数。如果你想知道特定时间内的速率，那么你测量开始，测量结束，减去，除以时间间隔，计算出每秒的速率。当你用经过的厘秒数除以秒数，你会得到 100 倍的速率，这是一个百分比。所以你应该一直监控物品的数量，而不是价格。

## **2。技术堆栈外的监视器**

*如果没有满意的客户和销售渠道，您的技术平台将不复存在。监控对您组织的健康发展至关重要的因素。*

如果你只看你的电脑，那么你可能没有很好地服务你的企业。无论您的业务有什么样的关键绩效指标，都应该对其进行监控。您的营销部门正在分析这些数据以确定他们的活动是否成功，这些数据应该在您的监控解决方案中。

如果系统完全烧毁，但不影响业务，而交换机中引入的 0.5%的数据包丢失会对您的底线造成损失，那么如果您的监控系统中没有所有与业务相关的数据，您可能会优先考虑前者而不是后者。一个崩溃并着火的系统似乎总是比某个地方的某个百分比更重要，但结果可能完全不同。

## **3。不要储存数据**

*部件的行为必须放在上下文中。将不同的系统甚至业务成果联系起来是至关重要的。*

这个原则是上一个原则的完美延续:今天的 IT 组织希望所有东西都是分布式的，但是如果您没有将数据放在一起，那么您就无法将您的系统和业务成果关联起来。

当你把所有的数据放在你的架构中，监控你的系统、数据库、用户、财务等。，然后，您就可以开始围绕单个位置的数据构建任何业务问题、答案和解决方案。这就是为什么整个行业在构建高度可伸缩的时间序列数据库方面有如此多的投资。

## **4。真实工作的价值观察**

*…合成作品的测量。*

你没有理由不去观察*实际的*工作量，而不是综合的测量或它的综合副产品。我见过一些组织完全依赖于合成工作，甚至是来自该工作的平均测量，这绝不可能提供真实、准确的见解。

假设您合成网站流量，以确保满足延迟要求。虽然我在下面的原则中讨论了这一点的价值，但这永远不应该取代监控真实用户与你的网站的交互。您应该测量每个真实用户请求的延迟，并使用该分析来指导您的决策。事实上，很有可能没有真正的个体交互会与从合成流量中得出的平均延迟相匹配。因此，始终重视实际工作的观察和个人测量，而不是综合工作和平均测量。

## **5。合成工作以确保其功能**

*…适用于业务关键型的小规模活动。*

有了上面说的，合成工作就有了时间和地点。有时候没有人使用某项服务；即使是世界上最大的网站也有每 15 分钟点击一次的 API。你不会想在第一个用户出现时第一次就知道它坏了。特别是在低流量环境中，合成流量以确保服务实际工作是非常重要的。

## **6。百分点不是直方图**

*为了实现稳健的服务级别目标(SLO)管理，您需要存储直方图以便进行后处理。*

百分位数是工程师经常用于延迟 SLO 的有用统计集合，但不应与直方图混淆。

例如 SLO: 95%的主页请求应该在 28 天内得到 100 毫秒以下的服务。

百分比示例:在过去的 28 天中，95%的网站请求有 98 毫秒的延迟。

除了这个数字之外，这个百分位数本身不会产生任何额外的信息。例如，它没有提供延迟数据的分布，比如第 97 或 98 个百分点是什么。然而，直方图可以得出这个结果，甚至更多。

直方图是连续变量分布的一种表示，其中整个数值范围被划分为一系列区间或“箱”，该表示显示每个箱中有多少个值。直方图是计算延迟 SLO 的最佳方式，因为它们可以有效地存储所有原始延迟数据，并且可以轻松计算出您希望看到的任何百分比。想看看第 85 百分位吗？第 78 届？第 94 届？所有这些都是可能的。直方图直观显示延迟数据的分布，因此工程师可以轻松识别中断和集中，并确保满足性能要求。

## **7。历史至关重要**

*不是几周或几个月，而是几年的详细历史。* *产能规划、回顾、对比分析和建模依赖于准确、高保真的历史记录。*

许多监控厂商，尤其是开源厂商，淡化了历史数据的重要性。他们将数据存储一个月，认为任何超过这个时间的东西都没有价值。这真是大错特错。这些解决方案不会长期存储数据，因为它们的设计初衷并非如此，但这并不意味着数据不重要。

你应该有几年，而不仅仅是几周或几个月的历史数据，让你可以做事后分析。关键是你今天收集的数据明天还是一样的。您的每分钟或每秒钟的数据应该就是这样，而不是像许多解决方案那样，一小时一小时或一天一天地平均。没有什么比事后发现一个新问题更让人恼火的了，但是你已经没有回答这个问题所需的数据了。你还记得六个月前的那次停电吗？你想问一个你当时没有问的问题，但是等等，你不能问，因为你的图表只是一天中的一个大平均值。

从现在起 6 个月和 12 个月后，您今天拥有的数据应该完全相同。这对于理解容量规划也至关重要。您需要粒度数据来进行长期容量规划。带宽利用率就是一个例子。

你可能不会一整天都使用相同的带宽。如果您查看带宽利用率的历史记录，并对其进行一天的平均，那么您的最大值是完全模糊的。所有的最大值都消失了，你计划的轨迹曲线根本不适应你的峰值。有了这些精细的数据，您就可以正确回答未来的所有问题。

## **8。警报需要文档**

*没有易读的解释、业务影响描述、补救程序和升级文档，任何规则集都不应触发警报。*

每一个监控专业人员都遭受过警戒疲劳。任何产品都无法避免警报配置不当的问题；只创建必要的警报需要人类的自律。然而，根据我的经验，我已经确定了可以附加到警报的规则，这些规则引入了足够的负担，以防止工程师编写不必要的警报。

例如，假设您创建了一个 85%磁盘空间警报，您需要描述这一警报的重要性以及对业务的影响，同时还需要包括一个完整的补救程序以及在出现问题时您需要与之沟通的主要领导或利益相关方的列表。一旦附加了这些规则，就不太可能在 85%的磁盘空间上创建警报。

除非有人真的应该采取行动，否则你不应该发出警报。即使在这些情况下，自动操作可能比警报更有意义。

## **9。在爆炸半径之外**

*监控的目的是检测行为变化并帮助回答操作问题。*

这是我在警报架构中看到的最常见的错误之一。工程师在系统内设置警报，系统崩溃。因此，他们试图使用监控来了解和修复的实际停机是在问题内部，在重新上线之前，他们无法使用它或看到任何东西。

将您的数据从问题中转移出来至关重要，这样当系统出现故障或失灵时，您的监控、警报、可视化和分析系统仍然可用。事实上，监控解决方案需要比它们所监控的系统更加可用，并且需要在爆炸半径之外。

## **10。有总比没有好**

不要让完美成为好的敌人。你必须从某个地方开始。

我经常看到工程师让完美成为好的敌人，你不可能拥有完美的监控。刚开始很重要，从顶层开始也很好——那些最密切影响顶层业务指标的系统或服务。如果您的组织是一个面向用户的网站，那么出口流量可能是最重要的和高度相关的成功替代测量

当决定从哪里开始监控时，瞄准那些为您的业务提供最高价值的东西。在此基础上，您可以更深入地研究监控，直到监控每个 IOP 和服务调用的延迟。一旦到了这一步，您就可以识别出能够产生巨大性能改进的易得之果。

## **给你后口袋的实用建议**

在我们这个微服务、分布式系统和持续期望的新时代，监控对于企业成功来说从未如此重要。这可能很复杂，令人不知所措，但希望这份清单能在您的监控之旅中提供一些快速、实用和有用的帮助。如果你准备好让你的监控更上一层楼，[请阅读我们关于如何升级到高级监控的文章。](https://www.circonus.com/2020/06/how-to-elevate-from-basic-to-advanced-infrastructure-monitoring/)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>