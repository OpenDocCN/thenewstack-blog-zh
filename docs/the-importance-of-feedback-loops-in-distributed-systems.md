# 反馈回路在分布式系统中的重要性

> 原文：<https://thenewstack.io/the-importance-of-feedback-loops-in-distributed-systems/>

这是分布式跟踪系列的一部分。要获得本系列的其他文章列表，请查看

[the introductory post](https://thenewstack.io/distributed-tracing-why-its-needed-and-how-it-evolved/)

.

[Lightstep](https://lightstep.com/) 赞助本帖。

 [奥斯汀·帕克

Austin Parker 是 Lightstep 的主要开发人员，也是 OpenTracing 和 OpenTelemetry 项目的维护者。除了他的专业工作之外，他还教授大学课程，谈论 DevOps 和分布式追踪的所有事情，甚至还抽空开了一个播客。Austin 还是 O'Reilly Media 出版的《实践中的*分布式追踪*的合著者。](https://www.linkedin.com/in/austinlparker/) 

有一句格言通常不适用于软件，但我认为它是一句有用的格言，请记住:“如果第一次你没有成功，尝试，再试一次。”当我这么说的时候，你可能会认为我指的是简单的开发行为，这是一个鼓励性的短语，在试图修复的错误没有得到你想要的结果之后，它会让你振作起来。虽然这很有用，但从软件的*用户*的角度考虑更有趣。当你点击网站上的一个按钮，但它不起作用…你会怎么做？很有可能，你会再次点击它。也许你会刷新页面。如果您特别感兴趣、有动力或者足够聪明，您可以打开浏览器的开发人员工具窗格，在 JavaScript 控制台或网络选项卡中四处查看，试图收集一些关于正在发生的事情和问题可能是什么的信息。

这个基本循环包含了我们作为开发人员试图理解我们的系统所做的许多事情。你做一些事情，看看会发生什么，收集更多的信息，并尝试在调整一些事情后再做一次。大多数系统将以类似的方式运行。如果我正在调用某个外部服务，而它没有响应，我的服务应该在一会儿之后再试一次。如果我试图向数据库写入一个值，如果失败了，我不应该放弃——我应该再试一次，这取决于*为什么*失败了。然而,*为什么*的概念很重要。我需要知道发生了什么事情的背景，以便决定如何再试一次。这些反馈回路对我们生活中所做的一切都至关重要！如果我想把一件大家具搬进门里，当它卡住时，如果我只是不停地推，那就没什么用了。我需要评估*为什么*卡住了，然后改变我正在做的事情。盲目地推开只会让我得到一个毁坏的沙发，一扇坏了的门，和背痛。

在本系列的前一期中，我谈到了分布式系统的兴起，以及它们变得如此流行的一些原因。现在，让我们在我们刚刚讨论的背景下思考它们:反馈循环的概念。当我开发一个小的应用程序时，我的反馈循环非常短。我可以对一行代码进行更改，重新编译并运行软件，然后立即看到发生了什么变化。至少可以说，这不仅对理解我的软件非常有用，而且有助于改进它。变化和变化的结果之间的联系是非常明显和容易量化的。想象一下，在一个分布式系统中，我一次只能改变它的一小部分。我的变化可能只是沧海一粟，但即使是很小的一滴也会向外荡漾，最终成为巨浪。

考虑以下场景:我有一个接收一些数据的服务(哪种数据并不重要)。也许我正在获取一个值，并将其重新编码或重新格式化，作为与新的客户数据源集成的一部分。服务被部署后，一切都好了。但是有一天，一张票来了。数据格式正在改变，所以我需要改变我如何转换它。没问题:几行代码，几个测试用例，甚至假设我们可以优雅地处理新旧数据格式。见鬼，今天是星期五，让我们开始部署吧——最坏的情况是什么，对吗？我完成我的代码，公关合并，然后我停下来度过一个轻松的周末，充满渴望地看着窗外，看着 YouTube，回忆新冠肺炎之前的时光。

在这种情况下，我做的一切都是对的，不是吗？在孤立中，我当然做到了。我写了测试用例，我编写了防御性的程序，我确保了在产品化阶段一切正常，我让人检查了我的代码，我反复检查了规范和文档……一切都应该没问题。除了，万一不好呢？如果新的转换逻辑比旧的代码慢——甚至仅仅如此——该怎么办？如果我的防御性编程，检查以确保我可以转换新旧格式的数据，如果这给我的应用程序的关键路径增加了延迟，那该怎么办？而且，根据调用我的服务的位置，当其他服务得到备份时会发生什么？额外的毫秒起初看起来并不明显，但也许它们*确实*很重要……假设它们确实很重要。突然，由于我增加的额外延迟，离我四五跳远的一个旧服务开始超时。这些超时会导致连锁故障，因为其他服务也开始超时，甚至开始出错并崩溃。这些超时和崩溃最终会导致应用程序的主数据库负载出乎意料地高，开始崩溃，突然之间，我的一个小小的更改就导致了完全的中断。哎呦！

好吧，让我们暂停一下——我们如何解决这个问题？嗯，这实际上是一个很难回答的问题！这种系统性的失败可以用许多不同的方法来解决，这也是它们如此难以解决的原因之一。我们是否解决了直接原因:我们的服务部署？或许，你甚至可以说这是*停机的根本原因*——但真的是这样吗？毕竟，许多其他事情出了问题，导致整个系统崩溃。例如，许多其他服务开始超时并失败——这就是原因之一。遗留服务开始崩溃，因为它们无法解决超时问题，这也是一个原因。当这些服务重新启动时，会给数据库带来额外的负载，从而导致数据库失败，这也是一个原因。不过，我们也可以把镜头拉远一点。首先，我们部署新版本服务的原因是由于数据格式的变更请求，这导致了整个繁琐的工作。如果我们愿意，我们甚至可以进一步缩小——为什么数据格式会发生变化？这是可以避免的吗？重要的是要明白，没有什么是*只是*一个技术问题，*只是*一个计算机问题——一切都始于人，也终于人。

诊断和解决这些问题可能具有挑战性！正如你所看到的，仅仅有数据是不够的。你需要*为什么*事情发生的背景。您需要逆向工作的能力——从结果到原因——以及理解系统中的服务如何连接在一起的能力，以及系统中某个部分的变化如何影响其他服务，甚至是那些不在其上游或下游的服务。生成这种数据可能很难，您需要能够集成到各种服务中的东西，每种服务都可以以不同的方式部署，在世界各地的数据中心运行。然后，您需要一种方法来收集这些信息，并以人类可读的形式显示出来，并构建工具，通过允许您搜索和查询来帮助您解释这些信息。

谢天谢地，现在有很多解决这些问题的好方法。正如我在本系列的上一部分中提到的，这些年来已经开发了相当多的工具来监视服务，收集关于它们的诊断信息，并允许您尝试和找出问题所在。然而，人们遇到的一个常见问题是，在不同的语言、运行时和部署策略下，他们的工作方式都略有不同。然而，最关键的是缺乏*背景*。分布式跟踪解决的正是这个特定的问题。如果你回想一下这篇文章的开头，找出*为什么*事情发生是我们解决问题反馈循环的关键部分。分布式跟踪通过提供对系统中发生的事情的请求级可见性，为您提供了 *why* 。它不是万灵药—它本身不能解决您的所有问题—但它是将您从服务中获得的诊断数据结合在一起的粘合剂。然而，它是如何工作的，什么是分布式跟踪，*真的是*？在本系列的下一部分，我们将深入探讨 [OpenTelemetry](https://opentelemetry.io) 的技术细节，并解释什么是跟踪。

通过 Pixabay 的特征图像。

目前，新堆栈不允许直接在该网站上发表评论。我们邀请所有希望讨论某个故事的读者通过推特或脸书与我们联系。我们也欢迎您通过电子邮件发送新闻提示和反馈:[feedback @ thenewstack . io](mailto:feedback@thenewstack.io)。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>