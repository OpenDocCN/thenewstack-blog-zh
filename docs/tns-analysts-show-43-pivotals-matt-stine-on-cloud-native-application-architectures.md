# Pivotal 对云原生应用程序架构的看法

> 原文：<https://thenewstack.io/tns-analysts-show-43-pivotals-matt-stine-on-cloud-native-application-architectures/>

Alex Williams 欢迎 Pivotal 的 Matt Stine 加入新的 Stack Analysts 播客，他是最近出版的书籍[迁移到云原生应用架构](http://blog.pivotal.io/cloud-foundry-pivotal/news-2/new-book-explains-how-cloud-native-application-architectures-drive-the-innovation-cycle)的作者。

更多剧集，请查看新堆栈的播客部分[。](https://thenewstack.io/podcasts/)

[#43: Pivotal 的 Matt Stine 关于云原生应用架构](https://thenewstack.simplecast.com/episodes/43-pivotals-matt-stine-on-cloud-native-application-architectures)

谈话的主题主要来自 Matt 的书，包括十二因素应用程序、抗脆弱性，以及这场关于微服务和云原生架构的划时代辩论。共同主持人唐尼·伯克霍尔茨也做出了贡献，他指出，“游戏肯定在改变。”

“每一家公司——至少是每一家供应商——都意识到这一点非常重要，”唐尼说，他还帮助研究了一些定义。“他们希望让客户能够构建—使用云原生架构、使用微服务，无论你怎么称呼。“云原生架构”确实意味着比“微服务”更大的图景。"

Matt 非常善于表达和思考，所以从现在开始我们让他自己的话来说话

“当我使用‘云原生应用架构’这一术语时，”Matt 说，“我想做的是抓住一堆正在同时讨论的不同主题——正在进行的微服务对话；Cloud Foundry、Heroku 等人在讲的十二要素应用概念；这种强调直接为云构建应用程序的做法。

“就我们 Pivotal 而言，我们谈论的是构建一个平台。有人称之为“PaaS”，我的同事 Andrew Shafer 不喜欢“PaaS”，所以我们经常谈论平台，但这种自助式敏捷基础设施的想法，以及你正在编写的应用程序代码和你试图与之交互的平台之间的契约，不是由票务系统和人来代理，而是由你调用一些 API 来代理。

“这就过渡到了基于 API 的协作的一般主题，并创建了可以用运行的代码来验证的契约，而不是传来传去的对话和文档，这成为了应用程序相互协作、与服务对话以及与平台对话的通用方式。

[![MattStine](img/ba62d1f4410dfa43e4a2ba4a09564a20.png)](https://thenewstack.io/wp-content/uploads/2015/05/MattStine.jpg)

马特·斯汀

“最后，纳西姆·塔勒布在《抗脆弱性》一书中谈到的这个概念——以及他在书中谈到的许多东西都超出了本次对话的范围——但有一个系统概念的想法是，假设故障事件会不断发生。

“当网飞开始转向 AWS 时，AWS 因造成大量系统故障而闻名，许多公司因此遭受损失。因此，他们从这个核心原则出发，即“系统中的每个组件都应该能够出现故障，并且将会出现故障，并且将会持续出现故障，因此我们需要设计我们的系统，以便它能够继续为客户提供服务，即使在一个或多个组件消失或服务质量不佳的情况下，无论是什么情况。”

“然后他们把这一点发挥到极致，说，‘我们不仅要假设失败会发生，我们还要有目的地把它们注入系统，然后利用我们从中获得的经验让系统变得更强大。’因此，在这些分布式系统中，你最终会需要更多的微服务，这又让我们回到了微服务。我们现在通常在云中做这件事，所以你有所有这些独立对话的主题领域，但同时它们似乎聚集在谈论它们的相同的人和正在构建的相同类型的架构上，所以我决定从阿德里安·科克罗夫特那里得到启示，开始谈论“云原生应用架构”，并将其作为一个总括术语来涵盖所有这些不同的事情， 相对于“微服务”，这可以说是一个更流行的词，但并没有真正抓住所有我认为重要的事情的总和。 "

## 关于当前建筑转变的重要性:

“关于微服务和云原生以及这些主题领域，需要注意的一件重要事情是，它们代表了我们在开始开发运维及持续交付对话后看到的第一次重大架构转变。我在心里做了这样的观察，但我并没有真正用这些术语来表达，然后我坐在[尼尔·福特](http://nealford.com/)在一次会议上的微服务演示中，只是想看看他对这个话题的看法。他做了那个声明，它对我来说是真正的结晶。

“我们开始思考如何更好地为我们的客户创造价值，并且更快、更持续地实现这一目标，同时强化反馈循环。一群人正在进行这种类型的对话，并发明语言来描述这可能会是什么样子。与此同时，进行对话的人是日常的实践者，他们试图建立系统并把事情做好。

“许多公司正在独立融合。他们通常从一个整体开始，然后变得很难操作，并且继续保持他们更小更瘦时的速度，所以他们开始把这个东西拆开。这本书里的“扼杀独石”短语是我从阅读[【马丁】福勒](https://twitter.com/martinfowler)写的一篇[短文](http://martinfowler.com/bliki/StranglerApplication.html)中得到的，这篇短文是关于“扼杀者应用”，它与这个主题无关，但与这个主题非常相似，然后我阅读了几篇关于公司的早期博客报道。我在书中谈到的是 SoundCloud，以及他们如何从这种整体架构转移到微服务，其他公司正在缓慢但肯定地开始编写这些经验报告和他们从一个到另一个所做的事后总结——他们为什么这样做，哪些事情可行，哪些事情不可行。

“你所看到的是，相同类型的模式已经出现，人们已经开始充分谈论它们，现在我们想开始给这些东西贴上通用标签。有些术语已经过时了。“十二因素”已经存在了一段时间，但直到最近才成为很多人谈论的话题。多年来，我甚至没有在软件会议上看到过“12 因素”这个词，今年，在我演讲的 [NFJS 巡回赛](https://nofluffjuststuff.com/home/main)上，我有一个会议，还有另一位演讲者专门讲述了如何构建这样的应用程序。2015 年我去过的每一个软件大会，一半议程都在说微服务。

“我们的一个大客户现在正试图将这些东西扩展到一个更大的开发组织，那里有大量的人埋头苦干，日复一日，只想完成他们的工作。他们中的大多数人不像我们一样在对话中根深蒂固。现在，我基本上是在教人们使用一种全新的语言来谈论应用程序开发，然后我们才能学习工具、平台、框架和模式，我们必须用这些来实际构建东西。在这一点上，我们必须跨越鸿沟，从这些早期采用群体到试图交付代码的大多数人。”

## 关于老牌公司转型为软件公司:

“人们看待自己身份的方式肯定开始发生变化，[从]我们在 Pivotal 交谈的公司数量，或者现在接近我们的公司数量来看，'好吧，我看到了坐在我身边的这些垂直行业正在发生的事情，我开始意识到这也将发生在我的行业，我觉得我们需要开始重塑自己，成为一家技术公司，不是因为技术本身是优越的， 而是因为我们需要开始考虑如何走得更快——不仅仅是更快地交付东西，而是更快地验证想法。

“我本周进行了这样的对话:‘我对微服务感兴趣的两个主要原因是，它们允许我分散我们完成工作的方式，并分散这项工作的治理。’如果你以此为逻辑结论，你几乎创造了一个团队构建服务的世界，而服务的存活是由自然选择决定的。当你让团队自主行动成为可能时，你就可以很快地站起来说，“去验证这个想法”，而不是说，“我们要花六个月的时间为一个两年内不会交付任何东西的项目规划和获得资金，直到两年过去了，我们才知道建造我们开始建造的东西是否是一个好主意。因此，公司开始意识到，这种经营模式最终会让他们丧命。"

## 关于十二因素应用:

" [12 因素点网](http://12factor.net/)是 Heroku 的营销工具。他们显然想帮助人们开发能在他们的平台上运行的应用，这样人们就能在他们的平台上运行更多的应用。但在我看来，这是最早描述一套用于编写代码的架构或设计原则的地方之一，它代表了应用程序及其运行平台之间的松散契约。

“这是一个平台，它说，‘你把你的代码交给我，我要做的事情是把代码转换成一个可以在某个地方运行的应用程序，我要保持它的健康，我要允许你横向扩展它，我要允许你了解这个应用程序的行为。从中会产生什么样的事件？“从中得出的性能指标是什么？”他们通过这 12 个因素来说，‘如果你这样设计你的应用，那么它会在这种环境下运行良好。当我们开始做 Cloud Foundry 第二版时，我们还决定使用 Heroku 的 buildpack 模型，在这样做的过程中，我们开始针对这些 12 因素应用程序非常好地调整 Cloud Foundry。

“人们可能会看到 Docker 指导应用程序打包的方式，并认为，‘现在我已经将我的应用程序包作为这个 Docker 映像，我将采用这个 Docker 映像，并在某个平台上运行它，无论是 Cloud Foundry、Kubernetes、Mesos 还是 Amazon，无论您选择什么都不重要，这些平台一旦启动，就会与您的 Docker 容器挂钩。 在配置方面向它提供信息，在事件和日志方面从它那里获取信息，以及这些东西将如何扩展，它们都开始看起来非常相似。

“如果你正在为那些你可以捆绑在这个‘云平台’标签下的目标平台中的一个构建，那么这十二个因素的想法就是第一步。如果你想让代码在这样的环境中运行并运行良好，这就是你必须要做的。”

## 关于抗脆弱:

“我们现在谈论事情的方式更侧重于应用程序和服务，以及它们的目的和它们试图做的事情，我们几乎想把它下面的基础设施看作一个实用模型:我把我的笔记本电脑插到墙上，我假设我会得到电力，但我并没有真正考虑电力是如何产生并带给我的。我只知道这会成功的。作为一名应用程序开发人员和应用程序运行人员，PaaS(即自助式敏捷基础设施)正试图将这一点带给我。这是我的代码。我真的不关心你如何让它运行，或者你如何把它缝合在一起，让它能够和所有它需要交谈的东西交谈。作为这项商业服务的开发者，我真的没有时间去考虑它下面的所有部分。

“其中一部分是 API，因为我正在进行一个 API 调用，为您提供我的代码和一些元数据来运行那个东西，我正在进行另一个 API 调用来扩展那个东西，然后我假设那个东西将监控我的进程，如果我的进程失败，它将为我重新启动那些进程。这些是我需要的类型的东西，甚至开始有一些可能感觉像一个抗脆弱的基础设施。

“什么是‘抗脆弱’？”塔勒布的描述是:首先，定义“脆弱”。脆弱是:你给某物施加压力，它往往会断裂或失败。与之相反的不是“当你给它施加压力时它不会断裂”;在他看来，“当你给它施加压力时，它会变得更好”。我们如何构建一个软件系统，当我们对它施加压力时，这个系统实际上会变得更好？想想我们对软件系统施加的压力类型；其中最大的一个是变化。需求变化、业务变化、市场变化，我们需要软件随之变化。

“传统上，我们在基础设施和运营方面的应对方式是:变化会破坏事物，因此我们将加大变化的难度，使变化过程更加有序，更加以过程为导向，这将减缓事物的发展速度，如果我们这样做，那么我们将建立这些强大的系统，当我们对它们施加压力时，它们不会破坏。当我们加载太多负载时，或者当一台服务器出现故障，我们可以进行故障转移时，它们可能不会中断，但是如果我想添加一个新功能，突然之间，这种类型的压力源就被禁止了。在这个“我们必须创新，否则我们就会死亡”的新世界中，企业最想对系统施加的压力是变化。

“我认为，作为一门学科，我们还没有取得足够的进展，我们实际上可以建立真正抗脆弱的系统，当我开始研究这些东西时，它们实际上在某种意义上改善了自己。我不认为我们已经得到了；我们还缺少某些东西。我非常宽松地使用“抗脆弱”这个术语，从这个主题领域抓住一个想法，“如果我们能够以这种方式构建软件，那将是非常好的，那么我们如何开始以这种方式思考，以及我们如何开始构建东西？”混沌-猴子型的东西是朝着正确方向迈出的一步，它说，“如果变化是有风险的，因为变化会破坏事物，那么我会让它知道我的弱点在哪里，当事物攻击这些弱点时，我会提高我的反应能力，并且假设，随着时间的推移，系统不会变得更好，因为系统有能力自我改善，但我们实际上给了自己更好的数据来工作，我们可以用来建立一个更好的系统，对这些类型的变化更有弹性。

迪克·加布里埃尔写道，在某种意义上，系统的行为就像人类的免疫系统。如果你的免疫系统以前从未见过攻击者，它会非常虚弱，不知道如何应对感染。我们帮助孩子不生病的方法之一是:我们让他们和生病的孩子在一起。

“这个想法并不是说，‘好吧，我们必须这样建立我们的系统。’我认为我们还没有工具来做这件事。但至少，让我们开始思考如何建立这样的系统，因为如果我们能够实现，那将是我们工具箱中非常强大的工具。

“几年前，创造了 Erlang 的乔·阿姆斯特朗做了一个非常棒的演讲。我记得它的标题是“如何构建永远运行的系统”他走过了其中几个领域，这些领域与我们今天讨论的非常相似，最终它们成为了 Erlang 工作方式的核心原则。“组件故障”的想法不应该导致系统停止工作，因为如果这是真的，那么您可能会有一个非常小的难题开始表现不佳，这可能会导致您试图交付的更大类型的服务无法交付。"

## 论国家和裂脑问题:

“现在房间里的大象之一是，从云原生的角度谈论的许多东西，我们描述的许多模式，他们有一个核心思想，即你正在构建的服务是无状态的，但我们知道你不能构建一个完全没有状态的系统。在某个地方总是会有状态，你移动它，你移动它，但最终你必须找到，'我如何处理状态将生活的地方？'

“如果有状态，有些东西将读取状态，这没问题，但也有一些东西将写入状态，您需要确保这些写入得到适当的协调，以便数据集实际上是一致的。在完全的一致性和最终的一致性之间有一个一致性的范围，但是你不想有混乱，所以你有一些协调。

“我们这样做的方法之一是选举领导人。如果你有一个领导者选举算法说，“领导者将协调写入”，你引入一个网络分区，系统的一边认为领导者已经走了，而系统的另一边认为领导者还在那里，领导者继续运行。另一方选出了新的领导人，现在你在这个系统中基本上有两个大脑，两个大脑都认为自己处于控制之中，但有一个网络分区将它们充分分开，以至于现实被掩盖了，这造成了一系列问题，其中一些问题极难恢复。”

## 关于问题和解决方案:

“[分布式计算的八个谬误](https://en.wikipedia.org/wiki/Fallacies_of_distributed_computing)，作者提供了]当人们第一次进入构建分布式应用程序的领域时所做的八个假设。所有这些假设都是绝对错误的，但如果你做出这些假设，并以这种方式构建一个系统，在某种程度上，你对可靠性和一致性做出了错误的假设——事实上，你已经分发了你的系统，所以你的组件在那里飞来飞去做不同的事情，然后你有网络互连，我们意识到网络不可靠——它引入了延迟，我们没有无限的带宽，它不安全。

“网络本身会给系统带来各种各样的问题。而且，因为你已经分离了系统的组件，现在它们是可独立部署的，这意味着它们可以来来去去，四处移动和改变。即使网络继续工作，你在网络连接的另一端交谈的东西可能实际上是不同的，或者失败，或者改变。

“作为一名生活在这样一个系统中的开发人员，你不可能不考虑这些事情，但是它们会给你的构建带来很多开销。我们在 Pivotal 尝试做的事情之一是构建框架、工具和平台，将许多众所周知、描述良好的样板解决方案引入到您的系统中，以处理这些谬误——我不严格地使用它，但它是“即服务”——以便您可以再次专注于您试图编写和交付价值的业务代码。”

Pivotal 是新堆栈的赞助商。

特色图片:《脆弱》(1931)，阿尔滕/德绍-阿尔滕，德国，纸板上的蛋彩画，途经[WikiArt.org](http://www.wikiart.org/en/wassily-kandinsky/fragile-1931)。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>