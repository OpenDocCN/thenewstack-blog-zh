# 构建云规模软件的 10 个基本实践

> 原文：<https://thenewstack.io/10-essential-practices-for-building-software-for-cloud-scale/>

规模是[复杂软件系统](https://thenewstack.io/category/development/)最常见的压力源之一。尽管它的流行对以前工作良好的系统造成了严重的破坏，但每当“预期”与“实际”(每天的用户数、每个用户的事务数、每个事务的大小、每个事务的保留时间等)有显著差异时，它就会继续导致大量的返工。).公共云服务最令人印象深刻和最有价值的贡献之一是它们看似无限的规模(网络、处理、存储等。).同样，最容易模仿的实践之一是那些区分“云规模”开发团队和“常规”软件开发团队的实践。

那么公有云服务公司是怎么做的呢？即使在开发不需要“云规模”的解决方案时，我们也可以从他们的工具包中应用哪些与众不同的实践？

## 让你的软件变得更好的 10 种方法

在探索云规模所需的实践之前，为*任何*高性能软件团队设定基线是很重要的。DevOps 研究评估(DORA)中概述的[实践](https://services.google.com/fh/files/misc/dora_research_program.pdf)是一个很好的起点。DORA 中的技术实践、精益产品开发、精益管理以及文化和工作环境方法适用于任何规模的软件系统。但是，还必须有一些新的或不同的东西来支持这些实践，以实现云规模。

我从 Vendia 工程团队观察到的实践，那些似乎将常规软件与云规模软件区分开来的实践，被分为四类:

*   **知识**——你和你的团队成员知道什么
*   **运营**–您和您的团队成员如何处理运营
*   **开发**——你和你的团队成员如何构建软件
*   **帮助他人**——你和你的团队成员如何与他人分享上述所有内容

这些类别，以及其中的实践，允许软件团队提高他们开发新特性的速度，提高他们交付的软件的质量，并增加他们实现他们期望的规模的可能性。

## 知识

沃伦·巴菲特不是软件工程师，但他非常了解风险。在他看来，“风险来自于不知道自己在做什么。”对于复杂的软件系统来说尤其如此。虽然 DORA 中概述的实践有助于培养学习文化，但是从直接经验中获取知识没有捷径。

### 实践 1——雇佣或发展分布式系统专家

对于云规模的软件团队建设来说，深入理解分布式系统及其解决方案的常见缺陷至关重要。阅读这些陷阱是积累知识的良好开端，但是处理失败的经验会灌输一种无与伦比的理解水平。同样，找到创造性的方法来解决这些挑战往往需要利用以前的经验，包括成功和不成功的经验。

例如，分布式系统专业知识允许团队保持[幂等性](https://en.wikipedia.org/wiki/Idempotence)，即使当与提供“至少一次”通知交付的系统交互时。虽然“恰好一次”交付对于某些通知服务来说是一个可能的选项，但是这个选项通常伴随着[陡峭的性能](https://aws.amazon.com/sns/features/)损失。凭借深厚的知识，一个团队识别出[模式](https://chrisrichardson.net/post/microservices/patterns/2020/10/16/idempotent-consumer.html)来解决“至少一次”交付，同时保持幂等性，与选择“恰好一次”通知方法以避免复杂性的团队相比，允许更好的性能数量级。

在常规开发团队中，分布式系统专业知识通常是集中的，这限制了团队的效率和有效性。

***在云规模的团队中，分布式系统专业知识无处不在。***

### 实践 2——非常熟悉你使用的库和云服务

你可能听过这句谚语，“业余者练习直到他们能把事情做对，专业者练习直到他们不能做错。”你可能不知道它同样适用于软件依赖选择。对于软件环境来说，这句话看起来像这样:“业余爱好者集成一个库，直到他们让它工作，专业人士集成，直到它永远工作。”

花适当的时间来选择正确的库，一个可以工作但也会优雅地失败的库，是 DORA 的团队实验实践的一个很好的实现。同样的严格选择也适用于公共云服务。必须充分了解它们的固有限制和故障模式，以便针对这些潜在故障进行适当的设计和制造。代码审查(参见实践 9)有助于确认故障模式得到处理，但是要知道处理什么样的故障只能来自于对你正在交互的库或云服务的深入理解。(完全披露:如果你一开始就已经[创建了那些云服务](https://thenewstack.io/author/tim-wagner/)，这确实会有所帮助，但是你可以通过文档和实验达到足够的理解水平。)

在常规的开发团队中，库和云服务的选择是基于什么是流行的，什么对简单的情况最有效。这可能导致选择产生丑陋的失败场景。

***在云规模的团队中，云服务和库的选择涉及对源代码(当可用时)、文档的深入探索，以及对实验、基准测试和原型(包括故障模式)的大量关注。***

## 操作

DORA 广泛涵盖操作，包括其[测量功能](https://cloud.google.com/architecture/devops/measurement)。云规模团队在运营领域的不同之处不是实践本身，而是所应用的复杂程度和完整性。

### 实践 3 —提供深入全面的运营可见性

监测和可观察性已经是公认的必要条件。DORA 中的指南概述了几个重点领域，包括工具和关联。插装意味着必须向系统添加代码来公开其内部状态。相关性意味着从应用程序及其底层系统收集的指标可以用来解释行为。

团队经常发现操作可见性是不可能的，因为仪器不足或者相关性不足或不准确。随着软件系统变得更加分布式和更加复杂，这变得尤其具有挑战性。越来越多优秀的[工具可用](https://www.honeycomb.io/)，允许跨应用程序、区域和云的分布式跟踪。虽然这些工具可以处理相关性，但是它们仍然需要开发团队在插装上花费适当的时间。在正确的时间，以正确的方式，使用正确的元数据(以便与其他数据相关联)公开应用程序的正确内部状态，与其他工程任务一样重要，甚至可能更重要。如果没有正确的工具和关联，很可能会发生操作上意想不到的事情，但不会被注意到。“没有证据”表明问题存在，因此，对于操作系统的团队来说，问题不存在。

在常规的开发团队中，操作可见性没有得到与特性开发相同的时间和关注，这缩短了工具，并且通常依赖于不充分的工具来进行复杂的分布式系统之间的度量关联。

***云规模团队明白卓越运营需要深入全面的运营可见性。他们知道，证据的缺席不是一回事***[](https://en.wikipedia.org/wiki/Evidence_of_absence)****。****

 *### 实践 4 —创建强大的运营自动化和工具

自动化部署和测试也是公认的持续交付实践。自动化背后的目的是减少辛劳，增加成功的可能性，使重要但痛苦的过程变得简单、可靠，从而更频繁地执行。

对于一些团队来说，[自动化可以应用到什么程度](https://aws.amazon.com/blogs/developer/how-vendia-leverages-the-aws-cdk-to-dynamically-provision-cloud-infrastructure/)仍然是难以理解的，他们认为这是一种主要用于持续交付的技术。考虑一个团队构建一个由 API 网关、API 实现和支持 API 的数据存储组成的 API 解决方案。他们可以(正确地)自动化 API 解决方案的构建、部署、测试和发布过程。但是他们可能会忽略(错误地)基于单个模式文件完全自动化(T21)API 设计、实现、后台数据存储和前端 API 网关的机会。

工具是另一个经常被选择性应用的领域，但是没有达到它应该达到的程度。当工具是“生产的唯一途径”时，它们会得到必要的时间和关注。同样地，当[伟大的工具](https://github.com/trek10inc/awsume)是开源的，他们会有一种所有权的自豪感和对细节的关注，这可能是团队内部专用工具所缺乏的(参见实践 10)。

常规团队在他们知道其他人使用自动化的地方使用自动化。他们在内部工具上花费时间和精力，但是他们没有应用与新功能开发相同的设计和代码质量严格性。

***云规模的团队明白自动化应该被应用到任何地方，任何存在可重复过程的地方，包括软件开发。他们花在审查内部工具的设计和实现上的时间和花在外部特性上的时间一样多。***

### 实践 5——进行严格的电话回访

反思是持续改进思维的核心，回顾(各种风格)是敏捷软件开发的核心。虽然回顾在今天很常见，但是它们的有效性会因计划和执行的质量而有很大的不同。正如常规开发团队中经常缺少操作工具一样，操作随叫随到评审也是如此。像许多 DORA 实践一样，仅仅“做”实践是不够的——还需要把实践做得特别好。

例外是什么样子的？我每周参加的每周电话回访有几个突出的特点:

*   **格式一致** —这提供了一种涉及所有必要主题的结构化方法(没有任何内容被跳过)。
*   **材料来自深入的运营可见性** —对话是非常数据驱动的，依赖于并展示在运营可见性和自动化工具方面的投资价值。
*   **行动项目被快速跟踪和关闭** —许多行动项目作为待命轮换的一部分被处理。那些没有完成的通常会在下周优先处理。
*   **动力是协作** —每个团队成员的心态都是关于如何弥补导致运营问题的任何差距。问题不会被忽视；它们被视为需要解决的问题。
*   **方法是严格的** —团队成员对每件事都相互负责，从会议持续时间到内容结构，再到确定的行动项目。

常规团队将绩效反思局限于回顾，如果行动项目没有被快速捕获和结束(如果学习没有被应用)，这可能成为死记硬背的练习。运营事件得到处理，表面层面的纠正措施得以实施，但真正需要投资的根本原因分析和纠正措施却经常缺失。

***云级团队知道，运营可见性提供了丰富的数据，只要有足够的时间和精力来检查和学习这些数据，就可以收集这些数据来改进设计、实施和团队绩效。***

### 实践 6——永远保持乐观

云规模团队大量投资的另一个领域是自动化测试和部署。[金丝雀发布](https://martinfowler.com/bliki/CanaryRelease.html)技术是团队采用的一种增量发布新特性的方法，以避免大爆炸式的操作事件。这项技术与 DORA 的小批量工作[的指导相一致。](https://cloud.google.com/architecture/devops/devops-process-working-in-small-batches)

一旦新软件发布，重要的是将[主动/合成/黑盒和被动/真实用户/白盒](https://cloud.google.com/architecture/devops/devops-measurement-monitoring-and-observability#blackbox_monitoring)监控与[主动通知故障](https://cloud.google.com/architecture/devops/devops-measurement-proactive-failure-notification)结合起来。软件即服务(SaaS)产品的理想发布顺序如下:

*   **Wave 1 Release** —新软件的第一次发布，理想情况下针对已知非生产环境(沙盒帐户)的一小部分用户和环境
*   **主动监控序列** —综合驱动流量到共享服务(控制平面)以确认释放按预期工作
*   **被动监控结果** —检查真实用户活动(数据平面)以确认发布按预期运行
*   **第二波释放**–假设第二波和第三波(足够长时间后)都是干净的，继续第二波，然后重复相同的过程

常规开发团队可能会选择蓝/绿部署策略，因为这比金丝雀发布更容易机械化。他们也可能不会投资大量的主动和被动监测，因为前者需要实践 4，后者需要实践 3。

***云规模团队小批量工作，利用领先的运营实践。他们明白组合是大于其组成部分的总和。***

## 发展

有无穷无尽的资源可以帮助你和你的团队改进软件开发实践。编码最佳实践甚至有自己的[维基百科页面](https://en.wikipedia.org/wiki/Coding_best_practices)。虽然所有这些实践都很重要，但是在比较常规开发团队和云规模开发团队时，有两个不同的实践非常突出。

### 实践 7——专门针对故障场景的工程师

分布式系统越大，系统中至少一个独立组件发生故障的可能性就越大。考虑一个依赖于 10 个独立服务的 10 步工作流，每个服务的可用性预期为 99%。如果仅仅基于服务可用性，您会认为工作流有超过 9%的失败几率吗？将所有服务提高到 99.9%的可用性仍然会使整个工作流有将近 1%的失败几率。这可能看起来不重要，但是如果这个工作流一天被执行几百万次，并且你对它负责，那就很重要了。

提高服务可用性和可靠性会有所帮助，正如我们在前面的示例中看到的那样，在每个服务中添加了一个额外的“9”。但是，很多时候服务交互涉及团队控制之外的服务，或者完全在他们的组织之外的服务。尽管分布式系统中普遍存在故障，但许多团队还是减少了时间、精力和对细节的关注，来设计和优雅地处理这些故障。这至少部分是因为实践 1 和实践 2 之间的差距。毕竟，团队可能不具备分布式系统知识来理解处理不当的失败的级联效应。类似地，团队可能没有足够好地理解他们的库和云服务选择，以涵盖所有可能的失败场景。

常规团队开发使用基本技术捕捉和处理基本故障的代码，可能会忽略不太常见但影响更大(如果处理不好)的故障场景。

***云规模团队将其大部分设计和开发花费在避免、处理、测试和自动从故障场景中恢复上，尤其是那些源自他们无法控制的系统的故障场景。***

### 实践 8——应用频繁和广泛的代码评审

代码评审补充了小批量工作的团队和基于主干的开发。它们通常在开发期间(用于定期反馈)和[拉取请求](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests)(合并到主干之前)应用。这允许开发人员在代码成为每个人的代码库的一部分之前征求团队成员的反馈。

有许多代码审查清单，但是大多数只关注审查代码。一些检查表将范围进一步扩大到测试和文档。以上所有这些都很重要，但是为了增加代码评审的价值，可以通过应用额外的镜头来扩展评审:

*   **设计**——从代码本身后退一步，了解开发的代码是否/如何适合总体设计，以及现有的设计是否仍然适用
*   **可用性**——如果是面向用户的，考虑正在构建的特性的用户体验；适用于 web 界面和命令行界面(包括内部和外部工具)
*   **一致性**——验证代码和应用程序的一致性——从变量命名约定到按钮名称、命令行参数和缩写，再到文档中的术语
*   **可扩展性**——推断正在进行的更改，以预测一种方法何时不再适用，并寻求在潜在的可扩展性问题存在之前解决它们

常规开发团队使用代码评审来提高代码质量。

***云级团队使用代码评审来改进代码质量、软件设计、操作可见性、用户体验、自动化和工具。***

## 帮助他人

### 实践 9-在第一天提供开发人员环境

2019 年的 DORA 报告发现，72%的“精英”团队(在评估中处于最高水平的团队)“自动配置和部署到测试环境”，但自动性能和安全测试的数量要少得多(分别为 28%和 31%)。性能和安全性测试通常不自动化的原因之一是环境设置和拆卸的复杂性。

那些统计数字与帮助他人有什么关系？

软件开发团队是不断变化的，包括新成员的加入。通常，云规模团队是高增长组织的一部分，在一年之内，这些团队的规模就会翻一番(或三倍)。当一个新的团队成员加入时，拥有一套他们可以操作的环境可以让该团队成员快速适应。要理解一个大型复杂的分布式系统是如何工作的，还有什么比用自动化性能测试来摧毁它更好的方法呢？这种自主性与 DORA 中提到的[团队实验](https://cloud.google.com/architecture/devops/devops-process-team-experimentation)实践非常一致。更好的是，对于开发云原生软件的团队来说，团队成员在第一天就可以访问单独的云帐户，并有足够的权限让它们变得有用。

常规团队经常被允许他们运作的环境所窒息，新团队成员经常需要等待数天或数周才能访问使他们高效工作所需的系统。

***当您加入云规模团队时，您就拥有了快速提升、频繁交付价值和自由试验所需的工具。***

### 实践 10——通过开源回馈社会

正如实践 4 中所提到的，开源一个内部能力通常是一个有用的强制功能，使得这个能力值得共享。知道你的工作可能被数千甚至数百万开发人员使用通常是令人生畏的，但是分享你的工作对其他人来说是一个巨大的帮助。

在短短两年多的时间里，Vendia 已经开源了许多[库](https://www.npmjs.com/search?q=%40Vendia)，我们相信其他人可能会发现这些库很有用。虽然其中一些库是[专门针对](https://www.npmjs.com/package/@vendia/share-sdk)Vendia 共享的，但它们具有通用的开源依赖关系，对于那些构建在公共云上的库来说[非常有用](https://www.npmjs.com/package/@vendia/aws-signed-fetch)。

常规团队严重依赖开源库，但很少做出反馈。

***云规模的团队广泛使用开源库并创建自己的库，他们知道，这样做，他们既提高了自己的技能，也提高了他人的技能。***

## 关键要点

[云规模开发团队](https://thenewstack.io/category/cloud-native/)在很多方面与常规开发团队相似。在某些情况下，云规模的团队对现有实践应用额外级别(或两个级别)的严格性(比如操作可见性)。在其他情况下，他们扩展了一个公共实践的范围，或者将它应用到以前没有打算的领域(代码审查)。当结合一组优秀的[基础实践](https://www.devops-research.com/research.html#capabilities)时，上面定义的 10 个实践足以将云规模团队与所有其他团队区分开来。

努力成为云规模并不适合每个团队或每个应用程序。将本文中概述的实践执行到云规模所需的程度是时间、精力和资源密集型的。然而，任何开发团队都可以有选择地或者在适当的程度上应用这些实践，不管其解决方案的预期规模如何。更好的是，因为其他人已经掌握了实践并继续寻找新的方法来满足大量用户或工作负载的需求，大多数团队可以通过依赖云、平台和根据这些实践开发的软件来获得这种掌握的好处。

## 巩固你的基线

在探索 Vendia 的[图书馆](https://www.npmjs.com/search?q=%40Vendia)和[资源](https://www.vendia.net/docs/share)的同时，不断积累知识。或者，加入我们的[开发者社区](https://www.vendia.net/developers)，构建强大的实时数据共享应用。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>*