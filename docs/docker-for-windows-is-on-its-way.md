# Windows docker 即将推出

> 原文：<https://thenewstack.io/docker-for-windows-is-on-its-way/>

在新版本中很少讨论微软视窗系统，原因对普通读者来说是显而易见的。至少在过去的五年里，也许更长的时间里，Windows 在大多数相关领域都没有发展，而是被迫专注于不相关和多余的事情。自从去年 12 月我的作品开始在这里展出以来，正如我的三四个长期读者会指出的那样，Windows 成为一个话题只是时间问题。

它现在是一个话题，因为人们意识到:为了在现代工作世界中保持相关性，Windows 必须在新的堆栈(包括出版物和实际堆栈)中为自己找到一个位置，即使它必须完全变形为其他东西。各种各样的变化正在发生，从去年 10 月 Docker 的接受开始，继续到上周各种传言的证实([再次感谢，Mary Jo](https://www.zdnet.com/article/windows-server-2016-leaks-reveal-nano-server-protected-vm-role-plans/) )即将推出一款名为 Nano Server 的极简操作系统。

Windows 即将发生的变化——包括已经确定的变化，以及 Windows 为赶上世界其他地区而将要做出的变化——对于某些出版物来说是如此陌生，以至于他们仍然不知道从哪里开始。

他们可以从这里开始:服务器世界正处于向微服务架构过渡的中期。微软现在可以放弃，或者它必须带领 Windows Server 经历一次惊人的转变。

## 容器 A 和容器 B

迈克·尼尔(Mike Neil)是微软的资深员工，现在再次担任 Windows Server 总经理，他将向 Nano Server 的转移描述为虚拟化发展的下一个合乎逻辑的步骤，这是 2011 年代号为“吊桥”的研究项目[的高潮](http://research.microsoft.com/en-us/projects/drawbridge/)虽然微软可能有许多正确的想法，但 Linux 可能是随着 2010 年控制团体的兴起而开始整个对话的。

在与新堆栈的对话中，Neil 承认 Windows Server 有效地增加了 Linux 带来的功能。然而，他解释说，新版 Docker 引擎将在 Windows Server 中支持两种类型的容器:所谓的“Windows 服务器容器”(实际上是 Windows 的 Docker)，以及第二种形式，称为 Hyper-V 容器。

为什么 Windows Server 需要两种可以被 Docker 引擎识别的容器？

> “Hyper-V 容器提供了额外的一层安全能力，”尼尔告诉新的堆栈。"它们提供了底层管理程序支持的边界."

Neil 评论说，应用程序不会发现自己需要为某一类容器开发。区别是配置上的，也许主要是美学上的，涉及到它们与底层操作系统的关系。

“无论是 Linux 还是 Windows Server，如今容器面临的一个挑战是，您要在基本映像和实际容器中运行的映像之间共享很大一部分操作系统，”他告诉我们。因此，如果我升级该操作系统，那么我会遇到需要升级容器的挑战，因为这两件事在一个共享的环境中。”

新的二级 Hyper-V 容器支持不同版本的基础映像同时运行的情况。它说明了微软在这一点上需要解决那些 Windows 架构特有的问题，在某种程度上仍然使 Windows 应用程序能够运行，而无需从头开始完全重新设计。

“这对于企业客户来说尤其重要，因为出于修补、更新和合规性的原因，他们正试图部署到他们希望拥有独立生命周期管理的环境中，”他说。此外，它还提供了一个他们现在了解并信任的安全边界:Hyper-V 虚拟化安全，它基于英特尔的虚拟化技术。

在一个新注入数百甚至数千台并行运行的新型纳米服务器的世界中，Windows 服务器管理员将如何完成 Neil 提到的这种独立的生命周期管理——这是一项他们已经非常熟悉的任务？你不能指望用微软著名的“巫师”之一[来逐一解决](http://www.informit.com/guides/content.aspx?g=windowsserver&seqNum=250)

Neil 说他注意到 Linux 领域的 DevOps 从业者如何利用生命周期管理来维护容器的多个实例，即使它们正在被积极地开发。

> “我们意识到，世界上运营商的数量明显多于开发商，”他指出。

随着应用程序越来越趋向于操作角色，在生命周期管理下，它们变得不太活跃。在 Neil 看来，这产生了两类配置，它们将通过一种生命周期管理器来维护。

## 状态投影器

在这里，我们发现了微软对下一版本 Windows Server 在这种环境中的角色的看法:作为生命周期管理器的平台，尤其是新的 Hyper-V 容器类。从这里开始，DevOps 团队将在我称之为“孕育期”的阶段监督应用程序的并行容器，并在它们准备好进入生产状态时，将它们的配置转换到一种成熟模式。

除了其他原因，这种级别的监督可能是必要的，因为 Hyper-V 容器将不是我们所知道的 VM——甚至不像 Docker 容器。

“这是一个非常不同的容器，”Mike Neil 解释道。“从那个世界内部投射的操作环境来看，它不同于虚拟机。顾名思义，虚拟机在软件/机器接口上有一个抽象层。它将虚拟化的 CPU 投射到该环境中；虚拟内存；非常低级的存储，通常是块存储解决方案；和联网，通常是在分组级别。而 Hyper-V 容器实际上旨在提供与 Windows Server 容器相同的抽象层，并进一步虚拟化网络中的堆栈和文件系统。所以它们提供了一个非常不同的结构。”

Neil 暗示了 Hyper-V 容器、Docker 容器没有的独立 Hyper-V 虚拟化层和 Windows Server 的现有 Hyper-V 虚拟机管理程序之间的关系。正如您可能已经猜到的，这使得这种新的容器类非常特定于 Windows，或者至少在设计上限制了它在 Windows Server 边界之外的可移植性。

这种奇怪的“绑定”容器可能有合理的架构原因，与现有 Windows 应用程序的设计有关，而不是微服务的发展。微服务被设计成无状态的，对其更广泛的应用程序的状态或上下文不做任何假设。他们不应该是外部数据库的用户。

典型的 Windows 应用程序完全不是这样，它依赖于有史以来最麻烦的数据库之一:[系统注册表](http://www.informit.com/guides/content.aspx?g=windowsserver&seqNum=26)。在应用程序植根于它们的操作系统，并且只能在它们之间共享处理器的世界中，注册表被设计成记录安装在系统中的所有应用程序的配置数据和可共享状态。

仅仅一年前，在看过微服务中无状态架构的完整演示后，我得出结论，仅仅因为这个原因，容器化的 Windows 是不可能的。为了证明我是错的，微软一直在忙着设计一种方法来使一个不可容器化的应用程序(现在，有一个词来形容诺姆·克劳斯贝)容器化…如果只是虚拟的。

“这里有一项配套技术:我们想要的状态配置机制，”微软的迈克·尼尔告诉我。“它现在是 PowerShell 的一部分。DSC 允许我们显式地调用这些东西，而不是依赖于注册表并创建一个映像，在其中我隐式地设置所有这些值并以正确的方式配置它，然后使用它。然后，当您启动一个容器并启动 Nano Server 时，您可以针对它运行一个 DSC 脚本，它会重新配置该映像以达到所需的状态。”

微软有一种命名深奥的服务器技术的诀窍，就像科幻小说中的委婉语一样，所以期望的状态配置听起来直接来自菲利普·K·蒂克。它不一定是为容器而创建的，但如果它有效，它可以预见地使可伸缩服务(可能不再是“微”的，但仍然是服务)感知到属于它们的注册中心的一部分，作为一个活动代理的一种虚幻投影。

如果成功的话，它可以使现有的 Windows 应用程序在弹性云架构中具有可伸缩性。但正如迈克·尼尔的揭露向我们表明的那样，这是一个巨大的“如果”

## 平静的骚乱

Mike Neil 在大部分讨论中忽略的短语是“编排层”显然，Windows Server 将会发现自己需要开源社区已经在利用的工具的对等物，例如用于编排的 [Mesos 和用于调度的 Aurora](https://thenewstack.io/twitters-aurora-replaces-operating-systems-stateless-services/)。

但是因为这些工具是开源的——特别是因为它们是 Apache 项目——它们受益于实现者的贡献，这些实现者成功地为他们自己的目的进行了调整。Windows Server 一直是一个闭门造车的项目。尽管 Docker Engine 仍然是开源的，并由社区监管，但 Docker Engine 的 Windows Server client 将由微软提供。

即使在新的服务器系统已经宣布之后，仍有待确定的是，随着这种新的以 Docker 为中心的操作系统成为商业现实，微软如何看待自己与开发者之间的关系，以及自己与 DevOps 专业人员之间的关系。如今，专业人士更习惯于为这一过程做出贡献。微软喜欢为专业人士举办会议——它计划在短短几周内举办两场会议，分别是 [Build](http://www.buildwindows.com/) 和[Ignite](http://ignite.microsoft.com/#fbid=RyHm1WHxTsq)——过去也举办过开源项目，但从未以“Windows”为名

微软很可能继续假设这个和其他架构问题的解决方案只能从其研究实验室的洞穴深处出现(正如“吊桥”的情况)。如果最终出现这种情况，那么无论对 Windows Server 进行什么样的更改，习惯于开源的企业都不会再耐心等待分配给他们的更新了。

毕竟，他们已经经历了革命。新的堆栈已经在这里了。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>