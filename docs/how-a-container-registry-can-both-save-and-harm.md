# 私人与公共集装箱注册:优点、缺点和最佳实践

> 原文：<https://thenewstack.io/how-a-container-registry-can-both-save-and-harm/>

[VMware](https://www.vmware.com/company.html) 赞助了这篇文章。

 [黄家强

作为 Kubernetes 项目的一部分，黄家强是 VMware SIG 的主席，也是物联网和边缘工作组的共同组织者。自 2015 年以来，他一直致力于容器领域的开源项目，并且是 VMware 云计算原生应用业务部门的工程师。Steve 过去是 KubeCon 和开源峰会的发言人，并在他居住的洛杉矶地区的 SCALE 会议上共同主持了 container track。](https://www.vmware.com/company.html) 

容器映像注册中心可以为开发人员提供显著的优势，但是有一个附加的警告:不是所有的注册中心都是平等创建的。

公共注册服务是基本的，易于使用，可以很好地为个人和较小的团队工作。但是一旦团队开始扩大规模，他们就会遇到许多公共注册的问题。具有扫描功能和基于角色的访问控制的私有容器注册表提供了更多的安全性、治理和高效管理。来自云计算本地计算基金会(CNCF)的[开源港项目](https://goharbor.io/)是一个很好的选择，尽管有许多开源的私有注册中心。

让我们更详细地了解为什么容器映像注册中心对任何开发人员来说都是一个好工具，好的注册中心的一些最重要的特性，以及为什么私有注册中心对于大规模运行应用程序的组织来说是必须的。

## 为什么要使用容器映像注册中心？

在容器出现之前，开发人员将运行代码定向到物理或虚拟机，为操作系统和机器变体创建独特版本的安装包，通常与机器中安装的其他软件相互依赖和交互。容器改变了这一点，允许开发人员编写小型的、可移植的单元(容器映像)，这些单元可以与所有必要的依赖项捆绑在一起，可以在任何地方运行，并且可以使用自动化进行部署。

在旧的模型中，当问题出现时，开发人员被要求一次一个地分析和修补运行的系统。在新的模型中，开发人员不断生产新的容器化版本来修复问题和添加功能。它们流入管道并驻留在专门的编目存储(容器映像注册表)中，等待处理步骤，如质量保证测试，然后部署到生产中。

这就是注册表发挥作用的地方:在整个过程中，注册表仍然是您想要运行的图像的真实来源。第一个优势是你可以在任何地方运行相同的代码。第二个优点是，代码段被保存在一个由 IT 控制的存储库中，因此您可以轻松地恢复到一个干净的环境。结果是生产中“配置漂移”的结束。

自动化系统现在连续监控运行的系统，询问问题“这是运行的期望(修补的)版本吗？”而不是劳动密集型和容易出错的手动修补如果没有，系统会自动触发更新。

## 就像一个仓库

与物理仓库和传统分销供应链不同，连续流和容器图像存储点既带来了安全挑战，也带来了机遇。考虑零售分销供应链中的这些问题场景:

*   您如何检测和防止篡改商店货架上的产品？
*   你如何防范假冒产品？
*   当一种受污染的成分被报告时:你如何隔离不良库存？您如何量化风险并识别有风险的客户？
*   如何将访问库存的权限限制在授权范围内？

这些“供应链”问题在基于容器的软件中有相似之处——一些图像注册中心有内置的特性来处理它们。

## 财务风险和隐私考虑

公共注册服务简单易用，这有助于解释为什么它们如此受欢迎。但是，由于它们在开发者之间共享，并且由 1000 多个地点运行的主机图像，普通的“免费”公共注册表可能会有所不足。

许多流行的软件组件都是开源的，很容易在互联网上找到，通常是预打包的容器映像。允许这些从互联网直接进入生产出错。

有各种开源的和商业支持的私有容器映像注册中心可供使用。有些提供一些企业功能，如集装箱图像安全扫描。其他私有注册中心功能齐全，具有严格的治理和审计日志记录等特性。

## **具有扫描功能的注册管理机构如何提供帮助**

容器是以这样一种方式组成的，即有可能分析内容并确定其中包含的所有部分。这意味着，当在容器映像中包含的一个小包中新发现一个安全漏洞时，您可以判断您是否面临漏洞。

行业和政府机构赞助频繁更新的已知“常见”漏洞和暴露或 CVE 数据库。一些容器映像注册表可以利用这些来执行库存映像的静态分析。每当图像更新、消耗或出现新的 CVE 数据库通知时，都会触发扫描。

那些最初从网上下载的容器可信吗？通常不会，但是你的在职开发人员也不是完美的:他们的代码会包含错误，他们可能会合并易受缺陷影响的库和包。

如果您的系统记录集装箱图像的流动和使用，您甚至可以生成报告，以具体的时间、日期和位置量化您的风险，这与仓库中的安全摄像头记录没有什么不同。

## 用于治理的图像签名和访问控制

可以对容器映像进行签名，并且可以在部署时验证签名。这类似于识别制造物品来源的激光全息图。

一些开源代码可能不会被许可用于您的特定用途，这将您置于法律危险之中。

私有注册表允许您决定谁可以批准容器在您的系统上运行，并允许以后验证图像没有被篡改。

基于角色的访问控制强制执行与特定活动、位置和部门相关的用户权限—谁可以发布更新的图像，谁可以使用它们。

治理补充扫描。如果没有特定的程序和保护措施，bug 和恶意代码(或者未经许可供您使用的代码)可能会在您的组织中传播。

## 复制支持的优势

当您大规模运行时，单一的中央注册中心不太可能满足您的需求。在运行容器的系统附近运行注册中心可以减少部署延迟并减少网络中断的风险。在负载均衡器后面运行多个注册中心实例带来了规模和高可用性优势。有时，将开发、测试和生产注册分离出来作为自动化 CI/CD 管道的一部分也是可取的。

如果您的注册中心支持策略驱动的自动化映像复制，多个注册中心可以支持自动化的连续容器开发工作流、负载平衡、高可用性和全球范围的多云操作，所有这些都具有最小的运营开销和延迟。您不希望使用手动操作和跨部门“票证”来运行此操作。

## 最后的想法

许多流行的容器注册中心都是开源的，但是有些比其他的有更广泛的采用和更广泛的社区支持。因为你有选择，所以从长远来看，在一个有效组织的治理下，如 [CNCF](https://www.cncf.io/) ，寻找一个有活力的社区(有大量积极贡献的开发者和组织)的解决方案是值得的。这可以增加 bug 被快速识别和修复的几率，并在将来增加新的特性和功能。

软件应用程序开发是一个永无止境的过程，但是容器映像注册中心尽可能地保持事情的清晰和直接。他们让每个人都唱同一首歌，并防止“害群之马”污染你的组织的健康。不要仅仅满足于提供基本功能和 API 的简单容器映像注册。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>