<html>
<head>
<title>Kubernetes' Long Road to Dual IPv4/IPv6 Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes通往双IPv4/IPv6支持的漫长道路</h1>
<blockquote>原文：<a href="https://thenewstack.io/it-takes-a-community-kubernetes-long-road-to-dual-ipv4-ipv6-support/#0001-01-01">https://thenewstack.io/it-takes-a-community-kubernetes-long-road-to-dual-ipv4-ipv6-support/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="attribution translated">Portworx赞助了New Stack对KubeCon+CloudNativeCon北美2019的报道。</p>
<p class="translated">虽然你可能认为Kubernetes是计算的未来，但直到最近，它仍然停留在过去的一个方面，即它是建立在IPv4上的，IP v4是广泛使用的，但很快就会成为互联网协议的遗留版本，互联网就是建立在IP v4上的。</p>
<p class="translated">互联网工程任务组长期以来一直敦促互联网服务提供商转向IPv6，因为全球已经耗尽了32位IPv4地址的供应。凭借其128位地址空间，IPv6将提供取之不尽的互联网地址。</p>
<p class="translated">“我们忽略了它，”谷歌首席软件工程师兼Kubernetes核心贡献者蒂姆·霍金在本周与微软Azure首席软件工程师兼核心贡献者T4·哈立德(Kal)赫尼达克举行的<a href="https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/schedule/" target="_blank" rel="noopener noreferrer external " class="ext-link"> KubeCon + CloudNativeCon北美2019 </a>会议的主题演讲中承认了IPv6。Kubernetes被牢牢锁定在IPv4上。</p>
<p class="translated">幸运的是，由于强大的志愿者团队，开源容器编排引擎现在已经为IPv6做好了准备:Kubernetes的最新版本1.16将是第一个拥有双IPv4/IPv6堆栈的版本，这意味着它可以解释两种类型的互联网地址。据两人说，实现这一目标并不容易，但一个强大的志愿者社区——包括许多来自彼此直接竞争的公司的工程师——使这一目标得以实现。</p>
<p class="translated">Hockin说,“Kubernetes比任何一家向Kubernetes投入资源的公司都要大。”。"如果没有“竞合”，Kubernetes就不会是今天的样子."</p>
<h3 class="translated">拉取请求长达5000行</h3>
<p class="translated">Kubernetes本质上是一种网络技术，所有与网络功能直接相关的代码都是为IPv4硬连线的。尽管如此，还是成立了一个工作组来搜索代码库并删除所有的IPv4元素，这是一个棘手的任务，但很快就成功完成了。</p>
<p class="translated">但这只是问题的一部分。人们很快发现Kubernetes真正需要的是双栈IPv4/IPv6支持——这意味着它的所有API都应该以IPv4或IPv6数据包的形式进行对话。将会有遗留应用或物联网设备仍然需要IPv4。“我们做了一个糟糕的假设，我们总是需要单个IP，”Henidak说</p>
<p class="translated">这将是一个重大的修正。Kubernetes是一种网络技术，它运行在API上。而且有许多涉及网络层的API需要修改:负载平衡器、节点、服务、端点。</p>
<p class="translated">“我们遇到了一个从未有过的问题:我们如何将一个单数字段转换为复数字段，并与所有客户保持兼容？”霍金说。“这可能会有点问题。”</p>
<p class="translated">一个团队在2017年10月开始研究Kubernetes的bootstrap工具，到2018年6月，他们有了一个Kubernetes增强提案(KEP)，其中详细列出了需要改变的一切，以及所有这些改变对用户的影响。</p>
<p class="translated">从这组用户需求中，工作被交给Hockin和Henidak来领导团队进行更新。他们将任务分为三个阶段:出口(因此从Kubernetes流出的流量可以是IP/4或IP/6)，然后是入口(因此集群本身可以识别这两种协议)，最后是为所有支持工具提供双栈功能，如负载平衡器和引导工具。这项工作并不容易实现，Henidak，他们希望尽可能使最终用户不痛苦的更新。这些变化必须是向前和向后兼容的。</p>
<p class="translated">几个月来，各个团队一直在讨论创建一个适用于所有各方的模型的最佳方式，其中包括许多热烈的讨论。赫尼达克开始着手修复。由此产生的pull-request非常庞大:仅仅是egress阶段，就改变了两个核心API——pod和node——超过5500行代码。端点、节点、路由和其他控制器也进行了修改。更糟糕的是，PR是在接近1.15版本的代码冻结窗口时发送的。</p>
<p class="translated">“我们必须认真思考如何进行这些改变，并确保它们是正确的。如果可以避免，你不会真的想打破人们的群集。Hockin说:“这是审查者用干草叉来处理的那种拉动式请求。</p>
<p class="translated">但是这里是社区站出来的地方。不只是少数志愿者站出来审查大规模的公关，而是18个人来帮忙。该评论被分成多个部分。“我们作为一个集体，作为一个社区，经历了审查、修复、修改的数据危机，”Henidak说。最终，他们决定跳过下一个版本，而是瞄准1.16，并包括入口。</p>
<p class="translated">所以现在支持入口和出口，但仍有工作要做。但是因为这次拉力赛，Henidak和Hockin对Kubernetes的未来持积极态度。</p>
<p class="translated">“我们得到了一个非常强大的团体的支持，”赫尼达克说。</p>
<p class="translated">KubeCon+CloudNativeCon是新堆栈的赞助商。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>