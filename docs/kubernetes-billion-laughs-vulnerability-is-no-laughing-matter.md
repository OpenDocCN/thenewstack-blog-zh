# Kubernetes 的“十亿次大笑”漏洞可不是闹着玩的

> 原文：<https://thenewstack.io/kubernetes-billion-laughs-vulnerability-is-no-laughing-matter/>

在 Kubernetes API 中发现了一个新漏洞。该缺陷集中在 Kubernetes API 服务器对 YAML 清单的解析上。在此过程中，API 服务器容易受到潜在的拒绝服务(DoS)攻击。这个问题([CVE-2019-11253](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11253)——尚未在页面上充实任何细节)已经被标记为“十亿次大笑”攻击，因为它针对解析器进行攻击。

## 什么是“十亿次大笑”攻击？

十亿次大笑攻击是一种特定类型的拒绝服务(DoS)攻击，专门针对 XML 文档解析器。这种攻击也被称为 XML 炸弹或指数实体扩展攻击。

### 这是如何工作的

Kubernetes API 是 Kubernetes 主节点和节点之间的主要交互点，由 Kubernetes API server([kube-API server](https://kubernetes.io/docs/reference/command-line-tools-reference/kube-apiserver/))提供支持。该 API 服务器验证和配置各种 API 对象(如 pod、服务和复制控制器)的数据，并验证传入的连接，以确保请求连接的实体有权发出请求。这个特定的 API 服务器服务 REST(代表性状态转移)操作，并提供一个 Kubernetes 集群共享状态的前端，但是 **kube-apiserver** 不在 YAML 清单上进行输入验证，也不对 YAML 清单文件大小施加限制。

这种十亿次攻击的后果是，节点的嵌套引用在展开时会变得非常大。因为 **kube-apiserver** 不在清单上执行验证，所以它不检测那些嵌套引用是否会导致问题。如果嵌套引用变得太大，过多的 CPU 和 RAM 使用会导致 apiserver 对连接没有响应…从而导致拒绝服务。

这种威胁应该被认为是实质性的，尽管没有向 CVE 发送详细信息，但您仍然可以采取一些措施来保护您的数据和集群。

### 你能做什么

要采取的第一步(也是最重要的一步)是审查您的 [RBAC 策略](https://kubernetes.io/docs/reference/access-authn-authz/rbac/)，并确保您了解如何向集群授予[访问权限。您希望验证只有受信任的实体才能获得对集群上任何给定资源的特权访问。应该仔细审核任何允许修改资源的角色。检查每个角色(如编辑、删除、修补、创建)，并确保每个分配了角色*的相关用户必须*拥有这些角色。确保定期审核这些角色和用户。](https://kubernetes.io/docs/tasks/access-application-cluster/access-cluster/)

此外，确保禁用对 API 服务器和 Kubelets 的匿名访问。这是通过**–anonymous-auth = false**选项完成的。如何将这个选项传递给 API 服务器和 Kubletes 将取决于您用来部署 Kubernetes 的平台。

最后，在任何情况下，都不应该将 Kubernetes API 服务器暴露给互联网。因为此时此服务特别容易受到攻击，所以您应该使用防火墙对其进行保护，并且只允许通过可信网络、子网或高度加密的 VPN 对其进行访问。

在负责 kube-apiserver 的开发人员解决这个问题之前，您和您的公司必须确保遵循所有部署 Kubernetes 集群的最佳实践，这一点至关重要。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>