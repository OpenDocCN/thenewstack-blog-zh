<html>
<head>
<title>Off-The-Shelf Hacker: Quirks of the Linux Serial Line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现成的黑客:Linux串行线的怪癖</h1>
<blockquote>原文：<a href="https://thenewstack.io/off-shelf-hacker-quirks-linux-serial-line/#0001-01-01">https://thenewstack.io/off-shelf-hacker-quirks-linux-serial-line/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">我们还没怎么讨论的是我的最新项目产生的数据，机器人头骨赫德利。没错，在内心深处，赫德利是一个“物联网”设备。他有传感器，这些传感器产生数据，然后可以用于分析，活动记录，并作为应用程序或其他设备的输入。</p>
<p class="translated">例如，当我带赫德利去参加我的下一次技术讲座时，我想制作一些便携式联网聚光灯，可以随身携带。他会坐在房间前面的一张小桌子上，当我在舞台上走动时跟踪我。如果有几盏聚光灯跟着我，岂不是很酷？或者，也许一个机器人摄像机，来记录我的会议。在我演讲的过程中，来自赫德利的数据可以将这两个小工具引导到正确的位置。嘿，我是独角戏，利用最新的技术来完成工作。</p>
<p class="translated">现在，赫德利的主要数据生产者是<a href="http://jevois.org/" class="ext-link" rel="external "> JeVois智能机器视觉摄像机</a>。它提供增强的USB视频输入和硬件串行线路输出。根据当时运行的特定车载视觉分析应用程序，增强视频对于监控传感器正在解释的内容非常有用。硬件串行线将位置数据发送到Arduino，然后Arduino移动连接到头骨的伺服系统，使相机保持在其感兴趣的点上。</p>
<p class="translated">USB电缆上还有一个软件串行馈送。这是流经硬件串行线的镜像，您可以用它来馈送其他应用程序和设备。今天，我们将集中精力整理USB串行线设置，这样我们就可以实际获取有用的数据。</p>
<h2 class="translated">MQTT和Python脚本的前奏</h2>
<p class="translated">不久前，我探索了使用MQTT发布-订阅模型在机器、设备和服务器之间传送数据的<a href="https://thenewstack.io/off-shelf-hacker-lightweight-inter-device-messaging-mqtt/" class="local-link">。对我来说，MQTT代表了一个很好的头骨通信协议，因为它是一对多和多对一的模型。换句话说，skull可以通过管道传输其USB串行数据，可能通过Python程序传输到MQTT服务器和多个客户端，然后这些客户端可以根据需要获取和使用数据。</a></p>
<p class="translated">使用MQTT还抽象了数据的来源。聚光灯是从头骨还是从我手中拿着的一个电池供电的ESP8266点击器获得指向数据并不重要。其中一个或两个都可以与MQTT一起工作。不仅如此，由于我们可以在闭环反馈中向两个方向发送数据，纠错也是可能的。例如，只需将数据从聚光灯发布回MQTT服务器，并让skull对这些数据做些事情。</p>
<p class="translated">Python通过库对MQTT提供了很好的支持，所以编写程序来自动化我们如何使用数据以及将数据发送到哪里，肯定会是赫德利的未来。最棒的是，因为skull有一个Raspberry Pi 3，我们可以简单地在那里安装一个MQTT服务器。而且，Python也很容易获得。</p>
<p class="translated">我们将在接下来的故事中讨论MQTT。在我们让串行数据处理可靠地工作之前，一切都是空谈。</p>
<h2 class="translated">古怪的Linux串行线和JeVois相机命令</h2>
<p class="translated">让串行数据流入/流出JeVois传感器并通过Raspberry Pi是一件棘手的事情。首先，你需要告诉传感器运行什么样的神经网络应用程序。最简单的方法是运行<a href="http://guvcview.sourceforge.net/" class="ext-link" rel="external "> guvcview </a>命令并选择合适的分辨率。当然，显示器、键盘和树莓皮需要连接到JeVois设备上，这样才能工作。</p>
<p class="translated">一旦摄像机开始运行，并且您正在监控视频馈送，您可能会认为您只需在Pi的一个终端上键入一个简单的命令，就可以输出数据流，因为Linux中的所有东西，包括设备，都被认为是文件。但是，不！</p>
<p class="translated">例如，有时我会输入'<strong>cat/dev/tty ACM 0【T3]'，但什么也没有得到。命令行只是静静地坐在那里嘲笑我。</strong></p>
<p class="translated">解决方法是使用<strong> <a href="https://www.computerhope.com/unix/ustty.htm" class="ext-link" rel="external "> stty </a> </strong>命令来配置串口。stty有很多选项，尽管我们只需要几个。在skull的Raspberry Pi终端中，我刚刚输入了以下内容。<br/></p>
<div id="crayon-642311bea5135303041052" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-e">sudo </span><span class="crayon-i">stty</span><span class="crayon-h"> </span>-<span class="crayon-i">raw</span><span class="crayon-h"> </span>-<span class="crayon-m">F</span><span class="crayon-h"> </span>/<span class="crayon-i">dev</span>/<span class="crayon-i">ttyACM0</span><span class="crayon-h"> </span><span class="crayon-cn">115200</span>
</pre>
</div>
</div>

<p class="translated"><br/> <strong> <a href="https://linuxacademy.com/blog/linux/linux-commands-for-beginners-sudo/" class="ext-link" rel="external "> sudo </a> </strong>用于避免与<strong> /dev </strong>文件权限冲突。-raw选项来回传输数据，没有任何修改或过滤。F指定设备，在本例中为<strong> /dev/ttyACM0 </strong>。最后，115200设置串行线速度。</p>
<p class="translated">一旦<strong> stty </strong>命令执行，像<strong> cat </strong>这样的运行命令应该是一帆风顺的。</p>
<p class="translated">没那么快。您必须显式设置JeVois传感器，以便从USB串行端口发送数据。这很容易做到，从Raspberry Pi发送数据到串行端口。</p>
<p class="translated">由于JeVois传感器实际上是一个运行在设备中ARM处理器上的小型Linux机器，它有一个用于配置的<a href="http://jevois.org/doc/UserCli.html" class="ext-link" rel="external ">基本命令行</a>。你可以发送一些命令来改变相机的分辨率(它将运行哪个神经网络程序)，获取关于设备的信息等等。只需通过USB串行线向它发送一个命令。</p>
<p class="translated">实际命令的形式是'<command> <parameter> <value>'。</value></parameter></command></p>
<p class="translated">在这里，它被卷起，将命令发送到JeVois，然后通过cat命令返回最终的相机数据输出。<br/></p>
<div id="crayon-642311bea513a407857997" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-e">sudo </span><span class="crayon-i">bash</span><span class="crayon-h"> </span>-<span class="crayon-i">c</span><span class="crayon-h"> </span><span class="crayon-s">"echo 'setpar serout All' &amp;gt; /dev/ttyACM0"</span>;<span class="crayon-h">  </span><span class="crayon-i">cat</span><span class="crayon-h"> </span>/<span class="crayon-i">dev</span>/<span class="crayon-v">ttyACM0</span>
</pre>
</div>
</div>

<p class="translated"><br/>再次<strong>须藤</strong>负责权限。然后，我们在bash shell下运行echo命令，并将“setpar serout All”文本字符串发送到<strong> /dev/ttyACM0 </strong>串行端口。这是一个连接到JeVois摄像头。最后，第二个命令<strong> cat </strong>用于显示从串口返回的内容。在这种情况下，它是来自JeVois摄像机的位置数据。</p>
<p class="translated">在setpar命令中使用“All”选项很重要，因为这将打开硬件串行线和USB串行输出的数据流。</p>
<p class="translated">下面是一些数据的截图。</p>
<div id="attachment_3910816" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-3910816" decoding="async" loading="lazy" class="size-full wp-image-3910816" src="../Images/b0fb1a343061ebf083528bc00b538ede.png" alt="" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2018/01/2af91a2b-serial-data.png"/><p id="caption-attachment-3910816" class="wp-caption-text translated">在Raspberry Pi 3终端显示器上看到的JeVois传感器数据</p></div>
<p class="translated">连接到Raspberry Pi USB串行端口的JeVois传感器的一个特别奇怪的行为是，当数据没有被发送时，视频馈送偶尔会冻结。</p>
<p class="translated">不过，这很容易解决。只需执行另一个cat命令。视频将再次开始，串行数据也将出现在终端屏幕上。<br/></p>


<p/>
<h2 class="translated">下一步是什么</h2>
<p class="translated">这是一次快速浏览Linux USB串行线配置和使用迷宫的旅程。请记住，虽然您可以在命令行上将数据重定向或传输(分别使用Linux redirect ' <strong> &gt; </strong>'和pipe ' <strong> | </strong>'符号)到其他应用程序和设备，但在后台运行的Python程序是完成我们的自动化任务的更实用的方法。</p>
<p class="translated">你必须先爬后走，因此消除项目中的串行线部分始终是一项重要的开发练习。如果你能把数据传送到终端显示器上，你就一定能把它输入程序或传送到网络上。</p>
<p class="translated">请务必在不久的将来<a href="/tag/off-the-shelf-hacker/" target="_blank">关注赫德利的MQTT安装和Python脚本开发</a>。</p>
<p class="attribution translated">由<a href="https://unsplash.com/photos/dzejyfCAzIA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="ext-link" rel="external "> Christopher Burns </a>在<a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="ext-link" rel="external "> Unsplash </a>上拍摄的特征图像。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>