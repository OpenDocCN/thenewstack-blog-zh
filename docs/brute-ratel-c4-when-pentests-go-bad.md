# C4:当圣灵降临节变坏

> 原文：<https://thenewstack.io/brute-ratel-c4-when-pentests-go-bad/>

Palo Alto Networks (PANW) Unit 42 威胁研究团队正在悄悄开展他们的业务，这时他们在 [VirusTotal](https://www.virustotal.com/gui/home/upload) 中发现了另一个恶意软件文件，这是一个可疑文件、域、IP 和 URL 的社区网站。这款产品得到了所有 56 家供应商的好评。他们仔细看了看，发现这根本不是良性的。事实上，它包含了一个与最新的红队和敌对攻击模拟工具[蛮率 C4 (BRc4)](https://bruteratel.com/) 相关的恶意有效载荷。

虽然他们说是“模拟”，但它实际上可以用来——惊喜！—攻击系统。我知道你对此感到震惊。

## 可定制的命令和控制

BRc4 自 2020 年末以来一直存在。这是一个高度可定制的指挥和控制基础设施(C2)框架。它的制造者声称，它不包括像 [Metasploit](https://www.metasploit.com/) 这样的漏洞利用生成功能，也不包括像 [Nessus](https://www.tenable.com/products/nessus) 、 [Acunetix](https://www.acunetix.com/) 或 [Burp Suite](https://portswigger.net/burp) 这样的漏洞扫描功能。

然而，它确实有许多好的特点。其中包括编写使用 Slack、Discord 和 Microsoft Teams 等服务的命令和控制通道的能力。它还可以将外壳代码注入到现有进程中，并使用未记录的系统调用来代替正常的 Windows API 调用。Brute Ratel 还可以执行内存程序和脚本执行。它有一个调试器，可以检测 EDR 钩子并避免触发它们的检测。

## 对某些人有好处，但不是所有人

简而言之，它非常擅长它的工作。但这也意味着，正如 PANW 所说，“这个工具是独特的危险，因为它是专门设计来避免检测的端点检测和响应(EDR)和反病毒(反病毒)能力。”而且，鉴于如此多的 EDR 和反病毒供应商认为它的有效载荷是可以的，显然它擅长这个。

虽然这对安全专家和 red 团队来说是好事，但对那些只想相信他们的 EDR 和反病毒工具会保护他们安全的公司来说就不那么好了。我们应该很幸运。

这有印象吗？钴击这个名字是不是听起来很耳熟？应该的。这是另一个 C2 框架，已经因为被黑客攻击和滥用而声名狼藉。现在，轮到更隐秘的 BRc4 了。

## 瓶中精灵

Brute Ratel 的创造者[切坦·纳亚克](https://0xdarkvortex.dev/about/)，又名[偏执忍者](https://twitter.com/NinjaParanoid)，曾是 CrowdStrike 和 Mandiant 的探测工程师和红色团队成员，[立即撤销了该程序的许可](https://twitter.com/NinjaParanoid/status/1544744698753204225)。但是很难把安全精灵塞回瓶子里。

当俄罗斯黑客组织 [APT 29(又名 Cozy Bear](https://www.bleepingcomputer.com/tag/apt29/) )似乎是 BRc4 授权攻击的幕后黑手时，这一点尤其正确。到目前为止，PANW 已经确定了 41 个与 C2 相关的恶意 IP 地址、六个 BRc4 样本以及另外三个受此工具影响的北美和南美组织。

我们可能会看到更多这样的攻击。在其 5 月发布的 Brute Ratel v 0 . 9 . 0([Checkmate](https://bruteratel.com/release/2022/01/24/Release-Checkmate/))中，它包括了诸如“反向工程几个顶级 EDR 和反病毒 dll”的功能无声且致命。从那以后，一个更新的版本，Brute Ratel v1.0(西西里防御)已经发布。

## 现在，它的功能包括(深呼吸)

就功能而言，BRc4 宣传了以下功能:

*   SMB 和 TCP 有效负载，提供通过合法网站(如 Slack、Discord、Microsoft Teams 等)编写自定义外部 C2 通道的功能。
*   内置调试器检测 EDR 用户区挂钩。
*   能够隐藏 EDRs 和 AV 中的记忆伪像。
*   即时直接 Windows SYS 调用。
*   通过 HTTP、HTTPS、HTTPS DNS、SMB 和 TCP 的出口。
*   LDAP Sentinel，它提供了一个丰富的 GUI 界面来查询对域或林的各种 LDAP 查询。
*   多个命令和控制通道—多个轴心选项，如 SMB、TCP、WMI、WinRM 和通过 RPC 管理远程服务。
*   截图。
*   x64 外壳代码加载程序。
*   反射和目标文件加载器。
*   解码 KRB5 票证并将其转换为 hashcat。
*   Windows 修补事件跟踪(ETW)。
*   修补反恶意软件扫描界面(AMSI)。
*   创建 Windows 系统服务。
*   上传和下载文件。
*   通过 CreateFileTransacted 创建文件。
*   端口扫描。

真的令人印象深刻。

### 你能做什么

那么当它被恶意使用时，你能做些什么来阻止它呢？当然，PANW 力劝您通过其威胁防御、Cortex XDR 和 WildFire 恶意软件分析来保护自己。但该公司也鼓励“所有安全供应商创建保护措施来检测来自该工具的活动，所有组织都要警惕来自该工具的活动。”

这是一件大事。鼓励您的安全提供商跟进此事。您不希望看到您的系统被这个工具损害。你可能不知道你已经被黑了几个月了。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>