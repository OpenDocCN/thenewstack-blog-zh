# 为什么监控 Kubernetes 如此具有挑战性以及如何管理它

> 原文：<https://thenewstack.io/why-monitoring-kubernetes-is-so-challenging-and-how-to-manage-it/>

[](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/)

 [查理·菲斯克

查理是 Circonus 的 ux 设计主管，他在前端为客户创造快速、易用的体验，同时与后端工程师合作，使 Circonus 安全无故障。自从他在世纪之交开始研究多媒体光盘以来，他已经从事前端开发二十多年了。查理与妻子和儿子住在肯塔基州。](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/) [](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/)

尽管 Kubernetes 很受欢迎，但运营一个 Kubernetes 集群是一个挑战。了解这项技术需要花费相当多的时间，因为它有一层又一层的抽象。管理集群部署非常困难，生态系统在不断变化，最佳实践也在不断发展。

因此，Kubernetes *监控*也很复杂。了解集群运行状况的指标、发现问题并找出解决问题的方法是组织面临的常见障碍，这使得组织很难充分实现 Kubernetes 部署的优势和价值。

要了解监控 Kubernetes 健康和性能的最佳方法，首先需要了解为什么 Kubernetes 的可观察性具有独特的挑战性。本文深入探讨了这些复杂性，以及如何用正确的解决方案来管理它们。

## **Kubernetes 监控——为何如此复杂？**

Kubernetes 的强大也是它的弱点之一。它抽象出大量的复杂性来加速部署；但是这样做，它让你看不到实际发生了什么，正在利用什么资源，甚至正在采取的行动的成本影响。此外，Kubernetes 拥有比传统基础架构更多的组件，例如服务器和服务，这使得在出现问题时进行根本原因分析变得更加困难。以下是使 Kubernetes 监控具有挑战性的三个核心复杂性。

### 复杂性#1:数百万个指标

Kubernetes 是一个多层次的解决方案。整个部署是一个集群，每个集群内部都是节点。每个节点运行一个或多个 pod，它们是处理容器的主要组件，节点和 pod 依次由控制平面管理。在控制平面内部有许多更小的部分，如 kube 控制器、云控制器、kube API 服务器、kube 调度器和 etcd。这些抽象都有助于 Kubernetes 有效地支持您的容器部署。虽然它们都非常有用，但是它们产生了大量的指标。

除了控制平面指标之外，还有“Pod 变动”指标。不同组织之间的实际 pod 使用情况差异很大。一些组织设计的系统中，吊舱可能持续几天、几周甚至几个月；而其他组织的系统中的吊舱只能持续几分钟或几秒钟。在 Kubernetes 中，每个 pod 都生成一组自己的指标。“荚果搅动”指的是荚果和容器被创造、破坏和后来再创造的循环；每次创建 pod 时，都会为它创建一组新的指标。这导致了大量高基数(非常独特)的指标。高水平的“pod 变动”会导致每天产生数以百万计的新指标。

### 复杂性#2:短暂性

除了系统控制平面之外，还有您的部署元素——它们会不断变化。部署、守护集、作业和状态集都可以生成新的 pods 来监控，有时甚至需要缩减规模；那么豆荚或节点将永远消失。Kubernetes 调度程序对所有这些元素进行调度，以确保资源总是可用的，并被分配到您想要的位置。在安排新的部署时，Kubernetes 可能会决定需要移动一个单元，以便释放给定节点上的资源。这导致 pod 被移动和重新创建—同一个 pod，只是名称不同，位置不同。

### 复杂性#3:缺乏可观察性

采用 Kubernetes 的组织往往也遵循现代软件实践，包括使用微服务和/或无状态应用程序设计。这些最终导致应用程序架构非常动态，并且阻碍了可观察性。

在基于微服务的应用程序中，工程师将应用程序分解为代表应用程序核心功能或服务的组件。这些组件旨在松散耦合，因此服务是独立操作的，并且以一种对一个服务的更改不会显著影响其他服务的方式进行设计。现代应用可以由几十个微服务组成，Kubernetes 跟踪这些不同组件的状态，确保它们可用，并且有足够多的微服务来处理适当的工作负载。微服务本身不断地相互通信，这种通信通过 Kubernetes 集群内部的虚拟网络进行。

在无状态应用程序中，应用程序避免在服务器上存储任何客户端会话数据。任何会话数据存储(如果需要的话)都在客户端处理。因为服务器上没有存储会话数据，所以也不需要任何特定的客户端连接优先于任何其他客户端连接。这允许应用程序将每个连接视为第一个连接，并轻松地在多个实例之间平衡处理负载。无状态应用程序设计的最大好处是，它使应用程序能够水平伸缩，只需在多个服务器上部署应用程序的实例，然后在可用的服务器之间分发所有传入的客户端请求。

微服务不需要是无状态的(无状态的应用程序也不需要被组织到微服务中)，但是您会发现这两种实践被一起利用，以便能够轻松地扩展应用程序。这意味着 Kubernetes 成为部署这类软件的理想平台。然而，这些类型的服务(通过设计)被认为是短暂的；它们可以纵向扩展以处理工作负载，然后在不再需要时消失。因此，当它被拆除时，pod 中的所有操作信息都会随之消失。什么都没有留下；都没了。

这对 Kubernetes 的可观测性有何影响？因为可观测性是通过系统输出的知识来推断系统状态的能力，所以看起来 Kubernetes 确实是一个具有最小可观测性的系统。这种有限的可观察性是 Kubernetes 很难解决问题的原因。Kubernetes 运营商在迁移到生态系统几个月甚至几年后发现重大软件问题的故事并不少见。Kubernetes 本身在确保服务保持运行方面做得非常出色，鉴于其有限的输出，您可以很容易地发现自己处于这种情况下，而不会意识到这一点。从表面上看，这对 Kubernetes 来说是一个伟大的成功故事，但这些软件问题迟早需要被发现，当系统似乎是一个“黑匣子”时，这将是一个问题

## **监控为您管理 Kubernetes 复杂性的解决方案**

管理 Kubernetes 可观察性的复杂性需要知道在监控解决方案中要寻找什么。虽然有几个开源的 Kubernetes 监控解决方案，但是它们需要您创建并安装几个单独的组件，然后才能有意义地监控您的集群。一些传统的 IT 监控工具提供商也引入了 Kubernetes 监控解决方案，但许多都不是专门为 Kubernetes 构建的。因此，组织需要做更多的调优工作，并花费大量的时间来确定问题、导致问题的原因以及如何解决问题。

那么，你如何确定什么最适合你呢？以下是评估 Kubernetes 监控解决方案时需要考虑的关键标准。

### 自动适应变化，同时保持一致的用户体验

由于 Kubernetes 的短暂性，监控解决方案需要能够自动检测变化并不间断地持续监控。还有，Kubernetes 本身也在不断变化。因此，除了弄清楚 Kubernetes 是如何工作的，还有一个挑战是试图弄清楚如何在一个不断进化的生态系统中进行监控。一个好的 Kubernetes 监控解决方案的目标应该是跟上并封装这些变化，同时仍然为用户提供一致、可靠和可重复的体验——从而减轻他们的负担。

### 提供专为 Kubernetes 打造的交钥匙工具

如果您正在监控 Kubernetes，那么您的工作就是识别问题、失败的原因以及快速补救的步骤。这需要开发适当的领域知识，包括一组离散的病理故障和对每一种故障的说明性反应。但当你看到今天市场上 Kubernetes 的技能差距时，这种知识是极其罕见的。

一个有效的 Kubernetes 监控解决方案应该能够识别和修复 Kubernetes 部署中反复出现的特定故障，如崩溃循环、作业失败、CPU 利用率等。用户不需要弄清楚他们需要监控哪一个以及如何监控。解决方案应该让你意识到问题，但不需要深入分析或学习跟踪它，处理它，并确保它不会再次发生。

### 处理大量数据，知道哪些指标值得关注

传统的监控系统跟不上正确监控 Kubernetes 集群所需的大量独特指标。一个全面的 Kubernetes 监控解决方案必须能够处理所有这些数据。但是您应该关注哪些指标呢？你不可能全部看完，也不需要全部看完。您的 Kubernetes 监控解决方案需要跟踪重要的指标，因此您可以放心，一切都在正常运行。

## **结论**

Kubernetes 为现代基于云的应用程序提供了显著的优势，但要充分获得其优势，组织需要一种新的监控方法。Kubernetes 提出了独特的可观察性挑战，传统的监控技术不足以深入了解集群健康和资源分配。通过了解 Kubernetes 监控背后的复杂性，您可以更好地确定一个解决方案，让您从 Kubernetes 部署中获得更多价值。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>