# 集装箱机密管理的 8 个最佳实践

> 原文：<https://thenewstack.io/8-best-practices-for-container-secrets-management/>

[机密管理](https://www.twistlock.com/2017/09/12/manage-secrets-container-based-applications/) 是集装箱安全的关键组成部分。在本帖中，我们来看看管理秘密(或者，换句话说，像密码、 [API 密钥和令牌](https://www.twistlock.com/2018/06/04/7-api-best-practices/) )的最佳实践，以减轻容器安全风险和漏洞。

## 1.区分机密和标识符

在容器的上下文中，秘密是任何信息，如果暴露给未授权的人或实体，将使您的组织、客户或应用程序处于风险中。随着系统变得越来越复杂，所涉及的秘密信息量也在增加，随之而来的是所涉及的风险水平也在增加。系统中的活动部件越多，就越容易受到风险的影响。

值得一提的是，并非所有的信息都是秘密信息。一些信息，如用户名和 TLS 证书，是标识符，需要有选择地共享。标识符并非完全没有风险，但它们的风险明显小于机密。但是，与其相关的密码和密钥应该被视为机密。

## 2.建立信任圈

系统的某些部分可以完全信任(例如，CPU、RAM、根用户或具有适当安全策略的秘密管理工具)。系统的某些部分只能被选择性地信任(例如，员工被明确授权访问某些机密或云服务，如受保护的 S3 桶)。最后，默认情况下，外部实体是不可信的。他们包括随机用户，或一个 WiFi 热点。向这些实体透露的秘密会受到损害，并会导致风险。

## 3.了解信任链

当秘密通过系统时，它们触及这些不同的实体。秘密采用的路径是决定秘密是否安全或被泄露的关键。旅程中的每一步都是一个“链接”，整个链接列表一起形成了一个“链”。拥有整个供应链的全面可见性非常重要。这样，您可以建立信任链，并确保只有信任圈内的实体才能访问机密。

## 4.使用 KMS 加密数据

防火墙不足以保护机密数据；也不是受密码保护的数据库。他们离完全妥协只有一步之遥。相反，我们需要的是一个密钥管理服务(KMS ),在多个层次上加密数据。您应该能够使用加密密钥加密整个文件，并使用不同的加密密钥加密文件中的个别数据。这样，您可以只共享数据的特定部分，而不会危及其余数据。这限制了潜在攻击的爆炸半径。但是，在内部创建和管理加密密钥是一件非常繁琐的事情。当使用云原生容器应用时，必须使用基于云的加密服务，如 AWS KMS 或类似的替代服务。它们具有复杂的功能，可以自动操作并极大地控制加密密钥的创建和管理。

## 5.经常轮换秘密

长期保持不变的秘密更有可能被泄露。随着越来越多的用户接触到某个秘密，很可能有人处理不当并将其泄露给了未经授权的实体。秘密可以通过日志和缓存数据泄露。它们可以被共享用于调试目的，并且一旦调试完成就不能被改变或撤销。它们可能会被黑客破解。出于所有这些原因，机密应该经常轮换。

## 6.自动创建密码

创建密码和访问密钥的方式对它们的安全性至关重要。人工创建密码是一种灾难。据 Troy Hunt 统计， [85%的密码都是不安全的](https://www.troyhunt.com/86-of-passwords-are-terrible-and-other-statistics/) 。对抗不良密码的唯一方法是使用机器自动生成的唯一且不易被破解的密码。如今，大多数机密管理工具都将自动生成密码作为默认功能。

## 7.负责任地储存秘密

机密管理工具已经成为集装箱安全不可或缺的工具。他们的重点是防止秘密被保存在磁盘上、嵌入代码中或者除了秘密管理器本身之外的系统的任何部分中。这是一个文化问题，很难在大型团队中实施。但是，必须使用 secrets 工具强制创建密码，并使用相同的工具通过过期的令牌共享密码。

## 8.检测未经授权的访问

 [吐温·泰勒

吐温是 Twistlock 的客座博主，也是 Fixate IO 的撰稿人。他在谷歌开始了他的职业生涯，在那里，他参与了 AdWords 团队的技术支持。他的工作包括审查堆栈跟踪和解决影响客户和支持团队的问题，以及处理升级。如今，作为一名科技记者，他帮助 IT 杂志和初创公司改变团队构建和发布应用程序的方式。](https://cloudplatformonline.com/TNS-CI-CD-with-Kubernetes.html?utm_source=google&utm_medium=email&utm_campaign=FY18-Q3-americas-nurture-email-wd-icb_tns&utm_content=cicd&utm_term=tns) 

尽管你尽了最大努力，还是有可能在某个时候泄露秘密。在这种情况下，你之前的所有计划都将受到考验。第一步是尽可能早地识别事件(这就是为什么您需要一个安全监控工具)。

您还应该准备好一个计划，以便在检测到违规时快速做出响应。假设您在事件发生一小时后发现了一个漏洞。您能以多快的速度阻止恶意用户或实体的访问？在这里，对系统中每个点的密码的完全控制和一个考虑周全的架构是必不可少的。最后，作为预防措施，您需要更改系统中的所有密码。这容易实现吗？一旦更改了所有密码，是否可以通知合法用户，是否可以立即授予他们访问权限？万一系统离线，密码管理器还能起作用吗？

请确保您能够检测违规行为，并且您有一个计划来管理上面列出的所有注意事项。

## 结论

容器为 IT 管理员和开发人员团队带来了新的安全挑战。然而，通过意识到潜在的风险，以及减轻这些风险的可用选项，您可以建立更健壮且几乎万无一失的安全性。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>