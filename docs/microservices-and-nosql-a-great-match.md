# 微服务和 NoSQL:一场伟大的比赛

> 原文：<https://thenewstack.io/microservices-and-nosql-a-great-match/>

[](http://hibernatingrhinos.com/)

 [柳文欢·艾尼

柳文欢·艾尼，冬眠犀牛的首席执行官和创始人，在开发领域有 20 多年的经验，特别关注微软和微软。网络生态系统。自 2007 年以来，柳文欢被公认为微软最有价值的专业人士之一，他也是《Inside RavenDB 的作者。他经常在 DevTeach、JAOO、QCon、Oredev、NDC、Yow！还有 Progressive.NET。](http://hibernatingrhinos.com/) [](http://hibernatingrhinos.com/)

我们为什么需要微服务？十年前对面向服务的架构也进行了同样的宣传，尽管有各种预期，但是到 2009 年，90%的软件架构没有采用面向服务的架构(SOA)。

什么变了？

就在我们说话的时候，有超过 40 亿人联网。超过 300 亿台物联网设备在世界各地的超过 2500 万个应用程序之间来回传输信息。有太多的活动来自太多不同的位置，无法通过一台服务器集中处理。

当今数字世界的规模和速度要求分布式架构。那时 SOA 是奢侈品，现在微服务是必需品。

## 那么什么是微服务呢？

[微服务](https://thenewstack.io/microservices-vs-monoliths-an-operational-comparison/)获取一个应用程序，并将其拆分成称为服务的功能。每个服务可以有自己的运行环境、数据库和位置。在 monolith 中，如果服务器宕机，您的应用程序也会宕机。在某些情况下，您的整个组织都会崩溃。即使您在多台服务器上运行，也是如此。一个整体通常被建模为一个单独的应用程序，但是相互依赖的多个应用程序也同样危险。一次失败就会使整个系统瘫痪。

当您的系统由独立的微服务组成时，一个功能可以脱机而不会出现任何问题。这就像一架四引擎喷气式飞机的最左侧机翼发生了爆裂——飞行将会继续，没有人会知道。这并不理想，但系统能够在这种模式下工作并继续正常运行。

为了使这种体系结构以最佳方式工作，每个服务必须完全相互独立。它们可以向彼此发送信号，指示它们应该在什么时候运行，甚至应该如何运行，但是这些服务根本不能相互依赖。如果只有一个服务停止工作，任何类型的依赖都会导致多服务崩溃。情况可能会变得更糟——如果一项服务直接依赖于缓慢的服务，那么这项服务的速度减慢将会导致其他服务的交通堵塞(并最终完全瘫痪)。

## 微服务就像一家好餐馆

在所有最好的餐厅，主人都有一套系统来管理预订、预约和顾客安置。酒保在客人等待入座时为他们服务，因为知道他的顾客喜欢喝什么而出名。服务员有自己的记事本来记下用餐者的点单。厨房有一个订单轮接收订单并开始准备订单，收银员有一个收银台。

如果我们给这家餐厅一个微服务架构会怎么样？主机将使用非关系数据库来管理预订系统。当一方来了更多的人时，可以进行更新，当取消时，可以进行删除。一旦人们吃完饭，桌子空出来，就可以发出警报。

> 在微服务架构中，您可以灵活地为每项服务选择最佳数据库。

酒保可以使用图表数据库为顾客匹配合适的饮料。根据走向吧台等待入座的顾客，这项服务可以调出他们的订单历史，并推荐最好的鸡尾酒。坐下后，服务员可以使用文档数据库来接受订单，特别是如果订单必须根据特定食客的口味和需求进行定制，或者如果食客希望在点餐前看到食物的图像。一旦完成，ETL 可以接受订单并进入厨房，告诉他们开始工作和准备什么。使用键值持久化模型，厨房将看到下一个要准备的订单并开始处理。

因为用餐过程中的每一步都是独立的服务，不需要其他服务来操作，所以顾客可以从餐厅员工能够承担彼此的任务所增加的效率中受益。一旦用餐体验结束，满意的顾客可以通过在关系数据库上运行他们的登记来向收银员付款。

## SQL vs NoSQL:敌人，一个爱情故事

monolith 应用程序通常会限制您使用一个数据库和一种类型的持久性。在微服务架构中，您可以灵活地为每项服务选择最佳数据库。一些函数需要关系数据库所要求的硬模式的刚性，而另一些函数需要非关系选项所固有的灵活性。

根据 Gartner 的调查，70%的数据库是关系型的，根据 IDC 的调查，90%的新应用将使用微服务作为其架构。即使默认选择仍然是关系型的，也会有更多的空间将特定的功能分配给精品非关系型数据库，从而使您的整个应用程序具有多语言持久性。可口可乐和百事可乐孰优孰劣的挑战就此结束。SQL 和 NoSQL 已经成为一种美味的鸡尾酒，一种你需要的数据系统将征服世界。

## 非关系数据库有什么特别之处？

非关系数据库的最大好处是分布式数据。在单点服务器出现仅 40 年后，关系型服务器已经开始涉足分布式体系结构。这是一个破碎的模型，因为你在增加复杂性。关系数据库将通过从多个表中获取数据，然后将它们放在一起来回答查询。如果你分发它，它会变得更加复杂。将其放入微服务架构中，您会看到三个不断增加的复杂性级别。

哎哟。

像文档模型这样的非关系数据库将把你需要的所有东西放在一个地方，不再需要表格。这使得事情变得简单多了，并且易于与分布式拓扑连接。一开始，非关系*就简化了微服务架构的*事情。

此外，非关系数据库是轻量级的。它们使用起来很简单，尤其是那些具有灵活模式或者根本没有模式的应用程序。

您可以更快地设置它们，从而降低新体系结构的复杂性。服务也是分布式的，一个非关系模型可以用一个分布式数据库来支持它，这个数据库可以位于你喜欢的任何服务之下。它增加了应用程序的持久性。微服务应用通常会复制相同的服务作为备份，以防服务中断。您可以向外扩展分布式数据库，这样服务的所有副本都可以访问同一个数据库，并且可以一前一后地向外扩展。借助即时复制，备用数据库与离线数据库一样保持最新，让您能够在整个微服务应用体系中持续部署。

非关系数据库的开销也很低，甚至没有。对于每个例子，你可以*最小化痛苦、摩擦，尤其是复杂性*。最好的数据库解决方案是静默式的，它们可以针对新的配置环境进行自我优化，并且不需要 DBA 来照看它们。在这个新的架构中，DBA 将会更加忙碌。任何能减轻他们新工作量的事情都是受欢迎的。这对于您将经常大量部署的微服务环境非常重要。

最重要的是，微服务是为了速度而构建的。NoSQL 支持大多数服务快速设置、快速扩展，并创建额外的数据节点，您可以在不接触持久层的情况下进行测试。所有这些都是为了让你的发布周期比以前更快。

## 结论

微服务是新的软件架构。它依赖于灵活性、分布式和高可用性。微服务架构的思维模式与非关系数据方法的动态思维密切相关。2018 年，在微服务架构中编码的开发人员更频繁地选择 NoSQL。随着非结构化数据的持续增长，越来越多的应用程序从云平台推出，以支持应用层资源的优化使用，非关系思维对前沿开发人员的吸引力将持续增长。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>