# CI 管道的工程最佳实践

> 原文：<https://thenewstack.io/engineering-best-practices-of-ci-pipelines/>

在微服务架构流行之前，开发人员必须将大型软件应用程序作为单个实体来构建和交付。如今，许多较小的应用程序被同时使用，每个应用程序都专注于业务功能的一个方面。由于较小的应用程序和具有不同背景的成员的团队经常远程工作，团队之间增加协作和减少障碍是有效生产环境的基本特征。

## DevOps 和 CI/CD

[DevOps](https://www.runforesight.com/blog/what-ci-observability-means-for-devops) 将开发和运营团队聚集在一起，在开发和运营团队之间创造一种以合作、协作和伙伴关系为特征的文化转变。这种转变整合了微服务应用生命周期中涉及的流程，使组织能够更快、更高效地向市场交付产品。

[持续集成和持续交付或部署(CI/CD)](https://www.redhat.com/en/topics/devops/what-is-ci-cd) 是简化应用程序创建和部署流程的开发运维实践。CI/CD 中的术语“连续”代表两个基本特征:

*   首先，应用程序的集成和交付将是连续的，具有最少的人工交互和高度的自动化。
*   其次，构建和部署的软件包将尽可能小，允许软件更新的增量交付。

## 左移位

在云原生时代，CI/CD 系统最显著的优势是支持“[左移”实践](https://devops.com/devops-shift-left-avoid-failure/)。左移意味着在开发的最早阶段保证应用程序的安全性，这实际上意味着在软件开发过程的初始阶段执行测试、集成和质量检查。

尽管 CI/CD 已经成为软件开发领域的一部分很多年了，但是还没有一个通用的 CI/CD 平台。由于组织有不同的需求和目标，他们对 CI/CD 平台的期望也是不同的。但是，无论您使用哪种平台，在云本机 CI/CD 方面都有一些成熟的最佳实践。

## CI/CD 的最佳实践

让我们来看看包括谷歌、脸书和 VMWare 在内的软件巨头实施的战略，这样您就可以从他们的经验中受益，并在我们自己的 CI/CD 渠道中应用他们的战略。

### 进行较小的变更和频繁的构建

持续集成依赖于这样一个事实，即所有源代码、配置和依赖项都是在源代码控制库中定义的。每当对存储库中的数据进行更改时，CI 系统都会触发一组任务，以确保更改已经成功集成，没有任何冲突。

为了从 CI/CD 系统中获益，每个团队成员都应该将他们的变更以小块的形式提交给源代码存储库。通过执行较小的更改和频繁的构建，用于集成的工程时间将被最小化，从而降低低效率和相关成本。小的变化也有助于保持交付和部署的包的可管理性和可控性。这意味着在更新的应用程序中，用户和运营商都将面临更低的复杂性。

### 自动化测试和绿色构建

CI/CD 系统的本质是以绿色构建为目标，并在红色构建发生时快速解决问题，红色构建意味着测试失败。当自动化测试运行时，所有团队成员都应该可以看到任何失败的结果。然后，让构建再次工作应该是团队的首要任务。

绿色构建和快速修复至关重要，原因有二。首先，当测试失败时，不可能准确地测试即将到来的开发和变化。第二，连续部署将会停止，因为不存在新的和经过验证的包。尽管停止积极的开发，转而专注于修复失败的测试似乎是一种令人沮丧的情况，但这种心态将确保最佳的应用程序稳定性。

### 为生产创建把关人

高效的 CI/CD 系统应该是通向生产环境的唯一途径。换句话说，如果您已经用一套全面的测试自信地构建了一个 CI/CD 系统，那么应该没有其他方法可以将应用程序部署到生产系统。维护管理员权限并将应用程序只部署到生产系统一次是非常诱人且常见的。最常见的情况是，当有人试图在产品中快速测试一个新特性，或者用未测试的代码修复一个问题时，就会出现这种有问题的实践。由于这些变化还没有经过彻底的测试，它们可能会导致更大的破坏并产生安全问题。然而，当这些应用程序尚未通过所有 CI/CD 系统阶段和测试时，您就破坏了您的过程和先前的努力。

### 使用部署策略

部署策略是用于发布软件新版本的技术。它们是 DevOps 的一个关键方面，因为它们有助于最小化停机时间和风险，并在开发周期的早期发现问题。此外，部署策略非常符合进行频繁但较小的更改、执行频繁的部署和自动化的概念。一些众所周知的部署策略包括:

*   滚动升级部署:如果测试中没有发现任何问题，则增量发布新的更新并删除旧版本。
*   Canary deployment:最初向一部分用户发布新特性，在向所有用户推广该特性之前，检查在实践中是否有任何问题。
*   蓝/绿部署:需要两个生产就绪环境，一个空闲，通常称为“蓝”，另一个活动，标记为“绿”在蓝色上测试变化；如果一切正常，蓝色环境被设置为活动，而绿色环境变为空闲。

大多数云原生平台[，比如 Kubernetes](https://kubernetes.io/blog/2018/04/30/zero-downtime-deployment-kubernetes-jenkins/) ，都支持开箱即用的零停机运行时部署策略。您只需要在 CI/CD 管道的连续交付阶段配置您的部署策略。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>