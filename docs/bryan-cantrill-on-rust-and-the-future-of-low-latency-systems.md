# Bryan Cantrill 谈 Rust 和低延迟系统的未来

> 原文：<https://thenewstack.io/bryan-cantrill-on-rust-and-the-future-of-low-latency-systems/>

Bryan Cantrill 去年在首届 [P99 CONF](https://www.p99conf.io/) 上发表了慷慨激昂的见解——这是一个专注于开源的会议，专为痴迷于 P99 延迟的工程师设计。

怀着对坎特里尔回归 [P99 CONF 2022](https://www.p99conf.io/) 的热切期待，让我们回顾一下他关于“Rust、莱特定律和低延迟系统的未来”的演讲他预测，未来十年将会看到两个对低延迟系统产生深远影响的重要变化:基于 Rust 的系统的兴起，以及摩尔定律让位于赖特定律。

在这次演讲中，他讨论了这两种趋势，尤其是它们的融合——解释了为什么他认为低延迟系统的未来将在一些令人惊讶的地方包括 Rust 程序。

[https://www.youtube.com/embed/cuvp-e4ztC0?feature=oembed](https://www.youtube.com/embed/cuvp-e4ztC0?feature=oembed)

视频

相信我们:你会想看完整部电影的。这里有一个窥视这一切是怎么回事。

## 系统性能的仲裁者

 [辛西娅·邓洛普

Cynthia 写软件开发和测试的时间比她愿意承认的要长得多。她目前是 ScyllaDB 的内容战略高级主管。](https://www.linkedin.com/in/cynthiadunlop/) 

演讲从硬件/软件协同设计和性能之间不可分割的纠结开始:“硬件是我们系统性能的最终仲裁者。硬件是实际运行我们系统的东西。尽管硬件不是所有系统性能的起点和终点，但它最终会限制我们的性能。"

坎特里尔认为，三种不同的革命推动了系统性能的进步，经济可行性笼罩着所有这些革命:

*   推动所有设计的流程变革
*   针对特定用例进行优化的架构变革
*   让我们更好地利用硬件的软件革命

用他的话说:“那些软件革命实际上可以归结为‘我们如何更好地利用硬件？’我们并不总是这么说。但是，当我们通过软件革命提升性能时，我们是在提升性能，因为我们更好地使用了硬件。"

## 摩尔定律

众所周知的“[摩尔定律](https://en.wikipedia.org/wiki/Moore%27s_law)”——观察到晶体管密度、速度和成本效率每两年或不到两年翻一番——是讨论工艺革命的可以理解的起点。(完整视频记录了戈登·摩尔的真实言论)。

在这方面，20 世纪 80 年代和 90 年代初是平静的日子:“你去买一台新电脑，而你 18 个月前刚买的那台已经过时了。事实上，它变得如此之快，如此之快，以至于我们实际上不得不减慢计算机的速度，以便玩为旧机器编写的游戏。你会买一个为 PC/AT 编写的游戏，然后它就不能在 386SX 上玩了。

抱歉，如果我在这里听起来像“古董路演”*，但是如果你是我的同辈，你知道我在说什么。实际上，你可以不按加速键，让你的应用程序变慢。*

 *但是再深入一点，你会发现摩尔定律的“美好旧时光”并不完全是黄金。DRAM 没有被邀请参加聚会:虽然内存变得越来越密集，但它并没有变得更快。

在 20 世纪 80 年代末，尤其是 20 世纪 90 年代，我们越来越多地撞上了内存墙，到了缓存成为必需品而不是辅助手段的地步。摩尔定律在继续，正如[丹纳德缩放](https://en.wikipedia.org/wiki/Dennard_scaling)(随着晶体管变得更小，它们的功率密度保持不变)。然而，越来越多的应用程序撞上了内存墙。唯一的解决办法是一场重大的建筑革命。

到 20 世纪 90 年代中期，对称多处理似乎已经准备好引领这样一场架构革命，让我们走上了为多线程工作负载提供吞吐量的道路。然而，它需要一场软件革命——为多线程系统编写代码——并且没有真正帮助单线程延迟。

20 世纪 90 年代还出现了类似深度流水线和 [VLIW(超长指令字)](https://en.wikipedia.org/wiki/Very_long_instruction_word)的实验，但都没有成功。摩尔定律导致了更多的晶体管，但利用它们是一个挑战。

在过去十年左右的时间里，摩尔定律已经明显减速，更广泛的过程革命也是如此。Dennard 的扩展在 2006 年停止，时钟频率实际上限于 5 千兆赫以下，各公司正在尝试不同的方式来使用多核芯片——在一个芯片上获得许多许多内核。但这一流程革命无疑已经减速，一家接一家的公司都在努力缩减流程节点。(观看 Cantrill 的视频，他认为用纳米来谈论过程节点是“完全虚构的”。)

Cantrill 的底线是，Moore 在 1965 年的观察结果，即随着密度和性能的提高，处理器越来越便宜，不再成立。这些 3 纳米和 5 纳米晶体管成本很高，因为必须建立巨大的制造系统来提供它们。但是戈登·摩尔并不是唯一一个回顾科技史并对其经济状况感到疑惑的人。

## 赖特定律

1936 年，西奥多·莱特(与莱特兄弟没有关系)正在研究一架飞机的长期成本。他发现生产的东西越多，单位成本就越低。更具体地说，当数量大约增加一倍时，单位成本下降了 10%至 15%。这不仅仅是规模经济。

坎特里尔解释说:“随着我们对某样东西做得越来越多，我们会做得越来越好。我们正在寻找过程改进，一堆小的迭代的东西加起来。这就形成了这个非常重要的定律:[莱特定律](https://en.wikipedia.org/wiki/Experience_curve_effects)。2013 年，[圣达菲研究所的 Jessika Trancik 和她的团队](https://phys.org/news/2013-03-law-wright-tech.html)观察到，在解释晶体管经济随时间发生的变化时，赖特定律实际上比摩尔定律更好。

摩尔定律正在终结，但莱特定律似乎成立，尤其是对于较老的过程节点。也就是说，我们在每个晶体管上的花费似乎在下降，而且我们正在制造越来越多的晶体管。"

那么，处理器生产成本越来越低意味着什么呢？

*   如果莱特定律继续成立，计算将在更多以前局限于硬逻辑的地方变得经济可行，例如，我们已经看到网络接口卡(NIC)上的 CPU、闪存旁边的 CPU 和磁盘轴上的 CPU
*   即使在芯片上也是如此，在芯片上，构建异构系统比以往任何时候都更容易，混合工艺节点要求更加复杂
*   在更多的地方拥有更多的计算能力与系统性能密切相关。更多接近数据的计算(智能网卡、开放通道固态硬盘、轴上计算)降低了延迟；将数据引入专用计算(通用图形处理单元、现场可编程门阵列)可提高吞吐量。

现在是重温 Bryan 在演讲开始时提出的观点的好时机:“硬件是我们系统性能的最终仲裁者。“鉴于摩尔定律让位于赖特定律所引发的硬件发展，我们需要重新思考我们的系统软件。是时候重新思考我们的系统软件来水合所有的核心，包括许多隐藏的核心(观看[蒂莫西·罗斯科的 USENIX](https://www.youtube.com/watch?v=36myc8wQhLo) 主题演讲，了解一些甚至被研究人员忽略的核心的 X 射线视觉)。

## 所需的软件革命

正如 Cantrill 所说，“这场即将到来的革命，我们在许多不同的地方拥有许多计算元素，是在一些非常深的层次上的特殊用途。我们通用计算机仍将是运行在原始 CPU 上的大型核心复合体。这将消耗最大的功率，具有最高的性能，并且将连接到我们最快的 DRAM。但是，我们也将拥有这些特殊用途的计算元素。

而且，因为它们是特殊用途的，所以它们会很奇怪。特别是，他们将拥有更多的计算能力，他们将在内存方面失去平衡。至于存储，他们不会有太多的内存。他们将拥有非常少的非易失性存储，尤其是可以动态写入的非易失性存储。在这些非常有限的世界里，像 Java、Go 和 Python 等动态环境。是不成功的。"

C 和 c++——传统上在这个领域使用的语言——当然可以在这里工作。然而，它们带来了众所周知的围绕安全性和可组合性的挑战。那么前进的道路是什么？

## 嵌入锈

进入 Rust，它有一个特殊用途计算杀手级特性:no_std。Rust 不需要依赖自己的标准库。事实上，Rust 的许多最有价值的方面在标准库中是*而不是*(例如，求和类型、代数类型、所有权模型特征和卫生宏)。你可以用 no_std 板条箱挖掘 Rust 的绝大部分能力。

" no_std 机箱不能执行堆分配。它是在编译时强制执行的。这是令人惊讶的，我可以在堆栈的一个层上真正拥有可组合性，而这个层从来没有这种可组合性。这是令人难以置信的，能够拉进不同的 no_std 板条箱，实际上将一个系统拉在一起——并且二进制是紧密的，”他说。

你可以把这些紧密的基于 Rust 的程序——没有运行时——放在各种有趣的地方，为你想要运行的任务提供所有你需要的能力。此外，你这样做是在一种内存保护和安全的方式。

典型的例子:[氧化物计算机公司](https://oxide.computer/)正在开发一种新的([现在开源](https://www.osfc.io/2021/talks/on-hubris-and-humility-developing-an-os-for-robustness-in-rust/))操作系统，恰当地称为 [Hubris](https://oxide.computer/blog/hubris-and-humility) 。这是一个基于消息传递微内核的系统，它的内存是受保护的，并且它完全是在 Rust: microkernel and tasks 中构建的。最小的 Hubris 系统是 30k，完全真实的系统面积是 200k——这还是在集中优化尝试之前。

## 铁锈、莱特定律和未来

Cantrill 总结道:“no_std 真的是没有先例。Rust 实际上是自 C 语言以来第一种有意义地存在于硬件和软件边界的语言。这为我们指明了未来。莱特定律意味着我们将在更多的地方使用计算机——我们已经看到了这一点。那些计算机元件将会有特殊用途。不要等待通用 CPU 被推到智能网卡上。会消耗太多能量。我们不可能有那么快的记忆。但是我们能放下的是铁锈。

“我们将会看到更多令人兴奋的面向硬件的全新 Rust 系统——多亏了 no _ STD——将能够相互构建。开发高性能低延迟系统是一个非常令人兴奋的时代，Rust 革命就在这里。”

同样，你会想[看布莱恩关于这个话题的完整介绍](https://www.p99conf.io/session/rust-wrights-law-and-the-future-of-low-latency-systems/)，即使你已经读到这里。

[P99 CONF 2022](https://www.p99conf.io/) 是免费和虚拟的:现在注册，向坎特里尔、[利兹·赖斯](https://twitter.com/lizrice)、[慈善专业](https://twitter.com/mipsytipsy)、[亚历克斯·伊达尔戈](https://twitter.com/ahidalgosre)、[吉尔·特内](https://twitter.com/giltene)和[阿明·罗纳彻](https://twitter.com/mitsuhiko)等名人学习。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>*