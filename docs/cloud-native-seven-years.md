# 云原生，七年过去了...

> 原文：<https://thenewstack.io/cloud-native-seven-years/>

*本文是一系列文章中的第一篇，来自[云本地计算基金会](https://www.cncf.io/)的成员，将于 12 月 6 日至 8 日在奥斯丁举办 CNCF 的 [Kubecon/CloudNativeCon](http://events.linuxfoundation.org/events/kubecon-and-cloudnativecon-north-america) 。*

[![](img/c68905133ab50f3aa7fb73b4e731a5e8.png)

保罗·弗里曼特尔

Paul 在 2005 年共同创立了 WSO2，目的是通过开源模型重新发明企业中间件的开发、销售、交付和支持方式。在加入 WSO2 之前，Paul 在 IBM 担任了九年的高级技术人员。在那里，Paul 创建了 Web 服务网关，并领导团队开发并将其作为 WebSphere Application Server 的一部分发布。他也是将服务集成总线技术引入 WebSphere Application Server 6 的团队成员之一。十多年来，Paul 在新兴的开放标准中发挥了核心作用。在 IBM 时，他与 Sanjiva Weerawarana 共同创建了 Web 服务调用框架(WSIF ),同时还共同领导了 JSR 110:WSDL Java API，该项目开发了 WSDL4J。Paul 目前是 OASIS Web 服务可靠交换技术委员会的联合主席，该委员会负责创建通过 SOAP 进行可靠消息交换的行业标准。Paul 还在开源开发方面发挥了先锋作用。他是 Apache 软件基金会的当选成员和 Synapse 项目的副总裁，领导了 Apache ESB 的推出。Paul 对开源的最初贡献可以追溯到最初的 Apache SOAP 项目，在那里 Paul 贡献了代码来支持对 Enterprise JavaBeans 的访问。他还领导了 IBM 对 Axis C/C++项目的参与。](http://wso2.com/about/leadership/paul_fremantle/) 

早在 2010 年，我发表了一篇[博客文章](http://pzf.fremantle.org/2010/05/cloud-native.html)来定义 c *loud-native* ，这是基于我和我在 WSO2 的同事之间的讨论。大约在同一时间，网飞也开始在演讲中使用这个术语。从那以后，对云原生的兴趣直线上升，包括许多博客文章、书籍，当然还有云原生计算基金会(CNCF)。

云原生的高级概念很简单:通过以真正的云为中心的方式在云中运行，为用户提供更好体验的系统。换句话说，云可能使现有的数据库更容易启动，但是如果数据库不支持弹性，那么它就不能利用云的伸缩能力。

定义云原生的动机由两个不同的方面驱动。首先，我们想要捕捉创建适当的“云”系统的思想和架构。其次，我们想强调的是，并不是每个被重新命名为“云”的系统都真正利用了云的优势。

快进到今天，我们有了一个来自 CNCF 的云原生的新定义。新的定义更加简单，提供了三个主要的特征:

*   用集装箱装
*   动态编排
*   面向微服务

在这篇博文中，我们将探讨两者的区别和相似之处，并回答这样一个问题:七年来，Cloud Native 的愿景发生了怎样的变化，不同定义之间是否有任何重叠？

以前的定义和新定义之间有明显的重叠，我将通过展示旧的特性可以被使用新特性的系统实现来证明这一点。因此，差异从根本上讲是关于如何高效地实现这一目标，而不是关于云原生的核心含义。

> 容器为我们的业务逻辑和微服务提供了有效的多租户，但后端存储仍然是一个挑战。

早在 2010 年，我们就在构建系统，试图通过利用底层云基础设施即服务(IaaS)的自动化控制，使现有和新代码在云场景中运行良好。从那以后，最显著的变化是*容器编排*的出现:像 Kubernetes、Docker Swarm、Mesos Containerizer 等工具能够调度和管理数千甚至数百万个 Docker 容器。这些工具是新的云原生定义更简单、更有效的根本原因:因为构建适合这个世界的组件提供了许多在容器编排之前需要更多思考、关注和机械的功能。

让我们看看我在 2010 年确定的云原生的六个关键属性:

*   **分布式和动态连线**:第一项确保工作负载可以跨多台服务器拆分和重新定位。例如，如果您在端口上有一个可用的微服务，那么像 [Weave](https://github.com/weaveworks/weave) 和[法兰绒](https://github.com/coreos/flannel)这样的容器网络覆盖，或者像 [Envoy、](https://envoyproxy.github.io/)这样的*服务网格，可以允许负载平衡或动态移动。新的云原生定义的两个方面涵盖了这一点:动态管理(意味着 orchestrator 可以移动服务)和微服务定义(要求松散耦合的系统具有明确描述的依赖关系，例如作为服务端点)。*
*   **弹性:**云工作负载的弹性意味着它们可以根据需求进行扩展和缩减。这一点现在看起来很明显，但在 2010 年，有许多供应商将现有代码带到云中，却没有弹性扩展的计划或模型。即使在今天，像 [Couchbase](https://www.couchbase.com/) 或 [Cassandra](https://cassandra.apache.org) 这样具有动态分片的多主数据库在云原生场景中也比许多只支持从数据库弹性伸缩的传统主从数据库具有显著优势。一般来说，弹性要求在容器中运行的代码是无状态的，或者使用可伸缩的缓存机制来管理状态。这隐含在新的云原生定义中的动态管理和面向微服务的定义中。
*   **多租户:**2010 年，我们需要云原生系统具备一些多租户的概念。这是因为每个租户运行大型传统整体系统的成本过高，而云的主要目标之一是实现自助服务和软件即服务。这里最大的变化是容器包装的出现。容器提供了一种更有效的方法来部署多租户，它允许每个租户拥有一组代表他们运行的容器。举例来说，我在博士学位期间所做的工作表明，普通人可以运行自己的容器，为他们的物联网设备处理隐私管理，成本不到 1 美元/年/用户。另一个例子是 Borg，Google 为每个 GMail 会话推出一个新的容器，通过容器提供租户隔离。
*   **自助服务:**云系统本质上是“即服务”。换句话说，它们为用户提供了注册、远程配置、选择服务级别等机会。对于 SaaS 系统，这意味着终端用户可以自助服务。对于 IT 系统而言，这意味着开发人员、[开发人员、](/category/devops/)运营人员和其他人员可以自助创建、构建、部署、管理和监控系统。重要的是要确保这个方面适合用户。例如，适应开发人员的工具和思维方式通常意味着开发人员对云原生环境的自助控制应该基于配置文件、命令行工具、git 拉取请求等。
*   **精确计量和计费:**在 2010 年确定的标准中，这似乎是离 CNCF 简单的三个标准最远的。然而，这只是前面三个特征的逻辑延伸:如果您允许任意资源跨租户和自助服务进行弹性扩展，那么显然需要对资源进行控制。最好的方法就是降低成本。AWS 弹性容器服务、Google Kubernetes 引擎、Docker Cloud 都证明了云编排服务可以做到这一点。事实上，容器的使用大大简化了这一过程。早在 PaaS 的早期，我们围绕租户、代码和服务构建了复杂的计费:今天，我们可以使用像[普罗米修斯](https://prometheus.io/)、 [cAdvisor](https://github.com/google/cadvisor) 、 [InfluxDB](https://www.influxdata.com/) 等系统简单地跨编排层监控容器。
*   **增量部署和测试:**在过去的七年里，这个领域取得了巨大的进步。这实际上是所有三个方面的融合:更好的编排、容器打包和微服务模型。我们在 2010 年描述的模式被广泛使用，并且有更好的名字:[蓝/绿部署](https://martinfowler.com/bliki/BlueGreenDeployment.html)、 [CanaryRelease](https://martinfowler.com/bliki/CanaryRelease.html) 、[社交单元测试](http://blog.jayfields.com/2014/07/solitary-unit-test.html)等等。

为什么这些变化很重要？从根本上说，云原生为我们提供了更具适应性的基础设施，能够更快地变化以满足业务需求:

*   **更快的重新部署**:组织已经转向(或者正在转向)持续集成和持续交付(CI/CD)。集装箱化部署是有效实现这一目标的重要方法之一。
*   **更有效的伸缩**:作为微服务部署到容器编排中的代码可以更快、更多地伸缩，更好地适应传入的负载。应用程序的不同部分可以独立伸缩，以适应应用程序的不同用途。
*   **更好的演进** *:* 因为部署在容器中的云原生工作负载固有地通过网络套接字进行通信，所以我们可以将这些视为*服务契约。结果是，每个容器都可以在不中断应用程序的情况下发展、重写和重新部署，只要契约得到维护。*

如果我让它听起来像是我们在 2010 年努力做的这些事情现在都很简单，那么这还不完全正确。今天你还需要考虑什么？

*   通过干净、快速的启动、低内存占用、迁移和干净的关闭，使您的微服务/容器映像支持无共享架构。这实现了精细的流程编排、低多租户开销和快速弹性。
*   数据库和存储层的多租户仍然面临挑战。容器为我们的业务逻辑和微服务提供了有效的多租户，但后端存储仍然是一个挑战。
*   正如我们在上面看到的，过去七年中的许多挑战已经被先进的容器编排系统解决了。确保您的选择有助于管理自助服务、多租户和增量部署，这应该是您的首要任务。

让我们举一些尝试针对原生云进行优化的系统的例子，为用户提供更好的体验。

*   由于 JVM 的开销，许多人已经预言了 Java 在云原生世界的死亡。然而， [Eclipse OpenJ9](http://www.eclipse.org/openj9/) 项目在减少容器中基于 JVM 的微服务的内存占用和启动时间方面付出了巨大努力，包括跨容器共享类加载。
*   [Couchbase](https://www.couchbase.com/) 、 [Cassandra](https://cassandra.apache.org) 和 [DynamoDB](https://aws.amazon.com/dynamodb/) 都展示了如何使用动态分片和重新分区方案在云中有效地扩展数据库。像[vitesss](https://github.com/youtube/vitess)这样的系统已经对现有的数据库进行了改造，使其更加云原生。
*   由我的同事 [Sanjiva Weerawarana](https://medium.com/@sanjiva.weerawarana) 领导的 [Ballerina](https://ballerinalang.org) 语言是一个创建*复合微服务*的项目，具有低内存和快速启动时间，直接编译到容器中。
*   最近[宣布](https://www.cncf.io/blog/2017/09/13/cncf-hosts-envoy/)在 CNCF 举办[特使](https://envoyproxy.github.io/)，将关键的面向服务的方面，如负载平衡、[断路](https://martinfowler.com/bliki/CircuitBreaker.html)和可观察性从应用程序代码中取出，放入基于 sidecars 的云原生底层。

在过去的七年中，云原生技术不断发展，与 2010 年相比，云原生背后的技术在容器方面更加强大，架构也更加完善，但构建充分利用云的系统的核心信息仍然是一样的。

![](img/b84766d381127d3a3ad0077ab6d11bf9.png)

云本地计算基金会是新堆栈的赞助商。

由 [Vincent Guth](https://unsplash.com/@vingtcent) 通过 [Unsplash](https://unsplash.com/photos/K-y29dWc4Zs) 拍摄的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>