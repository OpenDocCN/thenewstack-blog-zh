# 云原生应用需要以全新的方式进行管理

> 原文：<https://thenewstack.io/cloud-native-apps-need-to-be-managed-in-a-completely-new-way/>

[](https://twitter.com/Pypestream/status/1064677962019041281)

 [马克斯·约翰逊

马克斯·约翰逊是霍尔伯顿学校的前学生。他目前在纽约市的 Pypestream 担任 DevOps 工程师。在业余时间，他喜欢学习新技术，是一个狂热的视频游戏玩家，喜欢 Crossfit 和斯巴达比赛。](https://twitter.com/Pypestream/status/1064677962019041281) [](https://twitter.com/Pypestream/status/1064677962019041281)

为在云中运行和扩展而构建的应用程序需要以全新的方式进行管理。DevOps 是在云中构建和发布应用程序的新方式——但这说起来容易做起来难。

做 DevOps 的时候很容易出错。考虑到现代应用程序的复杂性、它们的分布式基础设施、大量的流量以及新的工具和技术，DevOps 的采用可能会以一百万种方式出错。

这就是自动化必不可少的原因。通过将自动化构建到 SDLC 的每个阶段，您可以确保成功过渡到 DevOps。

## DevOps 呼吁左倾思维

转移到 DevOps 软件交付方法的最大优势之一是速度。更快的发布带来更好的创新。然而，DevOps 不仅仅是速度，它同样关乎质量。从一开始就构建高质量的应用程序会更加稳定、可靠、高度可用。DevOps 能够在速度和质量上超越传统开发模式的原因是它的左移方法。

左移是什么意思？在传统的瀑布模型中，一个想法通常从产品和业务团队的上游开始，然后移动到开发，在那里它以代码的形式出现。然后传递给 QA 进行测试。在这三个步骤之间有许多来回，直到特性达到可接受的质量水平。然后，它就翻墙向它扔去。他们部署它，或者如果它还没有准备好部署，就把它送回去做更多的更改。发布会因为最后的兼容性问题、错误、安全漏洞等等而出错。通常，出乎所有人意料的是，这款应用在生产中比在测试中更不稳定，更容易出错。但是如果质量没有从一开始就被考虑进去，这是一个预期的结果。

Shift-left 打破了瀑布从左到右线性移动的僵化，将测试带到了第一步。这不仅迫使 QA，还迫使其他团队，如产品和开发团队，也要考虑他们构建的功能的可靠性。

这实际上意味着，每当提出一个想法或新功能时，所有的团队——产品、开发、QA 和 Ops——都会聚在一起讨论该功能的可行性，应该记住哪些注意事项，以及对该功能的最低期望。实施这一点的两个概念是[行为驱动开发](http://searchsoftwarequality.techtarget.com/definition/Behavior-driven-development-BDD) (BDD)，和[测试驱动开发](http://searchsoftwarequality.techtarget.com/definition/test-driven-development) (TDD)。BDD 使用用户行为作为标准来定义一个特性的成功意味着什么。TDD 定义了一些单元测试，如果特性被认为是可接受的，就必须通过这些测试。在这两种方法中，团队从一开始，在构建之前，就定义了成功对每个特性意味着什么。

> Shift-left 打破了瀑布从左到右线性移动的僵化，将测试带到了第一步。

沃尔玛用 BDD 左移，采用持续集成(CI)和持续交付(CD)。他们描述方法，在开发之前定义自动化单元测试。然后，他们编写基本代码，这些代码在开始时无法通过大多数必需的测试。然后，在每次迭代中，他们减少失败测试的数量，直到所有测试都通过。一旦发生这种情况，这个特性就差不多可以部署了。

左移方法有很多好处。它让质量成为每个人的头等大事，而不仅仅是 QA 和 Ops。它节省了成本和精力，并通过确保在周期的早期发现错误来防止糟糕的用户体验。它迫使产品、开发、QA 和 Ops 团队从一开始就一起工作，定义成功对产品或单个特性意味着什么。这有助于打破他们之间的孤岛，因为他们使用自己独特的专业知识来解决共同的问题。

## 左移在每个阶段都需要自动化

要让左移成为现实，需要在流水线的每个阶段实现自动化。开始时，你需要一个像[詹金斯](https://jenkins.io/)这样的 CI 工具来自动化构建，并触发自动化单元测试。这个阶段的反馈循环应该是快速的，给开发人员关于代码质量的即时反馈。一旦基本单元测试通过，QA 执行更高级的功能测试、负载测试等等。在这一步，移动带来了新的挑战——QA 需要确保代码通过跨多个平台和设备的功能测试。这就是像 [Sauce Labs](https://saucelabs.com/) 这样的测试自动化工具必不可少的地方，它也有一个真实的设备测试云。

随着测试数量的增加，而且大多数测试都是自动化的，您还需要自动化另一个关键方面——基础设施的创建。与虚拟机是运行这些测试的默认选择不同，今天容器是标准。它们是轻量级的，易于创建，并且可以比虚拟机更高效地扩展。正如容器是新的一样，自动化其创建和管理的工具也是新的。

Kubernetes 已经成为最强大的容器编排工具，并得到了容器生态系统各个角落的支持。它使您能够将基础设施层与应用程序层分离开来，因此您可以根据需求轻松扩展测试和生产环境的创建。优势是多方面的——更快的测试，因为环境准备得更快，更可预测的测试结果(因为一切都是自动化的，不容易出现人为错误)。最后，您将体验到更快的部署，这只是将质量和自动化带到上游的结果。

## 自动化云中的安全性

容器容易受到外部攻击，并且缺乏内部监督。随着您自动化测试和部署，确保您不会在安全性方面有所欠缺变得更加重要。容器的运行规模比虚拟机大得多，保护它们自然也更复杂。与虚拟机不同，虚拟机可以通过为每个实例配置相同的安全参数来手动保护，容器需要基于策略的安全性，根据容器包含的内容以及容器与系统中其他容器的交互方式，以独特的方式对待每个容器。

为了满足容器的新安全需求，Twistlock 在其容器安全平台中添加了两个新功能。首先，有[云本地应用防火墙(CNAF)](https://www.twistlock.com/2017/07/07/cloud-native-app-firewall-cnaf-deep-dive/) ，它处理流量到容器的自动路由。它与 CI 流程集成并创建安全策略，以确保只有经过扫描的安全流量才能到达集装箱。为了实时扫描大量的流量，它利用了机器学习算法。因此，它会自动阻止来自 Tor、DDoS 和僵尸网络等危险来源的流量。它报告漏洞的重要细节，包括可疑的 IP 和恶意软件签名。运行容器时，安全性至关重要，CNAF 在运行时提供了急需的威胁检测。

尽管您尝试保护容器，但在某个时候漏洞还是会悄悄出现。如果您运行的数百万个容器中有一个受到威胁，该怎么办？这时，您需要进行损害控制，并将缺口的周边限制在尽可能少的容器内。Twistlock 推出了[云本地网络防火墙(CNNF)](https://www.twistlock.com/2017/09/29/cloud-native-network-firewall-twistlock-2-2-deep-dive/) 来做到这一点。

它是一个容器到容器的防火墙，扫描和控制容器之间的访问。当它发现一个受损的容器时，它会限制该容器对系统其余部分的访问。CNNF 还使用机器学习来识别集装箱之间的正常交通模式，无论交通流量有多大，都可以发现偏差。

像 CNAF 和 CNNF 这样的特征正是集装箱安全所需要的。像你开发管道的其他部分一样，手工只能做到这一步。要真正大规模地使用容器，您需要实现安全自动化。

## 结论

当你优先考虑质量和速度时，你会看到质量向你的管道左边移动。这种左移方法从一开始就建立在强大的自动化之上。自动化构建和自动化测试应该渗透到自动化基础设施管理中。最后，你不能忽视容器的安全措施。就像管道的其他部分一样，您的安全应该通过像 Twistlock 的 CNAF 和 CNNF 这样的工具实现自动化。

*感谢[霍尔伯顿软件工程学院](https://www.holbertonschool.com/)，它将新堆栈连接到作者马克斯·约翰逊。*

Twistlock 是新堆栈的赞助商。

照片由 [Jason Yu](https://unsplash.com/photos/DbeEqK0iFRQ?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/search/photos/shift?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>