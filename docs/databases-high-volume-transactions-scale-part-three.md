# 大规模数据库第三部分:事务性应用的现实

> 原文：<https://thenewstack.io/databases-high-volume-transactions-scale-part-three/>

编者按:这是我们的三部分系列的第三部分，也是最后一部分，介绍实时事务数据库可伸缩性的当前进展，重点关注企业可以采取哪些步骤来管理早期可伸缩性，同时构建可以管理增长轨迹的未来基础设施。

[Part One](https://thenewstack.io/databases-high-volume-transactions-scale/)

关注新一代数据库服务，这些服务正在大规模提供实时事务处理。

[Part Two](https://thenewstack.io/databases-high-volume-transactions-scale-part-two/)

观察新兴玩家如何分享性能基准测试，以此吸引新客户购买他们的产品。

云计算的发展、超本地和上下文产品的变革潜力(能够在移动中从任何位置做出决策或购物正在改变应用程序设计)，以及企业内外移动应用程序的增长，都推动了对强大数据库架构的需求，这种架构可以管理来自全球大量同时访问数据的用户的实时数据交易和分析。

许多构建实时和事务性应用程序的企业的生命周期成熟度是由数量决定的。正如在线广告欺诈服务公司 Forensiq 的首席技术官 Matt Vella 指出的那样，他们服务的交易量最初以 100 到 1000 倍的速度增长，但只有在此基础上再增长 1000 倍时，对强大的大容量交易数据库架构的需求才会发挥作用。这可能需要一段时间才能到位，而且在这一过程中，可以采用一些策略来管理事务性增长。

史蒂文·威尔莫特是 API 提供商 [3Scale](https://thenewstack.io/stripe-for-developer-payments-with-new-3scale-service/ "3Scale on The New Stack") 的首席执行官和联合创始人，该公司每天代表客户处理数十亿次 API 调用。他们的客户有自己的 API，每个 API 每天都有很高的交易量，允许最终用户能够查找数据、支付和修改数据细节。此外，3Scale 需要监控所有客户的数据使用情况，以确保 API 管理系统的性能，并将呼叫量与使用限制和授权相匹配。随着 API 成为客户管理数据的核心方式，他们面临着扩展数据库架构以继续实时处理高速、大容量事务的需求。

## 容量、延迟和故障转移

“扩展数据交易有三个重要的方面，”Willmott 说。“首先是原始卷。您希望能够在不降低性能的情况下处理大量事务和数据请求。大多数系统都有一个性能急剧下降的点:您不会下降，只是开始非常缓慢地管理数据。

“其次是延迟。不同的调用有不同的资源需求:因此，如果其中一些调用需要一秒钟才能返回，这对最终用户来说是一种可怕的体验。

“最后，还有故障转移或分发。如果您有来自世界各地的数据请求，您会希望在世界各地都有数据中心或分发点。如果您在一个位置的一个数据中心出现故障，您会希望进行故障切换，以便终端用户体验不会中断，并且您会希望数据中心靠近您和您的用户所在的位置。”

## 控制分片:替代方案

虽然像 Redis Labs 这样的数据库服务正专注于构建分片功能，以帮助管理增长超过单台机器大小的数据集，但像 T2 NuoDB T3 这样的其他服务正在创建提供分片替代方案的功能。

Willmott 认为，在处理他们需要管理的数十亿笔交易时，他们希望保持对分片的完全控制。

“我们在所有的地方都使用 Redis，当我们提供越来越多的流量时——我们一个月要处理数十亿笔交易——我们需要对它进行分片。”威尔莫特回应了数据库服务公司 [Aerospike](http://www.aerospike.com/) 和 NuoDB 所指出的:“Redis 没有任何本地集群。所以我们实际上阻止了 Twitter 开源项目。这对我们来说非常有效。网飞也做了一个分支，叫做 [Dynomite](https://github.com/Netflix/dynomite) 。

“Redis 的一个问题是，你不知道目前需要多少碎片。我们花了三到六个月的时间才把碎片放好。很有挑战性。我们自己做的，因为我们有极端的性能需求，所以我们觉得云解决方案不适合我们。

“管理起来很复杂，你必须真正置身事外。如果你不是 redis，那么有一个可以共享的第三方可能是一个好的解决方案。

通过使用 Twemproxy 来管理他们的分片功能，Willmott 对坚持使用 Redis 感到很舒服:“围绕您可以使用的数据基础设施有很多选择。Redis 非常擅长的是跟踪事物，所以你有原子增量，我们需要实时跟踪事务:Redis 很棒，你不能用其他 SQL 数据库做到这一点。其他任何人都在读取值、检查值、写入值，这就更难说了。

## 规模和速度上的混合数据库架构

虽然 Redis Labs 和 Aerospike 都提供数据库即服务产品，但与竞争对手 FoundationDB 一样，NuoDB 是客户自行部署的软件产品，无论是在内部部署还是在私有云或公共云架构中。

NuoDB 的 CTO Seth Proctor 看到客户使用数据库解决方案在任何配置中提升其事务处理能力:

“因为转向分布式技术有许多价值主张(连续可用性、在多个地理位置实现更低延迟的物理分布等)。).我们的客户需要从非常复杂的逻辑的几百到更快的应用的每秒几十万的 TPS 速率。我们展示了该软件在公共云上以几百万 TPS 的速度运行的演示。我们的大多数客户正在使用现有的速率受限系统，并转向我们来处理当前的容量，但仍有根据需要增长的空间。我们的分布式模型意味着客户不需要预先考虑 TPS 的规模。”

## 临时扩展解决方案:解决外部因素并创建 API 抽象层

Willmott 坚持认为，当企业扩展其内部数据库架构以增强容量、延迟和故障转移能力时，关注外部压力同样重要。例如，API 调用的速率限制是在增加数据库的容量压力之前控制数据流量的最常见方法之一。Willmott 之前[介绍了五种技术，通过首先管理外部压力点来帮助企业和应用程序开发人员处理扩展影响](http://www.slideshare.net/3scale/api-scalability)。

“这并不意味着您不需要非常好的扩展基础架构，您仍然希望每月增加后端的事务数量。但是，至少从 API 的角度来看，大多数人忘记了外部机会，而你希望两者都看到。管理交易量和延迟风险的外部策略通常成本不高，不需要大量后端基础设施投资或代码重写，并且通常意味着公司的不同部门将负责管理这些策略。

## SlashDB:使用单个 API 来启用事务

[SlashDB](http://www.slashdb.com/) 还认为他们有一种技术非常适合帮助那些已经部署了遗留数据库系统，但可能需要通过 API 开放对其数据的访问的企业，以此作为解决数据库扩展需求的一种方式，同时实现大容量事务基础架构。

“Oracle、MS SQL Server 和 DB2 等传统数据库是业务数据管理基础架构的基石:所谓的记录存储，”负责运营 SlashDB 的 VT Enterprise 创始人 Victor Olex 解释道。“但在当今世界，数据管理必须超越企业的界限，而这些系统在网络规模上并不总是工作得很好。虽然 NoSQL 数据库提供了一个可扩展的替代品，但它们也带来了一个隐藏的成本:重写现有的业务应用程序，或者至少向这些新的大数据存储提供来自记录存储的重要企业数据所需的时间和费用。

“当谈到利用传统数据库中已有的投资用于 web 和移动目的，或与 NoSQL 连接时，SlashDB 提供了一个瘦 API facade，它可以立即将 SQL 数据库转换为 HTTP 资源，并具有授权、搜索、数据格式转换和缓存功能。因此，以前孤立的 SQL 数据现在可以以 JSON、XML 和其他格式获得，NoSQL 和 web 应用程序都可以无缝地使用它们。”

对于基于遗留系统的数据库架构，Olex 将 SlashDB 视为一种解决方案，可以帮助企业使用存储在记录系统中的数据作为数据流的一部分，以实时实现应用程序事务:“反向 HTTP 代理缓存用于保护数据库，使其不必响应重复的查询，并将系统性能提升到 web 服务器的速度和可伸缩性。”

扩展实时事务处理越来越多地转移到企业和中型企业的生产层面。因为越来越多的应用需要在移动设备上运行；随着数据集在全球范围内扩展并收集数十亿个数据点；随着物联网数据开始成为新产品和服务设计的关键数据源，可扩展的大容量事务处理数据架构将成为新常态。在这一过程中，企业需要以减少其架构负载的方式管理流量，同时还要评估如何利用日益拥挤的数据库服务提供商市场提供的新功能集。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>