<html>
<head>
<title>Off-The-Shelf Hacker: Portable Atmospheric Readings with a Sparkfun Breakout Board</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现成的黑客:便携式大气读数与火花分线板</h1>
<blockquote>原文：<a href="https://thenewstack.io/off-the-shelf-hacker-portable-atmospheric-readings-with-a-sparkfun-breakout-board/#0001-01-01">https://thenewstack.io/off-the-shelf-hacker-portable-atmospheric-readings-with-a-sparkfun-breakout-board/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">邮递员上周从Sparkfun送来了一个BME280大气分线板。它测量当地的气压、湿度、海拔和温度。这种传感器可以测量室外天气状况，帮助排除室内环境的故障，甚至可以作为无人机(UAV)上的导航传感器。这块板大约要20美元。</p>
<p class="translated">我想我会将BME280板与NodeMCU微控制器结合在一起，并将数据发送到我的“台式电脑”，也称为<a href="https://www.oreilly.com/library/view/oscon-2018-/9781492026075/video321504.html" target="_blank" rel="noopener noreferrer external " class="ext-link">蒸汽朋克会议徽章</a>。该徽章采用电池供电，配有几个USB端口，使其成为临时和便携式测量工作的快速简便的平台。前阵子我们已经介绍过一个<a href="https://thenewstack.io/off-the-shelf-hacker-throw-a-thermocouple-on-the-grill/" target="_blank" class="local-link">外部高温传感器</a>。</p>
<h2 class="translated">为什么要使用NodeMCU？</h2>
<p class="translated">NodeMCU现在几乎是我的首选Arduino克隆。它的长度大约与Arduino Nano相同，宽度比Arduino Nano宽四分之一，内置Wi-Fi和大约1MB的程序空间。它的功能与普通的Arduino非常相似，并且可以很容易地用标准的Arduino交互开发环境(IDE)进行编程。我从Banggood以14美元的价格购买了三个装的NodeMCU板。同样，我花了大约11美元买了三包Arduino Nano克隆产品，用于不需要Wi-Fi的项目。我已经在很多项目中使用了Nano克隆，它们通过USB或串行线发送数据也很好。</p>
<p class="translated">您可以在NodeMCU板上使用Lua编程语言，开箱即用。我的偏好是在项目中使用Arduino IDE和库。确保将板类型设置为NodeMCU 1.0 (ESP-12E模块)。默认波特率是9600。我通常在我所有的项目上运行115200。</p>
<p class="translated">由于我刚刚获得了与会议徽章一起工作的传感器的基本功能，我将在另一个时间离开Wi-Fi部分。分阶段开发项目更容易。明智的做法是让一个阶段稳定地工作，然后在以后的版本中添加新的功能和特性。</p>
<h3 class="translated">将BME280连接到NodeMCU板</h3>
<p class="translated">BME280有两种不同的接口，I2C和SPI。SPI需要六根线。I2C装置只需要四根电线。我和I2C一起去的。</p>
<p class="translated">我不再在电路板上焊接四或六引脚接头，而是选择剥去一些22号实芯线的绝缘层，用于试验板引脚。这项技术很简单，它提供了移除“引脚”和将连接线直接焊接到电路板上的选项，因为该项目具有更永久的原型或演示状态。将大约1/2英寸的裸线穿过电路板上的孔，向下推入试验板。在板级将电线焊接在BME 280的顶部。然后剪掉一点多余的电线。对所有四个引脚都这样做。当您将电路板从试验板上移开时，移除常规连接的接头要困难得多。</p>
<div id="attachment_8828751" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-8828751" decoding="async" loading="lazy" class="size-full wp-image-8828751" src="../Images/871eeba9b0938018a6466fe1f4c4b0da.png" alt="" border="1" data-id="8828751" data-original-src="https://cdn.thenewstack.io/media/2019/10/fee33d95-pins-headers.png"/><p id="caption-attachment-8828751" class="wp-caption-text translated">22号线“引脚”焊接到BME280板上，带有标准的0.1英寸引脚接头以供参考</p></div>
<p class="translated">两块板之间的连接并不复杂。我刚刚在NodeMCU板和BME 280之间运行了22号实心线(这次是绝缘的)。您也可以使用标准的6英寸针式原型跳线，尽管这不会是一个整洁的安装。</p>
<div id="attachment_8828752" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-8828752" decoding="async" loading="lazy" class="size-full wp-image-8828752" src="../Images/f26972c8afd2e92c2a8935262632bdb7.png" alt="" border="1" data-id="8828752" data-original-src="https://cdn.thenewstack.io/media/2019/10/ff701070-bme280-breadboard.png"/><p id="caption-attachment-8828752" class="wp-caption-text translated">展示NodeMCU板和BME280之间连接的试验板</p></div>
<h2 class="translated">代码</h2>
<p class="translated">你可以从很多地方获得BME 280在Arduino上运行的代码。我从GitHub 下载了Sparkfun BME 280库。这个库有许多例子，包括一个基本大气数据和一个当地气压。基本数据示例对于检查传感器是否工作非常有用。我使用当地压力代码来校准传感器以适应当地条件。两个例子在NodeMCU板上运行都没有问题。<br/></p>
<div id="crayon-642311fb92c69409245547" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-c">/*</span>
<span class="crayon-c">  Adjust the local Reference Pressure</span>
<span class="crayon-c">  Nathan Seidle @ SparkFun Electronics</span>
<span class="crayon-c">  March 23, 2018</span>
 
<span class="crayon-c">  Feel like supporting our work? Buy a board from SparkFun!</span>
<span class="crayon-c">  https://www.sparkfun.com/products/14348 - Qwiic Combo Board</span>
<span class="crayon-c">  https://www.sparkfun.com/products/13676 - BME280 Breakout Board</span>
 
<span class="crayon-c">  'Sea level' pressure changes with high and low pressure weather movement. </span>
<span class="crayon-c">  This sketch demonstrates how to change sea level 101325Pa to a different value.</span>
<span class="crayon-c">  See Issue 1: https://github.com/sparkfun/SparkFun_BME280_Arduino_Library/issues/1</span>
 
<span class="crayon-c">  Google 'sea level pressure map' for more information:</span>
<span class="crayon-c">  http://weather.unisys.com/surface/sfc_con.php?image=pr&amp;amp;inv=0&amp;amp;t=cur</span>
<span class="crayon-c">  https://www.atmos.illinois.edu/weather/tree/viewer.pl?launch/sfcslp</span>
 
<span class="crayon-c">  29.92 inHg = 1.0 atm = 101325 Pa = 1013.25 mb</span>
<span class="crayon-c">*/</span>
 
<span class="crayon-p">#include </span>
 
<span class="crayon-p">#include "SparkFunBME280.h"</span>
<span class="crayon-e">BME280 </span><span class="crayon-i">mySensor</span>;
 
<span class="crayon-e">void </span><span class="crayon-e">setup</span>()
{
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">begin</span>(<span class="crayon-cn">9600</span>);
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">println</span>(<span class="crayon-s">"Example showing alternate I2C addresses"</span>);
 
<span class="crayon-h">  </span><span class="crayon-i">Wire</span><span class="crayon-st">.</span><span class="crayon-e">begin</span>();
<span class="crayon-h">  </span><span class="crayon-i">Wire</span><span class="crayon-st">.</span><span class="crayon-e">setClock</span>(<span class="crayon-cn">400000</span>);<span class="crayon-h"> </span><span class="crayon-c">//Increase to fast I2C speed!</span>
 
<span class="crayon-h">  </span><span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">beginI2C</span>();
 
<span class="crayon-h">  </span><span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">setReferencePressure</span>(<span class="crayon-cn">101710</span>);<span class="crayon-h"> </span><span class="crayon-c">//Adjust the sea level pressure used for altitude calculations</span>
}
 
<span class="crayon-e">void </span><span class="crayon-e">loop</span>()
{
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-s">"Humidity: "</span>);
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">readFloatHumidity</span>(),<span class="crayon-h"> </span><span class="crayon-cn">0</span>);
 
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-s">" Pressure: "</span>);
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">readFloatPressure</span>(),<span class="crayon-h"> </span><span class="crayon-cn">0</span>);
 
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-s">" Locally Adjusted Altitude: "</span>);
<span class="crayon-h">  </span><span class="crayon-c">//Serial.print(mySensor.readFloatAltitudeMeters(), 1);</span>
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">readFloatAltitudeFeet</span>(),<span class="crayon-h"> </span><span class="crayon-cn">1</span>);
 
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-s">" Temp: "</span>);
<span class="crayon-h">  </span><span class="crayon-c">//Serial.print(mySensor.readTempC(), 2);</span>
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">print</span>(<span class="crayon-i">mySensor</span><span class="crayon-st">.</span><span class="crayon-e">readTempF</span>(),<span class="crayon-h"> </span><span class="crayon-cn">2</span>);
 
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">println</span>();
 
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">200</span>);
}
</pre>
</div>
</div>

<p class="translated"><br/>代码很简单。它使用库设置设备，然后调用各种数据值并打印结果。我喜欢使用英国的测量单位，并注释掉公制数值线。我们还需要根据当地条件调整<strong>setreferencepression</strong>值。我们将在下一节讨论这个问题。</p>
<p class="translated">编译后的代码上传到NodeMCU板后，您可以使用Arduino IDE中的串行终端或Linux桌面上的常规终端来重置板并读取值。使用我们的标准<strong> stty </strong>和<strong> cat </strong>命令。</p>
<p class="translated"><code>linux-notebook% stty -raw -icrnl -F /dev/ttyUSB0 115200<br/> linux-notebook% cat /dev/ttyUSB0</code></p>
<p class="translated">在Raspberry Pi会议徽章上使用NodeMCU-BME280器件组合非常简单。启动徽章，将NodeMCU USB线插入Pi，并在终端窗口中运行<strong> stty/cat </strong>命令组合。数据将在屏幕上滚动。使用CTRL-C停止读取数据。</p>
<p class="translated"><iframe loading="lazy" title="nodemcu bme280" src="https://www.youtube.com/embed/gkMe32cdPgQ?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="">视频</iframe></p>
<h2 class="translated">校准很棘手</h2>
<p class="translated">找到正确的<strong>设置参考压力</strong>对我来说仍然是一门“黑色艺术”。显然，我们希望我们的项目有准确的气压和海拔读数。我住在奥兰多国际机场(OIA)附近，所以我想他们当地的大气数据可以用来校准我的传感器。该机场的海拔被列为海拔96英尺。我所在的城镇在维基百科上也显示了同样的高度。我在两者之间，不是在山上或洼地上，所以这个数字对我来说似乎是合理的。</p>
<p class="translated">假设根据他们当前的测量，当地OIA海平面气压为1015.8，海拔为96英尺。</p>
<p class="translated">如果我使用1013800的<strong>setreferenceppressure</strong>，我会得到101380的BME280测量值(除以100以与OIA读数一致)和0.0英尺高度。</p>
<p class="translated">另一方面，如果我们使用101710的<strong>setreferenceppressure</strong>，我会得到101377的BME280测量值和90.7英尺的高度。这个高度接近OIA的实际高度。1015.8的气压(OIA当地)与BME280测得的1013.77稍有出入。</p>
<p class="translated">同时在我的Galaxy 8+手机上使用GPS测量气压和海拔高度。它给出的读数是101490 (1014.90)和35.6英尺的高度。</p>
<p class="translated">我所在位置的正确<strong>setreferencepression</strong>数字是多少？传感器在室内，空调温度约为81华氏度，而室外温度为84华氏度，这有什么关系吗？</p>
<p class="translated">把所有这些放在一起，读数之间有相当大的差异。哪个是正确的？现在我不知道，这说明了构建物理计算设备的困难之一。你总是要问自己，你的数据“看起来”是否正确。如果没有，我们显然需要更深入的了解。那需要时间和努力去学习。</p>
<h2 class="translated">更进一步</h2>
<p class="translated">在摆弄BME280之前，我对实际和测量的大气压力、湿度、温度等之间的关系知之甚少。显而易见的是，将传感器校准到实际的本地条件非常重要，在将该技术应用到日常设备和项目之前，需要充分了解和验证这一点。</p>
<p class="translated">BME 280和Raspberry Pi会议徽章“胸顶”电脑的基本操作工作正常。现在的问题是通过测试和调整来校准和获得数据的可信度，以使设置有用。</p>
<p class="translated"><em>赶【Torq博士的 <a href="https://thenewstack.io/tag/off-the-shelf-hacker/" target="_blank" class="local-link">现成黑客专栏</a>，每周六，只上新栈！在<a href="mailto:doc@drtorq.com">doc@drtorq.com</a>或407-718-3274联系他咨询、演讲、委托项目。</em></p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>