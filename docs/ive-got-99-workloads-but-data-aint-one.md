# 我有 99 个工作负载，但数据不是其中之一

> 原文：<https://thenewstack.io/ive-got-99-workloads-but-data-aint-one/>

[](https://www.linkedin.com/in/michelle-gienow-00007055/)

 [米歇尔·吉诺

一名前端 web 开发人员和正在康复的记者，米歇尔·索林白天为蟑螂实验室做技术内容，晚上做休闲 JS。她是 O'Reilly Media 出版的《云原生转型:创新的实践模式》一书的合著者。](https://www.linkedin.com/in/michelle-gienow-00007055/) [](https://www.linkedin.com/in/michelle-gienow-00007055/)

如今，如此多的应用程序被部署在容器中，可能更容易问谁没有使用 Kubernetes，谁在使用 Kubernetes。然而，对于 DevOps 的双方来说，一个令人沮丧的问题是不能将 Kubernetes 用于整个堆栈；数据库已经落后了。

开发人员希望统一他们的数据基础设施和应用程序堆栈。运营商希望对数据库和应用程序应用相同的工具。每个人都想为数据层获得 Kubernetes 授予应用层的相同好处:在自我修复、可水平扩展的分布式系统中跨环境的快速启动和可重复性。

然而，实际上很难做到这一点。为什么？

OG Kubernetes 为用户提供了定义需求组件风格的能力，从简单的构建块到部署。然后，他们可以使用控制循环将编排好的组件推向期望的最终状态(重启一个 pod，创建一个 DNS 条目)，确保运行状态与目标状态保持一致。每当检测到故障时，控制回路也有助于自动修复故障。

Kubernetes 组件、节点、集群和部署的无数可能组合使得 K8s 可以水平扩展，控制循环赋予了 K8s 自我修复的超能力。然而，分布式数据库需要比这些内置资源更复杂的操作序列。

这就是为什么在很长一段时间里，许多人的明智之举是在 Kubernetes 旁边运行数据库，而不是在其上运行。

但是现在，由于 K8s 生态系统的成熟，我们可以拥有更好的东西，比如我们所有的工作负载都在一个地方。

## 数据库，认识 K8s

你现在真的能在 Kubernetes 上运行数据库吗？复杂的操作和持久、一致的数据要求，并保证分布式系统中的 ACID 事务？是的。

我们终于到达了一个事件地平线，足够多的人已经找到了如何解决分布式数据库中的持久性和一致性，Kubernetes 生态系统已经充分发展和扩展，允许数据和应用层的合理低成本集成。

是什么让我们在 Kubernetes 上运行数据库不仅是可能的，而且越来越是最佳的呢？

1.  **高级有状态组件。** Kubernetes v1.9 引入了 StatefulSets，即管理一组 pod 的部署和扩展的 API，同时还保证这些 pod 的顺序和唯一性。它们使得在 K8s 集群中部署有状态的应用程序成为可能。StatefulSets 将数据库应用程序与持久性存储分离。数据可以存储在永久卷上，这样当 pod 被重新创建时，所有数据仍然在那里。此外，有一个一致的端点可以连接，因为在 StatefulSet 中重新创建的 pod 只是保持相同的名称。
2.  **可用性。**一个重要的里程碑是克服可用性问题。永久卷意味着现在我们有能力确保数据被复制，K8s 足够智能，可以在对等体来来去去时处理数据的移动。
3.  **通信员。**Kubernetes API 已经成熟到包含定制资源，并且出现了像 [kubebuilder](https://github.com/kubernetes-sigs/kubebuilder) 和 [operator-sdk](https://github.com/operator-framework/operator-sdk) 这样的 OSS 框架来简化创建定制资源定义及其控制器。操作符允许用户通过定义新的资源类型和控制器，将 K8s 内置基础扩展到特定于域的逻辑，因此他们能够创建分布式数据库所需的复杂操作。
4.  **老何。**与持久卷 API 相结合，容器存储接口(CSI)允许计算和存储松散耦合，有时可以定义数据存储，随着应用程序在集群中的重新调度而跟随应用程序。

所以，必要的材料都准备好了。组织真的在用它们为 Kubernetes 上的数据库编写操作手册吗？

## 工作负载说明了一切

很明显，Kubernetes 上的所有工作负载都出现了大幅增长，这既来自更广泛的应用生态系统，也来自数量不断增加的独立供应商。但更难看到的是公司每天是如何在生产中部署工作负载的。不过，最终来说，Kubernetes 是一个构建和部署应用程序的平台，这意味着我们可以通过工作负载来了解组织目前如何使用 Kubernetes 的真实情况。

一项名为 [2021 Kubernetes 采用趋势报告](https://www.cockroachlabs.com/guides/kubernetes-trends/)的新研究对各个行业的组织如何在日常生产部署中与 Kubernetes 合作进行了第一手调查。关于在 Kubernetes 上运行数据库的组织，它说了什么？

参与者表示，他们的头号挑战是有效地设计和部署数据密集型事务性工作负载。这是最多的参与者(46%)选择的，超过了其他挑战，如迁移遗留工作负载和雇用/保留熟练的工程师。事实上，许多受访者认为部署分布式事务性工作负载是他们唯一的担忧。

这些数字表明，在生产中运行 Kubernetes 上的数据库是这些组织中的大多数现在的优先事项。

进一步推断，我们看到，在将数据工作负载的架构设计视为主要挑战的调查参与者中，没有人表示迁移传统工作负载也是次要问题。

数据似乎表明这些受访者——占整个调查人口的 25%!—发现他们的事务数据库是一个瓶颈，并在寻求现代化。看起来他们已经成功地用 Kubernetes 部署了分布式应用程序，现在正在投资继续发展和改进他们的堆栈。

报告中还有更多内容，包括:

*   这些组织运行的工作负载类型。
*   他们用作生产环境的发行版。
*   他们致力于构建和管理所有这些的团队类型。

该报告还提供了对公司如何围绕多云和混合、无服务器制定未来战略的分析和见解，是的，通过最终联合他们的数据和应用层，将他们的数据库带入当前的世纪，以便他们可以从此幸福地生活在 K8s 中。

![](img/f620400d3f58d723440a85aa65739860.png)

*要了解更多关于 Kubernetes 和其他云原生技术的信息，请考虑参加 10 月 11 日至 15 日举行的 [KubeCon+CloudNativeCon 北美 2021](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/) 。*

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>