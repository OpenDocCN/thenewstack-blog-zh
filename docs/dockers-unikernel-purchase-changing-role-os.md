# Docker 的单核购买和操作系统角色的变化

> 原文：<https://thenewstack.io/dockers-unikernel-purchase-changing-role-os/>

周四宣布 Docker Inc .将收购总部位于英国剑桥的 Unikernel Systems ,这使得操作系统在现代数据中心堆栈中的角色问题成为人们关注的焦点。这是一个深深扎根于 Linux 阵营的开源开发者要么回避，要么还没有意识到正在讨论的问题。但早在 2007 年，学术开发人员就已经在构建虚拟机——不是容器，而是兼容 Xen 的虚拟机——用取自真实操作系统的库例程取代单独的操作系统，而是编译成应用程序。

## 抓住微服务的尾巴

芬兰阿尔托大学的学生 Antti Kantee【PDF】2012 年在[发表的博士论文记录了一个为期五年的项目，该项目旨在开发一种叫做 *anykernel* 的操作系统结构。按照最初的设想，这是一项可行性研究，研究与正在编译的应用程序相关的特定任务驱动程序是否可以与应用程序合并，而不是存档在一个单一的内核中。这样，内核可以缩小到只有通用的例程。](http://lib.tkk.fi/Diss/2012/isbn9789526049175/isbn9789526049175.pdf)

在应用程序中，代表操作系统运行特定任务驱动程序的引导程序被古怪地命名为 *rump* 。正是这个项目的演化形式，仍然被称为 Rump Kernels，它是去年 11 月在巴塞罗那 DockerCon EU 上的一次演示的核心，可能赢得了 Docker Inc .高管的心。这种形式只有 Docker 本身的历史，它采用了一种可再发行的应用程序的形式，能够自己运行——这是 unikernels 和 Docker 容器的一个共同点。

首席技术官所罗门·海克斯(Solomon Hykes)在最近与新堆栈的一次采访中说:“单核让你基本上摆脱了操作系统，而是将应用程序实际需要的操作系统的小部分编译进应用程序中。

“换句话说，它需要将有效载荷缩小到绝对极限的想法，”CTO 继续说道。VMs 是很重量级的。您必须将整个操作系统与机器捆绑在一起。容器通过只包含几个操作系统组件来缩小有效负载。单核进一步缩小了内存占用。

这并不是说操作系统真的不存在了。更重要的是，它不再是一个独立于编译后的应用程序的实体。因此，单核是计算逻辑不可分割的单元。作为一个微服务，它承载着无限可扩展性的承诺。作为虚拟机，它被设计为在 Xen Type 1(硬件级)虚拟机管理程序下运行。

作为一种建筑，统一中有某种优雅。因此，当“anykernel”首次构思八年后，这个概念首次在学术界之外出现时，[的竞争供应商将其称为下一个潜在的容器杀手](https://gigaom.com/2015/10/09/why-unikernels-will-kill-containers-in-five-years/)。

在 8 月于[举行的 ContainerCon NA 2015 上关于 unikernels](http://lccocc2015.sched.org/event/20f3de07d9af141abb85b9c75201f44c) 的专题讨论会上，Docker 撰稿人 jérme Petazzoni 将 unikernels 描述为处于容器和虚拟机之间的一种中间地带，通过重新引入虚拟机管理程序作为一种安全服务，解决了用户对容器不确定安全状况的持续担忧。

虽然他当时承认单核是“有趣的”，但他确实将它们描述为解决容器的一系列独立挑战，在某种程度上有效地将它们区分开来。

几个月后， [Apprenda 首席执行官 Sinclair Schuller 为 GigaOm](https://gigaom.com/2015/10/09/why-unikernels-will-kill-containers-in-five-years/) 写道，“Docker 和 CoreOS 等技术在使我们消费基础设施的方式现代化方面做了出色的工作，因此微服务可以成为现实。然而，这些服务需要改变和发展，才能在单核的崛起中生存下来。”

## 潜在的对手变成了盟友

或者，它们可以简单地包含那些单核，并彻底解决这个问题。

去年 9 月，在 Strange Loop 2015 大会上，总部位于科罗拉多州博尔德的 Rally Software 的基础设施自动化工程师 Matt Bajor 发表了题为“[看，Ma，没有操作系统！用最简单的语言解释了单核架构是如何从普通堆栈中消除至少五层进化抽象的——这种方式与容器化的概念完全互补，而不是相反。](https://www.youtube.com/watch?v=W9F4pn9Lngc)

在提醒开发人员现代应用程序堆栈的广泛本质后，包括持续集成/持续部署(CI/CD)平台、流程编排系统、虚拟机管理程序和配置管理系统，Bajor 指出，“这些系统为我们工作，但它们极其复杂。它们很难作为一个整体进行推理，调试也很困难。原因之一…是几乎不可能一对一地复制您正在运行的环境。”

事实上，CI/CD 从业者确实证明了任何任务的自动化是不可能的，尤其是测试过程，当复制该任务所需的步骤如此复杂和可变以至于它们不能被复制时。集装箱化简化了秤前端测试和部署程序的自动化。但是 Bajor 指出，当容器进入生产阶段后，它就变成了一个如此独特的怪兽，以至于为了调试的目的而复制它变得不可能。

CI/CD 工程师会说，使用更紧凑的代码简单地重建容器，然后重新部署它，比试图诊断它要简单得多。虽然这可能确实是一种最佳的状态，但对于设计用来运行遗留软件的容器来说，这也是不切实际的，因为遗留软件与活动数据库保持着持久的联系。

Bajor 指出，更重要的是，操作系统本身是由一个完全独立于软件开发团队的团队构思、生产和部署的。在典型的容器驱动的环境中，是操作系统托管流程。因此，当操作系统被打补丁时，新的错误有可能悄悄进入流程，而这些错误在代码首次进入生产时并不存在。CI/CD 工程师会再次指出，有一些方法可以维护已部署的代码和它们各自的操作系统之间的正确配对，还有一些平台可以让开发人员测试和部署适当的补丁。然而，即便如此，这些方法还是很复杂——巴约认为，这是不必要的。

“打补丁并不是分为功能性和安全性，”他告诉奇怪的循环观众。“当我们进入并修补一个系统时，我们将 **yum update** ，并应用那里的一切，无论是安全性还是功能性。如果它没有被使用，我们为什么要为它付出代价？”

几个月后，Unikernel Systems 团队在 DockerCon 展示了它的集成容器方法。该团队包括阿米尔·乔德里，他也为[米拉杰斯](https://mirage.io/)做贡献。尽管名为 MirageOS，但它并不是一个真正的操作系统，而是一个操作系统使用的所有东西的库，用 OCaml (Objective Caml)编写，运行在 Xen 上——这是一种有 20 年历史的抽象机器语言的现代形式，具有功能性、声明性和无状态性。

在随后不久发表的一篇博客文章中，Chaudhry 提出了这样一个案例:由 unikernels 提供的简化和由 containers 提供的简化不仅是互补的，而且从一个角度来看，是互为目的的。

“一方面，我们采用传统的方法，将完整的操作系统堆栈放在虚拟机中，在上面放一个应用程序。下一步自然是使用在单一操作系统上运行的容器，这样可以更好地利用资源，并允许每个应用程序更加独立。从这个角度来看，单核只是这条道路上的又一步，可以被认为是极端的、独立的应用程序。”

## 整合积分器

Chaudhry 写道，未来的挑战是让单核像 Docker 制造的容器一样容易实现。Docker CTO Hykes 告诉 New Stack，他的公司的目标将是以这样一种方式实现单核，即向开发人员隐藏它们的实现，有效地使单核的合并成为一个零步骤的过程。

Hykes 说:“它的美妙之处在于，如果你是一个使用 Docker 的开发者，基本上没有什么变化。开发人员将像以前一样继续编写 Docker 文件(构建清单)。他说，Docker 将通过插件的方式增加新的功能。在这里可能需要额外的配置工具。“但是 Docker 的用户体验不变，Docker 的标准界面不变。这就是这种结合的美妙之处。

“你可以说，一切都发生在构建时，”他继续说道。“每次构建应用程序时，您都在构建一个一次性的、独一无二的操作系统，它只做一件事:运行您的应用程序。从这个角度来看，我们很少使用传统的 Linux 部署工具。现在，每个应用程序都是独一无二的。”

在他 9 月份的演讲中，Matt Bajor 列出了不少于 8 个当时正在进行的强大、健康、开源的单核项目，此外还加入了一个名为 [Drawbridge](http://research.microsoft.com/en-us/projects/drawbridge/) 的微软内部项目。根据这一标准，Docker 周四的收购行动并没有将 unikernels 从开放容器倡议( [OCI](https://www.opencontainers.org/) )容器的潜在竞争对手名单中剔除，就像甲骨文收购其正在进行的平台消除了甲骨文未来的潜在竞争对手一样。

尽管如此，这一举动确实证明了任何把单内核从根本上与容器对立起来的描述都是完全虚假的。Docker 还没有为其开发工具中任何商业上可行的单内核外观设定时间表，可能还需要时间来消化这个概念。一个包含的 unikernel 的好处是可以很好地与 Docker 容器中已经存在的工具集集成。

但是已经为现有的生态系统设计了一个独立的单核:Xen。如果 Docker 让单核流行起来，它实际上可以为其他人闯入并让单核进入市场扫清道路。

然而，更重要的是，仅仅是由当今数据中心技术领域最具创新性的供应商之一对这一概念的验证，就带来了操作系统持续无处不在的整个问题。第一代虚拟机是桌面和服务器操作系统，让它们“相信”自己运行在通用硬件上；当前一代的容器是由操作系统托管的收缩包装的应用程序。我们已经习惯于在需要它的功能时简单地复制操作系统。现在，当我们面对一个充满微服务的未来时，旧的客户可能不会像我们想象的那样扩展。

单核本质上是软件开发不断发展的故事的另一个象征，也是不断改善隔离和安全性的需要[只是应用程序开发和管理中的一部分](https://thenewstack.io/continuum-containers-unikernels-serverless-architectures/)。技术人员已经实现了一定程度的兼容，下一步的努力是获得更好的性能。通过将 unikernels 引入 Docker，可以让人们更加熟悉这项技术。考虑到 Docker 和容器技术的开发者工具生态系统，这一点尤其正确。

Apprenda 和 Docker 是新堆栈的赞助商。

封面图片:[“在玉米田里”，作者 Lars Plougmann](https://commons.wikimedia.org/wiki/File:In_the_corn_field.jpg) ，通过知识共享 2.0 授权。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>