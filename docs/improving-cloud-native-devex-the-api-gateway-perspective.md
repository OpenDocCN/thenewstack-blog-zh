# 改进云原生 DevEx:API 网关视角

> 原文：<https://thenewstack.io/improving-cloud-native-devex-the-api-gateway-perspective/>

云原生开发风靡一时，因为如果做得好，它会减少开发时间，为开发人员提供更快的反馈，为最终用户提供更高质量的功能和应用。云原生范式因其分布式特性而为更大的灵活性打开了大门，并允许在日益动态的环境中实现可扩展性。

许多开发团队已经在生产中利用了这种灵活性，并看到了直接的价值。然而，这并不意味着 cloud native 没有它的实现障碍。云原生方法增加了新的不同的复杂性，这不是不可克服的，但确实需要一种新的思维方式。

降低复杂性以实现云的生产力承诺意味着开发组织的其他部分不能落后——事实上，它们将是云原生采用的一部分。开发人员必须了解容器和云技术，以便与底层基础设施进行交互。但是基础设施——也包括 API 网关、服务网格和虚拟化网络堆栈的一些部分——通常不是开发人员的责任。

取而代之的是，架构师和平台工程师将需要为开发人员建立一条途径，让他们在考虑速度和安全的情况下继续发布软件。QA 专家也必须是这项工作的核心。用[团队拓扑](https://teamtopologies.com/)的话来说，重点将放在实现团队上。让开发人员轻松完成云原生之旅是一项团队工作。

## 如果云如此复杂，为什么要搬到那里？

如果很难解决云本身的复杂性，为什么那么多的开发团队和组织想要迁移到云呢？从业务和开发人员的角度来看，快速扩展和发展的能力意味着更快取得成果(或上市)，并且它具有显著的优势，从更高的组织效率到更多的收入机会。当然，诀窍是克服最初的障碍(复杂性)。

这需要团队合作，确定适合其团队的流程、工作流和工具，以实现其特定的云原生目标:他们要去哪里？团队期望获得什么价值？

事实上，像 Kubernetes 和微服务这样的云技术带来了复杂性，使得云原生对许多组织来说不切实际，特别是那些在传统和规避风险的行业中运营的组织。

从某种程度上来说，这就是为什么这个行业已经广泛转向将[开发者平台](https://samnewman.io/blog/2023/02/08/dont-call-it-a-platform/)和平台工程作为万灵药的想法，按照顾问和作家 Sam Newman 的说法，以“给旧实践贴上新标签”的形式推广开发者体验的产品化方法就足够了。

想象单个平台可以解决复杂性是对云原生环境的根本性误解，特别是考虑到纽曼强调的出发点:Kubernetes 从来就不是对开发人员友好的，云原生计算基金会(CNCF)生态系统中的工具环境包含“一系列令人困惑的选项”，可供任何希望在其上构建解决方案的人使用。很容易迷路。

## 解决开发人员支持和体验问题:降低复杂性

但这并不真的与平台有关:它总是取决于开发人员的体验和支持开发人员团队的生产力以及云原生的承诺。也就是说，什么样的过程和工具的组合能让应用程序更安全、更快速地进入世界，同时对开发人员来说摩擦和认知负荷最小？一旦开发人员体验得到解决(这是一项持续的活动)，云原生开发的目标是什么？

## 为实现云计算设定可衡量的目标

云实验对于找出可能性是有用的，但是将云引入生产意味着认真对待它必须为开发团队(和整个组织)做什么，这是更传统的开发模式所做不到的。为什么云适合您的组织和团队？团队和组织能够应对云带来的变化和复杂性吗？

一旦你明白你想要实现什么，并且知道如何去衡量它，你的道路将会变得更加清晰。

让我们使用一些典型的以 DevOps 为中心的指标来看一下性能测量，作为一个例子。大多数组织使用 DORA 或 Accelerate 指标来了解他们在关键领域的表现，如部署频率(DF)、变更提前期(LT)、平均恢复时间(MTTR)和变更失败率(CFR)。如果您已经进入云原生开发，寻求更快、更安全的软件交付，那么理解所有这些都是至关重要的。

让开发人员与这些指标联系起来，以便更好地理解他们的工作，这是一种在不强迫他们运行指标的情况下深入了解他们工作的方法。(DevOps 团队通常仍然会这样做。)

## 云原生责任

在这个新的云原生范式中，不同的代码运行责任位于何处？近年来，关于责任的辩论已经发生了变化，一些人认为开发人员应该对完整的代码、发布和运行负责，而另一些人则认为开发人员应该继续专注于编码。

我们所看到的是一个介于两者之间的领域，在这个领域中，开发人员需要了解在整个软件生命周期中发生了什么，但实际上不需要担心基础设施使其在幕后工作。

这是平台讨论频繁出现的地方，作为赋予开发者更多责任的一种方式。目标并不总是让开发人员在他们自己关注的领域之外做更多的事情——它应该是为更快更容易地完成他们职责范围内的工作铺平道路。

一个开发人员需要洞察和访问，但不是 100%负责的领域的实际例子是 API 网关。API 网关是大多数现代应用程序开发的必需品。它是您的应用程序和系统的大门。这就是每个用户请求的部署、路由和保护方式。开发人员希望快速编码和发布服务，同时能够动态配置 API 端点。他们不需要额外的负担(通常在他们的核心能力之外)来设置平台，以实现事件最小化和更强的安全性，这对于 API 网关运营至关重要。

## 云原生 API 网关

云原生/Kubernetes 原生 API 网关简化了安全、高性能微服务流量管理的大规模交付。

围绕选择云原生 API 网关的决策，还有哪些其他考虑因素？

### 服务发现:单片、微服务和网格

采用云原生方法进行服务连接和通信的最大问题之一是:“我应该使用哪种技术(API 网关或服务网格)来管理基于微服务的应用程序之间的交互？”答案还没有完全确定。这些技术的工作方式各不相同，应该从最终用户的体验来考虑——如何在特定环境中实现成功的 API 调用。潜在用户必须了解这两种技术之间的差异和相似之处，以确定何时应该使用一种技术而不是另一种技术，或者同时使用两种技术。

转向基于服务的方法的好处之一是能够快速发布，并且不需要“大爆炸”式的部署方法。为了保持较短的变更准备时间和较高的部署频率，API 网关和服务网格必须易于配置，并且可供开发人员自助使用。

### 平衡负载:配置变化的诅咒

负载平衡以最有效的方式在多个后端服务之间分配网络流量，以确保可扩展性和可用性。在 Kubernetes 中，有各种选择来对 pods 的外部流量进行负载平衡，每种选择都有不同的权衡。要做出正确的选择并开始行动，需要理解各种负载平衡策略和实现。

团队还需要清楚这种类型的基础设施的错误配置的[影响。如果没有适当考虑云原生环境中增加的动态性，就很容易影响变更失败率和 MTTR。](https://surfingcomplexity.blog/2021/05/29/why-do-config-changes-keep-coming-up-in-major-incidents/)

### 轻松采用:AWS EKS 和 API 网关

在 Ambassador Labs，我们已经帮助数千名开发人员在不同的云提供商之间安装并运行他们的 Kubernetes ingress 控制器。如果你在任何地方使用亚马逊 EKS，那么[推荐的入口和 API 网关是使者入口](https://www.getambassador.io/products/api-gateway)。总的来说，AWS 提供了一个强大的、可定制的平台来运行 Kubernetes。然而，大量的定制选项经常会导致新用户的困惑，并使他们难以知道何时何地针对他们的特定用例进行优化。

你可以在 EKS Anywhere 文档中看到，亚马逊团队在开发人员体验方面投入了大量资金，他们的[eks CTL-命令行工具](https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html)降低了打包和部署支持基础设施和应用程序的复杂性(和认知负荷)。

## 向云迁移:关注速度、安全和自助服务

转向云原生是一个重大决策，并不一定是每个组织的正确决策。许多技术和组织方面的考虑支撑着利弊。一旦组织达到准备实施由平台和运营团队推动的开发人员自助服务的水平，云原生就成为速度和安全性方面的可行选择。

然后其他的考虑就进入了框架。哪些技术支持采用云本地实践和技术？如前所述，API 网关是应用程序的大门，也可以支持向云的迁移。最终，当迁移到云时，很有可能您的技术堆栈的任何部分都不会受到影响。一定要围绕你的目标框定任何变化，比如提高速度和安全性；你的度量，比如提高你的 DORA 度量；以及开发人员体验，例如提高开发人员基于平台支持团队定义的铺设路径进行自助服务的能力。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>