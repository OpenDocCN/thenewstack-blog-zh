# Kubernetes、数据可移植性和可移植有状态应用程序的兴起

> 原文：<https://thenewstack.io/kubernetes-data-portability-and-the-rise-of-portable-stateful-applications/>

[](https://kasten.io/)

[Niraj Tolia](https://kasten.io/)

[Niraj Tolia 是 Kasten 的首席执行官和联合创始人，对 Kubernetes 的一切都感兴趣。他过去担任过多种职务，包括戴尔 EMC 的 CloudBoost 系列产品的高级工程总监，以及 Maginatics(已被 EMC 收购)的工程副总裁兼首席架构师。Niraj 在卡内基梅隆大学获得了计算机工程的博士、硕士和学士学位。](https://kasten.io/)

[](https://kasten.io/)[](https://kasten.io/)

使用 Kubernetes 的最大好处之一是由于它的扩散。由于其功能性和受欢迎程度，每个主要的云提供商都有托管 Kubernetes 产品，对于私有数据中心，有各种内部解决方案可供企业选择。这种跨不同操作环境的公共基础设施的可用性是前所未有的，并且增强了所有应用程序开发人员的能力。这种普遍性带来的最大好处之一是应用程序的可移植性。对于 Kubernetes 的用户来说，在任何地方部署相同的应用程序都变得很容易。

事实上，开发人员已经在利用无状态应用程序的可移植性优势，但是要实现有状态应用程序的可移植性，还有两大障碍:存储基础设施抽象和实际数据(或状态)的可移植性。在本文中，我们将解释，如果设计正确，这些相同的可移植性好处也可以应用于有状态应用程序，包括关系数据库和 NoSQL 系统。

## 利用存储接口的可移植性

对于没有数据可移植性要求的应用程序，底层存储基础架构的多样性可能是一个问题。然而，通过使用存储类和[容器存储接口(CSI ),可以抽象出存储多样性。](https://thenewstack.io/what-the-container-storage-interface-means-for-storage-evolution/)

特别是，特定于基础架构的存储配置可以在 StorageClass 中抽象出来，只要具有所请求名称的 StorageClass 存在，应用程序就会使用管理员为所选存储基础架构提供的映射。存储配置的常见示例包括定义底层存储性能类型(例如，SSD 与旋转磁盘)、QoS 功能(如 IOPS 要求)和静态加密选项。

CSI 用于将块和文件存储添加到容器化的应用程序中，通过提供一个通用的跨平台 API，类似地抽象出不同存储提供商的管理接口。几乎所有存储供应商都提供了一些有用的常见 CSI 存储摘要，包括所有生命周期操作，如卷创建、删除和装载，以及拍摄和恢复卷快照的能力。

当这两种抽象结合使用时，开发人员无需了解存储供应商或底层存储架构，就可以在异构存储基础架构上构建和部署应用程序。

这种 API 可移植性方法是我们发现最适合大多数 Kubernetes 用户的方法，因为它遵循 KISS 原则，即大多数系统在保持简单而不是复杂的情况下工作得最好。特别是，与采用存储“覆盖”解决方案(在部署环境中可能存在的任何内容之上引入新的存储层)相比，使用 API 抽象具有许多优势:

*   **同类最佳**:使用始终最适合您的部署环境的本机存储技术(例如 AWS 中的 EBS 或 NetApp 内部部署)。这使您的应用程序能够利用底层存储提供商的优化性能、可靠性和深度硬件集成，而不是局限于最低标准 API 的多平台存储覆盖。
*   **性能和成本优势**:直接允许应用程序使用部署基础架构的本机存储堆栈还可以带来成本和性能优势，这些优势会随着时间的推移而逐渐增加。相比之下，将一个存储系统分层到另一个存储系统(例如，EBS 上的存储覆盖)所增加的开销导致性能降低，同时承受运行两个独立存储层的额外管理开销和预算成本。

## 提供数据可移植性

虽然使用上述存储抽象可以为您的有状态应用程序提供**部署可移植性**，但是为了提高弹性、灾难恢复甚至测试/开发工作流，还需要**数据可移植性**支持。事实上，您真正需要的是应用程序的可移植性，但这是另一篇文章的主题——我们在这里只关注数据组件。

对于一个有状态的 Kubernetes 应用程序，应用程序数据不仅要在集群内备份，还要保留在多集群、多区域和多云环境中移动整个应用程序堆栈及其数据的能力。出于多种原因，必须这样做:

*   **灾难恢复**:拥有跨故障域(集群、区域、地域)的热备用
*   **混合设置**:在给定企业内部空间的情况下，支持跨混合环境移动数据的能力
*   **避免供应商锁定**:除了成本优势，还保留了不在选择的基础架构上重新部署的能力
*   **测试/开发工作流**:支持拷贝数据管理工作流，以便经常将生产数据引入测试或 CI 环境

根据我们与需要数据可移植性的客户合作的经验，我们了解到以下特征对他们非常重要:

*   **透明性**:不需要改变应用程序。拖开发人员的后腿不是一个可行的选择。
*   **API 驱动的自动化工作流**:工作流应该是 API 驱动的，完全自动化的。应该不需要手动操作。
*   **基础设施独立性**:就像上面描述的存储接口可移植性一样，您不应该被迫在任何地方使用相同的存储系统来受益于数据可移植性。您应该能够为您的环境选择最佳的存储系统，但是能够透明地跨基础架构移动(例如，从 AWS EBS 磁盘到 Google Cloud GPD 卷)。
*   **数据安全**:所有的数据传输必须是安全的，并且编排 API 支持 RBAC。除了动态和静态加密，解决方案还应支持数据屏蔽和基于策略的 GDPR 合规性。
*   **环境隔离**:支持跨不同帐户、资源组和集群的数据移动的能力，以便不影响主要工作负载的性能。
*   **性能和效率**:鉴于数据的重要性，出于成本和性能原因，能够使用先进的重复数据删除和数据传输技术。

通过 Kubernetes 的发展，各行各业的开发人员现在能够创建可移植的有状态应用程序，以实现部署和升级的灵活性，并提高应用程序的可用性和敏捷性。当您使用现有的各种产品来帮助开发、部署和管理您的 Kubernetes 应用程序时，请寻找一种支持数据可移植性的数据管理解决方案，同时为您的底层存储选项提供选择。

为了更深入地了解界面和数据的可移植性，我们把下面的视频放在了一起。它将向您展示像 GitLab 这样的复杂应用程序不仅可以使用接口可移植性抽象在单个云环境(谷歌 GKE)中捕获，还可以使用数据可移植性特性迁移到完全不同的云(AWS EKS)提供商。

[https://www.youtube.com/embed/wkP4NTvTax8?feature=oembed](https://www.youtube.com/embed/wkP4NTvTax8?feature=oembed)

视频

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>