# Apache Druid:现代分析的实时数据库

> 原文：<https://thenewstack.io/apache-druid-a-real-time-database-for-modern-analytics/>

[](https://www.linkedin.com/in/david-wang-0240204/)

 [王耀庆

王耀庆是 Imply 的产品营销副总裁，负责公司的定位、产品信息和技术内容。他是一名工程师出身的营销人员，职业生涯是建立新的类别，并提高对下一代数据管理、虚拟化和企业存储技术的认识。在加入 Imply 之前，David 曾在惠普企业(HPE)、Nimble Storage 和 GE Digital 担任领导职务。](https://www.linkedin.com/in/david-wang-0240204/) [](https://www.linkedin.com/in/david-wang-0240204/)

分析已经成为每个公司的秘方。但是，尽管它对制定决策很有用，但它不再仅仅适用于内部利益相关者。像 Twitter、Atlassian 和 Citrix 这样的公司正在引领他们的行业，因为他们正在向客户提供见解。

对于现在负责构建外部分析应用程序的技术领导者来说，试图找出使用什么样的数据库后端需要新的考虑。

简单的答案是默认使用 PostgreSQL 或 MySQL 之类的数据库，或者甚至在其标准 BI 仪表板和报告功能之外采用一个数据仓库。虽然这些选项一开始似乎可以快速完成工作，但重要的是要记住，创建面向客户的应用程序可能比内部应用程序具有更大的影响，这只是对收入的潜在影响之一。因此，从能够提供最佳用户体验的数据库开始工作是至关重要的。

## 正在加载…请稍候

没有什么比坐着等待应用程序返回结果更令人沮丧的了。如果您自己的员工必须等待几秒钟甚至几分钟才能处理一个查询，这没什么，但是对于像客户这样的外部用户来说，这种等待时间是不可接受的。

用户经常遇到长时间等待的原因有几个:您试图分析的数据量、数据库的处理能力、用户和 API 调用次数等等。总的来说，它基于数据库运行应用程序的能力。

虽然在处理大量数据时，使用通用 OLAP 数据库来创建交互式数据体验是可行的，但是您可能会将自己置于代价高昂的劣势。如果你试图提前计算所有的查询，你最终会得到一个昂贵而僵化的架构。同样，先收集所有数据会导致你的洞察力最小化。如果你只分析最近事件的数据，你阻碍了你的用户看到全貌。

因此，要创建一个面向外部的数据分析应用程序，您需要寻找一个具有优化的架构和数据格式、专为交互性而构建并可根据您的需求进行扩展的数据库。Apache Druid 是一个满足这三种需求的开源数据库。

Apache Druid 利用其分布式的弹性架构，将数据从共享数据层预取到一个无限的数据服务器集群中。因为不需要移动数据，并且您提供了更大的伸缩灵活性，所以这种架构的执行速度比解耦查询引擎(如云数据仓库)更快。

此外，Apache Druid 通过利用内置于其数据格式中的自动多级索引，可以在每个内核上处理更多的查询。这包括全局索引、数据字典和位图索引，它超越了标准的 OLAP 列格式，并通过最大化 CPU 周期来提供更快的数据处理。

## 高可用性是必须的

就内部运营而言，经历一次中断并不是什么大不了的事情，尤其是如果它只持续几分钟的话。这可能有点不方便，但对于 OLAP 数据库和数据仓库来说，在服务不可用的情况下出现一些计划外停机和维护窗口并不是没有听说过。

然而，当涉及到面向客户的外部分析应用程序时，情况就完全不同了。如果客户遇到计划外停机，他们可能会暂时或无限期地放弃应用程序，从而对收入造成影响。这就是为什么在构建这种类型的应用程序时，优先考虑高可用性和数据持久性的弹性是非常重要的。

为了实现面向客户的外部分析应用程序的弹性，有几个问题您应该问自己:我能防止节点或集群范围的故障吗？如果我丢失数据，会有什么影响？保护我的数据和应用程序需要什么？

服务器最终会出故障，这是不争的事实。备份数据和复制节点是确保弹性的标准方法，但除非您保持频繁的备份节奏，否则您需要采取更多措施来减少数据丢失。

相反，您需要确保高可用性和数据持久性内置于您的数据库中，特别是包含自动、多级复制的数据库，共享数据存储在 S3/对象存储中。 [Apache Druid](https://druid.apache.org/) 提供连续备份功能，即使您的整个集群受到影响，也能自动保护并恢复您数据库的最新版本。

## 在不增加成本的情况下添加用户

为高并发性设计您的后端是很重要的，因为您需要一个能够支持大量用户并且仍然提供引人入胜的体验的应用程序。这可以帮助您减少因为客户的应用程序工作不正常而激怒他们的可能性。

值得注意的是，这与内部报告的架构设计不同，因为后者通常拥有较少的常规用户。最终，这意味着您需要一个数据库用于内部报告，另一个数据库用于高度并发的应用程序。

在为高并发性构建数据库时，有三个因素需要考虑:CPU 使用率、可伸缩性和成本。有些人可能会说，增加更多的硬件可以解决这个问题，但这并不总是最好的答案。虽然增加 CPU 的数量可以让您运行更多的查询，但它也会带来更高的价格。

Apache Druid 提供了更智能、更经济的选择，因为它优化了存储和查询引擎，减少了 CPU 的使用。“优化”是这里的关键词；您希望基础设施在相同的时间内处理更多的查询，而不是让数据库读取不需要的数据。

## 为今天和未来而建设

提供外部分析应用程序可以成为出色的客户保持战略和收入来源的一部分。这就是为什么花时间寻找最能满足您需求的数据库并构建让您的客户满意的正确数据架构至关重要。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>