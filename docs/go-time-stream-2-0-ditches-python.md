# 是时候了:Stream 2.0 抛弃了缓慢的 Python，支持更快的 GoLang

> 原文：<https://thenewstack.io/go-time-stream-2-0-ditches-python/>

![](img/0e40d47a2a5235c213073a6fe66a7be7.png)

有没有停下来想想你的 Twitter 或 Instagram feed 是如何填充的，或者 YouTube 是如何为你个性化推荐视频的？都在饲料里。从 Instagram 和 Twitter 以及所有社交网站等引人注目的实时互动流，到新闻、天气甚至零售销售等被动功能，基本任务都是一样的:信息的聚合和自动、智能传播。虽然这个概念很简单，但是构建一个可伸缩的、可靠的提要可能是一项非常复杂且耗费资源的任务。

进入[流](https://getstream.io/)，一个用于构建、缩放和个性化 feeds 的 API。Stream 为开发人员提供了一个活动提要平台来实现新闻提要，而不是从头开始构建功能。Stream 于 2014 年推出的高度可扩展的开源 feed 框架目前为超过 3 亿用户提供 feed。该公司一直在不停地加速发展，在成立后不到一年的时间里就进入了 TechStars 孵化器项目，并在此后的两年里从 0 名员工发展到 23 名员工，同时在两个大陆上开设了办事处。在这个过程中，Stream 平台也开始超越其最初的基于 Python 的架构。

TNS 最近采访了 Stream 联合创始人兼首席执行官 [Thierry Schellenbach](https://www.linkedin.com/in/thierryschellenbach/) ，讨论了在微服务驱动的基于云的行业中开创性的“feed as a service ”,以及将 Stream 平台从 Python 过渡到 Go for Stream 2.0 的决定。

**是什么让你有了围绕新闻源创业的想法？**

我的第一次创业是建立一个面向时尚的社交网络，这个网络已经有了几百万用户。提要是业务的重要组成部分，随着时间的推移，它就崩溃了。这是一个巨大的工程挑战，我们四处寻找解决方案，但我们能找到的只有白皮书。它提供了非常好的信息，但是你必须推出自己的解决方案。货架上没有现成的。

所以当我离开那个组织的时候，这个问题集就在我的脑海里。20%的应用都有订阅源，当你拥有几百万会员时，这将是一个非常棘手的问题。可扩展性就是一切。

> 通过我们的 API，我们的客户基本上是在构建下一个脸书，下一个 Instagram，所以像重新排名 feed，聚合 feed 这样的功能——只要数据变得稍微大一点，就变得非常困难。

此外，超过 500，000 个应用程序仍在构建和维护自己的 feed 技术。每一次，所有这些公司都经历同样的挣扎，重新发明同样的技术。我们看到了[微服务](/category/microservices/)如何添加你可以作为你的应用程序的一部分的乐高积木，我们看到我们可以提供这种特殊的组件。使开发人员能够在几天而不是几个月内构建提要，并由机器学习提供支持，因此提要可以毫不费力地智能聚合并根据相关性重新排序。

**最初的框架是建立在 Python 之上的，但是对于 Stream 2.0，你切换到了 Go。是什么推动了这一决定？**

对于许多类型的应用程序来说，你使用的编程语言的性能并不重要——它只是应用程序和数据库之间的粘合剂。但是，如果你像我们一样，是一个为 500 家公司和 3 亿多终端用户提供 feed 基础设施的 API 提供商，那么性能差异就真的很重要了。Python 是一门伟大的语言，但对于一些用例，如排序、聚合、序列化和反序列化，它的性能相当缓慢。我们一直在优化 Cassandra、PostgreSQL、Redis 等。但最终，我们达到了极限。

通过我们的 API，我们的客户基本上是在构建下一个脸书，下一个 Instagram，所以像重新排名 feed，聚合 feed 这样的功能——只要数据变得稍微大一点，就变得非常困难。我们来自 Cassandra 的数据在后端需要一毫秒，但通过 Python 传输给我们的客户需要 20 毫秒。不仅仅是时间，而是我们的底层基础设施。

[哨兵](https://sentry.io/about/)(开源错误跟踪软件公司)在 Python 上遇到了类似的问题。他们最终将 Rust 用于他们的一些端点，并将它们嵌入 Python 中。这是一种选择。但是对于流、序列化、从 Cassandra 中读取以及其他嵌入到 Python 中的性能问题，意味着要完全迁移到一种新的语言。一个常见的解决方案是用 C 或 Rust 重写某些目标组件，Python 可以使用的任何东西。但这只适用于一个很小的部分，比如图像大小，这是一个问题。对我们来说，虽然它太普遍了。

我们开始寻找选择，比如 Algolia 的搜索即服务，它们非常有趣，是一家由 T2 Y Combinator 支持的创业公司。我们广泛地研究了 [C++](http://www.cplusplus.com/doc/tutorial/) ，然后是 [elixir](https://elixir-lang.org/) ，这是一种现在很受欢迎的编程语言。而且我们看了 [Scala](https://www.scala-lang.org/) 和 [Akka 框架](https://akka.io/)。我们看着围棋。

与 Scala 和 C++相比，Go 是一种更现代的语言，一种相当简单的语言，所以用 Go 培训工程师更容易。当您的团队中只有一个人具有该语言的经验时，这一点非常重要！而且有很多工程师想转到 Go，所以它也成为了一个人才招募工具。

Scala 和 Akka 一起很快，但是也非常复杂。我们觉得那会让我们太慢——我们仍然是一个小公司，所以我们需要平衡 API 的性能和我们能够负担的开发费用。真正达到最佳状态——它非常高性能，但也易于使用，并且入门非常简单。

长生不老药是最后的有力竞争者。而且很有意思。但是这个生态系统仍然太年轻，没有足够的库来容纳我们使用的东西，而且当我们对它进行基准测试时，它的速度更快。我们再也不会做这样的改变了，因为改变你的语言是一件你不应该重复做的事情。但未来寻找另一种语言的公司绝对应该考虑 Elixir。

就在 7 个月前，我们决定迁移下一代平台 Stream 2.0，我们刚刚完成了迁移。这是客户的一大福音，性能和稳定性都得到了极大的提高。

[![](img/0f4aedd91002b212f2db98ca89333cda.png)](https://storage.googleapis.com/cdn.thenewstack.io/media/2018/01/be86677c-rankedfeed.png)

是时候了:Stream 的一些排名提要功能

**Python 仍然被用于 Stream 的某些方面？**

所以我们整个网站本身，以及我们所有的机器学习仍然由 Python 驱动。它有优秀的机器学习库。如果你看看机器学习可以派上用场的提要——例如，重新排序和重新排列与个人用户相关的提要，这是我们为企业客户做的事情——Python 仍然是一个非常好的选择。

下一步是什么？

嗯，现在我们的大部分研究致力于确保 Stream 继续为越来越大的应用程序工作。

对于未来，我对机器学习中更微妙的改进非常感兴趣。

现在设置机器学习仍然非常复杂。我们开始用 Stream 提供我们自己的机器学习，但即使有一个专门的部门，也有如此多的移动部分需要跟踪:系统中的所有数据，人们如何处理这些数据。机器学习基本上是样板化需要发生的事情。现在它还很不完善，无论是技术还是我们应用它的方式都还在摸索中。现在很多应用程序只是向你扔内容。或者机器学习在不看其他东西的情况下为参与而优化时的危险。因为有争议的材料是最吸引人的，所以它会针对有争议的材料进行优化，这是一个你不想走下的悬崖。

因此，进化出不引人注目但更有用的方法来应用机器学习。例如，我们将 Google Cloud 用于他们的 [Vision API](https://cloud.google.com/vision/) ,因此当用户将活动上传到 Stream 时，其中有一张图像，我们使用 Google 来计算图像中的内容，然后将该主题输入到您的机器学习中。以前我们看的是标签或应用提及，但现在下一代我们可以使用视觉关键词来理解帖子是关于什么的。因此，如果有人上传了一张关于单板滑雪的照片，或者你正在看一张关于单板滑雪的照片，现在我们知道这是你感兴趣的东西。

我相信机器学习会有非常有用的应用——找工作，找房子。LinkedIn 有一个庞大的团队在开发他们的 feed，比我们整个公司还大，试图进行这些改进。实际上，像房地产这样有用的东西，比如说，当你搜索一栋房子时，你搜索的不仅仅是你指定的任何东西，而是你点击的内容，以及导致的结果——它更微妙地从你自己如何进行有机搜索中学习。

所以，是的，这就是我们要说的。人工智能应用于一些有用的东西，如找工作或住房。不仅仅是给你看猫的照片。

[谷歌云](https://www.cncf.io/kubecon-cloudnativecon-events/)是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>