# Kubernetes 备份的原因、时间和范围

> 原文：<https://thenewstack.io/the-whys-whens-and-wherefores-of-kubernetes-backup/>

[](https://cloudcasa.io/)

 [鲍勃·王茂林

鲍勃·王茂林是 Catalogic 软件公司 CloudCasa 的产品经理。Bob 在 IT、存储和数据保护行业拥有 30 年的经验。自从在华尔街开始其 IT 职业生涯以来，他曾在存储网络、维尔软件、赛门铁克、Savvis、EMC 和戴尔等公司担任工程和产品开发方面的高级职务。](https://cloudcasa.io/) [](https://cloudcasa.io/)

谈到数据保护，Kubernetes 是最容易被误解的新技术之一。造成这种混乱的原因有几个，包括:

*   Kubernetes 作为无状态应用程序解决方案的传统，
*   应用程序甚至整个集群使用基础设施作为来自存储库的代码自动部署的趋势，
*   云中模糊的组织责任线，以及
*   Kubernetes 倾向于由没有传统 IT 运营背景的开发或 DevOps 团队管理。

## **S**相同，但不同

在许多方面，备份 Kubernetes 的要求与备份其他关键 IT 基础设施的要求相同，但在其他方面，它们又有很大的不同。

对于传统的服务器基础架构，通常假设运行生产应用程序的所有服务器或虚拟机以及对开发至关重要的所有系统都将得到备份。用于测试/QA 和试运行的其他系统通常被排除在外，但是为了方便起见或者为了最小化可能的开发进度中断，也可能被备份。这些备份可以在服务器或虚拟机级别、存储级别或更有可能在这两个级别完成。这个过程虽然不一定简单，但很容易理解。

对于云基础架构，基础架构本身的配置数据也必须备份。如果云基础设施是使用 IaC 工具自动部署的，那么应该备份包含 IaC 文件的存储库。但是通常这并没有做到，当它做到时，必须希望实际的配置没有偏离部署的配置。云中的存储卷可能包括不同类型的复制和快照功能，但这些功能需要管理，通常不能替代应用程序级备份。在云中运行并没有消除备份的需要，只是改变了需求。

Kubernetes 增加了一层额外的复杂性。群集是在底层节点或虚拟机上实施的，其配置可能会随着时间的推移而改变。除此之外，还部署了容器化的应用程序，这些应用程序可能需要各种类型的持久存储卷，并且可以创建自定义资源或修改集群状态。

## **几种方法，结果相同**

有多种方法可以保护 Kubernetes 和在其上运行的应用程序，但毫不奇怪，最好的方法是使用真正理解 Kubernetes 的解决方案。您可以使用仅在存储级别保护底层持久卷(PV)的工具，或者您可以备份底层节点，如果它们是虚拟机，这可能很容易。但是，当您想要恢复时，您会怎么办呢？很有可能您只想恢复单个名称空间，或者单个 PV，甚至单个资源，比如一个秘密。不知道 Kubernetes 的传统备份工具对此没有帮助。

有状态应用程序在 [Kubernetes](https://thenewstack.io/category/kubernetes/) 下运行变得很常见，它们利用持久卷，甚至经常在其上运行数据库。与运行在传统服务器基础架构上的数据库一样，要获得一致的备份，可能需要应用程序以“挂钩”的形式感知，以便在创建卷快照之前停止数据库或应用程序。在 Kubernetes 上，这些钩子也必须是集群感知的，这样它们才能被指向正确的节点和容器。

## **备份还是不备份**

您可能认为您的 Kubernetes 集群根本不需要备份，因为它只运行无状态的应用程序，所有的东西都是使用 CI/CD 管道和 IaC 工具从 git repo 中的文件自动部署的。那可能是真的。但也可能不会。如果需要的话，你确定你可以轻松地重建五分钟前、两周前或九个月前的环境吗？您确定自从您的部署工具创建您的集群以来没有任何配置偏差吗？您确定吗，即使您可能不使用 PVs，重要的应用程序状态也不会作为 Kubernetes 自定义资源存储在 CronJob 条目中，等等。？你的秘密和证书受到保护了吗？最重要的是，您确定您的开发人员上个月告诉您的关于集群上缺少应用程序状态和可能的配置漂移的说法在今天仍然正确吗？如果您选择放弃备份，请确保与所有利益相关者一起持续检查这是否仍然合适。然后忽略他们告诉你的，定期从头测试一个完整的重建。安全总比后悔好。

## **高可用性与备份**

Kubernetes 和云基础设施一起可以为您的应用程序提供一个优秀的高可用性平台。跨多个可用性区域或地区的基础架构冗余和复制可以提供容错和应用程序级弹性。但是高可用性不能替代备份。高可用性解决方案可防止因物理故障(如磁盘、节点、电源、网络连接故障，甚至是整个站点的故障)而导致的数据丢失和不可用。但是它们无助于防止逻辑故障。自从 20 世纪 90 年代开始普遍使用 RAID 和卷复制以来，数据中心的物理故障很少成为恢复请求的原因。数据丢失和后续恢复的主要原因是逻辑错误:用户错误、软件错误、操作员错误和安全漏洞。使用高度可用的云解决方案并不能免除您通过备份保护应用程序和数据的责任。

## **快乐的结果**

在决定如何、何时以及是否保护您的 Kubernetes 集群时，请仔细考虑原因。一个好的和适当配置的备份解决方案可以决定 Kubernetes 体验的好坏。

作为一家数据保护公司，在 CloudCasa by Catalogic，我们听说了许多保护 Kubernetes 的方法，以及客户认为他们根本不需要备份的许多原因。这些理由有些是正确的，有些则不是。有时，这些决定会导致不愉快的结果，当客户找到我们寻求防止它们再次发生时，我们才听说。

![KubeCon EU 2022](img/3a946f86447e1f058ffa27e8553342db.png)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>