# 混沌工程如何给你的分布式系统带来稳定性

> 原文：<https://thenewstack.io/chaos-engineering-can-give-distributed-systems-stability/>

为了准备这篇文章，我问了一群我的工程和敏捷教练朋友和同事，他们是否部署了混沌工程的新兴实践。我得到了很多相同的回答——“当然，每天都是。”或者“哈哈这就是我的生活。”但他们更多的是在开玩笑，谈论他们如何试图驱赶猫或实践他们自己的流氓编码形式。

当然，当麻烦困扰他们的操作时，每个 IT 经理都会抱怨。但流媒体服务网飞实际上招致了这样的破坏，这一切都是为了让他们的系统更强大。流媒体服务的工程师给这种做法起了个名字， [【混沌工程】](http://principlesofchaos.org/) ，他们将其定义为“在分布式系统上进行实验的学科，目的是建立对系统承受生产中动荡条件的能力的信心。”

或者，如果你是[【code fresh】](https://codefresh.io/)的首席研究员[阿列克谢·莱德涅夫(Alexei Ledenev](https://github.com/alexei-led) ，混沌工程就是要认识和管理系统和人的复杂性。在今年的[Container Camp](https://2017.container.camp/)上，他谈到了在一个项目的生命周期中，不同的架构趋势、各种集成以及不断更新的外部服务和 API，如何与不断发展的团队相结合，使你的故事变得非常复杂。

“构建无意中变得复杂的软件很容易，但维护复杂的软件却很难，”勒德涅夫说。

因此，混沌工程拥抱失败的可能性，并将其视为一个机会，以更灵活、适应性更强的架构成为一个更灵活、适应性更强的团队。通过接受你会有失败，你可以控制失败并更好地了解你的系统——以及构建它的团队。

## 什么是混沌工程？

当网飞建筑师在亚马逊网络服务上建造他们的基础设施时，他们引入并命名了混沌工程。他们拥抱混乱来为失败做准备的版本是:

1.  拥抱失败。控制故障，看看您的系统如何运行。
2.  定义分布式软件系统抗测试的经验方法。
3.  定义系统的正常/稳定状态，并对其进行监控。

然后，以一种非常随意、有条不紊的方式，你把厨房的水槽扔向你的代码。除了它不是厨房的水槽，而是专门测试你的系统的最相关的风险和缺陷。

一旦你遵循了这三条原则，你就不仅能了解你的系统，还能知道是什么让它们陷入困境和停滞。Ledenev 说，这可能涉及随机注入伪故障，如终止虚拟机、杀死容器和改变网络。

“试着发现弱点或偏离常规的地方，”他说。

在混沌工程中，当你试图实现大规模稳定时，你按照以下四个步骤进行实验:

1.  定义系统正常行为理想状态。
2.  创建一个对照组和一个实验组。
3.  介绍真实世界的扳手，像换服务器。
4.  试着找出操控和崩溃的区别或弱点。

“破坏稳态越难，我们对系统的行为就越有信心。网站 [混沌工程](http://principlesofchaos.org/) 称:“如果发现了一个弱点，我们现在就有了一个改进的目标，以免该行为在整个系统中表现出来。”。

请记住，你在代码中抛出的每个变量都应该反映真实世界的事件。这通常是您的代码已经发生的情况，但有时也可能是您从其他类似的分布式系统中听到的经验。

然后，根据故障发生的频率和/或程度，对这些事件进行优先级排序。不要只考虑代码中的错误，还要考虑硬件故障、服务器故障和安全问题。

混沌工程的最后一条规则是，你必须在生产中运行这些实验，以真正了解它们将如何反应，这取决于你的环境和交通模式，而这是你在中转区也无法模仿的。

## 帮助你创造受控混沌的工具和动物测试

然后是自动化你扔向你的技术的扳手。当然，您可以运行手动测试来设置您的混沌测试，但是，为了使它成功，您需要创建自动化测试，这样您不仅可以连续测试已知的情况，而且还可以腾出时间来识别新的情况，这些情况可能不会产生很大的影响，但是可以帮助提高您的系统的性能和稳定性。

当然，有一些工具可以帮助你将风险和缺陷抛向你的系统。而且好像都是以动物命名的。首先，网飞创造了[混沌猴](https://medium.com/netflix-techblog/chaos-engineering-upgraded-878d341f15fa)，一个伪随机屠杀其 AWS 虚拟机的弹性工具。这已经演变成一个完整的[](https://github.com/netflix/simianarmy)，一套开源工具，对你的应用程序和网络系统进行攻击。

Ledenev 正在搜索“Docker 的混沌猴子”，但找不到任何与 Docker 或容器集群相关的东西。所以他创造了一个。 [Pumba](https://github.com/gaia-adm/pumba) 是一只混沌测试疣猪(还记得*狮子王*？)对于 Docker 来说。他发现，作为混沌测试的最佳实践，可以定义可重复的时间间隔和持续时间参数，以更好地控制混沌。在此基础上，他构建了 Pumba 来分发到单个 Docker 主机、Swarm 集群或 Kubernetes 集群。它可以做的事情有:

*   停止运行码头集装箱。
*   取消发送终止信号。
*   取出容器。
*   每十分钟随机停止一个容器。
*   每 15 分钟杀一个 MySQL 容器。
*   每 5 分钟杀死随机容器。
*   每 3 分钟暂停队列 15 秒。

现在，从一个小型开源测试工具中给出这么多例子似乎有些随意，但这正是混沌测试的症结所在。这是关于充分了解你的产品，知道是什么让它经常失败。这些是容器经常失败的原因。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>