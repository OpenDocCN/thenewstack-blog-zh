# 现代 Kubernetes 测试的五大挑战

> 原文：<https://thenewstack.io/top-5-challenges-in-modern-kubernetes-testing/>

向原生云的转变已经将软件测试远远抛在了后面。让我们提高您在 Kubernetes 上的测试能力。

过去几年的发展变化超出了我们许多人的想象，让我们面对它，这主要是因为一个叫做 Kubernetes 的小项目和向云原生的转变。从容器化到微服务，我们已经接受了远程工作、敏捷团队以及 cloud native 使我们能够管理的更快的开发和发布周期。

 [布鲁诺·洛佩斯

Bruno 是一名产品经理，他一直从事云生态系统方面的工作，是一名授权研究员、全栈开发人员，在过去几年中，他还担任 Kubernetes 为 Mercedes-Benz 开发专有解决方案的项目经理。最近，布鲁诺渴望为开源世界做出更多贡献，并加入了 Kubeshop。](https://pt.linkedin.com/in/bruno-lopes-a73b48103) 

但是我们遗漏了开发周期中的一个重要环节:测试。毕竟，当您每天(或一小时，或一分钟……)进行部署时，哪来的时间进行测试呢？是的，这是你产品交付的核心，每次都必须做好，但这就像拔牙一样！

当我们开始与 Kubernetes 合作时，很快就发现集成测试面临着巨大的挑战，尤其是在您的持续集成/持续交付(CI/CD)管道中配置测试以遵循 GitOps 方法时。所以我们建立了一个名为 [Testkube](https://testkube.kubeshop.io/) 的框架，使得用 Kubernetes 进行测试更加容易。我们专门处理了更复杂的测试场景，在这些场景中，您可能希望针对您的 UI 运行测试，测试不同的协议，或者运行具有许多服务和版本的微服务架构。

让我们更仔细地看看测试人员在云本地空间中面临的五大挑战(排名不分先后),以及我们如何通过将集群内测试添加到您的 CI/CD 管道中来让我们的生活变得更加轻松。

### 1.紧密结合

紧密耦合架构有很多优点，尤其是当您处理大量数据和许多数据源时。但是它限制了开发人员和测试人员在测试活动中的自由。

因为测试和测试执行活动与您的 CI/CD 和构建工作流紧密相关，所以您最终不得不在构建的同时运行您的测试。但是当您需要运行与您的构建不同步的测试时会发生什么呢？假设您已经更新了一个组件，并且只想重新运行测试套件的特定部分？或者，如果您需要在流程编排绑定到 CI/CD 工具(如 GitHub Actions 或 Jenkins)时运行特定的测试？

### 2.GitOps

现代工程的压力！我们不都知道吗，不变的期限和周期？

幸运的是，GitOps 为我们提供了一个单一的工作来源，因此您将始终知道您的集群的状态，并可以使用完善的工作流来使用它们。如果您正在使用一种成熟的 DevOps 方法，再加上一个可靠的 GitOps 框架，那么您每天都可以将数量惊人的代码部署到生产中。但是测试在哪里进行，又是如何进行的呢？

如何将您的测试和测试相关的工件与使用 git 管理所有集群状态的想法联系起来？你用同样的方式管理你的测试吗？将它们应用到每个集群？当测试已经在愉快地生产代码时，它如何适应你的 GitOps CI/CD 管道？

### 3.测试工具多样化

今天，我们可以挑选自己的语言和工具，甚至可以在团队中单独挑选，这真是太好了。我们可以为每项工作选择合适的工具，测试也不例外。我们已经看到团队为了不同的目的使用不同的测试工具——API 测试(SoapUI，Postman)，端到端功能 UI 测试(Cypress，Selenium)，负载测试(JMeter，k6)，更不用说用于自动化和集成测试的自制框架了。

缺点是这会导致不同的测试框架、工具和库以不同的格式生成结果。一些组织甚至建立了一个特定的框架，在特定的测试中使用一种语言，这是非常好的，直到团队中一个知道它如何工作的人不可避免地离开，所有的机构知识都消失了。

作为测试人员，你不可能什么都是专家。但是因为测试涉及堆栈的很多部分，所以需要一个易于运行和易于监控的标准化方法，不管您的语言或工具偏好如何。

### 4.测量和监控

在你看到结果之前，你有第六感觉知道为什么你的构建会出错吗？当你的主要焦点是测试时，很容易发现这些事情，但是组织的日益增长的异步性正在成为一个障碍，就像由独立团队管理的微服务一样，他们可能都有自己的构建管道。这种异步性也暴露了人们不理解测试结果中的模式的问题，使得当事情朝着错误的方向发展时更难检测。

在使用大量不同类型的组件和服务的组织中，始终如一地跟踪 QA 和测试通过率/失败率是非常重要的。毕竟，没有标杆管理，团队如何衡量成功？

### 5.访问限制

我们都遇到过这些问题——部署到 Kubernetes 时那些讨厌的网络访问和安全限制，更不用说基于角色的访问控制了，它会限制您在集群中能够访问或做什么。这些限制不容易解决。当然，我们中的一些人很幸运有慷慨的 DevOps 同事，他们会在你需要时给你访问权限，但情况肯定不总是这样。另外，在具体的测试环境中，您可能需要集群访问来运行您的功能或性能测试，这远远超出了您通常被授予的权限。

## 为什么是 Testkube？

我们经历过所有这些挫折——真的，所有的挫折。我们厌倦了云原生测试的这些限制，所以我们构建了一个框架，明确地给予开发人员和测试人员更多的自由。我们喜欢把 Testkube 变成一辆现代汽车。现代汽车会对自身进行诊断测试，以向驾驶员显示问题所在。为什么不让您的集群也这样做呢？安装 Testkube，集群可以在不依赖任何外部工具的情况下进行自我测试以发现问题，同时监控自己的集群健康状况。

Testkube 是一个 Kubernetes-native 抽象层，它允许测试人员和工程师编排和执行任何测试，而不依赖于特定的 CI/CD 工具。它从集群内部管理您的测试的编排和执行，这意味着您可以使用任意多的 CI/CD 工具，并简单地触发测试运行。此外，通过让测试人员简单地指向他们的集合/测试，它消除了打包和配置 Docker 的麻烦。

让我们回顾一下为什么我们认为 TestKube 正在改变云原生测试的游戏规则:

### 1.紧密结合

*   TestKube 允许您使用任何 CI/CD 工具，因此您可以避免供应商锁定，并坚持自己喜欢的项目。
*   您可以将您的测试从您的 CI/CD 构建中分离出来。更新组件后需要重新运行测试套件的特定部分吗？没有必要为您的整个构建重新运行测试；简单地挑选你需要的东西和时间。

### 2.GitOps

*   TestKube 通过允许对您的测试进行版本控制，同时使用 Kubernetes 自定义资源定义(CRD)使它们成为您的集群的一部分，从而与您的 GitOps pipeline 和 CI/CD 工作流无缝集成。

### 3.测试工具多样化

*   TestKube 提供了一个易于运行和监控的标准化方法，无论您的语言或工具偏好如何。
*   因为 Testkube 是建立在模块化架构上的，所以添加特性或支持您认为合适的任何测试工具都非常简单。
*   另外，不需要码头工人。

## 4.测量和监控

*   使用 TestKube，您总是可以知道集群的状态。Testkube 知道所有测试的定义和各自的结果，所以您可以使用它作为一个集中的地方来监控您的测试的通过率/失败率。
*   Testkube 定义了一个通用的结果格式，允许对所有类型的测试进行一致的结果报告和分析。

## 5.访问限制

*   Testkube 服务器位于您的集群中，因此您不必配置任何特殊的网络访问，因为测试运行也将在集群中运行。

我们还刚刚发布了 Testkube 0.9 版(T1)，以及一系列有用的新功能，包括一个更新的测试组织，随着我们继续扩展我们支持的执行器，我们已经使 test kube 仪表板更容易阅读。所以，试一试，让我们知道你的想法，以及我们如何能做得更好。从 [GitHub](https://github.com/kubeshop/testkube) 下载新闻稿。

你同意我们列出的五大挑战吗？请加入我们的 [Discord 服务器](https://discord.gg/hfq44wtR6Q)并在 Twitter @Testkube_io 上关注我们或直接给我发电子邮件 [bruno@kubeshop.io](mailto:bruno@kubeshop.io) 让我们知道您希望看到接下来讨论的其他挑战。我们期待着您的回复！

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>