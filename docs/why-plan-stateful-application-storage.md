# Kubernetes 中的有状态应用程序:提前计划是值得的

> 原文：<https://thenewstack.io/why-plan-stateful-application-storage/>

[](https://www.linkedin.com/in/rvandepoel/)

[Romuald vande poel](https://www.linkedin.com/in/rvandepoel/)

[Romuald 是 Ondat 的云解决方案架构师，带领客户踏上数字化转型之旅。他在企业 IT 领域拥有丰富的技术经验，曾在 Red Hat 和 NetApp 担任客户支持、咨询和交付方面的领导职务。](https://www.linkedin.com/in/rvandepoel/)

[](https://www.linkedin.com/in/rvandepoel/)[](https://www.linkedin.com/in/rvandepoel/)

据说亚伯拉罕·林肯曾经说过:“给我六个小时去砍树，我会用前四个小时去磨斧子。”Lincoln 知道在开始任何项目之前，无论是砍树还是开发有状态的应用程序，都不要忽视进行尽职调查的时间和精力。

任何开发项目都会有意想不到的曲折——范围扩展、需求变化、不可预见的依赖关系被发现等等。但是管理这些意想不到的挑战的关键是计划那些你可以预测和控制的因素。

当开发有状态的应用程序时，这些元素就是你的 Kubernetes 实现、模块、库、插件和用于支持生产应用程序的解决方案。让我们深入了解一下，我们如何从全面规划有状态应用程序的旅程中获益。

## 见机行事是什么样子的？

让我们演示一下企业部署基于 Kubernetes 的有状态应用程序的典型过程。

您将首先选择您的 Kubernetes 实现。也许你想要一个纯云解决方案，像谷歌 Kubernetes 引擎(GKE)，亚马逊弹性 Kubernetes 服务(EKS)或 Azure Kubernetes 服务(AKS)。或者，您可能希望使用自己的内部数据中心来解决像 RedHat 的 OpenShift 或 Rancher 这样的问题。

您需要评估启动和运行集群所需的所有不同组件。例如，您可能有一个首选的容器网络接口(CNI)插件，它满足您的项目需求并驱动您的集群的联网。

一旦集群可以运行，并且完成了开发阶段，就可以开始测试应用程序了。但是现在，您的平台团队正在努力维护您的有状态应用程序的可用性和可靠性。

作为有状态应用程序的一部分，您一直在使用像 Cassandra、MongoDB 或 MySQL 这样的数据库。每次重新启动容器时，您都会在数据库中看到错误。您可以通过一些手动干预来防止这些错误，但是这样您就错过了 Kubernetes 的本地自动化功能。

### 太迟考虑储物的后果

就像您的网络插件一样，您需要一个存储插件来使有状态的应用程序(比如您假设的数据库)在 Kubernetes 中正常运行。

首先，您可能需要一个网络插件来启动和运行您的集群，所以很自然地，您首先实现了项目的这一部分。只有当您开始在接受环境中测试您的应用程序时，对存储插件的需求才会出现。

因此，你开始调查[储物解决方案](https://www.ondat.io/blog/how-to-solve-kubernetes-persistent-storage-challenges)，几乎是匆忙寻找可行的解决方案。也许您尝试了几个，却发现它们有一些不适合您的组织的依赖项。为了更快地进入市场，许多存储解决方案依赖内核模块作为开发捷径，但是现在您，最终用户，正在为此付出代价。您的选择是草草拼凑一个解决方案，依靠一个刚好满足您的特定实现的次优解决方案，或者甚至基于[开源技术](https://www.ondat.io/blog/the-biggest-gap-in-kubernetes-storage-architecture)开发您自己的解决方案。

如果您的应用程序托管在一个混合环境中，您还会受到您的内部技术堆栈所允许的任何功能的限制。根据您组织的遗留基础设施，您可能无法从 Kubernetes 数据平面中获得所有预期的功能。

最终，结果是项目如期进行，直到结束。比错过时间表更糟糕的是，此类项目现在可能需要专门的支持团队来管理存储基础架构。一旦部署，项目可能不总是可用，可能经历高延迟，看到过多的数据错误或在其他方面表现不佳。

底线呢？未能充分规划有状态应用程序的存储需求意味着由于不可靠的性能而导致的收入减少，以及由于维护和消防而导致的成本增加。

## 从一开始就计划好呢？

没有一个开发人员希望做出特别的设计决策，基础设施团队也是如此。有一些因素会使开发项目变得更加即兴，尤其是在 Kubernetes 上使用有状态应用程序的时候。

这主要是因为预生产和生产环境通常完全是另一个团队的责任。一切都可能在开发环境中计划好了，但是生产的新需求可能会妨碍工作。因为有状态应用程序存储解决方案就是这样一个需求，所以开发人员尽早与他们的平台经理合作是很重要的，即使存储在开发过程中不是问题。

当从一开始就咨询平台经理时，开发人员可以计划他们的应用程序在整个生命周期中将依赖哪些解决方案。正如开发人员在项目开始时选择他们喜欢的网络插件一样，他们也可以确定一个满足他们需求的存储插件。

这样，开发人员就不会发现他们没有合适的依赖项或环境配置。他们可以选择一个依赖关系符合项目要求的存储解决方案，或者更好的是，他们可以选择一个平台无关的解决方案，如 Ondat。

此外，一旦开发人员开始研究整合存储解决方案来支持他们的有状态应用程序，他们可能会发现规划这样的解决方案比他们想象的要容易。为了支持基于容器的部署的独特需求，许多应用程序和组件都可以作为 [Kubernetes 操作符](https://storageos.com/using-the-rabbitmq-kubernetes-operator-with-persistent-data)使用。这些运营商通常包括存储解决方案的集成挂钩。

## 尽早评估有状态应用的解决方案

知道有必要规划应用程序的存储需求以避免最后一刻的延迟仅仅是个开始。一旦你开始研究不同的存储解决方案，能够对它们进行评估是很重要的。

由于存储经常超出开发人员的权限，我们委托了一项研究来帮助开发人员评估四个顶级的基于 Kubernetes 的云原生存储解决方案。如果你刚刚开始计划你的有状态应用程序开发项目，[我们强烈推荐你去看看。](https://info.ondat.io/the-new-stack)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>