# 易贝如何借助敏捷代码库转向苹果芯片

> 原文：<https://thenewstack.io/how-ebay-pivoted-to-apple-silicon-with-the-help-of-an-agile-code-base/>

[](https://www.linkedin.com/in/wyattawebb/)

 [怀亚特·韦伯

Wyatt Webb 领导着易贝的移动架构团队，该团队设计并构建了支持易贝 Android 和 iOS 应用的基础代码。十五年来，他一直在为各种类型的移动设备开发软件。](https://www.linkedin.com/in/wyattawebb/) [](https://www.linkedin.com/in/wyattawebb/)

作为最早的电子商务网站和最早推出 iPhone 应用程序的公司之一，易贝的本地代码库——包括我们的 iOS 和 Android 应用程序——已经发展和演变了超过 13 年。但它仍然足够灵活，能够迅速将最新功能融入应用程序。

该堆栈跨越不同地理位置的不同市场，既庞大又复杂。多年来，我们的易贝团队一直在寻找方法跟上不断变化的技术形势，并提供无缝的移动客户体验。我们如何创建一个足够灵活和适应性强的堆栈来支持持续的顶级应用？我会在这篇文章中解释。

## 创建敏捷代码库

在[易贝](https://tech.ebayinc.com/?utm_content=inline-mention)，移动架构团队负责规划和构建我们本地移动应用的基础代码。我们工作的一部分就是试着观察地平线，看看谷歌和苹果的发展方向，这样易贝就能在新技术出现时最好地利用它们。

易贝在科技领域的任期教会了我们如何让我们的代码库尽可能灵活——通过在有意义的地方共享代码，并在整个应用程序中保持架构的一致性。对于共享代码，我们将更改隔离到一个位置，可以在整个应用程序中快速验证和查看，而无需对每个部分进行太多干预。例如，在我们的应用程序中使用共享用户界面(UI)组件库使我们能够在 2020 年很快采用[黑暗模式](https://tech.ebayinc.com/product/dark-mode-now-live-on-ebay-native-apps/)。在我们的竞争对手和行业同行中，我们是最早支持这一功能的公司之一。

在共享代码不可行的地方，构建和维护一致的架构有助于促进未来的规划。当一个应用程序像易贝一样在不断的开发中生存，架构模式会改变，分歧会发生。努力避免代码发展到同时使用两到三种不同架构模式的状态。由于旧代码和新代码必须通过翻译层进行修补，这种情况使得在不更新应用程序旧部分的情况下采用广泛的新功能变得更加困难。

最后，采用新技术意味着跟上新技术——这听起来有些重复，但这意味着有一个不断采用的模型。你不能等到一个改变游戏规则的新特性在开发者大会上宣布；你需要花时间打好基础。新发布的版本可能会假设您已经跟上了更早的(但可能更普通的)更新。如果你因为没有直接的感知价值而忽略了技术 A 和 B，当技术 C 被大张旗鼓地宣布时，你将有很多工作要做(依赖于 A 和 B)。不过，这里有一点预测:你需要成为你的平台的学生，认识到更新的方向，并对它们下一步的走向做出有根据的猜测。然后，你可以决定在哪里下注，并为以后的回报花费时间。

## 案例研究:苹果硅

例如，当我们选择支持苹果芯片时，我们为支持我们的 iOS 应用程序中的 iPad 多任务处理所做的改装最近获得了回报。多任务处理允许我们的客户在创建列表时进行比较购物或参考外部信息，易贝很高兴支持这种体验，尽管这对我们的任何主要计划或功能都不是必需的。然而，对于每天从事代码工作的架构师来说，很明显，苹果正在为一些重大变化奠定基础——对易贝来说，与这些升级保持同步很重要。

在幕后，支持多任务需要易贝的代码停止假设屏幕尺寸在任何给定的设备上都是恒定的。在过去，一个应用程序可以在启动时检查它是否在 iPhone 或 iPad 上，然后不加改变地相应运行。然而，这个模型假设用户不能调整窗口大小。随着设备尺寸的增加和使用模式的改变，苹果引入了尺寸等级的概念 iPhone 被认为是“紧凑型”宽度，而 iPad 则是“常规”宽度。这使得开发人员可以通过粗略的设备尺寸来相对描述布局。此外，增加了对运行时发生的大小级别变化的支持。因此，易贝的代码必须进化，以减少对实际设备的依赖，而更多地依赖大小等级；以及在任何时候对大小级别的变化作出反应。这不是一个简单的变化，但它使整个应用程序更加灵活。虽然这些变化主要是为多任务服务，但我们也在为未来做规划。

有兴趣在易贝发展事业吗？我们在招人！请[看看](http://ebay.to/Careers)我们目前的职位空缺。

今年夏天，当苹果在 2020 年 6 月的苹果全球开发者大会上宣布他们的苹果芯片计划时，实施多任务处理并为重大变化做好准备获得了回报。通过在台式机和笔记本电脑 Mac 上使用自己的芯片，苹果能够在 Mac 和 iOS 产品线之间共享 CPU 架构。随之而来的是一个非常有趣的想法:几乎不做任何改变就能在 MAC 电脑上运行 iOS 应用程序。

现在，这和多任务有什么关系？这种在台式机和笔记本电脑上运行 iOS 应用的能力正是我们无法准确预测的未来技术，但我们易贝希望在它到来时加以利用。如果没有多任务处理，易贝的应用程序将适用于这些新机器，但窗口大小将固定为 iPad 的大小——在现代显示器上，感觉相对较小。这会让应用程序感觉不灵活，用处不大。但由于移动架构团队已经解决了多任务处理问题，易贝的 iOS 应用用户可以在新的 Mac 电脑上调整窗口大小，并利用额外的屏幕尺寸。

移动架构团队能够在预发布的苹果芯片机器上非常快速地评估易贝的应用，进行一些小的更改，然后在年底批准苹果芯片的 iOS 应用的分发。发布这个版本的成本很小，而更多地了解我们的客户的机会将会很大。

## 展望未来

在更大的工作空间上调整应用程序的能力已经激起了我们设计团队的兴趣，他们正在扩展易贝的平板电脑/iPad 设计，以适应更大的屏幕；并且也开始考虑易贝的应用程序在多窗口下会是什么样子。让买家和卖家在 Mac 上试用该应用程序将有助于我们更好地了解他们的偏好，以及他们如何在 Mac 上使用额外的屏幕空间。这些见解将帮助易贝现代化我们的用户界面设计和功能采用。如果这样做有好处的话，甚至有可能在这些更大的显示屏上为用户添加 iPhones 上没有的功能。简单地支持多任务已经为将来的研究和可能的创新开辟了许多途径。

好的架构的一部分是规划未来，即使未来受到平台供应商的影响。我们在易贝为我们在 App Store 的高评分感到非常自豪(在撰写本文时为 4.8 分！).我们的客户期望一个稳定的、功能丰富的应用程序，采用易贝平台供应商发布的新技术。这是我们发展过程中的一个重要部分，以一种永远不会让我们远远落后的方式继续建设，并允许我们在时机成熟时快速转向。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>