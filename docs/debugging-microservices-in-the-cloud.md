# 调试云中的微服务

> 原文：<https://thenewstack.io/debugging-microservices-in-the-cloud/>

[桑德拉](https://www.thundra.io/)赞助了这篇文章。

 [埃姆拉·萨姆丹

艾姆拉是桑德拉公司的产品副总裁。他热衷于无服务器、可观测性和混沌工程。](https://www.linkedin.com/in/emrahsamdan/) 

微服务作为一种将应用程序设计为可独立部署的服务套件的软件架构，已经迅速普及。

不像传统的[单片系统](https://www.tutorialspoint.com/monolithic-system-architecture)，其中一个模块的错误可能导致整个应用程序失败，微服务系统使用隔离的模块和独立运行的服务。这使得开发人员可以更加灵活地编辑代码，而不必担心影响独立的模块。如果错误被意外引入，它只会影响特定的微服务。

尽管微服务有很多好处，但在调试时，它们也带来了独特的挑战。在本文中，我们将探索开发人员可以用来应对这些挑战的方法。如果你想阅读我们对这个话题的深入探索，你可以在这里下载[我们的免费指南](https://www.thundra.io/guide/a-comprehensive-guide-on-debugging-microservices)。

## 调试微服务的挑战

微服务的本质使得调试变得棘手:环境的复杂性、基础设施的不透明性以及从开发到生产的过渡和扩展都可能带来问题。

### 在复杂环境中重新创建状态

因为应用程序的状态不是整合在一个单一的系统中，而是分散在许多不同的微服务中，所以很难清楚地了解系统的状态。微服务系统趋于变得更加复杂。随着更多组件的加入，一个复杂的网络发展起来了:每个模块独立运行，可能会失败而不影响其他模块。此外，每个服务可以用不同的语言编写，以不同的方式记录，并且完全独立于其他服务。

### 缺乏可观察性和可追踪性

随着微服务和无服务器模式的兴起，基础架构很快变得更加难以理解。每个模块、每个无服务器调用和每个云组件都进一步隐藏了幕后发生的事情。这使得[可观察性和跟踪](https://www.thundra.io/whitepaper/serverless-observability-the-ultimate-guide)变得困难，因为开发人员通常无法根据输出检测微服务系统的内部状态。因为微服务是独立运行的，所以很难在异步模块之间跟踪用户请求并重现错误。因为每个请求可能采用不同的路径，所以也很难检测哪些服务进行了交互。所有这些因素意味着开发人员很难找到错误的根本原因。

### 从开发到生产的不一致性

最后，当将代码从开发转移到生产时，状态和性能问题可能是不可预测的，并且难以复制。即使在单元和集成测试之后，当在分布式服务器上处理数百万个请求时，也很难预测代码会做什么。如果代码伸缩性很差，或者底层数据库无法处理生产中的大量请求，那么可能会出现大量的潜在故障，从而很难判断是哪段代码或数据库导致了问题。

## 传统调试方法

已经为整体代码开发了许多调试技术，在这种情况下跟踪请求相对容易。其中包括:

### APM 解决方案

应用程序性能管理(APM)解决方案帮助开发团队诊断性能问题，并准确检测问题发生的位置。他们还可以经常解析 web 服务器日志，以计算传入的请求数量，监控错误率，确定速度下降，并跟踪关键的应用程序依赖关系，以便您的团队知道在出现错误时到哪里去寻找。

### 日志分析器

第三方日志分析器通过分解和处理日志、检测哪里出现了 bug 或其他问题、提供性能仪表板以及将 bug 直接归档到 Git 存储库中来节省时间。在请求与单个系统交互的整体系统中，它们很有帮助。然而，对于微服务，通过日志来管理和跟踪请求要困难得多。

### 调试垃圾箱

在日志分析器和现代错误消息处理出现之前，开发人员通常依赖于整个系统中发生错误的内存转储。这个过程需要通读消息以查明错误的来源。然而，由于转储只显示错误发生时的内存状态，这浪费了大量时间，而且并不总能揭示根本原因。

### 停止代码的断点

在开发过程中，断点让开发人员可以查看应用程序状态的变化，并跟踪出了什么问题。然而，仅仅为了检查变量而用断点停止实时生产代码是不可行的——这使得这种方法对于生产来说太具侵入性，并且不能为开发人员提供他们需要的信息来找到问题的根源。

## 微服务调试方法

虽然上面的单片调试方法不太适用，但也开发了一些特定于微服务的方法，包括:

### 不间断、非侵入式选项

第三方工具允许您的团队设置断点，而不像标准调试器那样实际暂停或中止执行。然后，他们可以在执行过程中查看堆栈跟踪和全局变量，以及单个监视变量。这使得开发人员能够非侵入性地测试关于问题发生在哪里的假设，而无需暂停代码或重新部署/重新启动他们的代码库。

### 代码的可观察性

跟踪通过日益复杂的系统的请求是微服务系统的一个主要问题，创建定制的可观察性平台将消耗宝贵的开发时间和资源。幸运的是，现代第三方工具可以跟踪请求，并为微服务提供代码可观察性，以及无服务器和分布式计算。例如，使用桑德拉，您可以观察用户请求在生产环境中复杂的基础设施中的移动。通过让您在请求级别观察您的编码环境中发生了什么，这些工具帮助开发人员快速而容易地查明 bug。

### 自主异常捕获

在生产环境中调试的一部分是首先意识到存在问题。当异常发生时，自动捕获和跟踪异常的系统可以识别不经常发生的模式或重复的不良行为；例如由于特定浏览器版本引起的错误、每 30 次点击就会出现奇怪的堆栈溢出，甚至是夏令时或闰年错误。

捕捉错误是不够的。一个同时跟踪日志和变量以证明错误何时发生的系统可以帮助您的团队轻松地复制它。无论您是否使用微服务，自动跟踪和识别模式的能力都可以极大地简化生产中的调试。

## 用桑德拉调试

调试微服务不一定很难。桑德拉旨在帮助您在无服务器和微服务架构中轻松调试代码。通过实时调试，开发人员可以暂停并从他们自己的 IDE 中播放 Lambda 调用[，而离线调试(“时间旅行”调试)允许开发人员在执行完成后的几分钟、几小时和几天内逐步执行代码，以更好地理解其流程并检测意外行为。](https://blog.thundra.io/debugging-aws-lambda-functions-with-thundra)

为了更好地观察，桑德拉的调试器关联了可追溯性的所有三个组成部分:踪迹、度量和日志。例如，桑德拉提供跟踪，为整个微服务系统中的请求提供端到端可见性，以帮助检测 bug、[瓶颈](https://smartbear.com/blog/collaborate/identify-performance-bottlenecks-in-your-source-co/)和其他异常。

桑德拉甚至允许您深入特定请求以访问变量值，找出涉及的微服务，并关联关于跟踪和日志、日志和指标的类似信息——或所有三者。然后，您的团队可以反向工作，快速、非侵入性地识别生产中的 bug 的根本原因。

桑德拉的调试功能目前正在开发中，以帮助在任何阶段调试任何类型的应用程序。开发人员将很快能够使用桑德拉在代码上设置跟踪点，并拍摄与生成的跟踪相集成的快照，从而将调试时间从几小时减少到几分钟，无论是在将更改推向生产之前还是之后。你现在就可以[和桑德拉助手](https://thundra.io/sign-up)签约，马上开始调试微服务。

## 调试云应用并不一定很难

调试一直是一门复杂的艺术，在现代微服务的今天更是如此。跟踪请求和预测代码将如何扩展并不简单。加上生产调试的挑战，任务变得更加艰巨——但不是不可能，有了现代工具，工作变得更容易。

像桑德拉这样的第三方工具有助于跟踪请求并提高可观察性。它们还提供生产断点，并将日志与指标和[跟踪](https://blog.thundra.io/fine-grain-tracing-with-thundra)相关联。

微服务架构让您能够更快速地部署和轻松地进行转换。使用正确的工具，调试的挑战不应该超过这些优势。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>