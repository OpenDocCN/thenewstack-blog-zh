# TLS 令牌绑定标准在 Web 上获得了立足点

> 原文：<https://thenewstack.io/tls-token-binding-standard-gains-a-foothold-on-the-web/>

令牌绑定是 TLS(用于 https 连接的安全协议)的扩展，可提供更强的 web 身份验证和更长、更健壮的会话。它是 FIDO2 和 W3C WebAuthentication 标准的基础之一，用于超越密码的身份选项——它在 Chrome 中被否决，因为它即将成为互联网工程任务组的 RFC。

令牌绑定取代了 OAuth 2.0 的“不记名”令牌[——在中间攻击中，这些令牌可能会丢失、被盗、被拦截、被代理、重放或被人为更改，因为拥有令牌的人可以获得它解锁的资源——用绑定到客户端和服务器的加密证书](https://tools.ietf.org/html/rfc6750)的[令牌。](https://medium.facilelogin.com/oauth-2-0-token-binding-e84cbb2e60)

这就像用现金支付(任何人都可以花，即使他们偷了它或在街上找到它)和你必须用签名或 PIN 证明属于你的信用卡之间的区别。

代币绑定背后的想法是“拥有的证明”,并使其更难伪造，因此将代币保留更长时间是安全的。Okta 产品架构师 Tom Abbott 向新堆栈解释道:“代币面临的挑战是，它们的安全性取决于你把它们存放在哪里。“当前的 web 应用程序要么使用 HTML5 Web 存储，要么使用 cookies 来存储令牌。这两种方法都有各自的问题，包括容易受到中间人、令牌导出和重放攻击的攻击。”

Windows 身份和安全团队的产品经理 Steve Syfuhs[告诉我们，令牌绑定使用加密密钥对，理想情况下，使用安全存储来解决这个问题。](https://github.com/SteveSyfuhs)

“通过令牌绑定，有一个密钥存在于您的设备上，只有设备才能看到它；在某些情况下，甚至用户看不到它，所以它是受保护的，恶意软件不能得到它。当您的浏览器或 http 客户端与服务建立 TLS 连接并进行 TLS 协商时，客户端会说“我支持令牌绑定”,服务器会说“好的，这里有一个值，我希望您签名”。客户端用密钥对其进行签名，并发送签名值和密钥的公钥。然后服务器可以看到你已经签名了。每当我需要你证明你已经签名时，我可以传递这个值，并把它放在 OAuth 令牌和 cookies 等中，这样我就可以不断地验证它。”

这意味着，每当服务器需要证明您的连接来自同一台设备时，它可以比较签名值，以查看它是否来自同一个密钥。这防止了代币的横向移动。“这是针对每个设备、每个用户、每个应用程序的，”Syfuhs 解释道；“因此，它在我的设备上，为我的用户、我的应用程序(无论是 Windows 应用程序还是我的 Edge 浏览器)以及我与之对话的领域服务。当我与 Google.com 对话时，它将拥有与 Bing.com 不同的密钥。同一设备上的另一个用户不能窃取它，如果你在不同的设备上，服务器将协商不同的密钥。

使用令牌绑定，中间人攻击无法转发请求或重放凭证，因为他们无法证明他们拥有绑定到令牌的密钥。Syfuhs 指出，“他们可以把它从标题中去掉，但服务器会说‘它不在那里，所以我不信任这个令牌’”。“令牌绑定可以保护会话 cookies、OAuth 访问和刷新令牌或 OpenID 连接 ID 令牌，因此它们不能在发出它们的客户端特定 TLS 上下文之外重复使用。

这大大降低了窃取 cookie 的恶意软件对设备或漏洞(如开放重定向和跨站脚本)的影响；这并没有使攻击变得不可能，但这意味着它们不再便宜或容易。

开发者可以选择服务器如何处理没有绑定令牌的连接；也许设置较短的会话超时或强制新的登录。Syfuhs 告诉我们，微软用它来延长会话的寿命，而不会为了用户的方便而放弃安全性。“在某个时候，我们证明，回到登录点，这是同一设备上的同一连接，没有人代理或中间人。如果你登录到 Office 365，而不是会话生存期为 15 分钟或 1 小时，并不断进行后台轮询以确保你登录，我们可以将其延长到 8 或 12 小时，以匹配你的工作日。”

这也可以提高服务器带宽或设备电池寿命，这取决于后台轮询的数量。Syfuhs 建议说:“如果你想减少用电量或网络带宽，使用令牌绑定是一种既能保证会话安全又能减少开销的方法。”

## 准备好了吗

令牌绑定协议已经开发了几年，在谷歌、微软和 Paypal 的帮助下，该提案草案即将在 IETF 上获得批准(最终编辑工作于 7 月开始)，身份生态系统已经开始在此基础上构建。

令牌绑定从 2015 开始就在 Windows 10 [中，在 Edge 浏览器和平台中(所以任何 Windows 应用都可以利用它)，在 Windows Server 2016 中默认开启。自 1803 年发布 Windows 10(2018 年 4 月发布)以来，微软一直在一项名为云凭据保护(Cloud Credential Guard)的功能中使用它，该功能保护 Azure Active Directory 凭据，包括组织通过 AAD 管理的云服务的单点登录凭据(可能是 Twitter to Box、Salesforce 或](https://docs.microsoft.com/en-us/windows-server/security/token-binding/introducing-token-binding) [Google Apps](https://docs.microsoft.com/en-gb/azure/active-directory/manage-apps/what-is-single-sign-on) )。

Syfuhs 告诉我们，令牌绑定用于所有使用支持 AAD SSO 功能的 Web 身份验证管理器对 Azure 的身份验证，因此这包括企业用户登录他们的 Windows 帐户，密钥存储在隔离的 VM 和 TPM 中，由 Key Guard 服务提供。这将很快包括任何与 Azure AD 的浏览器连接，如连接到 Office 365 或 SharePoint。令牌绑定也支持联合身份，ADFS 也支持它。

正在开发的 [W3C Web 认证(WebAuthN)标准](https://www.w3.org/TR/webauthn/)使用 MFA 和无密码或生物认证(如 Windows Hello 或 Yubikey)将依赖令牌绑定来避免中间人攻击。

Yubico、Ping Identity 和微软正在制定一个规范，为 OpenID Connect 添加令牌绑定支持，最新的 OAuth 2 最佳实践文档推荐使用令牌绑定。需要满足 AAL3 认证的 NIST-800-63C 要求的政府和金融系统，如果他们想要用户浏览器认证而不是智能卡，将需要类似令牌绑定的东西用于身份保证。Dropbox 和 Oracle 一直在研究使用令牌绑定，Gluu 的开源身份和访问管理系统将在第 4 版中支持令牌绑定(定于 2019 年初推出)。

几年前，谷歌开始为 YouTube 等一些服务开启令牌绑定，尽管它在 Chrome 浏览器中落后于一个标志(当其令牌绑定实现出现错误时，这给 Edge 用户带来了一些问题)。但在 8 月初，Chrome 团队宣布该功能将在下一版本的浏览器中被否决，并且在 Chrome 71 中完全取消[。](https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/OkdLUyYmY1E/discussion)

谷歌给出的删除原因之一是缺乏兴趣和采用。部分问题可能是 web 和 IETF 开发的不同时间表，因为许多大型组织，如默克、HPE 和 Oath，一直计划采用令牌绑定，并等待它成为 IETF RFC。

但是谷歌也提到了[“网络兼容性风险”](https://groups.google.com/a/chromium.org/d/msg/blink-dev/OkdLUyYmY1E/NkUxgF27DAAJ)，其中包括扩展不工作和开发者工具崩溃。阿博特暗示，可能还有更根本的问题。

显然，向它们添加密钥和绑定令牌对客户机和服务器来说是一件额外的工作，这意味着第一次 TLS 连接需要额外的往返。Cookies 不能共享(这是一个安全优势，开发者可能会认为这是一个不便)。代理也变得有问题；服务器可以看到令牌绑定是否丢失，但这并不明显，如果这是恶意的，或者只是代理剥离了令牌绑定，或者代理可能只是断开连接。

Abbott 告诉我们:“通过将令牌安全(例如，应用程序或 API 层)绑定到网络层，TLS 的任何未来更改都将影响应用程序，从而使 OSI 层之间的基础更改在未来变得更加困难。”。

如果 Chrome 不支持令牌绑定，它就不会消失；微软和 Yubico 都致力于此，并且确实需要提高令牌的安全性(毕竟，Google 是令牌绑定规范的最初贡献者之一)。但是打算依赖令牌绑定的开发人员可能会感到沮丧。

虽然企业开发人员可以指定 Edge 来获得令牌绑定，但 web 开发人员通常不能依赖 Edge 的可用性。如果有一种全新的方法，而不仅仅是更新令牌绑定协议来解决谷歌提出的兼容性问题，标准小组，特别是 WebAuthn 小组，将必须做大量的工作来找到一种新的解决方案来保护令牌。这意味着更多的延迟，以及一个支离破碎的网络平台。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>