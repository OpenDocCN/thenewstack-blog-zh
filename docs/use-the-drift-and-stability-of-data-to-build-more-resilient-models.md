# 利用数据的漂移和稳定性建立更具弹性的模型

> 原文：<https://thenewstack.io/use-the-drift-and-stability-of-data-to-build-more-resilient-models/>

[](https://www.linkedin.com/in/anindya-datta-b61476/)

 [阿宁迪亚达塔

阿宁迪亚达塔是领先的技术专家和创新者，在一流的大规模数据管理解决方案、人工智能和互联网技术方面做出了核心贡献。作为 Mobilewalla 的创始人、首席执行官和董事长，Anindya 将业界最强大的数据集与深厚的人工智能和数据科学专业知识相结合，帮助企业更好地理解、建模和预测消费者行为。](https://www.linkedin.com/in/anindya-datta-b61476/) [](https://www.linkedin.com/in/anindya-datta-b61476/)

在构建预测模型时，通过曲线下面积(AUC)等指标衡量的模型准确性传统上是模型设计和可操作化的主要驱动因素。虽然这导致了在训练和测试时的高保真模型构造，但是生产中的性能经常降低，产生的结果比预期的差得多。

随着[机器学习](https://thenewstack.io/category/machine-learning/) (ML)在组织内的成熟，弹性通常会取代原始的预测准确性，成为操作模型的定义标准。越来越多的 ML 实践者倾向于操作性能良好的、可预测的生产模型，而不是那些在测试时表现出高性能，但在部署时并不完全兑现承诺的模型。这种对弹性模型的偏好可以从 [Unite.ai、](https://www.unite.ai/resilience-accuracy-why-model-resilience-should-be-the-true-metric-for-operationalizing-models/) [Rapidminer](https://rapidminer.com/blog/model-accuracy-you-need-resilient-models/) 、[卡内基梅隆大学软件工程学院](https://insights.sei.cmu.edu/blog/measuring-resilience-in-artificial-intelligence-and-machine-learning-systems/)和[走向数据科学](https://towardsdatascience.com/ai-in-the-time-of-corona-c6d3193fada8)的文章中得到证明，但是我们如何实现这一点呢？

## 数据漂移和稳定性

在生产中模型的行为与训练和测试时不同的许多原因中，最重要和最常观察到的原因之一是锚定它们的数据的属性的变化。用于创建模型训练所依据的要素的原始数据与部署中驱动模型的数据不同，这种现象称为数据漂移。当现实世界中的环境以意想不到和计划不到的方式改变数据时，就会发生数据漂移，这可以说是非弹性模型的主要原因。

## 明面上的救援，有点

漂移对模型弹性的影响是众所周知的，但是现有的减轻这种影响的解决方案仅表现出适度的有效性。实际上，今天每个企业 ML 软件工具包都包括确定数据漂移的机制，表现为漂移函数，如:drift_pkg(distribution1，distribution2) à {Drift_Metric}

大型云提供商也在其 ML 产品套件中提供了数据漂移报告；比如微软 Azure 机器学习的[数据集监视器](https://docs.microsoft.com/en-us/azure/machine-learning/how-to-monitor-datasets)，以及[亚马逊网络服务](https://aws.amazon.com/?utm_content=inline-mention)，SageMaker 的[模型监视器](https://aws.amazon.com/sagemaker/model-monitor/)。

这些都是有用的工具，但是它们最大的缺点是它们是被动的。当部署的模型行为不当时，这些工具被调用来检查漂移，揭示输入到表现不佳的模型的数据与用于训练它的数据如何不同。如果检测到漂移，模型被校正(主要通过再训练)。

## 向弹性模型发展，而不是被动工具

修正是好的，也是必要的，但它没有解决最关键的 ML 工程问题——我们如何从一开始就建立有弹性的 ML 模型？实现弹性意味着构建具有可预测行为的模型，并且很少出现不当行为。如果没有弹性，操作化 ML 模型将仍然是一个主要的挑战——建模者将继续构建在生产中表现不佳的模型，需要频繁的修正。对重新设计这些模型的持续需求将提出关于 ML/AI 的操作效用的组织问题。

我认为，现在是时候重新考虑如何在 ML 工作流中使用漂移，并设想新的方法来将漂移纳入模型建立工作流，以防止而不是应对模型的不当行为。为此，我们引入了数据稳定性的概念。

## 优先考虑数据稳定性

数据漂移表示目标数据集与源数据集的不同之处。对于时间序列数据(为 ML 模型提供动力的最常见的数据形式)，漂移是对两个不同时间点的数据“距离”的度量。关键要点是，漂移是数据距离的一个单一或点的度量。

我们认为弹性模型应该由随时间推移表现出低漂移的数据驱动——根据定义，这样的模型将表现出较少的数据诱导的不当行为。为了证明这一特性，即随时间漂移，我们引入了数据稳定性的概念。虽然漂移是一种点测量，但稳定性是一种纵向度量。稳定的数据很少随时间漂移，而不稳定的数据则相反。我们在下面提供额外的颜色。

考虑两个不同的属性:纽约市 11 月的每日温度分布(TEMPNovNYC)和公共机场的飞机皮重分布(AIRKG)。很容易看出 TEMPNovNYC 的漂移比 AIRKG 低；人们可能会认为，纽约市不同年份 11 月气温之间的差异比两个机场飞机重量之间的差异要小(比较一下 JFK 机场的大型飞机和阿拉巴马州蒙哥马利等较小机场的大型飞机)。在这个例子中，TEMPNovNYC 作为一个属性比 AIRKG 更稳定。

数据稳定性虽然在概念上很简单，但可以作为构建弹性模型的强大工具。为了看到这一点，考虑以下 ML 中数据流的简单表达式:

数据+特征+模型

被吸收到建模工作流中的基础数据被转换以产生特征，然后这些特征被馈送到模型中。稳定的数据元素可能会导致稳定的特征，而稳定的特征可能会为稳定的(或有弹性的)模型提供动力。让我们假设稳定性值的范围— 0、1、2、3、4，其中 0 表示“不稳定”，4 表示“高度稳定”，每个数据属性都可以分配一个稳定性值。这些任务在特性工程过程中提供给建模者，帮助他们构建特性，进而构建具有已知稳定性特征的模型。了解每个输入属性的稳定性后，建模者将选择稳定的数据元素，同时避免不稳定的数据元素，以构建稳定的要素，这反过来将为弹性模型提供动力。假设建模者故意选择不太稳定的数据来构建特征；会提醒 MLOPs 下游模型(即使用此功能作为输入的模型)需要比其他模型更密切地监控。MLOps 现在可以预测而不是反应。

## 心态的改变，方法的改变

我意识到这是对现存方法论的实质性背离。当前用于特征构建和模型构建的数据管道并未将特定数据项的“漂移”程度或数据稳定性的概念考虑在内。相反，它是一个特别的过程，主要由建模者的直觉和专业知识驱动，结合了分析程序(如探索性数据分析或 EDA)，其主要目标是为建模者提供对单个数据和特征的预测能力的见解。构建并最终使用要素的主要原因是其对模型准确性的贡献。正如我们现在所知，这种方法的显著缺点是，模型测试中显示的高预测性并不总是转化为生产，这通常是由与训练和测试中确定的不同的数据属性驱动的。因此，不稳定的模型。

根据我的经验，是时候采用基于数据稳定性的方法了。建模者不需要牺牲预测能力(即模型准确性)，但应该能够权衡模型准确性和稳定性，构建具有可预测行为的弹性、“足够准确”的模型。

## 进化的时间到了

为了体现这种方法，需要解决的最后一个技术挑战是 ML 工具集，包括漂移计算包，需要适应测量数据的稳定性。

在我们前面的 TEMPNYC 和 AIRKG 分析的例子中，属性的简单语义使它变得很容易——建模者可以直观地估计稳定性。然而，在现实世界中，摄取的数据和从中创建的要素都具有复杂、微妙的语义，无法进行直观的评估。这里，漂移的点估计可能会误导建模者。为了理解数据稳定性，我们需要纵向捕捉漂移，并从数学上确定分布特性的长期变化。现有的工具不能自然地实现这一点。

有人可能会说，点漂移度量可以通过重复的显式调用来实现这一目标，但这将需要复杂的工作区，而不是在 ML 工具集中得到本地支持。它最终会产生在现实世界中不切实际的潜在问题。

在 [Mobilewalla](https://www.mobilewalla.com/) 我们有一个专门的数据科学家团队，处理世界上最大的数据集之一。我们还与全球一些使用我们解决方案的最成熟的数据科学团队合作。我们亲眼目睹了漂移和稳定性给模型带来的挑战，并构建了自己的解决方案来应对这些挑战。

Anovos 是我们开发的一个开源项目，通过引入数据稳定性优先的概念，解决了预测建模工作流程的特征工程组件中的一些核心低效问题。它是为扩展而构建的，使用户能够使用 TB 级而不是 GB 级的数据进行工程设计，其核心是数据漂移和稳定性。今天就从 anovos.ai 开始，加入我们在 [MLOps 社区 Slack](https://go.mlops.community/slack) 的#oss-anovos 频道。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>