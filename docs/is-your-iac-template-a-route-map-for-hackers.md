# 你的 IaC 模板是黑客的路线图吗？

> 原文：<https://thenewstack.io/is-your-iac-template-a-route-map-for-hackers/>

网络攻击者看待事物的方式与我们不同。所以，一个被开发工程师视为代码(IaC)的简单的基础设施(T2)，一个坚定的黑客将它视为一个通往组织系统核心的路线规划者，这真的有什么好惊讶的吗？

根据 Prisma Cloud bridge crew 的开发者倡导者[马特·约翰逊](https://www.linkedin.com/in/mattjohnsonuk)的说法，使用像 [AWS](https://aws.amazon.com/?utm_content=inline-mention) CloudFormation 或开源 Terraform 这样的工具来编码基础设施意味着你最终拥有可重用的基础设施定义——这在构建、部署和管理复杂系统时是一个巨大的好处。

问题是，这些定义可能包括错误配置、安全缺陷，甚至硬编码的凭证，每次使用该代码时，这些凭证都将被回收和重新部署。

此外，正如 Johnson 告诉 New Stack 的那样，“如果开发人员需要做一些事情，他们会求助于 Google，他们会找到关于 Stack Exchange 或 Stack Overflow 的解决方案，然后复制并粘贴到他们的代码库中。”这意味着其他人的错误配置和弱点现在也是他们的错误配置。

这个问题部分归因于这样一个事实，即许多公开可用的 IaC 模板最初是作为示例或教程使用的，“让人们进入‘Hello World’，”正如 Johnson 所说。他补充说，如果它们是用所有相关的安全元素生产的，它们会长 100 倍，这将使它们作为学习辅助工具更不容易消化。

## “这肯定是用户问题”

[去年被](https://bridgecrew.io/) [Palo Alto Networks](https://www.paloaltonetworks.com/cloud-security?utm_content=inline-mention) 收购的安全平台公司 bridge crew,[使用其](https://bridgecrew.io/wp-content/uploads/state-of-open-source-terraform-security-2020.pdf) [Checkov 工具](https://www.checkov.io/)扫描了流行的 Terraform 注册表和[Cloud Native Computing Foundation 的](https://cncf.io/?utm_content=inline-mention) [artifacthub.io](https://artifacthub.io/) ，发现了超过 50%的模板或工件存在“重大问题”。

“事实是，你更有可能下载一个缺省不安全的基础设施作为代码，而不是缺省安全的，”Johnson 说。

重要的是要记住这个问题——以及解决这个问题的最终责任——不在于供应商。例如，Amazon Web Services 提供了工具来帮助客户检测 IaC 变化是否会导致问题，包括 AWS CloudFormation 挂钩和 AWS CloudFormation 漂移检测。

“这肯定是一个用户问题，”约翰逊说。“Terraform 或 AWS CloudFormation 不是不安全的东西。它们是一套工具，可以被使用，也可以被误用。”

但是，如果用户发现他们已经将不安全的 IaC 集成到自己的系统中，他们可能会感到震惊，当他们意识到这种代码的无处不在意味着攻击者可能会有一个直通他们系统的路线图时，他们的不适感会更高。

“如果你正在使用这些模块中的一个，”约翰逊说，“我可以确切地看到在那个模块中配置了什么和没有配置什么。”

这意味着，除了洞察可能的进入点，攻击者还可以提前规划出潜在的横向移动，确定他们下一步应该移动的优先顺序，决定要部署的最佳利用方式，并且对他们可以到达的目标有一个好的想法。

“你有越多的漏洞，你就越有可能找到一条直通的路径，”他说——而错误的配置可能会给出一条通向底层系统的直接路径。

避免公共 IaC 模板本身并不是一个解决方案。用户完全有能力添加他们自己的缺陷——即使他们当时并不是缺陷。“由于加密类型的变化，今年的安全违约明年可能会成为不安全的违约，”约翰逊指出。

## 提出 IaC 建议

devo PS——或者应该是 DevSecOps——已经通过自动化测试解决了开发人员“忘记”对代码进行安全测试的问题，并将这些测试存储为代码。因此，当谈到配置代码时，约翰逊说，显而易见的是要有自动化工具来做同样的事情。

但是“从历史上看，安全工具并不是为工程师和开发人员操作而设计的，”他补充道。"它们被设计成能被安全人员理解，他们是完全不同的一类人."

他说，还有一个障碍。扫描一个典型的现代组织的基础设施，它会识别出数百个(如果不是数千个)常见的漏洞和暴露(CVE)，并且同时识别出数百个(如果不是数千个)基础设施作为代码建议。但这可能会让开发人员不知所措，不知道应该先解决什么。

因此，挑战在于将这些信息转化为开发人员喜欢的东西，并且在不强迫开发人员离开他们的工具、环境或工作流的情况下完成。“让我们尽可能早地将这些信息浮出水面，提出有用的建议，告诉他们可以做些什么来补救，”约翰逊说。

Bridgecrew 的 Checkov 扫描并识别 IaC 代码中的错误配置，包括 CloudFormation 和 Terraform，以及其他文件类型，包括 Kubernetes 和 Docker。但随着 Palo Alto Networks 收购 Bridgecrew，该技术已被集成到 Prisma Cloud 的云原生应用程序保护平台中，这意味着 Checkov 的见解可以与其他漏洞信息一起放入更广泛的背景中。

约翰逊说:“我们一直在努力开发的一个新功能就是供应链图的概念。这构建了一个图表，其中显示了哪些 CVE 在哪些容器中，以及哪些 CVE 是由哪个基础设施作为代码部署的。"因此，我们实际上可以想象哪里有有形的攻击路径或没有."

例如，如果 CVE 运行在一个没有连接到互联网的应用程序中，那么它的优先级可能不会像运行在允许完全互联网访问的公共负载平衡器上的 CVE 那样高。

Johnson 说，这种分析需要扩展到开发者自己的工具链，这些工具链本身通常依赖于公开可用的组件:“我们看到越来越多的人试图攻击 [CI/CD](https://thenewstack.io/category/ci-cd/) 管道本身。”

毕竟，他补充道，“如果你可以将你自己的代码注入到开发者的系统中，然后让它为你进入生产环境，为什么还要尝试攻击生产环境中的某些东西呢？”

因此，Palo Alto Networks 的平台现在包括额外的检查和政策，以检查开发人员的管道是如何配置的，Johnson 说:“因为管道配置本身是编码的，我们可以通过它并说‘嘿，在有人可以合并之前，你可能应该打开至少两个内部批准。’"

很难想象开发商会退回到他们曾经工作过的围墙花园。自动化、IaC 和可重用性的好处太大了，即使其相关的危险变得越来越明显。

约翰逊说，这意味着自动化是解决这个问题的唯一途径。但这种自动化必须提醒开发人员和安全人员，让他们清楚地知道自己面临的风险，而不是简单地说不。“作为一名开发人员，”他说，“这是我想要的。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>