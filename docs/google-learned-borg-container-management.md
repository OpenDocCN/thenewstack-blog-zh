# 关于容器管理，谷歌从博格中学到了什么

> 原文：<https://thenewstack.io/google-learned-borg-container-management/>

Google 管理 Linux 容器已经超过十年了。在这段时间里，该公司已经建立了三个不同的容器管理系统， [Borg](https://thenewstack.io/google-lifts-the-veil-on-borg-revealing-apache-auroras-heritage/) 、 [Omega](https://thenewstack.io/googles-data-architecture-and-what-it-takes-to-work-at-scale/) ，以及它的最新版本， [Kubernetes](https://thenewstack.io/google-officially-launches-kubernetes-1-0-promises-to-give-you-evolution/) ，后者作为开放源代码发布供公众使用。

在构建这些系统的过程中，谷歌工程师学到了许多关于管理基于容器的架构的严酷事实。他们在构建和运行一个容器管理系统时学到的每一套经验都可以应用到下一个系统中。现在，工程师们在计算机械协会旗舰杂志《队列》的一篇论文中分享了一些经验教训。

谷歌工程师[布伦丹·伯恩斯](https://twitter.com/brendandburns)、[布莱安·葛兰特](https://www.linkedin.com/in/brian-grant-3317a6)、[大卫·奥本海默](https://research.google.com/pubs/DavidOppenheimer.html)、[埃里克·布鲁尔](https://twitter.com/eric_brewer)和[约翰·威尔克斯](https://research.google.com/pubs/JohnWilkes.html)认为，容器正在创造数据处理方式的重大范式转变。

这篇文章认为，通过将 API(应用程序编程接口)从面向机器转移到面向应用的 API(T21)，可以极大地改善应用程序的部署和监控。

## 面向应用的基础设施

容器将机器和操作系统的许多细节从应用程序环境中分离出来。通过“分离”操作系统和容器映像，系统可以看到部署可靠性和开发速度的提高。

“使这种抽象工作的关键是有一个密封的容器映像，它可以将应用程序的几乎所有依赖项封装到一个可以部署到容器中的包中，”该论文指出。

容器 API 管理不仅简化和加快了开发，还将内存和 CPU 使用等管理指标与应用程序联系起来。因此，应用程序监控有了显著的改进。

> “Kubernetes 的设计是微服务和小型控制循环的结合，是通过编排进行控制的一个例子——通过结合相互协作的独立自主实体的效果来实现所需的紧急行为。”

面向应用程序的体系结构的变化意味着现在可以更快地检测和识别应用程序故障。这种发行版使得构建、管理和调试应用程序变得更加容易。

Google 将 Kubernetes 用于在同一台机器上协同调度的嵌套容器。这种方法成功的关键是一致性。

API 在基础上的一致性创造了整个系统的简单性。编写适用于所有对象的通用工具更简单，这反过来也更容易学习，让工程师有更多时间花在编码上。映像和操作系统的分离创建了一个容器环境，其中多个组件共享一个稳定的外观。

“Kubernetes 的设计是微服务和小型控制循环的结合，是通过编排进行控制的一个例子——通过结合独立、自治的实体协作的效果来实现预期的紧急行为，”工程师们说。

他们告诫不要使用集中的编排系统。及时一针可省九针，尤其是在分散系统中。尽管分散式系统需要更长的时间来构建，但随着时间的推移，它会更加稳定，特别是在出现意外错误或状态变化时——它们总是这样。

## **做什么*不做什么*做什么**

除了找到有效的策略，他们还找到了一些无效的策略。以下是论文中的一些建议:

### **不要让容器系统管理端口号**

Borg 给集装箱分配唯一的端口号。谷歌工程师发现，这导致 DNS 等网络服务必须被本地版本取代，以处理 IP:port 对。

Kubernetes 为每个 pod 分配 IP 地址，从而使网络身份与应用程序身份保持一致，从而在使用第三方工具进行带宽调节和网络分段时具有更大的灵活性。

### 不要只是给容器编号:给它们贴上标签

用标签代替集装箱编号给了集装箱更多的灵活性。

"标签是包含帮助识别对象的信息的键/值对。一个 pod 可能有标签 role=frontend 和 stage=production，这表明该容器正在充当生产前端实例。

自动化工具或用户都可以使用标签，不同的团队可以管理他们自己的标签集。在 Kubernetes 中，标签选择器已经成为管理容器操作和跨多个实体的分组机制。

### **小心所有权**

虽然使用标签进行管理有多种价值，包括负载平衡和调试，但仔细注意配置选择以防止冲突是很重要的。例如，该文章断言“复制控制器等 pod 生命周期管理组件确定它们负责使用标签选择器的 pod，因此多个控制器可能认为它们对单个 pod 拥有管辖权。”

### **不要暴露原始状态**

Kubernetes 通过一个集中的 API 服务器强制所有的存储访问，这使得实施通用语义和管理变得容易。这隐藏了存储实现的原始状态数据。文章称，它还“为对象验证、默认和版本控制提供服务”。

这个美丽的集装箱新世界是未来的潮流。花一点时间来回顾这些经验教训可以在将来省去很多麻烦。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>