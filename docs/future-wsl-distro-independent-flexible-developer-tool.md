# 微软考虑扩展 Windows 10 以支持多个 Linux 发行版

> 原文：<https://thenewstack.io/future-wsl-distro-independent-flexible-developer-tool/>

微软对 Windows 10 的最新更新，称为 [Creator's Update](https://www.microsoft.com/en-us/windows/upcoming-features) ，标志着 Windows 子系统 for Linux (WSL)的稳定性和支持达到了一个新的水平，这是在 Windows 10 上运行 [Linux 二进制文件的方式](https://thenewstack.io/windows-10-creators-update-means-windows-subsystem-linux/)。它还带来了超越当前 Ubuntu 发行版的承诺，以支持未来的多个 Linux 发行版。

微软的 [Rich Turner](https://github.com/bitcrazed) 告诉新的堆栈，随着 Creators 的更新，WSL 已经足够好，可以成为需要使用 Linux 命令行工具和 Windows GUI 工具的开发人员的“日常驱动程序”。“我们已经到了底层平台变得相当成熟的时候，至少在主流开发人员的情况下是这样。”

但是 WSL 团队仍然有很多改进，其中一些需要在底层的 Windows 系统中进行改变。

“我们知道文件系统性能需要改进，”Turner 说。“我们希望提高磁盘 I/O 吞吐量；我们现在的磁盘 IO 性能没有达到我们的预期。在几乎所有其他方面，任何与进程或内存吞吐量有关的方面，我们实际上与 Linux 一样快，如果不是在相同的硬件上更快一点的话，”他声称。“在网络 I/O 方面，我们看起来非常好，但我们需要支持一些额外的网络套接字模式。有几个深奥的网络工具需要特殊类型的套接字支持，我们目前还做不到，所以我们正在与 Windows 网络团队合作添加这些工具。我们正在与存储和 NTFS 团队合作，为我们提供一些额外的挂钩，以便我们能够提高磁盘存储和吞吐量的效率。”

他指出，这些变化需要一些时间。“我们将在下一个版本的 Windows 中解决这些问题，在下一个版本中还会有更多。特别是文件系统的更改，我们必须非常小心，所以我们要花时间来确保它们正确完成。”

另一个让开发人员感到沮丧但也需要小心处理以确保安全模型正确的领域是网络文件访问。“例如，人们希望能够安装 NFS 驱动器、ssh 连接和 SAMBA 驱动器，以便能够连接到 Windows 网络共享。我们现在不支持任意挂载。我们可以挂载你的本地硬盘，但那是“挂载”我们希望最终能够在 Linux 本身中支持真正的挂载能力，但是我们需要编写工程和代码来实现这一点。"

WSL 也将获得更好的设备支持。“开发人员希望构建一个 Android 版本并将其部署到他们的手机上，或者他们希望部署到 Raspberry Pi 模块上，因为他们正在构建一个物联网设备。目前，我们不支持 USB 设备或串行[连接]，但我们希望最终能够添加这些功能。”

WSL 目前没有在 Windows Server 上运行，但这是另一种可能性(同样，它需要工作)。

一些请求需要更大的改变，比如能够运行持久的后台守护进程和服务，以使 cron 更有用。目前，您可以运行任何想要的后台服务——但是它们只能在 bash 控制台打开时运行。

“在运行 Bash 之前，任何 Linux 进程都不能在您的机器上运行。一旦打开 Bash，您就可以选择启动任何想要运行的后台服务。如果你想让 MySQL 或 FSH 或 ssh 或 Postgres 或 Apache 或其他什么运行，你可以手动或自动启动它们，然后用。巴什尔委员会的文件，”特纳指出。“但是一旦你关闭 Bash 控制台，我们就会拆除任何正在运行的 Linux 进程。因此，如果您关闭控制台窗口，您将无法再通过 ssh 从您的机器或任何其他地方访问您的系统。”

Canonical 的微软 Ubuntu 开发技术负责人 Dustin Kirkland 告诉新的 Stack，这是开发者会发现有用的东西。“用户不时来找我，询问有关持久守护程序的问题。终端打开时让 ssh 工作是一回事，但如果它一直运行就是另一回事了。”毕竟，“如果您正在运行一个带有网络映射的 Linux 虚拟机，那么只要它还在运行，您就可以 ssh 到该虚拟机。

特纳说，理想情况下，后台服务将像现在的进程一样与 Windows 集成。“我们希望未来能够找到一种体面的方式，让 Linux 进程作为守护程序或服务在后台运行，并且如果您愿意，能够以类似于 Windows 服务的方式在机器上自动启动。”

Canonical 还会发现持久 cron 对于更新 WSL 使用的 Ubuntu 映像非常有用。Kirkland 指出:“在传统的 Ubuntu 系统上，cron 作业每天运行一次，通常是在晚上，它进行适当的更新并获得可用软件包的列表，并且自动应用对安全至关重要的更新。”

Turner 解释说，WSL 不会出现这种情况，但 Windows 会定期获取可用更新的信息。“现在，我们有一个后台任务，每五到八天运行一次，定期 ping apt 缓存并下载 apt 包索引，因此当您开始一个新的会话时，我们可以告诉您已经安装了哪些包以及最新版本是什么，并向您显示一条消息，告诉您“嘿，您的 43 个包有点落后，您可能需要更新。”我们不会自动更新你的发行版。我们将自动更新 WSL 本身，因此我们将修补系统调用的底层实现，我们将修补我们的用户模式工具，如控制台本身，如果必要，我们将修补安装机制，但我们不会触及您的 Linux 发行版的内部。"

“为了让 Canonical 自动更新您的系统，他们需要在后台运行 cron 守护程序。一旦我们实现了后台机制，类似的事情就会发生。”

自动更新并非没有争议。“一些客户强烈认为不应该有自动更新，”他指出。“但是一些客户，尤其是企业客户强烈要求所有的 Linux 实例都必须更新到一定的补丁级别，这样如果在发行版中发现了漏洞，就会自动进行修补，不会造成问题。我们希望你拥有这两种选择，但我们必须弄清楚实现这一点的背景流程。”

Kirkland 还指出了 WSL 中网络的工作方式。“现在，网络空间是完全平坦的，所以 Windows 桌面和 Linux 外壳共享同一个 IP 地址和同一套端口。如果您试图在这两个服务器上使用同一个端口，您最终会遇到端口冲突。微软对此有一些保护措施，但这是一个有趣的考虑。通常当你考虑在一个操作系统上运行另一个操作系统时，每个操作系统都有自己的网络空间，自己的 IP 地址；可以是 NAT 或 bridge。但是试图将 TCP 栈压缩成一个单一的网络空间是很有趣的。从这个角度来看，这个团队做出了一些很好的安全决定，但这是一个需要考虑的复杂问题。”

所有这些改进的优先级取决于社区的兴趣和它们对 WSL 的贡献。特纳解释说:“所有这些都被放在堆栈上并进行优先排序，我们根据我们听到请求的频率以及我们认为该功能将在社区中产生的影响来按优先顺序删除这些内容。”。

有些请求需要做更多的工作。对 Linux 容器的支持(相对于 Windows 10 和 Windows Server 2016 内置的对 Windows 容器的 Docker 支持)是微软对 WSL 的首批请求之一。WSL 和引发这些问题的基于容器的系统在架构上有一些相似之处，但是也有一些关键的不同。

实现支持容器和名称空间所需的所有底层内核基础设施需要一些工作。这是积压，在未来的某个时候，希望我们能够考虑需要什么，”特纳说。“这是我们经常听到的事情，我们也有兴趣做，但我们必须想办法找到时间。”

## 超越 Ubuntu

目前 WSL 官方只支持 Ubuntu。非官方的，WSL 用户已经在尝试运行像 SUSE 这样的发行版；微软从这项工作中学到了很多，因为它显示了哪些系统调用需要添加或扩展。

当 WSL 的工作刚开始时，选择 Ubuntu 是因为它是最受团队咨询的开发者欢迎的发行版。Kirkland 把这归因于 Ubuntu 对大量 Linux 工具的定期更新政策。“使用 Ubuntu 的开发者选择我们是因为我们在非常及时和可预测的时间表上提供最新和最好的开源软件。我们每天在 25，000 个开源项目中的任何一个项目中进行几十次错误修复和安全更新，这些项目内置于 55，000 个二进制文件中，现在只需安装一个应用程序即可。”

Turner 说，自从 WSL 问世以来，开发人员也要求其他发行版，如 Alpine、ArchLinux、RedHat 和 SUSE，以及更专业的发行版。“我们希望这是一个与发行版无关的平台，开发人员可以在这个平台上自由地做他们需要做的事情，这样他们就可以在 Windows 代码、UWP 应用程序以及他们需要的任何东西的旁边构建他们代码的 Linux 部分，以便能够发布他们的移动桌面和云解决方案，无论这些解决方案针对的是什么技术。”

“就 WSL 而言，我们甚至不知道你运行的是什么发行版，它不知道它上面运行的是什么应用；它只是做要求它做的工作，”他指出。“本质上，WSL 只是一个内核基础设施，它提供了一个与 Linux 内核系统调用接口兼容的层。当某个东西调用它，并对它说‘打开一个文件’或‘从文件中读取’或‘打开一个网络套接字’或‘给我分配一些内存’时，它只是分配内存并把它交还。”

支持其他发行版需要改变用户模式工具，让你安装和卸载你的发行版，“因为你不希望必须用一个实例替换另一个。”但是首先 WSL 需要实现所有不同发行版中的工具所依赖的所有系统调用。

“每种风格的 Linux 都有不同的特质；他们有不同的安装程序，他们有不同的文件系统布局，一些工具有不同的配置系统…如果你运行的是 Red Hat，它可能会使用不同的 Ubuntu 安装程序，而 Red Hat 的安装程序可能会使用 Ubuntu 没有的 syscall，所以这是我们所缺少的。”

这意味着试用发行版，看看缺少哪些系统调用——或者 WSL 已经拥有的系统调用还需要哪些额外的功能。

“这将允许我们开始支持更广泛的工具集，并且我们最终将达到这样一个点，即我们可以支持 Red Hat 或 SUSE 或 CentOS 或其他数千种发行版中的一种。”

微软希望这些发行版在 WSL 上得到正式支持，但不是通过让发行版为 Windows 做额外的工作。“我们打算提供足够的基础设施，让其他发行版可以在上面运行，而不需要我们做任何事情，”Turner 说。

柯克兰对此表示欢迎；不仅仅因为 Linux 是关于选择的，还因为它将“提高 WSL 提供的系统调用的整体质量和测试”。

到那时，WSL 可能不仅仅能够运行多个 Linux 发行版——甚至能够在同一台 PC 上运行多个 Linux 发行版。这需要做很多工作才能实现，但这是一个普遍的要求，特纳可以看到对开发人员的吸引力。

“有些人在跨内部和基于云的环境的系统上工作。你可能有一个内部系统管理来自客户的信息，这个系统在 MySQL 中有一个 Redis 缓存；许多企业为此使用 RedHat 和 s use。但是当你有了这个系统的云前端，它可能会被放在运行于 Ubuntu 之上的 AWS 中。如果我必须在我的 Ubuntu 云接口上工作，我也必须在我的 RedHat 或 SUSE 后端环境上工作，那么我需要这两个环境来完成我的工作；我无法在 Ubuntu 上完成所有的工作。”

如今，这意味着至少要使用一台虚拟机，这意味着要为云服务付费，或者拥有足够强大的硬件来运行多个虚拟机。具有讽刺意味的是，因为 WSL 是 Windows 中的一个层，而不是发行版本身，它为开发人员创建一个极其灵活的平台开辟了新的可能性，这是 Linux 本身无法轻易提供的。

斯特凡·昆泽通过 [Unsplash](https://unsplash.com/?photo=BiyVuXGiF7s) 拍摄的特写图片。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>