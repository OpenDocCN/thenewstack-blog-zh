# 使用 Paketo 构建包自动生成 SBOM

> 原文：<https://thenewstack.io/automated-sbom-generation-with-paketo-buildpacks/>

生成软件材料清单(SBOM)在软件开发社区获得了很多关注。这是由于社区对使用外部依赖来设计解决方案的缺点越来越敏感。因为包含了易受攻击的开源依赖项，所以更是如此。这种弱点被称为软件供应链漏洞，是安全社区中积极研究和响应的领域。

## 什么是 SBOMs，它们来自哪里？

![](img/f73a8b661f5169c8e231e2d2a417b6fd.png)

软件开发已经有了巨大的发展。一个关键的变革性特征是使用扩展和外部模块来完成单个组件，这被流行的术语软件重用所定义。甚至今天的绿地项目也是外部库和第三方组件的混合体。启发性地说，其中很大一部分往往是开源的。

 [拉姆·艾扬格

Ram 实际上是一名工程师，本质上是一名教育家。作为一名开发人员，他被推上了技术福音传道者的道路，从此一往无前。他喜欢帮助世界各地的工程团队发现新的和创造性的工作方式。](https://www.linkedin.com/in/ramanujank/) 

此外，软件开发发生在许多迭代中，在这些迭代中，跟踪“谁在哪个模块中使用哪个组件”变得非常不可能这种创建大型集成代码库的方法降低了透明度，并极大地限制了识别风险的能力。

SBOMs 的核心是公开交流构建一个软件需要哪些组件。它大量借鉴了硬件行业，并很好地扩展了软件供应链的类比。如果正在构建的软件是由组件及其衍生产品组装而成的，那么维护一个可审计的项目列表是很自然的事情。透明度、漏洞管理和降低风险是为您的软件项目创建和维护 SBOMs 的一些直接好处。

将这些原则应用于容器图像变得越来越重要。从本质上来说，容器不容易检查或构造简单。容器映像由不同的层组成，每一层都有自己的依赖关系。

## SBOMs 长什么样？

![](img/88320684b2644ee09674e73eab541609.png)

在创建这些容器映像时，可以向它们添加元数据。使用构建过程中生成的信息将信息填充到这些元数据字段中是生成 SBOMs 的基本原则。它采用平面文件的形式，可以在审计过程中查询、组织和使用。

构建包在其生命周期中有四个典型的阶段。这些是检测、分析、构建和导出。第四个阶段是创建包括物料清单在内的最终映像，但这是在构建阶段收集元数据并将其写入文件时发生的。所有的依赖项都是从 TOML 文件中读取的，并在构建过程中使用。相应的环境变量用于生成 SBOM。

构建过程中使用的 bin/build.sh 脚本片段(来自 Ruby build pack):

```
# Adding the Bill of Materials
cat  >>  "$layersdir/launch.toml"  <<EOL
[[bom]]
name  =  "ruby"
[bom.metadata]
version  =  "$ruby_version"
EOL

```

生成的 SBOM 看起来像这样:

```
{
  "name":  "ruby",
  "metadata":  {
  "version":  "2.5.0"
  }
}

```

## 确保符合标准

![](img/7f838af6f3bffe2a099c2bd470c81c39.png)

https://xkcd.com/927

众所周知，创建上述 SBOMs 的开放方式会导致大量的竞争性格式。它们将根据消耗材料清单中的信息的每个团体的便利性来生成。SBOMs 有两种开放且相当一致的标准。这两者的共同点是作为数据交换格式的分类。

第一种是 CycloneDX 格式。它是为应用安全和软件供应链组件分析而设计的。目前使用的版本是 CycloneDX 1.3。CycloneDX 是一个厂商中立的开源项目，旨在为物料清单格式提供规范和相应的实现。CycloneDX 项目报告了跨越几个垂直行业的数千家组织的采用情况。

第二种常见格式是 SPDX。它代表软件包数据交换。它也是一个开放标准，被定义为一个关注 BOM 信息的标准，除了正在使用的软件库之外，BOM 信息还包括许可证、版权和安全性。Linux 基金会管理 SPDX 规范，现在作为 ISO/IEC 5962:2021 标准发布。

## 如何使用 Paketo 生成 SBOMs

![](img/3a9ed47caad28dc3244cb4555f645027.png)

这里有一个列表链接，展示了使用 Paketo Java Buildpack 时创建的 SBOM。现在，您应该采取以下步骤将它们应用到您的应用程序中。在接下来的教程中，我们将使用两个工具:

1.  ### 包装 CLI

这是一个由 Buildpacks 团队维护的命令行工具。这是构建容器映像所必需的。它的用途还扩展到支持其他功能，如重置基础、检查等。按照这些说明进行安装。

2.  ### 帕克托构建包

Paketo 是开放云原生构建包标准的实现。Paketo 项目采用了 CNB 规范，并提供了生产就绪的构建包，可用于为用各种语言/框架编写的应用程序构建容器映像。不需要安装。它们将根据需要从容器注册表中取出。

这里有一个来自 GitHub 的[示例代码库](https://github.com/paketo-buildpacks/samples)，你可以在本教程中使用。我们鼓励您对自己的应用程序源代码运行这个程序，以充分利用这个过程。

```
git clone https://github.com/paketo-buildpacks/samples
cd samples

```

对于示例 Java 应用程序，这里有一个要运行的命令:

```
pack build java-foo java/maven  --buildpack paketo-buildpacks/java

```

生成的图像将被命名为 java-foo，当使用 Paketo Buildpacks 时，您可以检查该图像以查看自动生成的完整材料清单。下面是要运行的命令:

```
pack inspect-image java-foo  --bom  |  jq  '.'

```

这将向您显示生成的完整软件材料清单。这里重要的一点是，在使用 Paketo Buildpacks 时，不需要额外的工作来创建这些物料清单。该标准的实现提供了一种零成本获得该功能的方法。

无论您选择哪种格式，软件材料清单对于提高任何组织的安全状况都至关重要。这是朝着更安全的软件方向迈出的重要一步。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>