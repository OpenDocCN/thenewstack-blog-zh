# 如何缓解 PwnKit 漏洞

> 原文：<https://thenewstack.io/how-to-mitigate-the-pwnkit-vulnerability/>

[](https://twitter.com/cfreemansynops1)

 [夏洛特·弗里曼

夏洛特从事科技和安全方面的写作已经超过 20 年。她目前是 Synopsys 软件完整性小组的高级安全作家。](https://twitter.com/cfreemansynops1) [](https://twitter.com/cfreemansynops1)

1 月 25 日， [Qualys 研究团队](https://blog.qualys.com/vulnerabilities-threat-research/2022/01/25/pwnkit-local-privilege-escalation-vulnerability-discovered-in-polkits-pkexec-cve-2021-4034)公开披露了 PolKit (pkexec)中的一个内存损坏漏洞，这是一个包含在每个主要 Linux 发行版中的组件。该漏洞被称为 PwnKit，现在被追踪为 CVE-2021-4034。

PolKit 为非特权进程提供了与特权进程交互的方法，是主要 Linux 发行版和一些类 UNIX 操作系统中使用的流行组件，因此 CVE-2021-4034 有可能对软件开发组织产生深远的影响。自 PolKit 的第一个版本(当时称为 PolicyKit)于 2009 年发布以来，该漏洞就一直存在。

## PolKit 是如何工作的？

PolKit 提供了一个授权 API，非特权程序可以使用它来访问特权程序或服务提供的功能。`pkexec`实用程序本身允许用户以另一个用户的身份执行命令，如果没有指定用户，它将以 root 用户的身份执行命令，root 用户是 Linux 和 UNIX 系统上特权最高的帐户。

已经登录到系统的攻击者可以利用此漏洞获得完全根用户权限，即使 PolKit 本身没有运行。Qualys 将利用该漏洞所需的工作描述为“微不足道”，正如所料，有多个来源描述了如何利用该漏洞。

## 有什么含义？

CVE-2021-4034 有潜力给予即使是没有经验的演员一个容易的方法进入许多系统和使用管理特权。通过链接`pkexec`中的内存损坏和软件中的其他一些弱点，无权限的本地用户可以获得完全的根权限，然后通过易受攻击的主机网络窃取敏感数据，并为具有更高隐蔽性、持久性和能力的其他攻击奠定基础。

重要的是，利用这个漏洞确实需要一个[威胁参与者](https://www.synopsys.com/software-integrity/software-security-services/insider-threat-detection.html?cmp=pr-sig&utm_medium=referral)已经拥有本地访问权限，因为易受攻击的组件不会监听外部流量。但是，即使是没有经验的攻击者也可以轻松地利用它，这是提高安全级别的原因。

此外，安全研究人员已经独立验证了该漏洞。他们能够开发一个漏洞，给予他们完全的根权限，这证实了这个漏洞很容易被一系列不同的目标利用。

## 你该怎么办？

自 2009 年以来的所有 PolKit 版本都存在漏洞。由于这个包默认安装在所有流行的类似 UNIX 的发行版中，这影响了大多数 Linux 和类似 UNIX 的机器。要修复 CVE-2021-4034，组织必须通过应用 PolKit 作者在其 GitLab 页面上发布的修补程序来更新 PolKit 包。RedHat 和 Ubuntu 也发布了补救步骤。

以下是你应该采取的行动。

1.  找到运行 PolKit 的系统。如果它们构建在标准的 Linux 操作系统上，那么 PolKit 应该默认包含在内。如果系统使用自定义版本，请检查 PolicyKit 或 PolKit 包，或者 pkexec 是否正在运行。
2.  检查他们是否容易被利用。虽然 Qualys 已经证明了 Ubuntu、Debian、Fedora 和 CentOS 系统容易受到攻击，但 OpenBSD 不会，因为它拒绝运行没有命令行参数(argc 为 0)的(" execve()")程序，这是利用漏洞的关键步骤。您应该测试 PolKit 支持的任何非 Linux 操作系统，比如 Solaris 和 BSD，因为它们还没有定论。
3.  对要修复的资产进行优先级排序。确定环境中易受攻击的资产后，在确定修补和缓解任务的优先级时，请考虑风险状况和业务价值。
4.  验证并为受影响的系统应用补丁。PolKit 团队和一些受影响操作系统的供应商已经发布了补丁。

## SBOM 能帮上什么忙？

PolKit 包不是开发人员独立决定加入到他们正在开发的应用程序中的东西；相反，每当受影响的 Linux 发行版被用作操作系统时，它就会出现。这是一种“一揽子交易”，没有双关语的意思。

考虑到 Linux 的广泛使用，这引入了一种独特的风险，尤其是对开发物联网设备、嵌入式系统和虚拟机模板的组织而言。[软件组成分析](https://www.synopsys.com/software-integrity/security-testing/software-composition-analysis.html?cmp=pr-sig&utm_medium=referral) (SCA)工具为用户提供签名和二进制分析，因此他们可以分析固件，确定是否包含易受攻击的 Linux 发行版，并准备好固件和虚拟机中包含的任何附加组件的完整列表。

构建一个全面的 SBOM 可让您在 CVE-2021-4034 等漏洞被披露时确定 PolKit 等组件的位置，以便您可以快速修复它们并避免业务中断。像 Synopsys Black Duck SCA 这样的工具也为您提供了 Black Duck Security Advisories(bdsa ),它提供了一层额外的保护，包括新报告漏洞的当天通知。在波尔基特的案例中，黑鸭客户一直忙于补救工作。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>