# Steeltoe:现代化。微服务架构的网络应用

> 原文：<https://thenewstack.io/steeltoe-modernize-net-apps-for-a-microservices-architecture/>

[](https://tanzu.vmware.com/)

 [大卫·迪鲁夫

大卫是 Pivotal 技术营销团队的一员，他带来了。NET 相关技术。自从 C#问世以来，他就一直在编写它。闲暇时，他喜欢打碎东西，只喜欢修理它们。在加入 Pivotal 之前，David 有着广泛的背景，从让事情变得更快，到构建计算机，到编写糟糕的代码。](https://tanzu.vmware.com/) [](https://tanzu.vmware.com/)

“你打算如何使你的现代化？NET 应用程序资产？”当我问企业这个问题时，答案通常是这样的:“我们知道我们需要做些什么，但我们不确定是什么。”另一个常见的答案是:“鉴于我们与 IIS 和 Windows Server 功能的紧密结合，我们的应用程序怎么可能是云原生的？”

事实是，应用程序现代化没有单一的解决方案。但是有一些非常[明确定义的路径](https://content.pivotal.io/blog/help-has-arrived-how-pcf-2-1-changes-how-you-look-at-windows-and-net)。还有。NET 应用程序现代化剧本看起来很像 Java 应用程序剧本。如果您的目标是为您的。NET 应用程序，那么你需要采用可靠的模式，如微服务、服务发现、断路器、12 因素和现代平台。

也许 Java 和。网络现代化看起来如此相似。毕竟，任何有经验的开发人员都会告诉你，最好尽可能使用其他人的成熟技术。这样，软件工程师可以专注于构建优秀的代码，使业务与众不同，而不是多余的脚手架。

你如何让你的开发人员写出令人惊叹的代码？给他们合适的工作工具。([其实这是企业采用微服务的一大原因](https://content.pivotal.io/blog/should-that-be-a-microservice-keep-these-six-factors-in-mind)。)任何给定的运行时的独占使用都是昂贵的和受限制的。相反，您应该培育一个生态系统，利用同类最佳的技术来满足组织内部不同的业务需求。

Java 和 Linux 世界有他们的现代工具。现在让我们来看看。企业的. NET 和 Windows 端。

## 斯蒂尔托群岛。现代网络

这就把我们带到了最著名的开源软件之一 steel toe T1。NET 项目在最近几年开始出现(它在 NuGet 上有超过 150 万*的下载量)。Steeltoe 带来了成熟的模式，可以在几个小时内改变应用程序的云适用性。它还会助长依赖 IIS 的应用程序的解耦服务和无状态性，这尤其具有挑战性。*

“它究竟是怎么做到这一点的？!"你可能会问。答案在三个组件中:服务发现、断路器和配置服务器。

### 服务发现

服务发现是您的微服务相互发现的方式。这是直接使用服务 URL 的现代替代方法。在网飞春天云的一部分尤里卡的帮助下，斯蒂尔托为两者都建了一个图书馆。NET 核心和框架应用程序。在这里，您的应用程序在 Eureka 服务注册中心注册。您的应用程序还会在注册表中查找其依赖的服务。Eureka 会跟踪您的所有微服务实例，并确保它们都能找到彼此。服务的运行时间并不重要，因为它是一个微服务，接口是基于 HTTPS 的。从 C#的角度来看，您仍然可以使用 WebRequest 之类的东西来调用外部服务，但是也可以使用 Eureka 提供的 URL。

### 断路器

现代应用程序需要具有弹性，即使它们不断变化。这意味着优雅地处理复杂的依赖关系网。通常，产品团队甚至不知道一小部分代码的依赖关系的确切性质。此外，该团队将无法控制相关服务的可用性。对您的企业来说，这是一件具有挑战性的事情，而对您的工程团队来说，这是一个简单的现实。

同样现实的另一面？作为一个软件驱动的企业，你的成功依赖于几十个团队迅速为大规模客户提供精彩的功能。每个团队都有不同的 SLA，并且处于不同的发布周期。一些应用比较老，其可靠性值得怀疑。你如何调和这两种现实？即使你不能控制它的后台服务，你如何隔离一个应用程序免于失败？使用断路器。

与服务发现类似，我们在网飞的朋友也为我们解决了这一挑战。使用 Hystrix server，您可以将断路器模式引入您的系统。你创建了一个“回路”，而不是一个应用程序调用另一个应用程序并包装一个“尝试/捕捉”(或者更糟，只是希望最好的结果)该电路不仅包括对另一个应用程序的调用，还包括如果下游应用程序失败该怎么办的智能，以及多久轮询一次下游应用程序的可用性。

通过 Spring Cloud 网飞库，Steeltoe 提供了一个用于与 Hystrix 服务器交互的包。您可以在. NET 中创建这些模式。您甚至可以自动执行各种令人惊叹的故障转移操作！例如，您可以使用 Steeltoe 在应用程序的集成测试中捆绑电路开路和电路闭合场景。最终的结果是:一个高度可用的弹性应用程序自动处理其依赖服务的问题。

### 配置服务器

十二因素法告诉我们"[将配置存储在环境](https://12factor.net/config)中。"通常开始使用这种模式来存储环境变量。复杂性会迅速增长。很快，您可能需要保存所有应用程序实例引用的动态全局值。如果其中一个值发生变化，所有正在运行的实例都需要得到通知。

您还需要一个能够区分从测试到生产的不同环境的单一配置服务。再次，Steeltoe 带来了一个解决方案。NET 开发人员。站在 Spring Cloud Config Server 的肩膀上，Steeltoe Config Server 为。网络应用。

它是这样工作的:

1.  您创建一个单独的 Git repo 来保存配置值；
2.  将您的应用程序配置为依赖于从该文档中检索值进行配置；
3.  现在，每次提交持有文档的回购协议时，所有应用程序都会收到通知并被刷新。

有关配置服务器和大量示例代码的更多信息，请查看 Steeltoe 文档。

## 让 Steeltoe 更进一步

扩展 Spring Cloud 服务套件只是 Steeltoe 所能提供的服务的开始。动态日志记录级别、自动创建的管理端点、云连接器和安全提供商也可以利用您的。NET 微服务更上一层楼。

Steeltoe 的入门也非常容易。[站点](https://steeltoe.io)有关于每个框架包的各种代码示例和文档。有一步一步的指导来为每个特性部署一个[样本应用](https://github.com/SteeltoeOSS/Samples)，或者有一个你可以使用【几乎】所有框架特性部署的应用。

您可以在桌面上部署示例，或者包含 Cloud Foundry 选项，您可以使用 Pivotal 的[免费试用服务](https://run.pivotal.io/)。一旦您很好地理解了示例应用程序是如何设计和部署的，那么让您的应用程序运行起来就轻而易举了。

请记住:虽然 Pivotal 是 Steeltoe 的主要贡献者，但它在[是一个社区驱动的项目。网基](https://dotnetfoundation.org/Projects?searchquery=steeltoe&type=project)。您可以看到所有的源代码，并开发新的功能来帮助它继续发展。

Steeltoe 为投资组合带来了巨大的价值。NET 应用程序需要现代化，以及新的。为云创建的. NET 应用程序。只需将 Nuget 分布式包添加到. NET framework (4.x)或。NET core app——反过来获得如此巨大的云原生优势，决定尝试 Steeltoe 应该很容易。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>