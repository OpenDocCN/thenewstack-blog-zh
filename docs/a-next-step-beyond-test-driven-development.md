# 测试驱动开发的下一步

> 原文：<https://thenewstack.io/a-next-step-beyond-test-driven-development/>

我一生中最成功的软件开发运动可能是测试驱动开发或 TDD。使用 TDD，需求被转化为非常具体的测试用例，然后代码被改进，这样测试就通过了。你知道它，你可能会使用它；这种实践帮助我们整个行业提高了代码质量。

但是是时候超越 TDD 了，这样才能写出在生产中运行良好的更好的软件。这一步是**可观察性驱动的开发**。

## **使用 TDD 驱动更好的代码**

 [慈善专业

Charity Majors 是 Honeycomb.io 的联合创始人兼首席技术官，honeycomb . io 是一款帮助软件工程师理解当他们的代码遇到生产时会发生什么的工具。查里蒂在 Parse 经营基础设施，是脸书的工程经理。她创建了 Honeycomb，为工程师们带来分布式系统时代所需的可观察性工具。Charity 是《数据库可靠性工程》(O'Reilly)的合著者，致力于创造一个每个工程师都随叫随到、没有人觉得随叫随到很烂的世界。](https://www.linkedin.com/in/charity-majors/) 

TDD 有一些强大的优势。这是一种非常纯粹的思考你的软件和它试图解决的问题的方式。TDD 抽象出肮脏的生产环境，留给你确定性的、可重复的代码，你可以一天运行数百次，给你一个温暖的、模糊的保证，你的软件今天会像昨天和前天一样继续工作。但是当你开始考虑通过测试是否意味着你的用户实际上拥有良好的产品体验时，这种保证很快就消失了。那些通过的测试是否意味着任何错误和回归都可以在你的代码被释放之前被清晰地隔离和修复？

TDD 有助于产生更好的代码，但是 TDD 的一个基本限制正是它最吸引人的地方。使用 TDD，您的测试在一个密封的环境中运行。每次运行时，该环境中的所有内容都会被清除并从零开始重新创建:您的数据被丢弃并重新播种，您的存储和远程系统是空的模拟。没有混乱的人为因素，只有一波又一波精确指定的机器人和模拟程序执行边界检查，序列化和反序列化，并检查预期的结果，一次又一次。

您的代码在野外可能遇到的所有有趣的偏差都已经从那个环境中剔除了。为了使您的代码可测试和易处理，我们删除了这些偏差。没有迷人的惊喜:意想不到的是**非常不受欢迎的**。任何偏离规格的情况都必须立即处理。

但是仅仅因为关于环境的一些事情没有按照计划进行并且被排除在 TDD 之外，并不意味着它没有价值。事实上，有人可能会合理地认为这些偏差是你系统中最有价值的部分；最有趣、最有价值、最值得浮出水面、观察、强调和测试的事情。因为当真实的人开始与你的软件交互时，所有这些东西都将决定你的软件的实际行为。

如果您认为这是真的，那么您可能会对另一种验证和增强代码信心的方法感兴趣。我一直将这种方法称为“可观察性驱动的开发”，或 ODD。那是**哦，对了，对了**，因为使用在生产中运行你的软件获得的真实数据来驱动更好的代码是一种没有工程师会觉得奇怪的方法。

## **利用生产推动更好的代码**

“但事情不是这样的！我们对我们的测试有信心！！!"

您的代码中的测试仍然是有价值的。但是我们还需要采取一个额外的步骤来扩展我们的验证，以包含生产的实际情况。这需要转变你的心态，发展一种做法，形成一种习惯。

拥抱失败。与其害怕失败并拼命避免失败，不如试着采取乐观的宿命论心态。一切最终都会失败，通常是在最糟糕的时候，以一种你无法预测的方式。第一步是承认你不可能预测你宝贵的代码在现实世界中失败的所有娱乐性的灾难性方式。你煞费苦心列举和编写测试的所有不同场景都不过是沙滩上的沙粒。接受这一点可能需要一些时间。继续吧。我会等的。

**随走随仪。鉴于我们无法预测未来，下一步是发展一种实践来帮助我们更好地看到开始展现的未来。这是在进行过程中开发仪器的实践。您想要构建的东西可能会完全损坏、部分降级，或者以各种不正常的状态结束——或者依赖于处于不正常状态的服务。这种非最佳状态将如何影响系统的其他部分，以及这些故障模式如何以新的方式表现出来？**

就像你不会在没有测试的情况下接受一个拉式请求一样，你永远也不应该接受一个拉式请求，除非你能回答这样一个问题:“我怎么知道这什么时候不起作用？”

**关闭回路。一旦你的代码被发布出去，你就会形成一种毫不留情地回头检查它的习惯。这是一种习惯，通过您刚刚编写的工具来检查刚刚部署的任何代码。它是否按预期工作？你确定吗？还有什么看起来…奇怪的吗？这应该和肌肉记忆一样是自动的。当你合并到 master 时，你的工作还没有完成。直到你看着它在野外跑，踢了踢轮胎，并确保它按预期工作，它才算完成。**

定期遵循这一步骤，可以在用户注意到之前，在问题大到足以触发警报之前，发现生产中的绝大多数问题。它还帮助您捕捉那些暂时难以发现的问题，这些问题将**永远不会**导致足够大的错误来触发监控警报。此外，它在最佳时间捕捉到它们:就在你建造并运送它之后，当你最初的意图在你的脑海中仍然温暖而新鲜，在它有机会腐烂或被一整天争夺你注意力的所有其他事情取代之前。

您需要如此频繁地遵循这一步骤，以至于通过插装检查您的代码是否如预期的那样工作变成了肌肉记忆:这变成了您每次部署代码时所发生的事情的自然部分。不检查运行情况感觉很奇怪**。您的内心深处应该有一种挥之不去的渴望，除非您通过检查您的代码在 prod 中的表现来结束部署，否则这种渴望不会平息。**

## **TDD + Prod =奇数**

这就是我所说的可观察性驱动的开发。这相当于戴着头灯在黑暗中徒步旅行；无论你走到哪里，它都会照亮你走在路上的双脚，并领先你两步。

有了 TDD，如果您的代码似乎做错了什么，您可以依靠自动化测试套件来举手反对。所有的测试都通过了？那是绿灯！当分支被合并并且测试通过时，你的工作就完成了；这就是你前进所需的全部信心。部署这些代码可能是其他人的工作。一旦进入 prod，bug 就会被监控软件(如果你幸运的话)或不高兴的用户(如果你不幸运的话)发现，并最终以任务或标签的形式回到你或你的团队。

这是一个**对**起作用的反馈回路，或多或少，但它漫长、缓慢且有漏洞。在 prod 中查看您的代码的人可能不知道他们在找什么或在看什么，因为他们不知道您的原始意图。几天、几周或几个月后，当这些错误回到你身边时，你可能也已经忘记了很多相关的内容。

有了 ODD，你已经接受了你不能列举每一个失败，所以你对任何固定测试的能力远没有信心来表现行为异常。但是你**确实**有已知宇宙中最大的混乱和异常来源可以学习:活用户。简单地用一个开放的生产端口运行您的服务会引起足够的混乱！

你的仪器的存在不是为了解决一系列固定的问题，而是为了开启你对用户与你的系统交互方式的主动、好奇、新奇的探索:可观察性的跳动的心脏。如果你把在 prod 中使用你的代码作为日常实践，你不仅可以更好地为你的用户服务，你还可以让你的系统达到更高的整洁和可理解的标准。你会开发出敏锐的技术直觉，你会写出更好的代码。你会成为一名更好的工程师。

开始沿着可观察性驱动开发的道路走下去，并跟随你的好奇心到它通向的任何地方。

***[下载实现可观测性的指南](https://www.honeycomb.io/resources/guide-achieving-observability)** ，了解更多关于可观测性驱动开发的知识。*

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>