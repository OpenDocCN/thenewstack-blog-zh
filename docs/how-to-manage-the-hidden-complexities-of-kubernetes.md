# 如何管理 Kubernetes 隐藏的复杂性

> 原文：<https://thenewstack.io/how-to-manage-the-hidden-complexities-of-kubernetes/>

[](https://www.linkedin.com/in/dmcramer/)

 [大卫·克莱姆

大卫是 Sentry 的联合创始人兼首席技术官，这是一家应用程序监控和错误跟踪软件公司，帮助软件团队实时发现、分类和优先处理错误。之前是 Dropbox 和 Disqus 的软件工程师，他创建了 Sentry 作为一个开源项目来解决他在开发中遇到的问题。自 2012 年以来，Sentry 已经发展到为 50，000 家公司和超过 100 万活跃用户提供服务。](https://www.linkedin.com/in/dmcramer/) [](https://www.linkedin.com/in/dmcramer/)

在过去几年中，容器在开发、测试和生产环境中的使用激增，部分原因是新工具使部署、扩展和管理云原生应用程序变得更加容易。根据云本地计算基金会的一项调查，开发者有 100 多种工具可供选择，但 89%的人都在使用某种形式的 Kubernetes。

谷歌的开源容器编排项目当然有它的优势——自动化是最大的优势之一。Kubernetes 通过自动化应用服务的部署和分发、应用服务的资源分配、应用网络配置，甚至跨分布式基础设施的负载平衡，消除了容器管理中密集、耗时的人工劳动。因此，精益团队可以高效地部署和管理大量的基础设施，而各种规模的团队都可以以更高的运营速度完成这项工作。

Kubernetes 几乎可以在任何地方运行容器，因为它在基础设施层创建了抽象。这提高了可扩展性，并简化了跨多个平台和资源(从云到虚拟机到裸机)工作的团队的共享和决策。DevOps 团队可以专注于构建应用程序，而不是管理底层基础架构。它还具有内置的弹性机制，包括高可用性、自动故障转移等功能，以及淘汰、复制和旋转新容器和服务以实现自我修复的能力。

因为 Kubernetes 是开源的，所以有充足的资源和文档，团队可以很容易地与生态系统中的许多其他工具集成。有了所有这些好处，它就是我们一直在等待的银弹——是吗？

## Kubernetes 是有代价的

虽然编排平台以其简化开发的特性而闻名，但它本身可能极难实现和管理。许多重要的功能和配置需要大量的时间和理解来设置。Kubernetes“开箱即用”本质上是一个集群，它有一组运行容器化应用程序的节点。

关键组件(如 DNS、用户仪表板和监控)是附加组件，几乎所有功能都需要通过[应用编程接口](https://kubernetes.io/docs/concepts/cluster-administration/flow-control/)进行集成。单独管理这个方面会成倍地增加复杂性，因为如果没有适当的优先级，API 调用的激增会阻塞重要的请求或使 API 服务器完全崩溃。

还有许多实现和使用 Kubernetes 的方法，比如如何访问集群(服务发现)和 pods 之间的负载平衡。这对于拥有多个共享资源的团队的大型分布式组织来说是一个问题。管理平台的大量选项和方法可能会让人不知所措，从而增加复杂性和不协调性。

类似地，对于没有花时间学习和适当配置他们的 Kubernetes 实例的团队来说，自动化特性会很快产生问题。团队需要理解并计划它如何构建和自动伸缩，它如何调度资源，以及当出现问题时它将如何自动失败。自动化只有在正常运行时才能节省时间，但错误配置的功能可能会很快变得难以管理，并导致应用程序功能和性能方面的问题。

> 因为 Kubernetes 是关于自动化的，用户不用写指令或命令来告诉它做什么。相反，他们描述他们想要的状态，Kubernetes 决定做什么和如何实现。

例如，Kubernetes 通过 [CFS 的配额机制](https://www.kernel.org/doc/Documentation/scheduler/sched-design-CFS.txt)实现了 CPU 限制，以并行运行多个任务，平均共享 CPU。当应用程序超出基于时间(例如，100 ms)和配额设置的设定限制时，内核调节用于限制 CPU 周期。[如果配置不当](https://medium.com/omio-engineering/cpu-limits-and-aggressive-throttling-in-kubernetes-c5b20bd8a718)——尤其是在更复杂的环境中——将导致高节流率，从而导致就绪探测失败、容器停滞和网络超时。换句话说，增加了应用程序错误。

该平台的主要优势之一也可能成为其致命弱点。因为 Kubernetes 是关于自动化的，用户不用写指令或命令来告诉它做什么。相反，他们描述他们想要的状态，Kubernetes 决定做什么以及如何达到这种状态。如果这种状态涉及到四个容器运行在特定的内存分配量下，Kubernetes 将启动这些容器，然后监控它们。如果一个失败了，它会旋转另一个来代替它。这种自我修复的能力将使应用程序在最初保持正常运行，但它可能会掩盖越来越多的问题。健康指标可能显示一切运行正常，但是应用程序可能每小时都会抛出错误。由于缺乏对代码的可见性，Kubernetes 的组件很容易在不知不觉中被降级。

## 最佳实践

这里有一些最佳实践来帮助你管理 Kubernetes 中的复杂性。

### 考虑外包管理

IT 组织应该确定他们愿意在 Kubernetes 上投入的时间和资源。管理和故障排除需要深厚的领域专业知识，对于内部还没有这方面人才的组织来说，学习曲线可能会很长。外包提供了更快的部署、对许多附加工具和资源的访问、对安全补丁、升级、故障排除和维护的持续管理。许多云提供商和独立供应商现在提供 Kubernetes 管理即服务，这可以减轻许多负担，并使开发团队能够专注于构建更好的应用程序。

对于那些希望(或需要)拥有 Kubernetes 管理的组织，这里有一些额外的建议:

### 看看引擎盖下面

尽管大肆宣传，Kubernetes 并不是一个神奇的解决方案。它是功能和特性的连接集合。花时间去理解单个组件是非常有价值的。

### 画出来

公司可以通过将团队聚集在一起制定所有应用程序来主动降低复杂性；它们位于何处、如何工作、如何相互连接以及如何最好地实现迁移。确定谁负责管理，最重要的是，管理出了问题谁负责。

### 开发专有文档

当团队讨论并同意如何实现和使用 Kubernetes，以及如何管理可能出现的问题时，复杂性可以更容易地得到管理。

### 监控系统和代码

监控应用程序运行状况，以及容器和后端系统。全面的监控方法将提高问题和事件的可见性，以便在问题对用户产生任何重大影响之前发现并补救问题。它还将帮助团队理解问题的影响和范围，以识别模式和随时间的变化。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>