# 管理 Kubernetes 的成本

> 原文：<https://thenewstack.io/managing-the-cost-of-kubernetes/>

Kubernetes environments [可以快速增长](https://thenewstack.io/what-does-it-take-to-manage-hundreds-of-kubernetes-clusters/)，随着这种增长，成本也在上升。在[云本地计算基金会(CNCF)针对 Kubernetes](https://www.cncf.io/wp-content/uploads/2021/06/FINOPS_Kubernetes_Report.pdf) 的 FinOps 调查中，68%的受访者表示 Kubernetes 的成本正在上升，其中一半的人经历了每年超过 20%的增长。

推动成本的因素之一是开发人员可以使用的自助部署功能。虽然这种做法可以加快应用程序部署，但成本往往会失控，因为开发人员通常会分配最大的存储、CPU 和内存来避免性能问题。

云原生环境的自动扩展是推动成本的另一个因素。虽然开发人员经常编写脚本来自动部署环境，但他们没有类似的自动机制来拆除这些环境。因此，自动化流程在不断部署，但这些资源并不总是得到利用。

Kubernetes 面临的挑战之一是，如果不进入命令行并运行一系列命令，就无法看到环境中正在发生的事情。同样，很难看出你在 Kubernetes 上花了多少钱。对于大中型企业来说，这些失控的成本每月从数万美元到数十万美元不等。

## 管理 Kubernetes 成本的挑战

令人惊讶的是，尽管 Kubernetes 环境继续增长并消耗资源，但大多数组织并不跟踪他们实际花费了多少。在 [CNCF](https://cncf.io/?utm_content=inline-mention) 的调查中，69%的受访者表示他们根本不监控 Kubernetes 的支出，或者他们依赖每月的估计。

如果你没有以任何方式监控 Kubernetes 的成本，你就看不到哪里的云资源被过度分配。另一方面，试图使用云提供商的账单和手动电子表格来计算 Kubernetes 的成本是耗时、低效且通常不准确的。这种方法可以识别环境中的某种总体成本问题，但是如果您不知道是什么导致了您的账单增加，这种方法就没有用了。

手动方法的另一个缺点是反应时间慢。如果不能实时了解成本超支，您就无法及时应对突然出现的成本高峰。等到你每月的账单上有一个惊喜时，会对你的底线产生真正的影响。

有一些开源工具可以帮助管理 Kubernetes 的成本，但它们需要设置额外的 Prometheus 服务器，以便获得分配成本所需的指标。这可能导致团队花费大量时间配置和维护他们的成本监控解决方案，而不是解决重要的业务问题。

## Kubernetes 成本管理的必备功能

Kubernetes 成本管理是所有云原生团队的关键能力。为了真正控制 Kubernetes 的成本，您需要一个具有深度 Kubernetes 可见性的商业解决方案，提供开箱即用的一切，使您能够以最少的配置在几分钟内启动并运行。

以下是您在选择 Kubernetes 成本管理解决方案时应该考虑的基本功能:

## 利用率、性能和成本数据的相关性

正确的 Kubernetes 成本管理解决方案会将利用率和性能信息准确地映射到成本。通过将这些数据整合到一个工具中，您可以立即获得相关的成本可见性。这种类型的解决方案将使管理员能够做出正确的规模决策，而不必担心影响性能。

## 向下钻取粒度

Kubernetes 成本管理工具应该使您能够深入到环境的各个层，例如名称空间和工作负载，这样您就可以确切地看到每个应用程序如何影响您的成本。这还允许您向各个团队展示他们的环境给他们的部门或公司带来了多少成本。

## 栈排序优先级

正确的解决方案应该自动提供节省时间的功能，例如按堆栈排序列出您环境中最昂贵的组件，这样您就知道应该首先解决什么问题。

## 实时警报

Kubernetes 成本管理的实时性至关重要。解决方案应该实时提醒您异常的成本高峰，以便您可以立即调查问题并进行补救，而不是等待月度报告。在某些情况下，这些峰值表示网络攻击，这也需要快速响应。

## 自动配置

最佳成本管理工具将自动与云提供商和 Kubernetes 集成，无需配置或管理额外的组件即可获得最大的投资回报。

## 节约成本的前瞻性建议

最重要的是，理想的 Kubernetes 成本管理解决方案将为您环境中与成本相关的配置设置提供可行的建议。该工具不仅仅揭示您的成本，还应该揭示通过对您的配置进行特定的更改，您可以节省多少成本。这是成本管理解决方案的真正价值，它能带来底线收益。

## 成本管理的好处

正确的 Kubernetes 成本管理工具可以带来以下好处:

### 通过减少浪费的资源来节省资金

最近的一项系统分析发现，大多数组织可以将浪费的 Kubernetes 资源平均减少 40%。根据环境的规模，使用正确的成本管理工具每月可以节省数十万美元。

### 提高成本管理效率

有效的 Kubernetes 成本管理解决方案还将显著减少将云提供商账单与 Kubernetes 基础设施或层级关联起来所需的时间。这使您的团队能够将时间花在更有成效的任务上，例如解决业务问题和创新新产品和功能。

### 实现性能和成本之间的平衡

降低成本并不是唯一的好处—您需要在成本和性能之间找到合适的平衡点。Kubernetes 的成本管理工具可以为您确定这一点，消除猜测。

### 控制成本飙升

从 Kubernetes 成本管理工具获取成本相关警报的能力提供了至关重要的实时可见性，使您能够在收到每月账单之前遇到突然的成本高峰时立即采取纠正措施。

## 结论

成本管理并不总是你的开发人员优先考虑的事情——他们专注于比你的竞争对手更快地将高质量的产品和功能推向市场。但是成本管理仍然是必要的。问问你的首席财务官就知道了！正确的解决方案可以使 Kubernetes 成本管理及时、主动、经济高效且毫不费力，使您能够实现成本和性能之间的完美平衡。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>