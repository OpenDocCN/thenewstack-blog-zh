# 关于“银行 Python”，一种金融专用语言分支

> 原文：<https://thenewstack.io/all-about-bank-python-a-finance-specific-language-fork/>

11 月，总部位于伦敦的软件工程师 [Cal Paterson](https://uk.linkedin.com/in/cal-paterson-290a2730) 出版了一本引人入胜的《[银行 Python](https://calpaterson.com/bank-python.html) 口述历史》，将它描述为“大型投资银行使用的奇怪的 Python 世界……实际上是*整个* Python 生态系统的专有分支。”

在接受 New Stack 的电子邮件采访时，帕特森告诉我，他在不止一家机构工作过，使用的都是自己风格的 Bank Python——这种“强烈的相似性”表明，当 IT 员工从一家投资银行跳槽到另一家投资银行时，他们都打着银行基本意识形态的旗号。

“如果你知道某个重要的功能存在于以前银行的某个文件中，它很可能存在于你现在银行的同一个文件中，”他说。

他自己的工作经历包括在摩根大通(JP Morgan)和美国银行美林(Bank of America Merill Lynch)的专有内部环境中编写 Python，以及在花旗银行(Citibank)担任为期四个月的 Python 开发人员。(尽管帕特森还补充道，即使在投资银行业内部，“有些银行有，有些没有。”)

为了避免透露雇主的具体细节，他的博客帖子只是呈现了他在整个职业生涯中所见所闻的虚构融合。但是它仍然提供了一个很好的机会来探索整个编程语言的一个奇特分支，这个分支对于一般公众来说几乎是完全未知的。

帕特森在他的文章中强调了这一阴谋，他写道:“外国的制度，就像外国一样，当亲身经历时，可以扩展思维。”

## 没有文件系统，只有一个大型对象数据库

第一个大惊喜:Bank Python 不能访问文件系统！但它似乎也不需要一个，因为它所操作的大部分内容已经存在于一个巨大的对象数据库中，代表着贸易和市场数据之类的东西。这些对象代表了从简单的债券到更复杂的衍生工具的一切。

“如果一家公司的一些坏消息被公布，信用机构降低了他们的信用评级，那么债券领域的某人将更新相关的债券对象，”佩特森的文章解释道。

这会立即传播到包含该绑定对象值的任何其他计算，就像在 Excel 电子表格中更改单元格的值会自动导致使用该单元格的任何公式更新其自身的值一样简单。(这还允许实现方便的附加功能，如通过数据进行“时间旅行”,以查看其在过去或未来的值。)

人类学家可能会认为，这种结构蕴含着投资银行文化的线索。有趣的是，帕特森在他的文章中把这一堆栈描述为“受金融部门技术路径依赖的严重影响，这是另一种说法:有很多 MS Excel。”

他在文章中承认，多年来，许多人都有合乎逻辑的商业理由在全公司范围内转向 Kubernetes、微服务和服务网格。但是让不情愿的用户放弃他们熟悉的微软电子表格“拿走了那些 Excel 用户的基本代理，他们不再理解他们运行的业务流程，现在不得不为每个软件变更与可笑的技术呆子谈判。”

他继续说道，“在源代码控制的系统中使用简单的 Python 函数，是比当今的 Java 2 Enterprise Edition 更好的折中方案。

“金融家能够学习 Python，尽管他们可能永远不会对它感到惊讶，但他们可以做出更高水平的贡献，甚至做出自己的改变并部署它们。”

因此，银行 Python 程序首先只是打开一个到对象数据库的连接——然后它们就离开了。但是比这更疯狂的是，因为甚至你的应用程序的主*源代码*也存储在那个数据库中，由一个单一的作业处理“运行者”运行

在他的文章中，Paterson 将其与 Jenkins 或 systemd 进行了比较，并指出这种设置有几个优点。“如果软件崩溃，它可以重启你的软件，如果软件继续崩溃，它会发出警报。它存储日志。它了解作业之间的依赖关系(很像 systemd)，因此如果生成作业所需数据的作业失败，您的作业甚至不会尝试启动，而是发出更多警报。”

但最重要的是，它让您只需创建一个非常简单的初始化文件，就可以在一个主要的有安全意识的机构中运行代码。“这是一件大事，因为在大银行谈判任何事情都是一项令人沮丧的工作:硬件的交付时间可以用几个月来衡量，”Paterson 写道。"当然，让人们同意你的观点需要更长的时间."

## 内部“发明”的定制 Python

Bank Python 实现似乎也在使用自己专有的表数据结构，提供对中等规模数据集的更快访问(同时更有效地将它们存储在内存中)。

Paterson 说:“有些实现是 C++(不是典型的金融软件)的集合体，有些是 sqlite3 上的薄皮。”。(他的朋友 Salim Fadhley 是一名伦敦的开发人员，他甚至发布了一个名为 [eztable](https://github.com/salimfadhley/eztable) 的表格数据结构(全 Python)版本。)

Paterson 总结说，虽然大多数编程都采用代码优先的方法，但 Bank Python 的特点是数据优先。虽然它表面上是面向对象的，但是“你将数据分组到*表*中，然后代码就独立存在了。”

不用说，Bank Python 最终不可避免地获得了自己的内部集成开发环境(IDE)来处理所有独特的配置问题，它甚至有自己独特的代码版本控制系统。Paterson 承认了一个无情的评估，即这只是不信任来自公司外部的任何东西的一次大演习(在编程领域被称为可怕的[“不是这里发明的”综合症](https://en.wikipedia.org/wiki/Not_invented_here))。

最大的不利因素是在那里工作的开发人员，因为你每年都要在雇主定制的单一文化中度过，“你需要的与正常软件萎缩互动的技能。”仅举一个例子:“当所有的东西都在同一个存储库中，所有的代码都只需要导入，软件打包就不会出现。”

当然，在银行工作多年后，帕特森也经历了一个更私人的问题:“长时间接触 Windows 7 和 MS Outlook 2010 导致的存在主义厌倦。”

## 开发人员分享“银行 Python”故事

Paterson 的博客在社交媒体上引起了开发者的兴趣，在 Reddit 的编程论坛上获得了 546 张[的支持票，在黑客新闻](https://www.reddit.com/r/programming/comments/qmi5fm/an_oral_history_of_bank_python/)上获得了 864 张[的支持票。“在此之前，我曾在一家投资银行工作过，这让我想起了一些往事，”一位黑客新闻评论员承认道。](https://news.ycombinator.com/item?id=29104047)

另一位读者[评论道](https://news.ycombinator.com/item?id=29109261)“老实说，这听起来比许多‘传统’书库少了很多*和*疯狂。

但这是对另一个世界的一瞥，在这个世界里，整个软件系统最终都是内部开发的。一条黑客新闻[评论](https://news.ycombinator.com/item?id=29104047)来自[肖恩·亨特](https://www.linkedin.com/in/sean-hunter-548358b)，他是高盛策略师[(或“strats”)](https://www.efinancialcareers.co.uk/news/2020/11/strats-jobs-goldman-sachs)团队的前副总裁，他发帖称他是在 2002 年至 2003 年间在那里引入 Python 的人。

亨特与电子金融职业网站分享了更多的回忆，记得他在高盛的接下来九年里，他们甚至创造了一个领先于时代的环境，用 Perl 编写的 CI/CD 管道部署代码更新。

“当时有 2000 万行 C++和 1000 万行 Java，我们会把它推广到全球所有的机器上，”亨特说。他认为，在那个时候，世界上任何地方都没有类似的东西。

还有一个类似云的内部计算网格，计算分散在不同的服务器上。(在后来的评论中，亨特回忆说，仅在一个两周的周期内，就有 667 名不同的开发人员提交了申请。)“我们所做的一切都是绝密的，外界没有人会知道，”他向电子金融服务公司讲述自己在高盛的时光。“银行为尚不存在的特定用例制造了大量东西，然后世界赶上了。”

## 尊重“银行 Python”贡献者

Paterson 很喜欢 Hunter 在 Hacker News 上的评论，并说他也听金融行业以外的人说他们喜欢 Bank Python 的想法。“我认为有很多 k8s 异议者’不喜欢软件制作的发展方向。”

他还表示，如今，Beacon 公司实际上是在营销“银行 Python 的白标版本”。

但在他的反应之下，似乎是对构建整个 Bank Python 生态系统的所有关心和努力的真正感谢。

如今，Python 的核心团队已经发展壮大，变得更加专业化/志愿者更少——但 Paterson 估计，在 2010 年，一个分叉 Python 生态系统(包括解释器)的大型银行可能最终会比 Python 最初较小的全志愿者核心团队部署更多的工时。

在我们的采访中，Paterson 称这个系统“非常棒”，并告诉我他希望他还能使用它。

* * *

# WebReduce

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>