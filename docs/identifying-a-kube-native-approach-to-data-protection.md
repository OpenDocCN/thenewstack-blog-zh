# 确定 Kube-Native 数据保护方法

> 原文：<https://thenewstack.io/identifying-a-kube-native-approach-to-data-protection/>

[](https://www.linkedin.com/in/chrismilsted/?originalSubdomain=uk)

 [克里斯·米尔斯特德

克里斯是 Ondat 的一名客户成功架构师。他已经为大大小小的公司工作了 20 多年，涉及的技术包括 UNIX、Linux、Kubernetes、云计算、网络、虚拟化和许多其他开源项目。Chris 在帮助企业解决如何应用这些技术来解决业务挑战和提供价值方面有着良好的记录。](https://www.linkedin.com/in/chrismilsted/?originalSubdomain=uk) [](https://www.linkedin.com/in/chrismilsted/?originalSubdomain=uk)

数据保护通常不是开发人员的首要考虑。从历史上看，开发人员的优势在于只关注功能，可以将基础设施管理中不太令人兴奋但绝对重要的方面留给生产团队成员。

但是随着 DevOps 原则改变行业，开发人员不再可能将生产问题留给其他团队。以整体的、端到端的方式考虑软件开发还包括软件开发生命周期中传统上不太引人注目的方面，如测试、可用性、故障转移和数据保护。

让我们深入到 Kubernetes 的数据保护中，确定一些 DevOps 专业人员在考虑这个重要的软件开发问题时应该遵循的最佳实践。

## 传统环境的数据保护

当虚拟机(VM)风靡应用程序部署时，数据保护是一项相对简单的任务。为了备份虚拟机，基础架构管理人员转向 IBM 的[Tivoli Storage Manager](https://www.ibm.com/docs/ko/tsm/7.1.0?topic=servers-tivoli-storage-manager-overview)(TSM)等解决方案，从本质上拍摄虚拟机、其操作系统、安装在其中的应用程序以及应用程序状态的快照。当出现故障并且需要恢复备份时，将正确的数据返回到正确的位置是相对简单的，因为所有数据都存储在一个单一的虚拟机中。

然后 Kubernetes 出现了。起初，没有什么大的变化。Kubernetes 和容器主要是为无状态工作负载保留的。任何需要备份的数据都存储在传统的关系数据库中，使用传统的存储管理器解决方案仍然可以轻松地备份这些数据。到目前为止，开发和运营之间的分工仍然很明确。开发人员不需要担心存储或备份或任何与基础架构相关的事情，这些是生产中更下游人员的问题。

当然，这种模式在现代企业中正在迅速过时。

## 是什么让现代数据保护与众不同

今天，DevOps 至少是许多组织的目标，如果不是标准的话。

在实践中，这意味着转移软件开发生命周期中遗留的传统基础设施相关问题，实施基于微服务的架构，并采用[云原生方法来交付应用](https://dok.community/dokc-2021-report/)。对于数据保护问题来说，最重要的是，现代 DevOps 通常意味着在 Kubernetes 中管理更多的基础设施和更多有状态的工作负载。

尽可能多地在 Kubernetes 内工作，在许多方面让 DevOps 专业人员的生活变得更加轻松。最重要的是，他们可以使用 Kubernetes 作为一个抽象层，允许他们以几乎相同的方式工作，使用几乎相同的技能集，而不管他们的云提供商、部署方法或底层基础架构如何。

但这也意味着传统的数据保护方法不再适用。

拍摄系统快照不再是一项简单的任务，因为系统是分布式的，被分解成数百个微服务。以前，您可以在关系数据库中捕获某个时间点的状态，但现在有状态的工作负载分布在这些不同的微服务中，这使得实现以下目标变得非常困难:

*   确定哪些数据需要备份，哪些数据不需要备份。
*   确定重要数据的位置。
*   将这些数据纳入数据保护解决方案。
*   跨微服务架构一致、准确地恢复数据。
*   在任何环境下都要这样做。

## 存在数据保护解决方案

有开源和商业解决方案，但它们仍然需要扩展来解决所有这些挑战。

[Velero](https://velero.io/) (之前的 Heptio Ark)是一个著名的开源解决方案，由 Kubernetes 的联合创始人 Craig McLuckie 和 Joe Beda 创建。在商业方面，也有类似 Veeam 的解决方案，该公司收购了 Kubernetes 备份解决方案 [Kasten](https://www.veeam.com/veeam-acquires-kasten-kubernetes-leader.html) 。

一般来说，这些解决方案的功能是明确地不控制如何启动和停止应用程序，或者获取容器中正在发生的事情的一致快照。相反，它们允许你在某些事件上使用前挂钩和后挂钩。这可能看起来像暂停 PostgreSQL 数据库。然后，数据保护解决方案可以[采取不同的备份操作](https://docs.kasten.io/latest/kanister/testing.html#logical-backups):它可以调用 Kubernetes 容器存储接口(CSI)，拍摄快照，写入 S3 兼容的存储桶，或者采取各种不同的方法，这些方法对您的应用程序来说或多或少是理想的。之后，您可以定义一个 post-hook 来进行操作。

有两种主要方法可以获得一致的快照，第一种是逻辑备份。当您试图恢复到时间戳并使用应用程序级智能(插入事务日志)时，会使用逻辑备份，这将在本文中介绍。第二种方法是物理级别的备份，您可以使用 CSI 插件在存储块级别创建快照。然后，可以像以前一样，将它流式传输到远程 S3 兼容目标。

对数据保护转型感兴趣的 DevOps 专业人员可能会在他们的群集上部署其中一个解决方案，熟悉其操作，然后发现它并不十分理想。

是的，这些现代数据解决方案在基于微服务的分布式架构中有效地备份和恢复数据。但是它们并不是在每种环境下都以相同的方式运行。因此，如果您依赖于多个云提供商，拥有混合环境或打算在未来扩展到多个环境，他们可能会成为您工作的负担，需要团队在管理和配置上花费额外的时间，并降低您的自动化能力。

## 以 Kube-Native 的方式考虑数据保护

尽管在 Kubernetes 中集中应用基础设施迫使我们寻找新的方法来提供一流的数据保护，但许多 DevOps 专业人员仍然选择使用 Kubernetes，因为它使业务应用程序的开发变得更加容易。这使得在多种环境下工作变得非常简单。我们需要的是一种像 Kubernetes 一样工作并与 Kubernetes 一起工作的数据保护方法，这样无论底层基础架构如何，它的功能都相同。

随着越来越多的有状态应用程序被部署到 Kubernetes 中，对 Kubernetes 原生数据保护解决方案的需求也在增加。无论这些数据是消息队列、数据库还是 AI/ML 工作负载，都需要一个集成到 Kubernetes 生态系统中的可靠、高性能和安全的存储层来支撑。

这就是 Ondat 的由来，它是一种软件定义的存储解决方案，通过容器存储接口向您的工作负载提供数据块和文件持久性卷。它支持 CSI 快照，可用于为您的 Kubernetes 工作负载构建数据灾难恢复和业务连续性策略。

点击了解更多关于 Ondat 和 [Kubernetes 持久存储的信息。或者，如果你想亲自尝试一下 Ondat，](https://www.ondat.io/platform/how-it-works)[点击这里](https://www.ondat.io/request-demo)请求演示。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>