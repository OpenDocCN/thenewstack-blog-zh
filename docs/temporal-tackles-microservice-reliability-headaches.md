# 暂时解决微服务可靠性问题

> 原文：<https://thenewstack.io/temporal-tackles-microservice-reliability-headaches/>

根据初创公司 [Temporal](https://docs.temporal.io/docs/get-started/) 的说法，使用微服务，开发人员花费太多时间编写代码以确保他们应用程序的可靠性，而不是为他们的公司创造商业价值。

这家总部位于华盛顿州贝尔维尤的公司由优步容错状态平台 [Cadence](https://cadenceworkflow.io/) 的创建者创建，它希望通过 Cadence 开源项目的[分支](https://github.com/temporalio/temporal)来改变这种情况。

使用代码，它旨在隐藏跨分布式系统使用微服务构建的复杂性。它采用不与特定进程关联的持久虚拟内存，即使出现各种可能的故障，也能保持应用程序的状态。

红杉资本的合伙人 Bogomil Balkansky 在一篇博客文章中说:“今天，开发人员被迫预测所有的失败场景和极限情况，他们花费大量时间从头开始编写‘胶水代码’来处理这些无数的失败模式。“这就是 Temporal 的用武之地:该公司创造了一种突破性的技术，使任何软件应用程序都能以一种用户友好的方式优雅地处理故障。”

红杉最近为该公司领投了 1875 万美元的首轮融资，该公司由马克西姆·法提夫和萨马尔·阿巴斯创立。

本质上，Temporal 希望开发人员专注于他们的业务逻辑，而它处理应用程序的持久性、可用性和可伸缩性。

## 操纵可靠性

单一的应用程序通常在一台或两台机器上运行，但有了微服务，数据可以在多台机器上运行。如果一个失败，应用程序的另一部分可能无法更新，“通常的解决方案实际上是开发人员使用的不同技术的拼凑:队列，他们使用数据库，他们使用 Redis 缓存，他们使用计时器服务，”Fateev 解释说。管理这一切不仅会变得极其复杂，还会耗费开发人员大量的时间。

“这也很容易出错。并且这些解决方案中的大多数不能跨不同的应用程序使用。因此，实际上每次开发人员必须编写新的应用程序时，他们大部分时间不是花在业务项目上，而是花在让他们的应用程序变得可靠上。”

他把这种情况比作微软 Word 的旧时代，为了不丢失工作，你不得不经常点击“保存”，而不是谷歌文档，它会自动保存。

“这是目前大多数程序所做的事情。它们加载状态，更新状态，然后在每次请求时保存状态。大部分代码都不是关于实际的请求，而是关于保存和更新请求。这是很大的努力，开发者对此并不满意，”Fateev 说。

## 国家的中枢大脑

Temporal 由编程框架(或 SDK)和托管服务(或后端)组成。

Temporal 中的核心抽象是一个错误无关的有状态工作流，业务逻辑用代码表示。工作流代码的状态，包括它创建的局部变量和线程，不受流程和临时服务故障的影响。

Temporal 支持编程语言 Java 和 Go，但也有针对 Ruby、Python、Node.js、C#/的 SDK。NET，Swift，Haskell，Rust，C++和 PHP。

如果在运行工作流时出现故障，状态会完全恢复到代码中出现故障的那一行，并且流程会继续进行，而无需开发人员干预。

然而，工作流代码的一个限制是每次执行时必须产生完全相同的结果，这就排除了外部 API 调用。这些必须通过工作流编排的活动来处理。活动是一种受支持语言中的函数或对象方法，存储在任务队列中，直到有可用的工作者调用其实现函数。当函数返回时，worker 将其结果报告给临时服务，然后临时服务向工作流报告完成情况。

“那些(外部)服务可能会失败，因为我们无法控制它们，”Fateev 说。“对于这些，你有非常广泛定义的重试策略。与其他解决方案的一大区别是，他们重试的时间没有限制，您可以指定一周、一个月或一年的重试策略。”

[https://www.youtube.com/embed/f-18XztyN6c?feature=oembed](https://www.youtube.com/embed/f-18XztyN6c?feature=oembed)

视频

后端服务是无状态的，依赖于持久性存储。到目前为止，它支持 Cassandra 和 MySQL 存储，尽管适配器可以用于任何其他提供多行单分片事务的数据库。

该公司将 Temporal 吹捧为以可扩展和弹性的方式扫描大数据集(或分区数据集的多个活动)的理想方式。它能够将任务路由到特定的进程，并在必要时将重试路由到不同的主机。

对于分布式事务处理，它采用本地 [Saga 模式](https://microservices.io/patterns/data/saga.html)支持，这涉及到在一个服务失败的情况下补偿事务，以消除前面事务的影响。

它最近发布了第 1 版[,具有向后的能力，改进了碎片 id 的散列方式，并为存档提供了实验性的特性；跨数据中心复制；批量操作；动态配置和添加；以及使用 ElasticSearch 删除和创建可搜索属性。它正在制定贬值政策。](https://docs.temporal.io/blog/temporal-v1-announcement/)

根据[的一项案例研究](https://docs.temporal.io/blog/how-temporal-simplified-checkr-workflows)，Temporal 在背景调查技术供应商 [Checkr](https://checkr.com/) 很受开发者欢迎。

“将事物建模为工作流和活动使得团队间共享成为可能，这意味着代码被不断地重用而不是不断地重新发明，”它说，并指出可见性也有所提高。“能够一步一步地看到正在发生的事情，工作流采取了什么路径，这是非常有价值的。”

文件共享网站 [Box](https://www.box.com/home) 已经建立了一个定制的编排系统来处理大文件的更新，这些大文件通常包含数百万个文件，每个文件都有自己的权限和元数据。但是，每个工作人员和队列都需要定制的逻辑和状态，这很快使系统变得难以管理。

“在我的内心深处，一直是这样的，‘我们需要开始寻找一种可以解决一般工作流模式的技术。’我们需要一个能够存储状态的中央大脑，”高级职员软件工程师 Steven Cipolla 在一个案例研究中说道。

颞叶变成了中枢大脑。另一个好处是能够将它的软件架构与组织内的代码所有权边界对应起来，以帮助识别实现它所寻求的速度的障碍。

根据 Fateev 的说法，Temporal 计划在明年推出一个托管版本，这是一个非常受欢迎的功能。它将增加对更多数据库的支持，包括 Postgres，并增加更多的安全功能。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>