# 云原生拓扑的连续体

> 原文：<https://thenewstack.io/continuum-cloud-native-topologies/>

[](https://www.paloaltonetworks.com/prisma/cloud)

 [约翰·莫雷罗

约翰是 Twistlock 的首席技术官，领导公司与战略客户和合作伙伴的合作，并推动其产品路线图。此前，约翰是财富 500 强全球化学公司雅宝的 CISO。John 在微软的咨询服务和产品团队工作了 14 年。他负责在 Windows、Azure 和 Office 365 中发布安全技术的功能团队，并担任美国混合云咨询团队的首席架构师。约翰与妻子和两个年幼的儿子住在路易斯安那州。作为一名热情的渔夫和潜水者，他也是恢复路易斯安那海岸联盟的主席。](https://www.paloaltonetworks.com/prisma/cloud) [](https://www.paloaltonetworks.com/prisma/cloud)

就像一个新的宇宙，云原生生态系统有许多技术和项目从容器的初始核心快速剥离和扩展。一个特别激烈的创新领域是工作负载部署和管理技术。虽然 Kubernetes 已经成为行业标准的通用容器编制器，但其他技术(如无服务器)试图抽象与管理硬件和操作系统相关的复杂性。这些技术之间的差异通常很小，很细微，这使得理解它们之间的好处和权衡很有挑战性。我们从客户那里听到的最常见的问题之一是，这些不同的技术如何解决他们的情况，以及如何在它们之间进行选择。

考虑云原生技术的一个有用方法是从虚拟机(VM)到容器再到无服务器的连续体。一端是作为有状态实体运行的传统虚拟机，正如我们十多年来所做的那样。另一方面是完全无状态、无服务器的应用程序，它们实际上只是应用程序代码的捆绑包，没有任何打包的附带操作系统(OS)依赖性。介于两者之间的是 Docker、AWS 的新 [Fargate 服务](https://aws.amazon.com/blogs/aws/aws-fargate/)、容器即服务(CaaS)平台和其他技术，它们试图在兼容性和隔离性与敏捷性和密度之间提供不同的平衡。这种平衡是生态系统如此多样化的原因。每种技术都试图将支点放在不同的点上，但范围的两端是一致的:一端优先考虑熟悉性和分离性，而另一端则为了增加抽象和减少部署工作而牺牲一些特性。

所有这些技术都有自己的位置—它们是不同的工具，具有不同的优势和权衡，我们通常会看到客户至少同时使用其中的几种。随着组织将越来越多的关键工作负载引入其云原生堆栈，这种异构性不太可能改变，尤其是那些具有深厚传统根基的组织。

当我们考虑所有这些技术时，请记住[云原生计算基金会的章程](https://github.com/cncf/foundation/blob/master/charter.md)，它将云原生系统定义为具有以下属性:

容器包装好的。在软件容器中运行应用程序和流程，作为应用程序部署的一个独立单元，并作为一种实现高级资源隔离的机制。改善整体开发人员体验，促进代码和组件重用，并简化云原生应用的操作。

动态管理的。由中央协调流程积极安排和管理。从根本上提高机器效率和资源利用率，同时降低维护和运营成本。

面向微服务。通过明确描述的依赖关系松散耦合(例如，通过服务端点)。显著提高应用程序的整体灵活性和可维护性。该基金会将推动技术的发展，推动应用程序管理的发展，并通过可靠的接口使该技术无处不在且易于使用。

## 虚拟机

虽然在原生云的背景下讨论虚拟机可能令人惊讶，但现实是当今世界上绝大多数工作负载都是“直接”(非容器化)在虚拟机中运行的。与我们合作的大多数组织并不认为虚拟机是一个需要淘汰的传统平台，也不仅仅是一个运行容器的哑主机。相反，他们承认他们的许多应用程序尚未容器化，传统虚拟机仍然是他们的关键部署模型。虽然没有托管容器的虚拟机不满足云原生系统的所有三个属性，但它仍然可以动态运行，并且可以运行微服务。

虚拟机在连续体中提供最高级别的隔离、兼容性和控制，适合运行几乎任何类型的工作负载。虚拟机技术的例子包括 [VMware 的 vSphere](https://www.vmware.com/products/vsphere.html) 、[微软的 Hyper-V](https://www.microsoft.com/en-us/cloud-platform/server-virtualization) 以及几乎每个 IaaS 云提供商提供的实例，例如[亚马逊的 EC2](https://aws.amazon.com/ec2/) 。虚拟机与连续体右侧的“瘦虚拟机”不同，因为它们通常以有状态的方式运行，操作系统、应用程序和数据之间几乎没有分离。

## 精简虚拟机

与其说是一种独特的技术，不如说是一种不同的操作方法，“瘦”虚拟机通常是与虚拟机相同的底层技术，但部署和运行的方式更加无状态。瘦虚拟机通常通过自动化部署，无需人工参与，以机群而非单个实体的形式运行，并优先考虑操作系统、应用程序和数据的分离。虚拟机可能会将应用程序数据存储在操作系统卷上，而精简虚拟机会将所有数据存储在一个单独的卷上，该卷可以轻松地重新连接到另一个实例。虽然瘦虚拟机也缺乏云原生系统的容器属性，但它们通常比传统虚拟机更注重动态管理。虽然虚拟机可以由操作员设置和配置，但瘦虚拟机通常会使用 Puppet、Chef 或 Ansible 等自动化工具从标准映像部署，无需人工参与。

精简虚拟机与连续体左侧的虚拟机的区别在于，它们有意关注任何给定实例的数据分离、自动化和可处置性。它们与 VM 集成容器的区别在于缺少容器运行时。瘦虚拟机将应用程序直接安装在其操作系统文件系统上，并由主机操作系统内核直接执行，无需任何中间运行时。

## 虚拟机集成容器

对于一些组织，尤其是大型企业，容器提供了一种有吸引力的应用部署和操作方法，但缺乏足够的隔离来混合不同敏感度级别的工作负载。抛开最近发现的 Meltdown 和 Spectre 等硬件缺陷不谈，虚拟机提供了更强的隔离程度，但代价是增加了复杂性和管理负担。虚拟机集成容器，如 [Kata containers](https://katacontainers.io/) 和 [VMware 的 vSphere Integrated Containers](https://www.vmware.com/products/vsphere/integrated-containers.html) ，试图通过提供开发人员友好的 API 和来自操作系统的应用抽象的混合来实现这一点，同时隐藏虚拟机管理程序中兼容性和安全隔离的底层复杂性。

基本上，这些技术寻求在用户不知道自己是虚拟机或不管理虚拟机的情况下提供虚拟机。相反，用户执行典型的容器命令，如 docker run，底层平台自动且不可见地创建新的 VM，在其中启动容器运行时并执行命令。最终结果是，用户在一个单独的操作系统实例中启动了一个容器，通过一个管理程序将其与所有其他容器隔离开来。一般来说，这些集成了 VM 的容器通常在一个 VM 中运行一个容器(或者一组密切相关的容器，类似于 Kubernetes 中的 pod)。VM 集成容器拥有所有三个云原生系统属性，并且通常甚至不提供手动配置作为可选的部署方法。

虚拟机集成容器与左侧的瘦虚拟机不同，因为它们被明确设计为单独运行容器，并将虚拟机供应与容器运行时操作紧密集成。它们与连续体右侧的纯容器不同，每个操作系统实例映射一个容器，集成的工作流用于通过单一的、以容器为中心的流程实例化新虚拟机及其托管的容器。

## 容器

[容器](/category/containers/)提供了所有三种云原生系统特性，并在连续体中提供了一组平衡的功能和权衡。Docker 项目普及并广为人知的是，容器已经以各种形式存在了很多年，并植根于 Solaris Zones 和 BSD Jails 等技术。虽然 Docker 是一个知名品牌，但其他供应商正在采用它的底层技术 runc 和 containerd 来创建类似但独立的解决方案。

容器平衡了分离(虽然不如虚拟机强大)、与现有应用程序的出色兼容性以及高度的操作控制，具有良好的密度潜力，并易于集成到软件开发流程中。容器的操作可能很复杂，主要是因为它们具有广泛的可配置性，并且为运营团队提供了多种选择。根据这些选择，容器可以是完全无状态的、动态的、隔离的，也可以是与主机操作系统高度混合的、有状态的，或者介于两者之间。这种选择度既是容器最大的优点，也是容器最大的弱点。作为回应，市场在其右侧创建了连续系统(如无服务器系统)，以使其更易于大规模管理，并通过减少一些可配置性来降低其复杂性。

容器不同于左侧的 VM 集成容器，因为它不使用容器到 VM 的严格 1:1 映射，也不将底层主机操作系统的供应打包到容器部署流程中。它们要求用户负责所有底层基础设施的部署和操作，不仅包括硬件和虚拟机，还包括每个虚拟机内主机操作系统的维护，这与容器即服务平台截然不同。

## 容器即服务

随着容器越来越受欢迎，用例越来越多样化，像 Kubernetes(及其衍生产品，如 OpenShift)、Mesos 和 Docker Swarm 这样的编排器对于大规模部署和操作容器变得越来越重要。虽然抽象了部署和操作大量微服务所需的复杂性，这些微服务由许多容器组成并在许多主机上运行，但这些编排器本身的设置和维护可能很复杂。此外，这些编排器专注于容器运行时，很少帮助底层主机的部署和管理。虽然成熟的组织经常使用自动化工具中包装的瘦虚拟机等技术来解决这一问题，但即使这些方法也不能完全减轻组织管理底层计算、存储和网络硬件的负担。默认情况下，CaaS 平台提供所有三种云原生特性，尽管由许多更通用的组件组装而成，但针对容器工作负载进行了高度优化。

由于主要的公共云 IaaS 提供商已经在较低级别的自动化和部署方面进行了大量投资，因此许多提供商选择利用这一优势来构建完整的平台，以运行力求消除用户对底层硬件和虚拟机的管理的容器。这些容器即服务平台包括[谷歌容器引擎](https://cloud.google.com/kubernetes-engine/)、 [Azure Kubernetes 服务](https://azure.microsoft.com/en-us/services/container-service/)和[亚马逊的 EC2 容器服务](https://aws.amazon.com/ecs/)。这些解决方案将 orchestrator 的容器部署和管理功能与其自己的特定于平台的 API 相结合，以创建和管理虚拟机。这种集成允许用户更轻松地调配容量，而无需管理底层硬件或虚拟化层。其中一些平台，如 Google Container Engine，甚至使用瘦虚拟机运行以容器为中心的操作系统，如[容器优化操作系统](https://cloud.google.com/container-optimized-os/)或 [CoreOS](https://coreos.com/) ，以进一步减少管理主机操作系统的需求。

CaaS 平台不同于左侧的容器，它提供了一组更全面的功能，这些功能抽象了硬件和虚拟机配置所涉及的复杂性。它们与右侧的按需容器不同，通常仍支持用户直接管理底层虚拟机和主机操作系统。例如，在大多数 CaaS 部署中，用户可以直接通过 SSH 连接到一个节点，并以 root 用户身份运行任意工具来帮助诊断或定制主机操作系统。

## 按需容器

虽然 CaaS 平台简化了容器的大规模部署和操作，但它们仍然为用户提供了管理底层主机操作系统和虚拟机的能力。对于一些组织来说，这种灵活性是非常需要的，但是在其他用例中，这可能是不必要的干扰。尤其是对于开发人员来说，无需了解或配置底层主机或虚拟机就能简单运行容器的能力可以提高开发效率和灵活性。

按需容器是一组技术，旨在权衡 CaaS 平台的一些兼容性和控制，以降低复杂性并简化部署。按需容器平台包括[亚马逊的 Fargate](https://aws.amazon.com/fargate/) 和 [Azure 容器实例](https://azure.microsoft.com/en-us/services/container-instances/)。在这些平台上，用户可能无法直接访问主机操作系统，必须专门使用平台界面来部署和管理其容器工作负载。这些平台提供了所有三种云原生属性，甚至可以说是必需的；通常情况下，**不**为他们构建应用程序作为微服务是不切实际的，而且环境只能动态管理并作为容器部署。

按需容器与左侧的 CaaS 平台不同，它缺乏对主机操作系统和虚拟机直接控制的支持，并且需要通过特定于平台的接口进行典型管理。它们与右边的无服务器有所区别，因为按需容器仍然运行正常的容器映像，这些映像可以在任何其他容器平台上执行。例如，用户可以在桌面上的容器中直接运行的同一映像可以在 CaaS 平台或按需容器中不加更改地运行。作为应用程序的全球可移植包，映像格式的一致性，包括其所有底层操作系统级依赖性，是与无服务器环境的一个关键区别。

## 无服务器

尽管按需容器极大地减少了向最终用户公开的“表面区域”,从而降低了管理它们的复杂性，但一些用户更喜欢用更简单的方式来部署他们的应用程序。无服务器是一类技术，旨在允许开发人员只向服务提供他们的应用程序代码，然后服务自动实例化其下的其余堆栈。在无服务器应用程序中，开发人员只上传应用程序包本身，没有完整的容器映像或任何操作系统组件。该平台将其动态打包成映像，在容器中运行映像，并(如果需要)实例化运行映像所需的底层主机操作系统、虚拟机和硬件。在无服务器模式中，用户为了获得最简单、最高效的部署和管理体验，在兼容性和控制之间做出了最大的权衡。

无服务器环境的例子包括亚马逊的 Lambda 和 T2 的 Azure Functions。可以说，许多 PaaS 平台，如 [Pivotal Cloud Foundry](https://pivotal.io/platform) 实际上也是无服务器的，即使它们在历史上并没有这样营销。虽然从表面上看，无服务器可能缺乏特定于容器的云原生属性，但容器在底层实现中被广泛使用，即使这些实现没有直接向最终用户公开。无服务器与按需容器的区别在于，它完全无法与底层主机和容器运行时交互，通常甚至无法看到它运行的软件。

## 结论

如今，一些供应商已经在尝试这些方法的组合，如亚马逊的 EC2 Kubernetes 服务与他们的 Fargate 技术相集成，以有效地创建按需 CaaS 平台。此外，随着用户获得更多运行这些平台的经验，可用的选项自然会缩小，因此只有顶级工具选择留在市场上。

“软件吞噬世界”的趋势正在推动几乎每个组织投资软件，作为他们业务的竞争优势。这推动了对支持开发人员敏捷性和运营规模的平台的巨大需求，从而为云原生拓扑带来了广泛的选择。每一种都有自己的优点和缺点——但是决定不是用哪一种，而是用哪一种。很少有组织会找到一个非常适合他们所有需求的选项，相反，他们会找到几个选项，每个选项都为不同的工作负载和使用情形提供优势，因为它们会发生变化和增长。

Twistlock 赞助了这篇文章。[云计算原生计算基金会](https://www.cncf.io/kubecon-cloudnativecon-events/)是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>