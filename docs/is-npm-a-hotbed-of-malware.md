# npm 是恶意软件的温床吗？

> 原文：<https://thenewstack.io/is-npm-a-hotbed-of-malware/>

根据领先的开源安全提供商 [WhiteSource](https://www.whitesourcesoftware.com/) 的说法， [npm](https://www.npmjs.com/) 是使用最广泛的 JavaScript 包管理器之一，是恶意行为者的[游乐场。真的有那么糟糕吗？](https://www.whitesourcesoftware.com/whitesource-npm-threat-report-for-javascript-package-registry/)

首先，JavaScript 非常流行。不管你喜不喜欢， [Javascript by Stack Overflow 的 count 仍然是当今最常用的编程语言](https://insights.stackoverflow.com/survey/2020#technology-programming-scripting-and-markup-languages)。全世界有超过 1600 万开发人员依赖于它的速度、强大的文档以及与其他编程语言的互操作性，这些都不会很快改变。

但它的受欢迎程度是喜忧参半。黑客越来越多地瞄准 JavaScript 的开源包管理器和包注册表。其中使用最广泛的是 npm，有超过 180 万个活动包。

## 恶意软件检测

使用该公司的旗舰自动恶意软件检测平台 [WhiteSource Diffend](https://www.whitesourcesoftware.com/resources/blog/welcome-to-whitesource-diffend/) 。该公司声称，2021 年在 npm 中发现了超过 1300 个恶意 npm 包。这很糟糕，但是 180 万中的 1300 只占 0.007222%。如果你只是为你的程序随机抓取 JavaScript 包，你很可能是安全的。

根据该报告，WhiteSource 跟踪了 2021 年期间每月平均发布的 3.2 万个新的 npm 包。即使在每年总共 38.4 万个包裹中，你抓取错误代码的几率也只有 0.00338%。

当然，没有人这样编程。但是这确实强调了在将 npm 代码引入项目之前，您需要非常仔细地查看它。例如，您会想要避免新代码或其他人已经避免的代码。

## 不同的攻击

另一方面，当隐藏在 npm 中的攻击类型包括:

*   软件供应链攻击:用于窃取数据，破坏目标系统，并通过横向移动获得整个网络的访问权限。
*   加密劫持:使威胁参与者能够控制受害者的计算资源，以挖掘加密货币。
*   数据窃取:攻击者使用键盘记录程序、屏幕抓取程序、间谍软件、广告软件、僵尸程序等从受害者那里窃取私人和/或专有数据。
*   安全研究:攻击者创建的包谎称是为安全研究而设计的，但实际上包含恶意代码。

我不认为你知道。

的确，大多数 npm 恶意软件只是检查你的网站。但是谁会想要一个侦察程序在你的系统中漫游呢？我当然不知道！

此外，根据 npm 的官方统计，每周有 200 亿个软件包版本被下载。显然，当谈到使用 npm 包时，很少有人在尽职调查。

就其本质而言，国家预防机制很难监管。Npm 使您能够使用外部库，并支持依赖性管理。结合起来，这使得为您的项目调用第三方库和依赖项变得非常容易。此外，虽然理论上 npm 软件包包含了其功能所需的一切，但很多软件包在安装时会下载额外的资源。当然，您检查了特定程序的安全问题，但是它所有的依赖项和下载内容呢？

你会说“[依赖地狱](https://searchitoperations.techtarget.com/definition/dependency-hell)”吗？我可以。

## 保护软件供应链

Npm 是一个典型的例子，说明了为什么[我们需要软件供应链安全](https://www.zdnet.com/article/securing-the-open-source-ecosystem-sboms-are-no-longer-optional/)。我们现在就需要它。

因此毫不奇怪，“随着 2021 年超过 18，000 个 npm 包版本的发布，毫无疑问，npm 是开发者的一个有价值的工具，”WhiteSource 的联合创始人兼首席执行官 [Rami Sass](https://www.linkedin.com/in/sassrami/?originalSubdomain=il) 解释道。但是，“不幸的是，这种受欢迎程度正被威胁者用来传播恶意软件和发起攻击，从而损害企业和个人。”

例如，假设您下载了您认为是广受好评的 npm 包 style-resources-loader 和 sass-loader。但是，不幸的是，你下载了两个伪造的[盗版](https://blog.loomly.com/brandjacking-definition/)包。除了拥有一眼就能看出来的名字之外，它们还包含了好的源代码。但是，隐藏在里面的是一个混淆的 JavaScript 文件和一对隐藏为 JavaScript 组件的二进制文件，这是不怀好意的。

具体来说，其中一个伪造的 JavaScript 文件是对手模拟框架 [Cobalt Strike](https://attack.mitre.org/software/S0154/) 的一部分。最终目标？让你的机器开始采矿 [Monero 加密货币](https://www.getmonero.org/)。没人认为这是一段美好时光。

## 与众不同

那么，你能做什么？当然，WhiteSource 希望你下载并最终购买 Diffend。他们的工具会进行检查，以确保您只使用经过验证的软件包源，并避免大多数 npm 安全陷阱。使用 Diffend 实际上是一个好主意。

此外，WhiteSource 还提供了许多其他建议，帮助您抵御常见的 npm 安全漏洞。其中包括:

*   警惕域名抢注及其朋友。比如 ss pec-> r spec；atlas-client-> atlas _ client；达默劳-莱文斯坦->达默劳-莱文斯坦；还是 ruby-比特币->比特币-ruby
*   永远不要盲目地假设任何注册表的所有权。
*   从被放弃的包中迁移或者接管它们。
*   不要使用相当新的包装(如几天前)。
*   向包所有者报告意外行为和不一致。
*   不要在没有运行评估的情况下安装软件包。
*   不要在没有仔细检查代码的情况下安装升级的库。
*   确保提取请求(PR)更新的依赖关系更新工具有足够的时间延迟来验证包更新。
*   不要使用相同的环境变量(ENV)来运行规范、构建容器、推送东西等。

最后，请永远记住，迄今为止，npm 造成的最大损害根本不是来自传统的恶意软件。相反，它来自开发人员摆弄他们的 npm 库，例子包括[最近的“colors.js”和“faker.js”混乱](https://www.zdnet.com/article/when-open-source-developers-go-bad)和 [2016 年臭名昭著的“左垫 npm”插曲](https://www.theregister.com/2016/03/23/npm_left_pad_chaos/)。

简而言之，虽然我不能说 npm 是“恶意行为者的游乐场”，但我可以说它是恶意软件的温床，无法很好地保护自己免受其固有的安全问题的影响。如果你使用 npm，我知道你们很多人都这样做，你必须采取措施保护自己。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>