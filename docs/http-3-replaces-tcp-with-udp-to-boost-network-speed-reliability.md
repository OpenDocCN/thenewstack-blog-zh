# HTTP/3 用 UDP 取代了 TCP，提高了网络速度和可靠性

> 原文：<https://thenewstack.io/http-3-replaces-tcp-with-udp-to-boost-network-speed-reliability/>

为网站和服务获得 [HTTP/2](https://thenewstack.io/take-advantage-http2-speed-web-sites-apps/) 的性能和安全优势意味着进行架构上的改变，因为它颠覆了像分片这样的原则，而分片曾被用来提高网站性能；这可能就是为什么目前只有大约 35%的网站使用 HTTP/2。

HTTP/3 在此基础上又增加了一倍，提供了非常相似的特性，但是用 UDP 代替了 TCP。这一次，可能需要对网络基础设施进行更根本的改变，以利用较差连接和移动网络的更好性能，但对于大多数开发人员来说，这种改变将是透明的。

HTTP/3 是该协议的第三个主要版本，它包括 TLS 1.3 和一个称为 QUIC(快速 UDP 互联网连接)的新传输协议；基于谷歌最初设计的 2013 协议，现在有多个贡献者和公司[通过互联网工程任务组](https://github.com/quicwg/base-drafts) (IETF)参与进来。

## 不可靠是一个机会

放弃 HTTP 一直用于 UDP 的 TCP 连接并不像看起来那么奇怪。U 有时被扩展为“不可靠”而不是用户数据报协议，因为它不能保证消息传递或数据包顺序。但是对于今天的网络，这实际上是一个提高 HTTP/2 引入的多路复用连接性能的机会。“有了 HTTP/3，我们将在旧的不可靠的互联网之上建立一个新的可靠的协议，”[的首席技术官 John Graham-Cumming](https://github.com/jgrahamc) 告诉新的堆栈。

HTTP/2 通过在同一个连接上发送多个 HTTP 请求，允许应用程序同时处理请求，从而更好地利用网络带宽。但是这些收益只有在网络完美运行时才能实现。Graham-Cumming 说:“你可以最大限度地提高吞吐量和带宽，因为 TCP 会计算出它能达到的最大速度，所有并行连接都以最快的速度运行。”。

这很好，除非网络连接出现问题，如网络拥塞或在移动网络上从一个小区移动到另一个小区，数据包丢失。“TCP 保证发送数据包的顺序就是应用程序接收数据包的顺序——所以如果你错过了一个，所有的事情都必须停止，直到那个特定的数据包被重新传输。如果您将多个请求多路传输到一个 TCP 连接上，那么所有这些请求都必须停止并等待，即使丢失的数据包可能只影响其中一个。

Graham-Cumming 解释说，这种“行首阻塞”问题是 TCP 所固有的，使用 UDP 可以通过允许应用程序控制数据包的重新传输来解决这个问题。“它可以说‘数据包丢失，但它只影响这一个数据流，其他数据流可以继续传输’。”这使得 QUIC [在恶劣的网络条件下更加健壮。](https://dl.acm.org/citation.cfm?id=3098842)

HTTP/3 的连接迁移建议可以将这种健壮性扩展到不同网络之间的移动，如从 Wi-Fi 到移动宽带，这通常会因为 IP 地址的改变而中断网络连接。“有了这个提议，你和服务器之间的标识符将不是 IP 地址，而是协议本身内的标识符。这将允许你在新网络上自动重启整个连接，这样你就可以无缝地从 Wi-Fi 连接到移动连接。最初的互联网的一些假设是，有相当固定的连接，我们现在正在进入一个非常移动的异构世界。”

Graham-Cumming 解释说，HTTP/3 还直接集成了 TLS，QUIC 对信息包传输的额外控制在这里也有优势。“当东西通过互联网发送时，它们被分成包；在 TLS 中，有一个传输数据缓冲区的概念。如果你想变得真正高效，你需要把所有这些事情排好队；这里有一个请求，我将对它进行加密，并通过互联网传输，这样它就可以一次性接收，而不会被分成更小的数据包，其中一些数据包也不会被延迟。如果你控制了这一切，如果你只是假设互联网是一种不可靠的数据包发送方式，那么你就可以控制你发送东西的顺序，你就可以控制你如何加密它们以及这些加密的数据块如何被传输。”

QUIC 规范的编辑之一，Mozilla 首席工程师 [Martin Thomson](https://github.com/martinthomson) 说，与 HTTP 服务器的初始连接会更快，因为 HTTP/3 去掉了建立安全连接通常需要的往返行程之一。

“使用 TCP 和 TLS，连接设置从 TCP 握手开始:客户端发送 SYN，服务器以 SYN+ACK 响应，客户端以 ACK 结束。然后，在发送任何请求之前，还有一个 TLS 握手，它需要另一个类似的三个消息交换。QUIC 大部分时间将其压缩到一个单独的交换中。一个关键特性是 0-RTT，它允许客户端立即发送请求；这是 TCP 和 TLS 的一个选项，但您仍然需要等待 TCP 握手完成。”

## **默认安全**

集成 TLS 还提高了安全性，因为身份验证和加密是由网络协议提供的，而不是由 TLS 之类的高级协议提供的——而且由于 TLS 内置在 HTTP/3 中，使用它也不是可选的。Graham-Cumming 指出:“业界正试图让一切都默认为安全的。”。当一个网站使用 HTTPS 时，浏览器不再显示锁，而是在一个网站*没有*加密连接时警告你。HTTP/3 和 QUIC 是朝着这个方向的另一个举措。

Thomson 解释说:“QUIC 的很多内容都被加密了。”。这包括攻击者可能试图使用的元数据。除了有助于将分组识别为 QUIC 分组的几个比特之外，QUIC 分组中唯一未加密的部分是用于连接的不透明标识符。这包括 TCP 和 TLS 不能保护的东西，比如确认(“我从你那里多得到了 5 个字节”)。

汤姆森还认为加密实际上会简化 QUIC 的部署。将新协议部署到需要更新的防火墙、路由器、NAT 和其他网络设备上的复杂性阻碍了创建新的、更有效的传输协议的努力，并推迟了 TLS 1.3 在浏览器中的采用。“这是部署 QUIC 成为可能的部分原因。互联网往往会干扰新协议，而加密将保护 QUIC 免受干扰。”

他坚持认为，这是 UDP 是一个好选择的另一个原因。“新协议不能像 TCP 或 UDP 那样直接部署在 IP 之上，因为那需要更新太多的互联网。想象一下更换或升级每个想要使用这种新协议的家庭中的每个路由器的前景。在这种情况下，UDP 是理想的，因为它做得很少。它非常轻便，因此允许我们在上面构建所有必要的部分。UDP 的主要缺点是少数网络会阻止或降低 UDP 性能。在这些罕见的情况下，我们可以依靠 HTTP/2。”

当用户访问一个站点时，他们的初始连接将通过 HTTP 或 HTTP/2，服务器将提供 HTTP/3 作为替代；理解提供该连接的报头的浏览器将在下次访问时记住它，但是旧的浏览器和设备将继续使用旧的协议。“我们预计 HTTP/2 和 1.1 将会存在很长时间，”Graham-Cumming 预测道。

## 网络变化

HTTP/3 可能有它的名字，但它仍在开发中；格雷厄姆-卡明斯暗示，形势稳定下来还需要几个月的时间。虽然在 Cloudflare 这样的服务上有 HTTP/3 端点可供测试，但脸书和 Litespeed [已经在 2018 年 11 月展示了他们 HTTP/3 实现之间的](https://twitter.com/dmitri_tikhonov/status/1059998989557395457)互操作性，浏览器和 web 服务器还不支持 HTTP/3(超出了 Chrome 对谷歌原始版本 QUIC 的实验性支持)。

一旦他们这样做了，服务提供商和托管公司将紧随其后，但旧的网络设备可能需要更新。Graham-Cumming 说:“UDP 的 NAT 穿越不如 TCP 发展得好，一些家庭路由设备假设什么样的 UDP 用于流视频，而不是 web。

汤姆森说，如果你托管自己的网络服务器，你会有更多的工作要做。“服务器管理员会发现 QUIC 需要的不仅仅是软件升级。启用 UDP 将需要网络和负载平衡基础设施的新支持。”网络运营商可能需要寻找更智能的第 4 层负载平衡解决方案，可以在软件中实现，如脸书的 [Katran 项目](https://github.com/facebookincubator/katran)。

但是因为 HTTP/3 是为解决 HTTP/2 的问题而设计的，所以当它可用时，你对 HTTP/2 所做的优化比如对域分片的改变将会自动应用。当它实现时，格雷厄姆-卡明希望它能推动网络向前发展。“我们希望网络和应用编程接口的下载速度更快。它应该会使互联网更加可靠和快速，并且希望对开发者来说，我们可以获得更丰富的 API 和 web 应用程序，因为这种新协议使我们可以更加依赖互联网。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>