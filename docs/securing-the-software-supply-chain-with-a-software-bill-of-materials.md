# 用软件材料清单保护软件供应链

> 原文：<https://thenewstack.io/securing-the-software-supply-chain-with-a-software-bill-of-materials/>

这个故事是我们将发布的一系列文章中的第一篇，这些文章探讨了安全在开源软件供应链中的作用。请在本月随时查看更新。

当一个流行的开源框架或组件的维护者死了，[进了监狱](https://www.theregister.co.uk/2020/03/26/corejs_maintainer_jailed_code_release/)或者只是厌倦了，会发生什么？软件依赖于回购的开发者可能有时间准备；可能会有一个带有正式继承流程的官方回购，一个快速但非正式的社区分叉。或者代码可能会消失——这可能[也会影响使用它的商业工具](https://github.com/sethvargo/chef-sugar)。即使有警告和计划时间，只有当开发人员意识到他们的软件中的依赖性并监控他们的状态时，它才是有帮助的。

死亡、监禁和突然离开可能很少见；软件漏洞不是。正如[微软](https://www.microsoft.com/en-us/) Azure 首席技术官 [Mark Russinovich](https://twitter.com/markrussinovich) 在今年早些时候的 RSA 会议上指出的，非常受欢迎的开源软件包已经被入侵多次，这意味着使用它们的组织也受到了威胁。

Webmin web portal admin toolkit 的构建脚本被篡改，留下了一个[窃取凭证的后门，持续了一年](http://www.webmin.com/exploit.html)，在此期间，它被下载了一百万次。当 npm 上的 **Bootstrap-sass** web 样式框架遭到破坏，攻击者移除了旧版本时，过了八天才出现安全版本。在一个新的维护者自愿接管一个旧的但仍然流行的 repo 之后，一个 crypto miner 被添加到 Node.js 事件流包中。

即使是经验丰富的大型技术组织也可能在保护其回购时出错(Canonical 的 GitHub 帐户在 2019 年遭到破坏)，或者错过修复组件中新发现的漏洞的更新。GitHub 只是发现它没有更新 Mercurial 导入代码中的一个依赖项，该依赖项清除了分支名称，使得攻击者能够通过其 bug bounty 程序在 GitHub 服务器上运行代码(尽管是在隔离网络上的沙箱中)[。](https://github.blog/2020-03-25-six-years-of-the-github-security-bug-bounty-program/)

这些问题当然不是开源独有的，但正如 Russinovich 指出的，“开源是一个如此巨大的生态系统，我们需要特别关注它，在供应链中有一些特定的实现点需要为开源解决。”

将开发人员和运营团队使用的开源软件视为一个供应链，可以更容易地思考问题发生在哪里。“我们如何确保只有我们有把握的包和源代码是值得信任的，才能进入我们的供应链？我们如何确保我们对供应链的了解是可靠的:当有人说‘这是值得信赖的，我已经对它进行了代码审查，我已经准备好 MFA 来检查源代码’时，事实确实如此。然后，当出现漏洞时，我们该怎么办，如何识别受漏洞影响的内容，以及如何恢复到良好的版本？”

> 导入一个包并不只是添加一个依赖项；它也带来了包导入的上游依赖。

开源社区可以采取多个步骤，从良好的卫生软件开发和软件包管理开始，一直到为软件定义“材料清单”,就像我们为物理产品所做的那样，以使依赖性跟踪更加有效。

像 linters、fuzzers 和静态代码分析这样的软件安全工具可以提高代码质量。虽然 [Coverity](https://scan.coverity.com/) 是一个专有的静态分析工具，但它可以免费扫描用 C、C++、C#、Java、JavaScript、Python 和 Ruby 编写的开源项目中的缺陷，并获得根本原因的解释。

[栓子](/spot-bugs-as-you-code-with-embolds-ai-enabled-static-analysis-and-visualization-tool/)也是免费开源使用。谷歌的 [OSS-Fuzz](https://github.com/google/oss-fuzz) 服务，与 [Linux 基金会的核心基础设施计划](https://www.coreinfrastructure.org/)一起运行，使用多个 fuzzing 引擎，检查用 C/C++编写的开源项目，Rust and Go free，已经在 250 个项目中发现了 17，000 个错误。

GitHub 希望其安全实验室(对开源项目免费)和 [CodeQL](https://thenewstack.io/how-code-analytics-could-help-github-decipher-its-semantic-code-graph-of-open-source/) 能够帮助消除数千个项目中的漏洞，而不是让每个维护者一次检查一个项目。

GitHub 安全实验室奖金计划有一个新的 [Bug Slayer 类别](https://securitylab.github.com/bounties)来奖励那些编写代码查询的研究人员，维护人员可以运行这些代码查询来发现不仅仅是特定的漏洞，而是整个类别的漏洞。这样，CodeQL 查询不仅可以大规模地修复当前的漏洞，而不是一个一个地修复，而且还可以防止未来出现新的类似漏洞。

同样对开源项目免费的还有 [Snyk](https://snyk.io/plans/) ，它会扫描你的源代码报告并告诉你是否有依赖。现在 GitHub 拥有了 npm，检查这些依赖关系将变得更加容易；正如 GitHub 首席执行官 [Nat Friedman](https://twitter.com/natfriedman) 在宣布收购时指出的，“展望未来，我们将整合 GitHub 和 npm 以提高开源软件供应链的安全性，并使您能够跟踪从 GitHub pull 请求到修复它的 npm 包版本的变化。”

## 依赖链

尽管自动化依赖工具有助于理解项目是什么代码，以便开发人员可以更新和修补(以及将修补作为源代码和构建管理的一部分自动化)，但长期方法需要更加系统化——因为依赖链在开源世界中是如此之深。导入一个包并不只是添加一个依赖项；它也带来了包导入的上游依赖。因为许多节点包都是片段，安装一个节点包意味着平均信任 80 个包，而且这个数字会随着时间的推移而增加。

“我们在这些生态系统中看到的一个有趣的趋势是，一旦某种东西变得流行，它就会变得更加流行，”Russinovich 指出。对于像[继承](https://www.npmjs.com/package/inherits)和 [Lodash](https://www.npmjs.com/package/lodash) 这样的节点供应链中被引用最多的五个包，这达到了 150，000 个依赖项。你可以在[npm.broofa.com、](http://npm.broofa.com/)查看节点包，上面还显示了相关的许可证，以及有多少维护者参与了这些依赖关系。开发人员不仅依赖于他们代码的质量，还依赖于他们如何保护自己的构建过程和发布管理不受损害。

为了更容易检测构建服务器何时受损，微软正在推动可复制构建的采用；源代码的构建不仅应该是版本化的，而且应该是确定性的，记录下所使用的工具以及重现或验证构建所需的步骤。他解释说:“可再生构建给你的是获取一些源代码的能力，有人可以重新构建它，并知道给定编译器，给定被拉入其中的工件，当他们进行构建时，工件将具有特定的哈希。”。“然后，当有人说‘这是一个合法的构建，这是它的哈希值’时，他们可以验证没有任何东西被篡改，没有任何东西进入从构建到发布管理的供应链中间，通过从源代码进行重建。”

现在大多数 Windows 都是用可复制的版本构建的，而 Linux 正在向可复制的方向发展。尽管它会有一些奇怪的副作用；已签名的 Windows 二进制文件中的时间戳不再是实际时间，因为否则，每次运行构建时它们都是不同的，因此转向可重复构建可能意味着大量的更改。

开发人员还需要确保，如果他们突然离开，就像 leftpad 和 sugar 那样，或者即使回购因网络问题而不可用，他们也可以访问他们所依赖的软件包。如果一个包遭到破坏，攻击者删除了以前的版本以阻止开发人员恢复它，这也可以保护您。

对于开发人员来说，通过了解他们所依赖的项目的源代码质量和信誉来保护他们自己的代码，并采取措施来确保可用性，他们需要的不仅仅是一个依赖列表。软件供应链和软件[材料清单](https://www.ntia.gov/SBOM)的想法是要有一个信息流，比如一个项目是否坚持维护者使用 MFA，并提供具有构建工件的可复制构建。构建系统可以查看已签名软件材料清单(SBOM ),并阻止已被篡改的发布，这样它们就不会与静态分析或依赖图揭示漏洞的构建工件或发布相匹配。

他警告说，转向一个软件包和构建包含如此多信息的系统，以便检查和阻止可以通过政策自动化，而需要对基础设施进行大规模改变，但像微软和谷歌这样的大型软件供应商已经致力于此。

信息和软件质量联盟(CISQ)和对象管理组织(OMG)已经[成立了一个工作组](https://www.it-cisq.org/software-bill-of-materials)来定义一个 SBOM 模型，用于一个全面的、层次化的软件项目清单，该清单可以在开发和编排系统之间交换。有两个项目已经在进行中。

他建议，现有的[软件包数据交换](https://spdx.org/)格式目前用于跟踪软件供应链中的许可要求，但它可能会发展成为交流 SBOM 信息的开放标准。“他们现在正在考虑扩展这一功能，以支持软件材料清单的要求，包括强签名、身份和与之配套的策略。”

来自纽约大学[安全系统实验室](https://ssl.engineering.nyu.edu/)和新泽西理工学院网络安全研究中心的 [in-toto 项目](https://github.com/in-toto/in-toto)专门用于通过在构建和发布系统中应用策略来帮助安全软件供应链。In-toto 监控 ide 内部发出的命令，如 Visual Studio 代码和它们创建的工件，包括 SHAH hashes，无论是克隆 repo 还是运行 linter。这些工件可以根据哈希进行验证，并用于检查一个包是否符合策略，比如已经通过静态分析运行过，或者在发布之前进行了模糊处理或修补了依赖关系。

像这样的工具可以给开发软件的开发人员和使用开源软件的组织信心，让他们知道他们得到了什么，这对保持开源生态系统的健康至关重要。

“我们需要了解漏洞的影响和严重性，以及软件供应链的哪些部分受到它的影响。带有强命名、散列和来源归属的 SBOM。他建议说:“在一个所有东西都流经 sbom 的世界里，在代码的下游，你可以看看那些带有你所依赖的所有东西的 sbom，然后用自动化工具一路逆流而上，一直回到源文件。

这也将有助于您了解其他代码是否受到相同漏洞的威胁；一些比现在更难的事情。“当一个包中有一个漏洞，并且这个漏洞来自这段源代码时，还有哪个包依赖于这段源代码呢？这是 SBOMs 最终可以通过自动回溯元数据中的依赖链来回答的问题。”

Linux 基金会和 Snyk 是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>