# DNS 劫持的风险很大，您应该采取对策

> 原文：<https://thenewstack.io/risks-dns-hijacking-serious-take-countermeasures/>

编者按:

[In a separate post](https://thenewstack.io/researcher-hijacked-several-io-tld-nameservers/)

卢西恩·康斯坦丁解释了一名研究人员如何劫持了一名

*.io top level domain*

名称服务器

*and what exposures it has surfaced about registries for country-code top-level domains.*

多年来，黑客已经劫持了许多域名，通过操纵它们的 DNS 记录将访问者重定向到恶意服务器。虽然没有完美的解决方案来防止这种安全漏洞，但域名所有者可以采取一些措施来限制这些攻击对其 Web 服务和用户的影响。

就在上周五，攻击者设法改变了 751 个域名的 DNS 记录，这些域名是通过大型域名注册商 Gandi.net 的 T2 注册和管理的。访问受影响域的访问者被重定向到攻击者控制的服务器，该服务器发起基于浏览器的攻击[，用恶意软件](https://securityblog.switch.ch/2017/07/07/94-ch-li-domain-names-hijacked-and-used-for-drive-by/)感染计算机。

同样在上周，一名安全研究员[劫持了七个域名服务器中的四个所使用的域名](https://thenewstack.io/researcher-hijacked-several-io-tld-nameservers/)。io 顶级域名(TLD)。他声称，他临时设置的测试 DNS 服务器被来自寻找的计算机的 DNS 查询淹没。io 域。如果他想的话，他可以回应流氓的回应。

域名及其 DNS 记录的管理方式很复杂。被称为注册管理机构的组织管理特定顶级域名的 DNS 区域，但这些区域中的记录来自域名注册商——与注册管理机构签订协议出售域名的公司。注册服务商本身可以有其他经销商，也可以与为他们管理 DNS 运营的第三方公司合作。

例如，根据甘地的说法，上周的恶意 DNS 修改是通过该公司用来管理地理顶级域名的技术提供商的未经授权的连接发生的。

域名所有者也有权从他们在注册商网站上的账户中更改他们域名的名称服务器。他们有时也会将 DNS 管理委托给第三方公司。

显而易见，这个复杂的系统可能会为黑客提供许多潜在的入口。根据链中的哪一个环节被破坏，攻击者可以通过一次破坏获得一个或数千个域的访问权限。

注册管理机构级别的违规显然是最严重的违规，因为它们会产生广泛的影响。这种妥协在过去发生过，尤其是在管理国家代码顶级域名(ccTLDs)的注册管理机构。

2012 年，黑客们利用了一个网站的漏洞。IE 域名注册(IEDR)并劫持了 Google.ie 和 Yahoo.ie 域名。同月，类似的漏洞和域名劫持[袭击了 PKNIC](https://web.archive.org/web/20121202050430/http://pknic.net.pk/2012/) 和 RoTLD。pk 和。ro ccTLDs。

这些年来，注册商和他们的经销商也受到了黑客的攻击。2013 年，一个黑客组织劫持了几个备受关注的域名，包括 nytimes.com、sharethis.com、huffingtonpost.co.uk、twitter.co.uk 和 twimg.com，此前他们在澳大利亚域名注册商和 IT 服务公司 Melbourne IT 对一个经销商帐户的凭据进行了网络钓鱼。

单个受损的域帐户也会产生严重的后果，特别是如果该帐户中的域名属于一家大公司或服务提供商。2013 年，黑客获得了大型云托管、主机托管和内容交付服务提供商 leaseweb.com 的域名管理员密码。

攻击者将 LeaseWeb 访问者重定向到一个网页，声称该公司没有安全性，其托管的所有网站都已被入侵。即使这些说法实际上不是真的，这也不是任何一家公司希望客户在访问其网站时看到的信息。

## 攻击者可以做什么

DNS 劫持是一种强大的攻击类型，为黑客提供了许多机会，但最终结果往往取决于他们设法妥协的域名。例如，如果受害者是一家主流新闻网站，攻击者可能会选择将访问者重定向到带有政治动机信息的页面。然而，如果该域属于一个流行的在线服务，他们可能会决定通过将受害者重定向到一个虚假的登录表单来窃取帐户凭据。这种方法甚至可以通过欺骗用户透露其短暂的一次性代码来绕过双因素身份验证。

当攻击者一次获得大量域名的访问权限时，他们更有可能发起大规模恶意软件分发攻击，就像最近的甘地事件一样。这比分析受影响的网站并为每个网站设计单独的攻击策略要容易得多。

同样值得注意的是，DNS 劫持不仅仅影响网络流量。被劫持的域名上的电子邮件和其他类型的服务连接也可能被拦截，从而可能导致敏感数据泄露。

DNS 劫持还会间接影响从外部服务或内容交付网络加载脚本和其他资源的网站。如果此类第三方服务的域名被劫持，攻击者可能会向成千上万个网站注入恶意代码。

## 域名所有者能做什么

为域名上托管的所有 web 应用和服务启用 HTTPS 应该是重中之重。一般来说，这将保护用户免受中间人攻击，并有许多其他好处，比如能够打开 HTTP/2 并获得显著的性能提升。然而，为了减轻 DNS 劫持的影响，HTTPS 需要与一种称为 HSTS 的安全机制相结合。

HTTP 严格传输安全(HSTS)是一种通过服务器报头表达的安全策略，所有现代浏览器都支持这种策略。它旨在防止协议降级攻击和 cookie 劫持，并可用于指示浏览器始终通过加密连接访问网站(HTTPS)。

如果没有它，攻击者劫持了一个支持 HTTPS 的网站的 DNS 记录，仍然可以通过将访问者引导到该网站的一个不使用 HTTPS 的虚假版本来实施网络钓鱼攻击。这种攻击的成功将取决于访问者是否会注意到浏览器地址栏中没有绿色 SSL/TLS 挂锁，这是用户不经常检查的。

在 HTTPS 之上有一个活跃的 HSTS 政策，如果通过未加密的连接提供服务，浏览器将简单地拒绝加载网站。为了绕过这种防御，攻击者必须从证书颁发机构获得该域名的有效证书，并将其安装在他的流氓服务器上。虽然这并不是不可能的——曾经有过 ca 被黑客攻击或诱骗签发欺诈性证书的案例——但这需要攻击者付出大量努力，而且他们成功的几率相当低。

当用户第一次访问网站时，浏览器会记录网站的 HSTS 策略，因此从技术上讲，中间人攻击者有机会阻止客户端在第一次访问期间接收到 HSTS 策略。为了关闭这个攻击窗口，谷歌 Chrome、Mozilla Firefox、Internet Explorer 和微软 Edge 都带有一个预加载的网站列表，对于这些网站，HSTS 总是被强制执行，网站管理员[可以提交他们的网站，以便包含在这个列表中](https://hstspreload.org/)。

另一种可以部分缓解 DNS 劫持攻击的机制是域名系统安全扩展(DNSSEC)。这是 DNS 协议的一套扩展，允许通过加密签名验证 DNS 响应的来源。

为此，TLD 域的根区域、域名服务器和用户的 DNS 解析器都必须支持 DNSSEC。这是一个问题，因为这个协议的使用还不广泛，特别是在解析器端。因此，虽然启用 DNSSEC 有可能保护一些用户免受 DNS 劫持——那些使用 DNSSEC 感知的解析器的用户——但它不会保护所有人。

另一个重要的缓解机制是注册服务商或注册管理机构可以为域名设置的一组锁或代码。它们是:注册器级别的 clientDeleteProhibited、clientUpdateProhibited 和 clientTransferProhibited，以及注册表级别的 serverDeleteProhibited、serverUpdateProhibited 和 serverTransferProhibited。

顾名思义，如果没有所有者的额外带外确认，这些标志将阻止域名被删除、转让或更新，包括更改域名服务器。[注册表级锁](https://www.verisign.com/en_US/channel-resources/domain-registry-products/registry-lock/index.xhtml)提供了更好的保护，在链中处于更高的位置。

2014 年，一群黑客进入了 MarkMonitor 的一个管理账户，这家总部位于旧金山的公司为大型企业和品牌管理域名。攻击者设法改变了 facebook.com 的联系地址信息，但无法改变域名服务器，因为它有一个注册表锁。

最后，为了降低通过第三方脚本注入恶意代码的风险，网站可以使用一种称为[子资源完整性](https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity) (SRI)的机制。这是通过为每个加载到网站的外部脚本计算和指定加密哈希来实现的。浏览器会将每个下载脚本的哈希与网站指定的哈希进行比较，如果不匹配，外部资源将不会被加载。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>