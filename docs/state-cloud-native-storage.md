# 云本地存储:初级读本

> 原文：<https://thenewstack.io/state-cloud-native-storage/>

[](http://iguaz.io/blog/)

 [亚龙·哈维夫

亚龙·哈维夫，iguazio 的 CTO 兼联合创始人，是一位涉足大数据、云、存储和网络的连续创业者。在加入 iguazio 之前，Yaron 是 Mellanox 的数据中心解决方案副总裁，负责技术创新、软件开发和解决方案集成。亚龙发推文为@亚龙特拉维夫。](http://iguaz.io/blog/) [](http://iguaz.io/blog/)

我们最近在一个技术论坛上讨论了什么是云原生存储，这让我相信这个话题值得更深入的讨论和更清晰的阐述。

不过首先，我想先定义一下什么是云原生应用程序，因为有些人可能认为将应用程序容器化就足以使其成为“云原生的”这是一种误导，没有实现云原生应用的真正优势，这些优势与弹性服务和敏捷开发有关。以下三个属性是主要的好处，没有它们，我们都会忽略要点:

*   **耐久性** —服务必须承受组件故障
*   **弹性** —服务和资源增长或收缩以满足需求
*   **连续性** —在服务运行时升级版本

起源于超大规模云应用的云原生架构围绕[微服务](https://en.wikipedia.org/wiki/Microservices)，即小型无状态、解耦的应用片段。可以部署许多类似的微服务实例(使用 Docker 或 Kubernetes)来解决服务弹性和复原力问题。多层微服务是更大且不断发展的应用程序的一部分。

[12 因素方法](http://12factor.net/)规定微服务实例不得保留任何配置、日志或数据，以实现云原生的耐用性、弹性和持续集成属性。状态和数据存储在分离的横向扩展日志流、消息队列、对象存储、键值和数据库中。

这种方法与传统整体/纵向扩展企业应用和当前 IT 基础架构(有时称为“pets”)中使用的方法截然不同，在当前 IT 基础架构中，应用需要大量配置、日志、数据和状态(按工作负载存储在“虚拟磁盘”中)。具有本地状态或缓存的应用程序可能会在出现故障时导致不一致，无法横向扩展，并且难以在不停机的情况下升级。

## 微服务是一次性的

微服务可以即时添加、删除和扩展，这带来了一些数据要求:

*   所有的数据更新都必须是原子性的，并且是持久的、分离的和共享的持久层。我们不能有临时脏缓存或中断的事务；无法使用本地日志；无法对文件执行部分更新，这可能导致数据损坏；无法在微服务中维护本地日志。
*   数据访问必须是并发的(异步的)。多个微服务同时读取和更新同一个数据仓库。更新应该是序列化的，没有阻塞、锁定或排他性。这使我们能够随着微服务实例数量的增加而线性扩展应用性能，并保持应用可用性。
*   数据层必须具有弹性和持久性，这样我们才能在不中断服务的情况下支持持续的数据增长。数据在一个或多个位置的可变数量的节点上进行分区和复制，以提供弹性。
*   数据应该具有灵活的结构和模式，以允许新功能和应用程序版本的持续开发。

云提供商的产品包括针对不同数据模型(对象、K/V、表格、文档、消息等)的服务。).亚马逊 S3、DynamoDB、Aurora、Kinesis、像 Big Query 和 Spanner 这样的谷歌服务，或者 Azure 的 cosmos db——都符合上述标准。MongoDB、Elasticsearch、Cassandra、RabbitMQ、Kafka 和 Minio 等开源解决方案，或者像 [Iguazio 的](https://www.iguazio.com/)数据平台这样的商业多模型产品，都做出了相同的假设。

传统的企业数据块存储解决方案(SAN、vSAN、HCI、光纤 NVMe 等。)和许多 NAS(共享文件服务)解决方案都不是为解决上述需求而设计的。这在涉及原子性(因为未提交的数据和状态可能存在于客户端)和并发性(当同一数据元素只能被更新或由单个消费者独占时)的情况下尤其缺乏，这也解释了为什么超大规模云供应商不将 SAN 或 NAS 用于云原生应用程序。

无服务器功能是最新的趋势，消除了本地持久存储，迫使我们使用云原生数据服务，与传统方法分道扬镳。

请记住，支持数据弹性或拥有容器 API 可能不足以成为云原生存储。

## 高效构建云原生数据服务

因此，我们需要一系列数据服务来存储日志流、统计数据、记录、文档、文件、消息等。我们可以使用许多开源或商业软件，但我们不应该在传统存储上运行它们吗？

在大多数情况下，在传统或横向扩展存储上运行商业或开源横向扩展数据服务(对象、消息传递/流、NoSQL/新闻 SQL、日志等)是多余且低效的，因为这些服务已经在服务级别使用复制或擦除编码技术来保证耐用性，在某些情况下甚至支持全局复制和灾难恢复。不要把钱花在企业级存储或具有 RAID 或存储层灾难恢复功能的超融合存储上，这将花费更多成本，并且很有可能由于跨磁盘和节点的 I/O 混合而只会降低您的性能和可用性。

您无法在存储层对横向扩展数据服务状态进行一致的快照，因为它是分布式的，数据服务在内部维护版本控制和其他形式的同步。此外，大多数数据平台在记录和文档级别实施压缩和重复数据删除，以提高搜索性能。云原生数据服务不需要具备快照或重复数据删除功能的高级存储产品。

对于在一个群集上运行的混合传统和云原生环境，使用传统的数据块或文件存储，只需确保关闭云原生数据服务的功能。要完全实现云原生，像云提供商那样构建数据层。使用更便宜的直连存储或闪存，并利用数据服务中间件内置的弹性和数据管理功能。

如果您有足够的数据要存储，那么使用优化的硬件会更具成本效益，因为与通用服务器/虚拟机相比，优化的硬件具有更高的磁盘或闪存密度以及更高的网络吞吐量。

## 数据服务购买或租赁与构建

作为一名开发人员，最简单、有时也是最便宜的选择是用你最喜欢的数据服务(Cassandra、MongoDB、Kafka 等)旋转一个 Docker 容器。)，但考虑到规模和运营，事情就复杂了。在数据服务级别*为这些堆栈中的每个*独立维护高可用性、安全性、配置管理、容量规划和性能调整。DIY 需要更多拥有更广泛技能的 DevOps 人员，而这些人并不总是能找到或负担得起。

租用或购买公共或私有云中的基础架构是减少风险和麻烦的常见方式。更上一层楼，使用更高级别的云原生数据服务，这样您就可以专注于编写业务应用程序，而不是调试中间件。公共云平台测试并集成了按需消费的数据服务，并以小时为基础定价。这些平台在多种服务之间具有统一的安全性和管理，节省了我们的集成和粘合层。

公共云产品也引起了一些担忧:它们可能价格更高，比 DIY 慢，包括 API 锁定，并且无法将所有数据都传输到云中。幸运的是，一种新的托管或内部自助式数据平台解决了这些问题。

你可以购买或租赁一辆汽车(虚拟基础设施)，照顾燃料，保险，停车，维修，驾驶等。或者，如果你太忙，只需获得拼车服务，付费使用，避免麻烦(云服务)。我们似乎一天比一天忙。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>