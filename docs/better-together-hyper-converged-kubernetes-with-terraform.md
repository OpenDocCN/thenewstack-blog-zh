# 一起更好:超融合的 Kubernetes 与 Terraform

> 原文：<https://thenewstack.io/better-together-hyper-converged-kubernetes-with-terraform/>

[](https://uk.linkedin.com/in/vnicolas)

[Nicolas ver mande](https://uk.linkedin.com/in/vnicolas)

[Nicolas 是 Ondat 的首席开发顾问。他是一名经验丰富的实践技术专家、传道者和产品负责人，在过去的 17 年里，他一直在云原生技术、开源软件、虚拟化和数据中心网络等领域工作。他热衷于为用户提供支持，开发解决现实生活问题的酷技术，你会经常看到他在全球科技会议和在线活动上发表演讲。](https://uk.linkedin.com/in/vnicolas)

[](https://uk.linkedin.com/in/vnicolas)[](https://uk.linkedin.com/in/vnicolas)

自从 DevOps 的概念在 2008 年左右开始在行业中扎根以来，基础设施经理一直在努力寻找将生产环境的要求引入 CI/CD 管道的最佳方式。当将 DevOps 原则应用于基础设施时，目标一直是尽可能自动化，以推出快速更新，同时保持高可用性。

但是，随着理想生产环境的改变，我们实现基础设施自动化的方法也必须改变。今天，许多基础设施管理者在多云环境中支持容器化的应用。这种情况带来了三大挑战:

*   跨每个服务提供商的平台自动执行任务
*   将云服务的相关成本保持在最低水平
*   根本管理[有状态工作负载](https://www.ondat.io/blog/how-to-solve-kubernetes-persistent-storage-challenges)，更不用说多个提供商了

幸运的是，这些都不是不可克服的挑战，通过正确的方法，基础设施经理可以向左移动并实现更多的自动化。关键是建立一个超融合的 Kubernetes 基础设施，并使用 Terraform 软件工具实现标准化。

在这篇博客中，我们将解释超融合对 Kubernetes 意味着什么，如何跨多个云提供商标准化您的基础设施，以及所有这些如何使基础设施经理能够将基础设施纳入其组织的 CI/CD 管道。

## 首先:什么是超融合？

在传统的非融合基础架构中，您将拥有单独的硬件组件来处理您的计算、网络和存储。通常，整个 IT 团队可能致力于维护每一组独立的组件，这使得这种数据中心方法不太适合现代敏捷组织。

融合基础设施也使用基于硬件的方法。但是，与 IT 部门选择、配置和连接各个组件(如服务器、网络交换机、存储阵列等)不同，供应商提供了一个预打包的单元。这降低了成本并简化了部署，但也降低了灵活性并导致供应商锁定。

相比之下，超融合基础设施尽可能多地虚拟化该系统。超融合基础架构通常包括虚拟机管理程序、软件定义的存储组件和软件定义的网络，所有这些都在单台服务器上运行。由于一切都是软件定义的，这大大减少了所需的管理工作量。一切都可以通过单一界面进行配置；该系统可以很容易地通过 API 进行扩展，并且出现硬件问题的可能性大大降低。

## 超融合的 Kubernetes 呢？

超融合的概念最初是在考虑虚拟机的情况下提出的。那么，容器呢？

超融合 Kubernetes 基础设施遵循许多原则，除了两个关键差异。

第一个区别是超融合 Kubernetes 基础设施使用 Kubernetes 代替虚拟机管理程序。与其用管理程序管理一组虚拟机及其资源密集型操作系统，不如让 Kubernetes 这样的容器编排器管理一组轻量级容器。

第二个有点复杂。因为容器和 Kubernetes 是考虑到无状态工作负载而设计的，所以您需要找到一种以超融合方式处理持久存储的方法。根据定义，连接到一个独立的存储系统意味着您的系统不再是超融合的了；你所做的任何自动化都必须考虑到这个独立的系统。因此，您的可用性将取决于保持存储最新所需的工作量。

一种选择是直接从您的云提供商那里使用数据库服务，但这可能会非常昂贵，并且当您依赖多个云提供商时，管理起来会很困难。

这就是为什么基础架构经理应该寻找像 Ondat 这样的 Kubernetes 本地软件定义的存储解决方案。Ondat 跨多个集群和云提供商汇集存储资源，并以成本优化的方式自动调配资源。由于 Ondat 集中了资源，任何突发需求都将在驱动器间平均分配，从而降低了总体成本。此外，您可以按需添加任意数量的磁盘，从而实现横向可扩展性。

例如，对于亚马逊的弹性块存储(EBS)，您唯一的选择是在通用 SSD 上垂直扩展，并希望您的 I/O 信用能够满足需求，或者购买预配置的 IOPS，这也与明显更高的成本相关。

此外，使用像 Ondat 这样的存储解决方案，您可以在自己的终端执行所有与存储相关的工作，而不是卸载到您的云服务提供商。您将拥有更多控制权，并能够更好地持续配置和管理应用程序的存储需求。

## 创建一个单一的标准框架

作为一个 Kubernetes 本地解决方案，Ondat 和 Kubernetes 一样，是云无关的和声明性的。这意味着 Kubernetes 和 Ondat 很容易在单个云环境中设置，但是多云环境需要一些额外的步骤。

为了尽可能多地自动化您的基础架构管理，您需要一个单一的标准化框架，允许您对每个云提供商的平台使用相同的语言。这就是 Terraform 的用武之地。

Terraform 是 HashiCorp 的一款开源软件工具，它从根本上解决了多云标准化的问题，并提供了有限的自动化功能。

Terraform 使用一种低代码的描述性语言，使基础设施经理能够声明他们的应用程序的配置，而不管所涉及的云提供商是谁。因为 Kubernetes 和 Ondat 本身是声明性的，所以这些工具是高度互补的。

跨多个云部署 Kubernetes 和 Ondat 或类似云存储解决方案的整个过程相对简单。Terraform 包括预构建的资源，可帮助您为每个主要的云服务提供商部署基本集群。Terraform 还包括为 Kubernetes 预先构建的资源，允许您将特定于 Kubernetes 的对象部署到集群中。

这些资源中有几行与 storage orchestrator(在本例中为 Ondat)相关的内容，使您能够声明您的存储要求并配置您的功能，例如:

*   要创建的卷副本的数量(1 到 5 个之间)
*   传输中和静态加密
*   智能、拓扑感知的卷和副本放置，考虑了可用性区域

然后，可以根据需要在开发、测试或生产环境中根据您的需求非常容易地进行调整。

## 将基础架构纳入 CI/CD 渠道，实现集中化和标准化

如果您的目标是在多云环境中使您的基础架构符合 DevOps 原则，那么可以说，您需要将数据中心的所有不同组件置于同一屋檐下。

Terraform 使您能够使用单一框架来管理您的云提供商；超融合使您能够在同一个地方配置所有数据中心组件；Kubernetes 和 Ondat 可以让你协调一切。一旦您将这些元素放在同一个地方并相互交流，您将能够更好地自动化基础架构任务，并且您的团队可以专注于扩展，而不是救火。

如果您想谈论基础架构自动化和云无关存储在您的组织中付诸实践时会是什么样子，为什么不[联系 Ondat](https://www.ondat.io/request-demo) 的专家呢？

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>