# 容器最佳实践:它们是什么以及为什么您应该关注它们

> 原文：<https://thenewstack.io/containers/container-best-practices-what-they-are-and-why-you-should-care/>

[](https://twitter.com/psvann)

 [彼得·范·诺登南

彼得·范·诺登南是斯利姆公司的高级增长主管。AI，一家专注于为云原生应用开发创造更好的开发者体验的创业公司。在加入 Slim 之前。AI，他领导 Tripadvisor 的产品和平台团队，在高可用性、微服务驱动的环境中构建和发布创新的机器学习驱动的应用程序。](https://twitter.com/psvann) [](https://twitter.com/psvann)

容器已经成为当今应用程序开发中最强大的范例之一，相应地，容器的采用也在增加。到目前为止，容器采用的组织焦点主要在基础设施方面，由高度专业化的基础设施人员负责推动这一过程。但是现在容器市场正在成熟(Docker 和 Kubernetes 分别是 8 岁和 7 岁)，组织的重点开始“左移”到开发人员在设计阶段可以做些什么来使容器更高效、更有弹性和更安全。

当容器破裂时，它往往是在生产中，许多这样的问题可以通过容器最佳实践在设计阶段解决。“容器最佳实践”是一个概念，它使开发人员——不仅仅是开发人员——能够以安全、简单和理想的自动化方式使用容器。通过使用容器最佳实践，开发人员可以更快地工作，更快地发布特性，忍受更少的中断/修复周期，并执行更少的重复性手动优化(toil)。

关于构建容器化应用程序的最佳实践已经写了很多，包括容器的先驱、Docker 和 Google。被广泛接受的最佳实践可以分为五个关键主题:

1.  控制容器内的内容
2.  最小化图像尺寸并优化构建速度
3.  控制漏洞和保护服务
4.  在您的组织中实施标准
5.  自动更新

正如“理想”经常出现的情况一样，这些最佳实践得到了广泛的认同并被简洁地列举出来，但是说起来容易做起来难。不幸的是，大多数组织发现很难大规模实现容器最佳实践。

## 缩小:必要但不充分

组织犯的一个常见错误是在实践中屈服于容器的缩小是容器最佳实践的错误认识。毫无疑问，人们花费了大量的时间和精力来考虑缩小容器图像的尺寸(缩小)，这是有充分理由的。图像越小越安全(攻击面越小)；推、拉和扫描速度更快；并且在开发生命周期中通常不那么麻烦。这就是为什么“缩小一个容器”成为博客帖子、视频教程和 Twitter 帖子的常见主题。这也是为什么由[凯尔·奎斯特](https://www.linkedin.com/in/kylequest/)创建和维护的 [DockerSlim](https://dockersl.im/) 开源项目如此受欢迎。它最著名的功能是自动创建一个功能相当但更小的容器。

容器缩小的另一个常见策略可以被描述为“两个容器的故事”在这种方法中，开发人员首先创建一个“开发容器”,包含他们喜欢用于开发的所有工具(如 Ubuntu、Python、包管理器、shells、curl、vim 等)。).然后，一旦开发完成，开发人员将他们的“开发容器”转换为“生产容器”，通常是通过用更轻、更安全的东西(如 [Alpine Linux](https://alpinelinux.org/) )替换“沉重的”底层基础映像。

当然，最小化只是容器优化的一个子集。优化容器的其他方法包括(1)以利用 Docker 缓存机制来减少构建时间的方式构建容器层，以及(2)针对基本安全协议的 Docker 文件的林挺。

可以肯定的是，缩小或更广泛的优化类别都很重要，但都不足以真正大规模实现容器最佳实践。需要一种更全面和标准化的最佳做法。

## 我们可以做得更好:使用自动化来大规模实现容器最佳实践

在与数百名使用容器的开发人员交谈时，我和我的同事们不可避免地听到了关于当前大规模使用容器的焦点和方法的两个大问题:

1.  在调整单个容器以使它们为生产做好准备时，需要进行大量的手工调整。如上所述，开发人员经常为 dev 和 prod 使用不同的映像，这增加了手工调整的工作量。这些当前的方法过于手工且效率低下。我们应该尽可能多地实现自动化。

1.  缩小和优化只是触及了容器最佳实践的表面。只专注于最小化或优化是忽略了所有的组织和系统问题，这些问题涉及到随着时间的推移大规模使用容器。容器最佳实践的目标是实现一种整体的方法，以便在整个组织中高效地使用容器。

我们不想做的是给开发人员一堆新东西去做，或者给已经很长的工具链引入另一个工具。那不是向左移动。仅仅让 DevOps 或 DevX 团队处理所有与容器相关的问题是不够的。大公司有能力让平台工程师团队监控和更新容器，但大多数公司永远不会有足够的 DevOps 资源来实现这一点。

## “容器最佳实践”引领潮流的时候到了

根据最近发布的 [Gartner 容器管理市场指南](https://www.gartner.com/en/documents/3970221/market-guide-for-container-management)，企业受访者认为采用容器的最大技术优势是应用程序开发人员的生产力/敏捷性；然而，这些受访者认为集装箱部署面临的最大挑战是缺乏熟练的资源。

这种二分法在新技术的生命周期中相当普遍:与采用曲线相比，人才/专业知识和最佳实践的发展通常滞后。这种模式在容器和云原生实践中非常明显。

好消息是，容器生态系统现在已经足够成熟，知道什么方法和实践是正确的，值得标准化和自动化。我们可以在使容器尽可能高性能的最佳方法上找到共识:尽可能快、易于构建、易于调试和易于部署。组织也认识到对容器采取更全面而不是条块分割的方法的重要性，更深刻地认识到团队经验对利用容器采用的好处是多么重要。现在正是集装箱最佳实践——CBP——发挥作用的时候。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>