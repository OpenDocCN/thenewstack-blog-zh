# 使用 ChatOps 实现协作式 K8s 故障排除

> 原文：<https://thenewstack.io/enabling-collaborative-k8s-troubleshooting-with-chatops/>

尽管现代工具在我们的工作日(不幸的是，在工作日之外)喋喋不休，聊天在我们的在线交流方式中一直占据着重要的角色。它像最新的 JavaScript 框架一样，时而流行时而不流行，反而在利基社区或应用程序中获得了最大的成功。

其中一个应用是帮助人们合作开发软件。与多人在各自独立的机器上工作、依赖屏幕共享或将代码样本复制粘贴到吉拉不同，chat 创造了一个就软件进行持续对话的机会——甚至自动化 CI/CD 管道、部署到生产中并对停机做出响应。

2013 年，随着 Hubot 的推出，GitHub 创造了 ChatOps 这个术语，Hubot 是一个开源聊天机器人，允许开发人员从其 Campfire 聊天室部署、监控、供应等。这个想法是将开发人员完成工作所需的流程引入到他们用来组织和协作团队的工具中——聊天室。如果他们可以聊天并从相同的提示中采取行动，他们就不必在许多工具之间进行上下文切换，并且他们可以在一个透明的、团队范围的空间中保存他们的行动。

2014 年至 2016 年间，ChatOps 风靡业界。对话驱动的开发就像一股清新的空气。随着远程工作和云原生的快速增长，经理们急切地寻找新的模式，如协作管理，来处理分散的员工和基础设施。但是这些早期版本的 ChatOps 很快就消失了，DevOps 团队将聊天降级为“仅仅”替代内部电子邮件的麻烦。

好像再也没有“回复所有*”*的锁链了。

但 2016 年也只是云原生的开始。从那以后，很多事情都变了。正如我之前说过的，聊天总是在朝着特定目标前进的小型社区中找到最大的价值，这也正是为什么 Kubernetes 的 ChatOps 再次引领了对话驱动的潮流。

## Kubernetes 的 ChatOps 是什么？

简而言之，ChatOps 允许您直接与您的 Kubernetes 集群聊天，以监控、调试和优化它。

但是为了确切地说明这是如何工作的，我们来看一个场景，在这个场景中，用于 Kubernetes 的 ChatOps 可以帮助您在用户面临的问题开始影响他们的体验之前解决它。

现在是周六的晚上 10 点，负责运行贵组织的 web 应用程序的 Kubernetes 集群刚刚经历了一次意外的异常。幸运的是，您有一个 ChatOps 应用程序，它正在监视您的 Kubernetes 集群的资源并监听它们发出的事件，包括这个异常。您的 ChatOps 应用程序将该事件转换为警报，并将其发送到您组织的聊天应用程序，如 Slack、Microsoft Teams、Discord 或 Mattermost，供您的所有 DevOps 工程师和管理员查看。

因为是在周六的深夜，值班工程师在聊天应用上收到一个 ping，告诉他们放下手头的工作，开始调查。在正常情况下，没有笔记本电脑和稳定的 WiFi 连接是一个严重的阻碍，但 ChatOps 允许您的工程师仅使用他们 iPhone 上的 Slack 应用程序来监控、调查和调试错误事件的来源。

ChatOps 将任何聊天应用丰富为一个始终在线、上下文感知、透明的终端，可通过所有的`kubectl`语法直接访问您的 Kubernetes 集群，您的工程师需要这些语法来获取关于出错原因和如何修复的重要信息。

随着其他人加入到争论中，他们可以在调试工作的同时开始就这个问题进行讨论和合作。您的聊天应用程序不仅仅是已经采取的行动的历史日志，而且还是一个强大的审计日志，用于进一步开发新的最佳实践、改进内部文档和最终的事后分析。

## 进入 Kubernetes 的协作管理

当 DevOps 中的协作管理运行良好时，它鼓励透明度和行为，从而提升整个团队。

*   **提供建设性的反馈**并以富有成效的方式接受他人的反馈，特别是来自其他团队的反馈，如开发和 QA。
*   **集体头脑风暴**，团队的每个成员，无论其职位或资历，都应该积极参与决策。
*   **高度诚实**在经理、主管和员工之间建立信任，促进协作精神。
*   向一个共同的目标而不是个人目标努力，成为许多不同人的教练和同事。

但是云原生环境往往会给已经充满挑战的工作带来一些麻烦。您可能有一个非常复杂的基于微服务的架构，其中多个集群运行在并行数据中心上，而且您的团队很可能大部分成员都在远程。DevOps 文化、分布式技术和持续协调需求的结合使得实现协作管理成为一个更大的技术挑战，但并非不可能。

ChatOps 有助于弥合人与技术之间的差距，让他们并行工作，使协作管理在一些常见的 DevOps 场景中大放异彩:

*   ****单个随叫随到工程师:**** 我们在上一节中概述了这种情况，但有了 Kubernetes 的 ChatOps，单个随叫随到 DevOps 工程师在如何、何时、何地响应方面有了更多的灵活性。不用被迫回到他们的工作机器，在那里他们已经设置了环境和密钥/秘密来正确地查询 Kubernetes 集群，他们可以在您组织的聊天应用程序所到之处开始调试。他们在这种情况下领先一步，当需要另一名工程师接管时，ChatOps 的集中化和透明性简化了过渡。
*   **交易监控调试任务:**随着二副上线，加入已经开始调试的通道或房间。由于 ChatOps 增强了透明性，并且从一个公共的终端在各个孤立的系统上工作，所以第二个工程师可以查看已经完成的调试工作的整个审计日志。如果他们要替换第一个工程师，他们不需要浪费时间重新运行命令，因为他们可以在聊天日志中看到每个`kubectl`的执行和结果。他们可以调试来自多个集群的部署、服务或其他资源，鼓励诚实、开放，并从之前的事件和解决周期中不断改进。

*   **实时配对:**或者，如果两名工程师成对进行调试和故障排除，ChatOps 可以帮助他们像在同一个任务控制室一样处理工作，即使他们碰巧相距数百或数千英里，在不同的远程或家庭办公室。他们不需要依赖尴尬而低效的屏幕共享，在那里观众只能观察、记笔记和提出建议——或者更糟的是，将他们的`kubectl`命令复制粘贴到聊天应用程序中。由于 ChatOps 支持协作管理精神，您的工程师们可以并行工作。他们可以随心所欲地进行实验、调试和查询，这一切都需要良好协作所需的透明度和持续对话。这是一个相互交流和与集群交流的单一环境。

但并不是所有的 ChatOps 平台都是一样的，尤其是当 Kubernetes 参与进来的时候。

## 用于监控和调试 Kubernetes 集群的 Botkube

Botkube 是 Kubernetes 的新一代 ChatOps。使用开源 Botkube，您可以监控多个集群，实时调试您的部署，并检查您的集群的状态，以获得您的团队可以持续改进的建议。

我们支持 DevOps 团队最受欢迎的消息平台，如 Slack、Microsoft Teams、Discord 和 Mattermost。我们甚至支持将消息发送到 ElasticSearch 用于存档目的，或者发送一个 webhook 来构建一个定制的消息响应管道。

我们刚刚在 2022 年 10 月发布了 [v0.14.0](https://kubeshop.io/blog/botkube-v014-release-notes) ，提供了更多用户友好的方式来动态更改你的僵尸工具通知设置。默认情况下，Botkube 会监控和显示您在 YAML 文件中配置的频道中或在 Helm 安装/升级期间的所有 Kubernetes 事件，但现在您可以在您选择的聊天应用程序中通过简单的`@Botkube edit SourceBindings`消息来动态更改这些设置。我们还发布了一个新的 Slack 应用程序，它更强大，具有更丰富的安全选项。

此外，对于喜欢全面使用开源的组织来说，这是一个重大的胜利，不仅仅是在他们的基础设施中:Botkube 现在支持 [Mattermost](https://botkube.io/docs/installation/mattermost) v7.x！

botkube v 0 . 13 . 0 仅在一个月前发布，完全支持我们最需要的特性:多通道支持。在 Kubernetes 集群中安装一个 Botkube，就可以将事件分组并发送到不同的通道和消息平台。例如，您可以将高严重性事件(如`Resource deleted`、 `Failed to pull image`或`Readiness probe failed errors`)发送到 Slack，以便您的团队立即做出响应，并将它们存档在 ElasticSearch 中，以获得透明、可审计的事件响应操作日志。

我们的社区已经因为很多其他原因喜欢 Botkube 了:

*   无需学习新的语法或工作流程——Botkube 使用熟悉的`kubectl`语法，只是有了一个新的界面。
*   默认情况下，Botkube 作为只读服务帐户在您的集群中运行，确保您拥有根据您组织的要求设置的访问控制和管理权限。
*   支持监控自定义资源，以便在证书过期或备份失败时接收警报(Velero 和 Kanister)。
*   我们是完全开源的！我们在 GitHub 上有 1.5k 的明星，近 100 个贡献者，还有一个快速增长的社区。

## Kubernetes ChatOps 的未来

要开始使用 Botkube ，您需要安装两个组件:

*   你选择的聊天应用中的 Botkube 集成。
*   Kubernetes 集群中该应用程序的 Botkube 后端。

由于每个应用程序的设置过程略有不同，它们需要不同的变量和密码，更不用说创建和验证聊天机器人的独特设置过程，因此您应该查看为您组织的应用程序选择量身定制的文档:

作为一个开源、社区驱动的项目，我们希望听到您的反馈和想法。这就是我们如何优化路线图和实现最受欢迎的功能，以尽可能快地使 Botkube 尽可能有价值。

将你对 Botkube 的 [GitHub 问题的想法发送给我们](https://github.com/kubeshop/botkube/issues)或者通过加入我们的 [Slack 社区](http://join.botkube.io/)来保持聊天应用的精神。或者，如果你喜欢电子邮件的直接性，你可以给我发电子邮件到 [blair@kubeshop.io](mailto:blair@kubeshop.io) 。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>