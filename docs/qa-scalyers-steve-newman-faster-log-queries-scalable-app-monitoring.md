# Scalyr 的 Steve Newman 问答:更快的日志查询，可扩展的应用程序监控

> 原文：<https://thenewstack.io/qa-scalyers-steve-newman-faster-log-queries-scalable-app-monitoring/>

你可能不知道史蒂夫·纽曼的名字，但你可能接触过他的作品。他是谷歌文档(Google Docs)背后的智囊之一，谷歌在收购纽曼的 Writely 时获得了谷歌文档的基础技术。在谷歌解决了这项技术后，他离开了谷歌，共同创立了 [Scalyr](https://www.scalyr.com/) 来应对新的挑战:将谷歌式的可扩展性引入日志管理。Scalyr 基于分布式列的 NoSQL 数据库为 NBC Universal、CareerBuilder、OKCupid 和 Scripps 带来了更快的运营可见性。

我们通过电话采访了纽曼，了解了 Writely 的历史，Scalyr 的成立，以及他对 DevOps 的看法。

**你为什么开始写作？**

我和几个朋友一起开始的，其中一个从大学开始就和我一起做几乎所有的事情。我们一起创办了大约六家公司，包括 Writely。我们感兴趣的是在文档上协作的更好方式。我们过去称之为“用电子邮件发送一个单词文件”问题。您正在进行某项工作，您不断地通过电子邮件将附件来回发送给您的合作者，并且忘记了谁拥有哪个版本。

多年来，我们在这个问题上做了其他尝试。但基本上，有一天萨姆·席勒斯走进办公室说，“我有一个想法。”他画了很多素描。他受到了 Gmail 的启发。当我们想到 Gmail 时，每个人都会想到免费的千兆字节以及支持它的谷歌基础设施的规模和能力。但 Gmail 推出时的另一个新奇之处是，它确实是第一个拥有格式化功能的流行网络邮件平台，除了纯文本之外，它还有其他功能。

所以，嘿，如果他们能在网上格式化，我们也能在网上格式化。这就是这个想法的来源。我们可以构建这个基本的文档编辑器，让人们可以在线协作。我们制作了一个原型，并开始向人们展示。我们谈论协作，每个人都会看着它说，“协作。嗯，那就像是单词？哦，但它是一个网页？哦，网上的消息。”我们会疯狂地打退堂鼓。因为我们知道即使在今天，Word 的功能也比 Google Docs 多一千倍。

但这很有趣，因为人们真的抓住了从任何地方使用它的(方面)。而合作方面几乎是次要的。

我似乎记得当时还有其他尝试。有没有一种特别的技术或东西 Writely 做到了，比如说，其他竞争者错过了？

这是突然出现的想法之一。

首先，我们找到了简单的最佳点。我们将登录网站并开始工作的过程简化到了最低限度。我认为这是字面上的意思，你在浏览器中输入 Writely.com，然后再点击一下。或者也许你真的直接进入了一个文档。

对我来说，入门非常简单，分享起来也非常简单。而且，坦率地说，它也只是有一个基本的专业水平和波兰是在其他一些尝试中所缺少的。那时候你能在浏览器上做的事情真的很有限。但是，我认为我们做得很好。每个人都认为这是 JavaScript 编程的巨大努力，实际上 Writely 上发生的所有有趣的事情都发生在服务器上，因为浏览器仍然是一个糟糕的编程平台。我们把所有繁重的工作都放在了服务器上，这意味着共享、自动保存、修订历史等等。

大约在同一时间，出现了另一个基于 Java applet 的解决方案。这比我们之前所做的要强大得多。它有更多的格式化和文档布局能力，等等。但是它花了一分钟的时间加载。这只是一个不成功的例子。还有另一个，来自 37 signals[现在的 Basecamp]。所以那是一个非常受人尊敬的组织。在我们准备推出 Writely 的时候，它即将推出一些叫做 [Writeboard](https://basecamp.com/retired/writeboard) 的东西。我们感到恐慌，因为我们认为，“哦，来了，37Signals 将做一些惊人的事情，每个人都知道他们，我们就完了。”如你所料，Writeboard 非常完美，但它是基于 Markdown 的。所以，它只是服务于不同的观众。

**创办一家初创公司后，谷歌会是什么样？**

是的，那是一次紧张的经历。在收购完成时，我们与谷歌的硬件和网络供应团队举行了一次规划会议，这是一次有点混乱的谈话，因为我们只是在如此不同的规模上工作。Writely 在被收购时运行在四台服务器上。因此，用谷歌的话来说，我们需要零机架，零千兆字节的上行链路。就像，在他们习惯的任何网络上，我们甚至不是一个舍入误差。

当然，在谷歌文档重新推出后，这种情况很快就发生了变化。因此，在收购后的三个月里，我们完全重写了整个系统，以迁移到谷歌的基础设施上。因此，在收购之前，这是在达拉斯某个数据中心的 Windows 服务器上的 IIS 中运行的 C#代码，我们自己开发的小对象存储将不同的文档存储在服务器的本地磁盘上。三个月后，在谷歌数据中心的 Linux 上的谷歌 servlet 容器中运行的 Java 代码在 [Bigtable](https://cloud.google.com/bigtable/docs/) 上存储文档。每一层都完全重做了。

**那么，斯卡利尔是怎么来的呢？**

我追溯到在谷歌的经历。谷歌是一次令人惊叹的学习经历，对我和我认为团队中的每个人来说都是如此。没有哪家公司在规模和宏大思维方面做得更好。谷歌的一个特点是他们擅长规模化，他们不害怕规模化，他们害怕技术挑战。如果有一个产品想法是有意义的，如果有需要被满足，并且碰巧很难满足，他们不会回避它。

我最终在谷歌工作，从事一些大型数据库基础设施项目，这些项目支持谷歌文档等。这在操作上非常复杂，会出现很多问题。性能问题。我们合作的一个团队出现了巨大的流量高峰，或者出现了一些中断，或者出现了一些问题。你有所有这些移动的部分，有很多问题出现的地方，当问题出现时，你一定知道去哪里找。这些关系是如此的复杂，以至于很难缩小因果关系的范围。我们在谷歌内部可用的工具在整理海量数据方面并不出色。我们收集所有这些数据、日志数据、指标和其他类型的数据。

我们使用了——我们在某一点上加起来——差不多 17 种不同的工具，只是为了整理所有的数据。他们各自解决了不同的问题。我们需要全部 17 个，但这还是不够。因此，Scalyr 的想法是给人们一个更好的方法来解决我们遇到的问题，提供更好的工具来获取来自 1000 个不同地方的大量日志、跟踪和指标以及所有其他数据，并能够在合理的时间内跟踪问题。所以，这是一种高层次的动机。

谨慎跟踪有助于让您全面了解系统的性能。而且，也许某件事花了很长时间，它可以告诉你，“嗯，它花很长时间的原因是你的数据库对它的响应很慢。”为什么数据库响应慢？嗯，这可能是因为我们有流量高峰，而你是超负荷的数据库。这可能不是很明显。可能不是每秒发送 1，000 个查询，而是每秒发送 1，010 个查询。但是事实证明这 10 个额外的查询是非常昂贵的。

你会看到同样多的人在运行他们的购物车，但与此同时，业务团队中的一些人一直在运行这些昂贵的大型分析查询。一次只有一个查询，但是它完全占用了数据库。这些问题可能非常复杂和微妙，追踪只能给你一个层次的图像。

那么 Scalyr 如何提供帮助呢？

这确实有两个原因。一个是我们已经建立了一个非常精简的 NoSQL 数据库，而不是其他日志管理解决方案所使用的，总是关键字索引。

有了关键词，你会想到日志，你会想到搜索。这就是从谷歌网络搜索开始的所有搜索方式。关键字索引技术最初是为文档检索而开发的，但它并不非常适合这种机器数据、服务器日志、应用程序日志。

在这里，您正在寻找单个的日志消息，它们非常小。它们有很多，而且比网页小得多。他们周转得很快。它们充满了记录 ID 和 IP 地址和各种不是文字的官样文章。因此，你拥有数百万或数十亿个词条，而不是数千个独特的词条。从来没有前 10 名。没有向我展示我的服务器崩溃的最佳 10 次。

无论你在寻找什么，你都希望找到它发生的每一次，并以图表或其他可视化方式进行总结。所以，所有的索引技术，比如 Elasticsearch，在这个问题领域并没有真正的帮助。所以，我们基本上抛弃了所有这些，说，“如果我们想搜索日志，让我们只搜索日志。让我们逐字逐句地扫描数据。”

我们做的另一件事是转向托管服务，这是实现规模经济的机会。但是你必须从一开始就设计系统来利用这一点。因此，如果你看看其他日志管理解决方案，也许它们是在托管解决方案中，但是主机解决方案倾向于为每个客户提供专用硬件。所以，你只能用你那点马力来分析你的日志。

我们的架构更像谷歌网络搜索。我们还没有达到谷歌的规模，但在日志管理方面，我们仍然有一个非常大的集群。我们的每个客户都可以使用整个集群。

**那么，最终用户的设置是什么样的？组织？听起来你只是在安装一个代理。这是软件吗？是在软件里面吗？是边车吗？那是怎么回事？**

是的，所以，我们支持一系列不同的模式，因为我们希望在顾客所在的地方见到他们。所以这要看情况，你是在运行自己的服务器还是至少是虚拟服务器？还是在 Kubernetes 或者无服务器？或者，人们可能有许多不同的模型。您可能已经有了某种日志集中基础设施。

我们有一个轻量级的代理，你可以直接去。它打包用于，你需要它，直接，服务器容器安装或用于 dock 或 Kubernetes。然后我们有很多 API 集成。所以，如果你运行的是无服务器，或者亚马逊或其他云提供商运行的是 Fortran，他们运行的是数据库或系统或其他任何东西。API 可以代表您收集这些日志。所以，无论你在哪里，我们都能见到你。

所以，如果你在解决一个新问题，走进去问一个你从来没有问过的问题真的很容易。你真的不知道去哪里找，所以你在探索很多，“是这个吗？是这个吗？是这个吗？是这个吗？哦，也许和那个有关。让我向下滚动。”所以你只是发射大量的漫无目的的查询和翻箱倒柜，直到你弄清楚发生了什么。我认为，这是我们最大的亮点。

也许我最满意的是我们如何看待产品的接受:我们将进入一个组织，我们的一些大客户可能有大约 1000 人获得了 Scalyr 登录。他们中的一半每周都在那里，四分之一每天都在那里，对于这样的工具来说，这是一个巨大的参与。

当人们想到谷歌时，他们会想到规模和令人难以置信的智能搜索。但谷歌早期真正改变游戏的另一件事是速度。早期的搜索引擎要慢得多。但是当你做得更快时，人们会更多地使用它。我想这就是我们带来的。

**你对 DevOps 的未来有什么想法？如今，在 DevOps 中进行报告时，我们应该关注哪些方面？**

DevOps 既提供了机遇，也带来了挑战。我们昨天与我们的一个客户交谈，他们刚刚开始向无服务器迁移，但他们已经在 Lambda 上部署了 750 个功能。而且，即使你习惯了运行微服务，你也不习惯任何东西的 750。你是怎么追踪到的？你如何找到根本原因？

我认为这是一个需要很多年才能完成的转变。人们将他们的一些代码移入 Lambda 将是大约 20 步中的第一步。原因是，它正在转向一种模式，在这种模式下，像亚马逊这样的提供商，拥有真正的专家，以及在解决问题上投入大量工作的规模，可以开始提供更多的价值。

因此，这不仅仅是排序托管代码和自动扩展代码，而是人们真正努力解决的与服务可靠性有关的问题，如速率限制、防止拒绝服务和 AB 测试，这两种测试都是针对用户行为，也是一种检测服务漏洞或问题的方法。当你把你正在做的事情分离一点，让云提供商有能力进入并控制，从而在你正在做的事情的更细粒度的层面上增加价值，我认为这将需要几年的时间才能显现出来。

谷歌是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>