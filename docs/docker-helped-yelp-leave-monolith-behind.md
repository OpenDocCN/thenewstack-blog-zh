# Docker 如何帮助 Yelp 将巨石柱留在身后

> 原文：<https://thenewstack.io/docker-helped-yelp-leave-monolith-behind/>

Yelp 是一个非常简单的应用程序。你输入你要找的东西和地点，它会返回该地点不同企业的评论列表。但是这种简单性掩盖了幕后巨大的复杂性。该应用程序由数百万行代码组成，用至少两种不同的编程语言编写，该公司雇用了 300 多名开发人员，每天都负责提供新功能。

对于一个以协作和快速变化为荣的公司来说，这种单一的代码库是一个巨大的负担。这就是为什么 Yelp 已经从那个庞然大物转移到一个基于亚马逊网络服务的面向服务的架构。问题是，当 Yelp 在 11 年前成立时，亚马逊网络服务甚至还不存在，它的许多关键服务仍在内部运行。因此，该公司两年来转向 Docker，以消除他们自己的传统数据中心和 AWS 实例之间的差异。

Docker 是出了名的容易上手。有无数的教程，包括 Docker 的[自己的一步一步的初学者指南，以及书籍和手册，如 James Turnbull 的“](https://www.docker.com/tryit)”T2 的 Docker Book [，他在其中写道:](https://www.docker.com/tryit)

> “运行您的第一个 Docker 容器非常容易。如果你只是想尝试一下，入门的门槛相当低，你需要知道如何编辑一些配置文件。”

就像 Yelp 本身一样，Docker 的简单性掩盖了隐藏在表面下的难以置信的复杂性。特恩布尔说:“(码头工人)有相当深的复杂性。”。“有很多方法可以配置内存[或] CPU。你可以有一整堆导轨，也可以有一整堆灯。你可以在不同的机器上拥有数以千计的容器，你可以编排它们。”

如果你真的想在生产中使用 Docker，Yelp 运营总监 Sam Eaton 说，你需要对 Linux 有一个合理的理解，Docker 如何使用 Linux 内核，以及这种方法的局限性。“在大型部署中，当你真正开始关心那些深层的技术细节时，”他说。“当您想要大规模部署它时，您需要了解它的构建基础。”

也就是说，伊顿的 60 人基础设施团队技术水平很高，精通各种开源技术，因此他们不需要任何特殊培训来实现 Docker。

Yelp 内部应用程序接口(API)是将面向服务的架构结合在一起的粘合剂。至关重要的是，伊顿的团队能够保持相同的 API，即使在将他们的服务分类之后。“API 非常重要。他说:“你必须努力让它们变得正确，如果你希望人们能够很好地合作，希望人们能够相互交流，你就不希望它们移动太多。”

伊顿说，事实证明，Docker 非常适合公司的需求。“不需要协作，开发者可以做更多的事情，给他们更多的独立性，”他解释道。"部署一个 Docker 容器只需要几秒钟的时间."

该团队还尝试使用网飞的 Asgard 来管理这个架构，这有助于自动缩放组和隔离服务。但这并不完全符合 Yelp 的需求，因为在本地基础设施和亚马逊云上运行一项服务需要大量的重复工作。伊顿表示，将他们的公司归档可以让开发人员按照自己的节奏工作，使他们相互隔离。他说，由于所有东西都小得多，这使得部署更快，并为组合现有服务创造新功能提供了可能性。

Yelp 现在也在其测试环境中大量使用 Docker，“来隔离我们的文本——我们基础设施部分的小拷贝。”

总的来说，Yelp 每天运行大约 700 万次测试，Docker 容纳了大约 100 万次测试，并且还在增加。“目前，我们正在迅速将大部分系统迁移到 Docker，因为将一个系统迁移到另一个系统是一件非常痛苦的事情。”

## Docker 和安全问题

特恩布尔提醒我们，Docker 不是一个安全控件。“Docker 容器是一个相当松散的抽象，”他说。“因此，它不是围绕您的流程的一个硬壳，所以它不是一个额外的安全级别。Docker 旨在简化工作负载的运行，而不是像沙盒环境一样。”

最大的区别在于，在虚拟机(VM)上，您会发现完整的操作系统安装，以及虚拟化设备驱动程序、内存管理和其他资源的相关开销。但是容器使用并共享操作系统和所有与其主机相关的资源。因此，容器比虚拟机更小、更快，但没有那么大的隔离性。

伊顿认为安全模式的权衡对于某些公司来说是一个真正的问题，但对于 Yelp 来说不是任何问题，因为它只在内部使用 Docker，拥有自己的人员和 API。他说，容器是为这样的情况设计的:你需要根据依赖性和内存来隔离应用程序，但你并不试图将用户彼此隔离。

如果人们希望在多租户环境中获得 Docker 的便利性和可扩展性以及传统虚拟机的安全性，伊顿提供了一种俄罗斯嵌套解决方案，您可以在虚拟机上运行 Docker 容器。“他们可能为每个租户运行一台虚拟机，但显然，像这样的间接层越多，您的环境管理起来就越复杂，”他说。

VMware 云原生应用的产品管理和架构总监 Jared Rosoff 警告说，当你谈论安全法规和合规性时，即使是在虚拟机上构建的容器的组合也不足以了解正在发生的事情。

Docker 努力构建更强大的安全态势。它在 2015 年春天宣布，它已经与互联网安全中心( [CIS)合作，制定了一份](http://www.cisecurity.org/) [基准文档，](http://www.cisecurity.org/) [详细推荐了 Docker 部署的安全性。](http://www.cisecurity.org/) [Chris Swan](http://blog.thestateofme.com/) [在一篇关于](http://www.cisecurity.org/) [InfoQ](http://www.infoq.com/news/2015/05/Docker-Security-Benchmark) [的博客文章中指出,“这项研究足够详细，可以作为一种资源来描述特定的 Docker 环境，并确定可以采取哪些实际步骤来提高其安全性。由于底层主机操作系统的差异而存在多种选择时，会引用由 Docker 核心团队成员和其他人创作的大量外部指导文档。”](http://www.cisecurity.org/)

在 6 月的 DockerCon 大会上，Docker 向开发人员介绍了[公证人，这是一个开源系统](http://www.cmswire.com/information-management/docker-engineer-our-containers-are-secure/)，用于认证发布到公共存储库的 Docker 图像来源的有效性，并对这些图像的内容进行加密。今年 8 月，该公司发布了自己的品牌公证人实现，称为 Docker 内容信任。

Docker 的目标是部署一个在网络的发送端和接收端都可靠的签名和加密系统，使中间的网络安全不再成为问题。

Rosoff 说，虽然虚拟机对开发人员来说可能感觉有点沉重，但它们对运营团队来说更方便，他们可以为开发人员保持用户体验，但保留虚拟机对基础设施和安全可管理性的更深入了解。

“作为一名开发人员，我开始真的很高兴能够运行这样的容器，但情况开始变得非常复杂，”Rosoff 说。“如果我运行虚拟化工作负载，我可以从 IT 部门免费获得所有东西:监控仪表盘、容量规划等等。”现在，通常依赖运营团队为所有这些 Linux 主机创建、管理和监控仪表盘和容量计划的开发人员必须创建自己的管理系统。
“当您的安全审计团队进来[询问]‘这是 HIPAA 合规还是 PCI 合规？’时，问题就来了运营部门在这些工作流程中找不到任何可见性，”他说。

为了克服这些问题，罗塞夫说，我们需要一个新的工具生态系统来缩小可见性差距。

但伊顿表示，下一代开发人员和运营团队将不得不接受 DevOps 文化，放弃对自己环境的控制，增加协作。容器将在这一转变中扮演重要角色。

“[Docker]为开发人员提供了更多的能力，让他们自己去做更多的系统管理工作，”他说。“这使他们更容易管理和负责自己的所有服务，而不必寻求运营帮助。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>