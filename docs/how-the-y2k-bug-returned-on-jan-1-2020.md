# 2020 年 1 月 1 日“千年虫”是如何卷土重来的

> 原文：<https://thenewstack.io/how-the-y2k-bug-returned-on-jan-1-2020/>

这在程序员中是不言而喻的——日期很难确定。世界上的程序员和系统管理员花费了数千亿美元来为人类从 1999 年过渡到 2000 年(“Y2K”)做准备，这是一项传奇的、基本上默默无闻的努力。但本月出现了新一轮与日期相关的故障，其中许多故障可以追溯到 1999 年执行的相同补丁。

或者像 ZDNet [报道的](https://www.zdnet.com/article/the-y2k-bug-is-back-causing-headaches-for-developers-again/)，“二十年前，一些开发者通过推迟到……现在来处理千年虫。”

## 1999 年的幽灵

简而言之，从 1999 年到 2000 年的变化在许多系统中不能正确地表示，因为在上个世纪编写这些系统的程序员给日期字段两位数(即“99”代表“1999”)而不是四位，从而节省了当时宝贵的内存空间。

一个解决方案涉及到一种叫做“开窗”的技术——根据一个硬编码的“关键年份”来确定两位数的年份属于哪个世纪。早在 1999 年，HPCWire 就将其描述为“极具争议性”，引用一位专家的话说，使用该技术的计算机是“[等待爆炸的定时炸弹”](https://www.hpcwire.com/1999/03/19/common-y2k-quick-fix-last-decades/)

然而，据 HPCWire 报道，据估计，世界上 80%的计算机都采用了这种解决所谓的“千年虫”问题的方法，因为另一种方法——将系统转换成包含日期的所有四位数字——需要进行繁琐的逐行修复。高德纳集团的研究员吉姆·杜根告诉他们，“这是一个创可贴，就像用木头和纤维板盖房子一样。你希望在它倒下之前，你已经在别的地方了。”

快进 20 年，伦敦经济学院的助理传播学教授 Dylan Mulvin 本月告诉《新科学家》，“即使在 Y2K 期间，[开窗也是所有可能的解决方案中最糟糕的](https://www.newscientist.com/article/2229238-a-lazy-fix-20-years-ago-means-the-y2k-bug-is-taking-down-computers-now/)，因为它将问题一拖再拖。”但是顾问埃德·约尔登告诉 HPCWire，这是一个有意识和务实的决定。“我们希望以正确的方式来做这件事……但我们没有时间，所以尽管这是一种快速而肮脏的方法，我们也别无选择。太可惜了。”

保罗·洛马克斯为沃达丰处理了千年虫问题，本月[与《新科学家》](https://www.newscientist.com/article/2229238-a-lazy-fix-20-years-ago-means-the-y2k-bug-is-taking-down-computers-now/)分享了他对在旧系统上工作的程序员的想法:“很明显，他们认为他们的系统到 2020 年将会长期闲置。就像 60 年代的人不认为他们的代码在 2000 年还会存在一样。"

Mashable 的一份视频报告指出，20 世纪 60 年代的内存成本[高达每比特 1 美元](https://mashable.com/video/wrong-about-y2k/)——并计算出现代 iPhone 的 4GB 内存将花费 320 亿美元，“经通胀调整后为 0.25 万亿美元。”在那个世界里，只用最后两位数字来表示年份是有意义的。

到 1999 年，这种最初的心态变成了一个问题——但是窗口只是提供了一个临时的解决办法。2019 年 12 月 30 日，退休的 COBOL 程序员拉里·麦克尼什(Larry McNish)在博客[中写道:“希望公司董事会高管当时意识到，使用关键年只是将他们的‘千年虫’问题推迟了几十年。”。“但随着人们退休、高管更替和公司合并，这样的信息往往会丢失。”](https://grumpyoldastronomer.com/y2kpivot.htm)

不幸的是，许多程序员认为 2020 年是合理的转折点。云平台提供商 Fastly 的工程师 tatsu hiko Miyagawa[告诉《新科学家》【that 2020 年是 1970 年开始的世纪的中点——“Unix 时间”开始计算已经过去的秒数。](https://www.newscientist.com/article/2229238-a-lazy-fix-20-years-ago-means-the-y2k-bug-is-taking-down-computers-now/)

## Y2K 年后

因果总是很难确定——但 2020 年 1 月 1 日肯定有一些日期相关的问题。

*   至少有一个推特用户抱怨说他们的保险公司发了一份日期为 1920 年 1 月 2 日的声明。
*   早在 11 月，Splunk 就已经宣布，他们用于分析机器生成的大数据的软件的用户确实需要在 1 月 1 日之前安装最新的补丁，否则这些系统将变得“[无法识别日期包含两位数年份的事件的时间戳](https://docs.splunk.com/Documentation/Splunk/8.0.0/ReleaseNotes/FixDatetimexml2020)”
*   开发者 Rich Felker 说[他在测试网络时间协议的 chrony 实现时发现了一个日期相关的错误](https://twitter.com/RichFelker/status/1216736900628783104)。
*   甚至在职业摔跤视频游戏 WWE 2K20 中也出现了与日期相关的故障
*   考克斯电报[显然发出了日期为 1920 年 1 月 1 日的账单](https://twitter.com/lippard/status/1214258302298685440)。
*   一位 Perl 博客作者还注意到，Perl 的 [Time::Local 模块](https://metacpan.org/pod/Time::Local)中的 *timegm* 子例程——将时间转换为格林威治标准时间——会假设两位数年份在 50 年以内。“这很混乱，但符合人们目前对两位数日期的想法，”[解释了文档](https://mojolicious.org/perldoc/Time/Local)，并补充道“只要有可能，就使用绝对的四位数年份。”所以在 1 月 1 日，这位博客作者发现了一个使用 1970 年的测试突然开始[假设这一年是 2070 年](http://blogs.perl.org/users/tom_wyant/2020/01/my-y2020-bug.html)。
*   另一个开发人员报告了同一个模块的问题，在黑客新闻[上写了一条评论“一些运行中的 Perl 开始返回奇怪的值，测试失败了。”](https://news.ycombinator.com/item?id=22045806)

但是有些故障比其他的更严重。《新科学家》报道称，波兰公司 Novitus 的数千台收银机无法打印收据。

市政府官员[告诉纽约邮报](https://nypost.com/2020/01/06/nyc-wont-refund-drivers-impacted-by-y2k-like-parking-meter-glitch/)，一个与日期相关的故障也意味着纽约市的 14000 个停车计时器突然停止接受信用卡，尽管他们仍然坚持司机用零钱(或通过其官方智能手机应用程序)支付停车费。一位交通专员向该报抱怨说，这个故障“不是我们造成的”，尽管市政工人最终还是做了修复它的跑腿工作。《华盛顿邮报》报道称，“工作人员现在正忙着一个接一个地重新校准每一个电表。”。到 1 月 6 日早上，市政工人已经更新了 9906 个电表(近 71%)，到本周晚些时候[所有的电表都修好了。](https://twitter.com/NYC_DOT/status/1214649047434309634)

对于总部位于桑尼维尔的 Trimble 公司来说，元旦也是一个大问题，Trimble 公司出售 PeopleNet 电子记录设备，可以自动记录商用卡车的驾驶时间。该公司的一名前高管告诉 Freight Waves 网站，他交谈过的 Trimble 员工承认，一些设备的 GPS 系统时钟和服务器时钟之间存在差异，导致设备[一次又一次地重启](https://www.freightwaves.com/news/peoplenet-outage-a-2020-issue-former-trimble-exec-says)。Trimble 告诉该网站，其“一部分”客户受到了影响，并补充说，他们在 1 月 1 日当天结束前有一个软件更新可用。

至少有一名卡车司机告诉该网站，他已经回到了手工在纸上记录日志。“这让我想起了卡车运输的早期，”他说。“我想这对我的数学技能有好处。”

## 对补丁的赞美

但是更重要的是什么事情没有发生——1999 年也是如此。据英国广播公司报道，估计花费了 3000 多亿美元来准备千年虫问题——考虑到 2000 年 1 月 1 日发生的相对较少的混乱，这一努力基本上是成功的。

Mashable 的视频称 Y2K“可以说是对已经运行了几十年的全球计算网络的第一次大规模审计。”事实上，“9·11 袭击后纽约市电信和交通的稳健性归功于为避免千年虫所做的大量工作。”

Mashable 的视频指出，这个 bug 确实造成了一些后果——例如，韩国有 1000 台加热器停止工作，据报道，埃及的一些透析机也停止了工作。但是“2000 年问题的持久寓意不应该是过度的恐慌，而是成功和必要的全球努力，以避免一个已知的问题。”

努力工作的程序员和系统管理员在潜在的故障发生之前就解决了它们，这一点已经成为历史。1999 年元旦，一位名叫格雷姆·福勒的英国极客在英国广播公司关于千年虫的讨论页面上留下了一条评论，吹捧为准备这个 bug 所付出的巨大努力。“我们共同取得的成就相当惊人——整个事件没有发生任何爆炸，更像是呜咽。

“2000 年问题不仅仅是炒作，尽管新闻界似乎希望如此。在大多数其他国家，人们会庆祝问题的解决……”

“一些程序员在这上面工作了很多年，”Y2K 顾问和开发者 Greg Sternberg 本月告诉 ZDNet。"坦率地说，他们是无名英雄。"

* * *

## WebReduce

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>