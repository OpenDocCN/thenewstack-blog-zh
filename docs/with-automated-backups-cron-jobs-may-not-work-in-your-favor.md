# 当“克隆工作”对你不利时

> 原文：<https://thenewstack.io/with-automated-backups-cron-jobs-may-not-work-in-your-favor/>

每个开发人员都遇到过这样的情况:他们已经将某个东西投入生产，但它崩溃了，或者数据库信息被破坏了，这导致他们需要回滚到他们以前拥有的数据。如果一个 bug 导致了一个不可预见的问题，开发人员通常不得不匆忙找出最后一次备份是什么时候执行的。是几小时前，几天前，甚至几周前？这时，备份协议可以解决问题，或者导致失控的安全性和合规性问题。

虽然定期和经常备份是最佳实践，但在现实中，开发人员有太多的事情要做，备份可能会半途而废。但是，如果过了太长时间，完全回滚到最后一次备份就变成了安全性与法规遵从性之间的冒险游戏，这可能会导致大量数据丢失。在许多领域，任何数据丢失都可能是灾难性的。医疗保健和金融是数据受到高度管控的行业的明显例子，在这些行业中，即使丢失一天的数据也会影响合规性要求。

数据库管理员通常通过 Linux 命令或" [cron jobs](https://thenewstack.io/tutorial-linux-task-scheduling-and-automation-with-cron/) "来开发他们自己的自动化，以计划未来的备份，作为一种附加的风险降低措施来补充他们的手动备份过程；然而，配置 cron 作业来为每个环境进行备份并不总是稳定或方便的。事实上，当涉及到 cron 作业时，数据库管理员经常发现自己在质疑是否能够可靠地回滚到昨天，如果他们需要的话。

那么，就设置、频率、数据保留和一般自动化最佳实践而言，数据备份的最佳点是什么呢？让我们更详细地探索它们。

## **完整备份，不是快照**

首先，让我们定义一下备份的含义。尽管数据备份的概念可以追溯到计算的早期，但今天的 web 和 IT 团队仍然感受到繁琐的备份选项带来的痛苦，这些选项需要花费时间在内部设置或开发，运行时只会造成中断或不稳定。当提到备份时，我们特指“完整”备份—这些不是 CIS 管理员可能拍摄的环境快照，而是存储所有信息的备份，包括特定时刻数据库中的数据。

## **当“实时”备份发挥作用时**

不同类型的企业会有不同的备份需求，但对于较大的公司来说，确保正确的备份是一项艰巨的任务。我们合作的一家企业客户每天需要对 24 小时的数据进行 30 次滚动备份。这是公司的安全要求，因此在过去 30 天内丢失一份备份对他们来说是个问题。最近，他们意识到他们需要以不同的方式自动化他们的备份，因为创建他们自己的 cron 作业对他们来说不是一种有效的做法。首先，它引入了停机时间，因此他们必须在有限的时间段内安排停机时间，这对于一家处理多个时区的全球性公司来说是很棘手的。如果在停机期间进行了任何其他维护，则可能会出现备份丢失的情况。此外，对于 cron 作业，他们必须为他们的每个项目单独设置，并且他们通常有几个项目同时发生。每当他们建立一个项目时，创建一个新的 cron 工作是令人难以承受的。他们需要实时备份，并且需要自动化备份。

借助自动化实时备份，CIS 管理员不必启动或安排备份，最重要的是，备份可以在没有任何停机时间的情况下完成。一些企业会选择在特定时间将实时备份与标准(手动)备份相结合，例如在大规模部署之前，以捕捉当时的一切。后者会导致短暂的停机时间，但它在必要时增加了对流程的额外控制和确定性。自动化备份不仅允许企业每 30 天自动备份 24 小时，而且通过实时备份，他们还能够在一天内进行多次备份，并在一整年内每月进行同步和存储。客户没有意识到这一备份过程对他们的安心有多么有效，直到他们尝试了这一过程并将其与他们自己最初设置的过程进行了比较。

## **每日备份是王道，但企业规模很重要**

说到频率，根据公司规模和市场会有所不同。强烈建议大多数企业至少进行每日备份。对于大型企业，尤其是那些处理大量消费者数据或处于高度管制行业的企业，更频繁的备份是最佳选择。对于许多大型企业来说，丢失一天的数据可能是不可接受的，因此 RPO(恢复点目标)目标可能低至 6 小时，因为这是组织可以容忍丢失的最大数据量(从发生故障到最近一次完整数据备份的 6 小时)。在发生灾难性系统故障时，由于其他一切都需要管理，从选择的备份中恢复网站应该只需单击一个按钮。虽然 RTO(恢复时间目标)或站点在恢复前可以停机多长时间因备份大小而异，但 5GB 将比 500GB 快，该过程开始得越快，花费的时间就越少。

## **高度管制行业的备份规划**

在一些市场，比如管理医疗保健或金融的网站，每个数据点都极其重要。如果患者信息或其他数据是按小时记录的，丢失一整天的数据将是灾难性的，也是一个重大的法规遵从性问题。我们有客户在经历轻微但严重的数据丢失后找到我们，或者可能在推送后数据没有被记录下来，这在事后产生了许多复杂情况。

电子商务是另一个行业，回滚太久可能意味着丢失关键的事务数据。丢失与访问你的网站购物的顾客相关的数据，对于任何经营电子商务网站的人来说，都是一个危险的先例。这是项目所有者关心的数据类型。确保以几种不同的方式或高度冗余的方式保留数据。另一个电子商务场景涉及流量进入，并确保来自购物者参与的网站的电子邮件正确通过。任何关于谁被访问的数据丢失都会对短期和长期的销售产生不利影响。

特别是对于这些行业，cron 作业作为一种自动化备份方法不够稳定。区别主要在于保留策略，例如，他们必须将患者数据或不一定立即使用但出于其他原因而存储的数据保留多长时间。这些类型的场景应通过实时备份结合标准手动备份以及潜在的增量备份实现自动化，以管理存储成本。

## **每个项目都应该有默认策略**

许多 CIS 管理员独自处理多个项目，他们可以根据存储需求调整默认策略，因为每个备份都非常大，但规模可能不同。当企业采用不一致的备份方法时，会导致不必要的时间浪费。在某些情况下，如果仅在部署前进行备份，可能会导致不可预测的数据丢失。

## **三种备份频率和自动化建议**

就备份频率、自动化选项和最佳实践而言，我们合作的业务通常可分为以下三类:

至少:

*   应每天进行一次备份，每次备份保留两天。 
*   应保留两个手动备份，直到进行新的备份，新的备份将替换当前存储的最旧的备份。 

对于需要更多备份或更长保留时间的项目所有者，下一步需要:

*   每天进行一次实时备份，每次保留一周。 
*   每周备份一次，每次保留四周。
    
*   每月一次备份，每次保留一年。 
*   四次手动备份，所有备份都将保留，直到创建新的备份并替换最旧的备份。
    

最后，对于感觉需要更多备份和更长保留期的项目负责人，我们建议:

*   每六小时一次实时备份，每次保留一天。 
*   每日实时备份，每次保留一个月。
    
*   十二次每月备份，每次保留一年。 
*   四次手动备份，所有备份都将保留，直到创建新的备份并替换最旧的备份。 

对于完整备份，能够在不丢失太多数据的情况下回滚至关重要。为了持续取得成功，设置和调度应该是一个非常简单和无缝的过程。自动实时备份最好与手动备份结合使用。业务越大或越复杂，自动化备份的“构建”方法就越具有挑战性，缺乏跨项目和时间表的稳定性和可靠性。毕竟，备份的目的是让项目负责人放心，如果没有做到这一点，最好看看如何在您的组织内全面标准化、简化和扩展。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>