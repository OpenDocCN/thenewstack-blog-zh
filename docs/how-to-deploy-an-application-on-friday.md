# 如何在星期五部署应用程序

> 原文：<https://thenewstack.io/how-to-deploy-an-application-on-friday/>

[](https://www.linkedin.com/in/powellronald/)

 [罗恩·鲍威尔

罗恩有空间物理学的背景，曾作为卡西尼小组成员分析土星磁层中的等离子体。他现在在加州旧金山的 CircleCI 公司工作，作为一名开发人员，倡导开发内容，使开发人员能够更快地构建、测试和部署他们的项目。](https://www.linkedin.com/in/powellronald/) [](https://www.linkedin.com/in/powellronald/)

没有人喜欢放弃周末去解决发布问题。

开发人员和运营团队传统上不愿意在周五进行更改或部署应用程序，以防出现问题，他们不得不利用周末进行紧急修复。或者更糟，试图回滚所做的更改。

然而，**有了一套强有力的实践和可靠的部署渠道，没有理由不在任何时候进行部署** —即使是在星期五下午。

在本帖中，我们将介绍 DevOps 团队应该采取的一些步骤，以确保他们可以安全可靠地部署几乎任何更改，并且不会失去他们的周末。

## 星期五我需要部署什么？

为了确保您可以在星期五或任何时候部署，**您必须确保您的应用程序至少没有需要紧急修复或回滚的关键 bug**。

为了获得这种确定性，您需要一套您可以信任的测试来覆盖尽可能多的用例。在将应用程序部署到生产环境之前，您还需要一种方法来确保这些测试运行并通过。但是，您如何开始开发测试并将其添加到您的开发管道中，以便获得这种信心呢？最好是从小处着手，不断重复。制定一个简单的计划，如下图所示，用你现有的资源增加你的测试。

## 我需要随意部署什么？

随时部署应用程序是一个崇高的目标。那么，**你真的需要随意部署应用程序吗？自信。**

信心使您可以在任何时候部署应用程序，而不用担心会浪费一个周末的时间来修复生产中的关键错误。这就引出了为什么大多数开发人员和操作团队对他们的部署缺乏信心的原因:没有足够的测试来覆盖整个应用程序。

如果不对您要部署到的大多数(如果不是全部)应用程序和环境进行严格的测试，bug 几乎肯定会进入生产环境。有时，你会很幸运，这些错误并不严重。其他时候，您需要进行紧急修复或回滚更改，这会导致对您的部署缺乏信心。

您需要对您的管道以及通过它的变更有信心，以确保您的应用程序总是准备好部署。您还需要一种尽可能自动化这一过程的方法，以确保您的部署不需要额外的工作。

## 测试之旅:开始

从查看应用程序的关键组件开始——用户最依赖的应用程序部分。开发一些基本测试来检查该功能是否有效。你不需要马上迎合每一个可能的组合，只需要想出检查“快乐路径”的测试就可以了——你希望用户大部分时间都能看到的路径。

如果您有时间并且知道您的用户有时在这条路径之外做什么，那么也添加一些测试用例来检查这些。

### 添加更多测试

让您对部署更有信心的下一步是，在您修复 bug 或添加新功能时，努力添加单元测试和集成测试。

完全采用[测试驱动开发(TDD)](https://en.wikipedia.org/wiki/Test-driven_development) 实践是有帮助的，因为这确保了任何新的或改变的代码总是有测试。即使您不完全采用 TDD 方法，每次修复一个 bug 时编写一些测试——以证明解决方案是可行的或者检查新特性是否满足需求——也是一个好的开始。

### 自动化测试

一旦你开始习惯于引入测试并使它们与你的过程一致，将这些测试合并到你的[持续集成管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)中。在部署新的构建之前，作为您的[持续集成(CI)](https://circleci.com/continuous-integration/) 构建过程的一部分的测试将自动重新运行。

通过在应用程序的所有部分运行所有这些测试，您对没有错误进入生产环境的信心将会增加，因为此时您已经自动测试了应用程序的大部分。

### 解决不可避免的事情

一旦您开始编写和自动化大量的测试用例，当变更进入构建管道时，您将不可避免地开始捕捉失败。在这种情况下，应该开发一个快速、标准的过程，将测试失败标记回变更提交者。

您希望构建尽可能快地发生并被测试，以便当变更通过或者——最重要的是——没有通过任何测试时，开发人员能够尽快得到通知。这将您的 CI 渠道提升为“我们如何确保我们的代码可以随意部署？”这一问题的解决方案

## 向 CI 管道添加测试

现在您已经有了一个向我们的代码库添加测试的总体计划，那么您如何实现这个计划呢？

大多数时候，您希望您的测试与您的环境一致，以便分离测试。June Jung 发表了一篇关于测试隔离的伟大而深入的文章。总而言之，您希望建立三个层次:

*   单元测试:小型、廉价、快速的测试，覆盖基本的代码功能，没有依赖关系，当代码签入时在开发中运行。
*   **集成测试**:涵盖服务如何集成的大型跨单元测试，将在早期测试环境中运行。
*   **用户界面(UI)测试**:针对用户工作流的自动化、基于界面的测试，在部署到生产环境之前或之后运行。

在向管道中添加测试时，要考虑的另一个关键问题是:您有足够的代码覆盖率吗？当您开始向现有应用程序添加测试时，您的覆盖率自然很低。然而，没有一个明确的代码覆盖率目标。

最好的方法是评估你的覆盖范围，然后随着时间的推移逐步增加。重要的是不要“全力以赴”并以 100%的覆盖率为目标，因为你可能用不够彻底的可怕测试来覆盖 100%的覆盖率，从而让错误溜走。

回到我们的游戏计划，从应用程序的关键部分开始，确保它们被真实的测试很好地覆盖。没有真正的方法来确定你是否有全覆盖。这是通过在开发代码时尽可能多的测试来增加信心。

当您考虑可能会越来越多地破坏您的代码的场景时，您的测试将变得更强大和更完整——允许您捕捉那些关键问题。为了更深入的了解，June 在[嘲讽、存根和契约测试](https://circleci.com/blog/how-to-test-software-part-i-mocking-stubbing-and-contract-testing/)上有另一个很棒的帖子。

## 实现部署自由

随着时间的推移，对您的应用程序进行良好的测试覆盖，并首先关注关键部分，这是增强您对部署的信心的关键。通过将测试套件集成到您的 CI 管道中，并确保它们在每次提交代码时都运行，您将很快获得随时部署您的应用程序的信心——甚至是在星期五下午。

随着您的代码覆盖变得更加完整，您变得更加自信，您也可以将连续交付(CD)添加到您的管道中。随着一个完整的 CI/CD 管道的运行，每个构建都将被自动测试；而且如果通过了所有测试，也会一气呵成的自动部署。

CI 的采用也改变了开发团队文化。当谈到开发团队的成功时，找到正确的 [DevOps 指标来衡量](https://circleci.com/blog/engineering-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogFriday)是至关重要的。了解[如何在](https://circleci.com/blog/how-to-measure-devops-success-4-key-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogFriday) [2020 年软件交付状态中用四个关键基准来衡量 DevOps 的成功](https://circleci.com/resources/2020-state-of-software-delivery/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogFriday):工程团队的数据支持基准。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>