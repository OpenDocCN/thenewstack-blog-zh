# 我们能从推特的瘫痪中学到什么

> 原文：<https://thenewstack.io/what-we-can-learn-from-twitters-outages/>

“所有这些系统基本上都是人和机器。在很长一段时间内都无法摆脱这一点——希望是非常非常长的一段时间。因此，如果我们只看技术是如何失败的，我们就错过了它是如何失败和如何工作的很大一部分。”威瑞卡的研究分析师考特尼·纳什 告诉新堆栈。

上周一，许多 Twitter 用户收到了一条不寻常的 API 错误消息，当时一项配置更改——据称是由一名工程师 做出的[——导致该网站的大部分内容无法像预期的那样为所有人工作。照片无法加载，Twitter 拥有的 TweetDeck 服务关闭，点击时链接无法打开，以及其他异常行为。这一切都是 Twitter 寻求从开放的 API 文化转向只提供高级 API 服务时所做的改变的结果——甚至对行业安全标准的双重认证收取有争议的费用。](https://www.platformer.news/p/how-a-single-engineer-brought-down)

这次中断只持续了几个小时，但它为整个科技行业提供了许多有价值的教训，围绕着变革管理和科技裁员对复杂的社会技术系统的影响。

## **哪里出了问题？**

我们不知道，也可能不会知道到底发生了什么，因为“公司以外的人不可能确切知道是什么导致了 Twitter 最近的 API 宕机，但在他们为开发人员构建新的付费 API 的努力中，一些推向生产的变化产生了意想不到的后果，”RedMonk 的分析师 Kate Holterhoff 告诉 New Stack。

我们所知道的是，这可能发生在任何公司，尤其是达到 Twitter 的技术复杂性、规模和全球分布的企业。

“这听起来像一个普通的配置变化，”纳什从首席执行官[埃隆·马斯克](https://twitter.com/elonmusk)和[推特支持](https://twitter.com/TwitterSupport)的推特上读到的内容中说道。“而且，取决于你问的是谁，是一个工程师推动了一项不正确的配置更改，从而破坏了他们的 API 状况。”

这可能会成为头条新闻，因为 Twitter 权力转移的政治，因为 4.5 亿用户群可能会受到影响，但这并不令人震惊。作为一名自称是互联网事件管理员的人，他建立了 Verica 的开放事件数据库 VOID，Nash 发现，在 VOID 上列出的来自 590 个组织的 10，000 份事件报告中，有 400 份涉及某种配置更改。

她说，这些是“这种连锁故障中臭名昭著的”，指的是微服务风险，即互连部分系统中一部分的故障可能导致其他部分甚至整个系统的故障。微软、亚马逊网络服务、脸书和 Cloudflare 等公司也遭遇过配置事件。

她指出，从历史上看，Twitter 从未公开报道过他们的事件。创建 VOID 是为了鼓励共享停机时间，这样技术行业就可以在同行之间相互学习。

虽然我们没有本周 Twitter API 中断的事件报告或事后分析，但有一些猜测。本周，马斯克在去年 10 月以 440 亿美元收购 Twitter 后成为其首席执行官，他公开称 Twitter 代码堆栈“ [”极其脆弱，理由并不充分。](https://twitter.com/elonmusk/status/1632810081497513993)

还是那句话，不意外。“我还没有见过一个不脆弱的企业系统，因为它们构建得如此之快，却并不总能得到它们所需要的支持。所以我不怀疑 Twitter 有一个脆弱的系统。它是多年来由许多不同的开发者建立的，”《邮差》的首席布道者 [金莱恩](https://www.linkedin.com/in/kinlane/) 告诉新的堆栈，这使得 Twitter 的系统过于相互关联，以至于无法缩减或关闭，而没有全面的重构和有目的的路线图 。

> “如果不拔掉整个数据中心的插头，拿出四分之三的微服务，解雇所有负责这些服务的人员，就可以避免这种情况的发生。”— [考特尼·纳什](https://twitter.com/courtneynash) 、维里卡

然而，马斯克试图关闭 Twitter 的大部分微服务。上个月，在他削减数据中心成本的努力之后，Twitter 经历了最严重的一次宕机，导致用户无法喜欢、发推或直接发送消息。这就引出了一个问题:为什么最近总是停电？

“那么，它之所以脆弱，是因为它更古老、更传统(建筑)，而且很长时间没有被重写，也没有进化吗？是因为大量微服务被关闭而变脆的吗？它之所以脆弱，是因为没有对数据库、索引、网关等运行 API 的东西进行维护吗？我会说 D，以上都是，”莱恩继续说道。这就是为什么像所有易碎的东西一样，Twitter 系统应该小心处理。

## 技术只是问题的一部分

像科技行业的所有事情一样，这真的是一个社会技术问题，而不仅仅是一个技术问题。当然，放大来看这是最近最激进的[](https://thenewstack.io/fear-and-layoffs-how-to-cope-with-techs-uncertain-times/)[科技裁员，在短短四个月内推特员工](https://www.nytimes.com/2023/02/26/technology/twitter-layoffs.html) 裁员高达 75%。这不仅仅是削减开销，还削减了大量的经验和专业知识。有未经证实的传言称，Twitter 的员工减少到只有一两名网站可靠性工程师，他们是正常运行时间和服务安全性的管理者。这意味着很可能没有人应用像 [混沌工程](https://thenewstack.io/chaos-engineering-business-value/) 这样的最佳实践来试图预测“如果……会发生什么”

“我认为问题是，可能没有机构知识来知道如何从油井中恢复，或者知道那里可能会发生什么。但我不认为像这样的事情会发生是令人震惊的，”纳什说。

这不应该是对一个工程师指指点点，而是承认“这是一个非常复杂的社会技术系统中的一个人。有一个人没有关闭 Twitter，”她继续说道。我们“责怪这个系统中的人类，在大多数时候，人类是这个系统在 90%的时间里工作的原因——但我们从来没有谈论过这一点。”她说，在某种程度上，Twitter 已经将这种对话从寻找指责转移到谈论机构知识有多重要。

这也不是第一次单方面决定关闭社交媒体应用程序的一部分。上个月，又发生了一次宕机——人们收到了“你超过了每日限额”的通知，即使他们当天还没有发推特——当时一名员工意外地从 Twitter 的内部服务中删除了关于费率限制的数据，可能是为了另一项高级功能。但是，根据 The Verge 的说法， [创建该服务的团队中已经没有人了，这使得在没有任何具有必要领域专业知识的人的情况下修复该服务变得更加困难。](https://thenewstack.io/observability/)

这都反映了团队拓扑的创建者之一 Manuel Pais[告诉新的 Stack](https://thenewstack.io/how-team-topologies-supports-platform-engineering/)——缺乏团队第一的方法。当科技公司仅仅因为长期员工的薪酬更高而不断解雇他们时，风险是很大的。

“不要放过那些专家，如果他们接受这种教学和帮助他人的想法，他们将会变得强大，”他说。

## **什么可以防止未来的停机？**

这并不是说没有改进代码的方法——毕竟，Twitter 是 [失败鲸迷因](https://www.techopedia.com/definition/1987/fail-whale) 的起源。但是技术变革必须由人和流程来驱动。

“内部人士经常抱怨 Twitter 的遗留代码——公平地说，多年来发展的大型复杂系统几乎总是如此，”霍尔特霍夫说，在采访中重复了这一说法。“遗留代码和架构的一个问题是，它们可能会阻碍实现更先进的流程，如渐进交付。”

是一个总括术语，由她的同事 red monk[James Governor](https://twitter.com/monkchips)创造，用来描述将流量路由到用户子集的做法，以努力减少任何发布的爆炸半径。这包括金丝雀测试、特性标记、A/B 测试、蓝绿色部署、[服务网格](https://thenewstack.io/service-mesh/)等等。它通常与更广泛的战略 [混沌工程](https://thenewstack.io/why-chaos-engineering-isnt-just-for-operations/) 和 [可观察性](https://thenewstack.io/observability/) 相结合，不仅可以在故障发生时将影响降至最低，还可以试验和询问系统，提高可靠性并减少事故。

在反思本周的 Twitter API 宕机时，Holterhoff 继续说道，“听起来平台团队为促进渐进式交付而制定的任何政策都没有提醒他们一些问题，如果工作正常，这些问题将使他们能够避免在整个平台上普遍部署这些更改。”

在过去的几个月里，Twitter 公司文化经历了一次重大的思维转变。纳什评论道:“在马斯克接手之前，Twitter 在如何做事和如何改变方面的速度是出了名的慢。”。

相比之下，现在似乎缺乏技术领导或自上而下的策略来*而不是*快速行动和打破常规。

霍尔特霍夫说:“这次故障是今年一系列服务中断中最近的一次，它的后果是对 Twitter 可靠性的持续审查以及它不愿意承担全部责任。”“除了马斯克的表演——特别是那些与严重裁员有关的表演——这些高调的停机事件表明，组织缺乏资源和意志力来充分测试和审查正在发布的代码。”

同样，对于复杂的团队来说，级联故障不是“如果 T1”时的“T0”，而是“当 T3”时的“T2 ”,但是类似于渐进式交付的行业最佳实践可以帮助更好地准备和实现更快的恢复。当然，你需要受过教育、有经验或受过训练的队友来练习。

“除非亲身经历，否则很难知道这些变化的影响范围有多大。因此，能够防止这种情况发生的可能是对这些系统上的其他事件进行仔细调查，”纳什说，理想情况下是较小的事件。这包括围绕尸检和文档的透明文化，这有助于支持员工的变化。

## 失去一个开放的 API

马斯克试图将 Twitter 货币化的众多尝试之一是最近宣布，在 17 年后，Twitter API 集成合作伙伴有几周的时间要么付钱，要么离开。这是本周早些时候可能破坏网站的配置变化，但它也是建立在开放 API 生态系统上的 Twitter 的一个巨大转变。

“对我来说，Twitter 是最重要的 API，”莱恩说，他也被称为 [API 布道者](https://apievangelist.com/) 。“这是我爱的人，也是我最讨厌的人。它塑造了奥巴马的总统任期。它塑造了特朗普的总统任期。它塑造了阿拉伯之春。它帮助了大学研究人员，”包括 [Twitter API 团队](https://developer.twitter.com/en/docs/twitter-api)联系大学，了解他们如何利用开放 API 进行新冠肺炎研究。

> "推特在很大程度上是世界的神经中枢系统."—金巷，邮递员

也许这是一个不受欢迎的观点，但莱恩希望看到 Twitter 像公用事业一样受到监管。

Lane 并不反对团队对 API 的使用收费，但是他强调，Twitter 是建立在一个开放的 API 生态系统之上的，并且提供公共服务。他回忆说，当 Twitter 在 2006 年推出时，它几乎没有什么，这就是为什么在最初的五年里，它严重依赖 Twitter 开放 API 社区和黑客马拉松来共同扩展它。

与元社交应用套件不同，Lane 认为 Twitter 已经变得更像一个公共广场或市政厅。最近，他合作了一个新冠肺炎跟踪应用程序，美国各县通过 Twitter 句柄发布新闻——指向开放 API 的公共使用。他还合作在飓风桑迪和其他自然灾害期间将人们转移到避难所——这表明了 API 对社会公益的支持。Twitter API 在政治世界中也扮演着不可否认的角色，包括大量使用它的机器人。

是的，最终关闭一个开放的 API 来从中榨取收益，这就是 Lane 所说的“商业 API 剧本 101”但 Twitter 早在 2016 年就已经创建了一个高级业务层，同时仍保持其开放的 API 生态系统。

“他(马斯克)认为这是一个战略决策。省钱，也许创造新的收入，因为你向人们收费，而不是免费赠送。所以这是一种成本节约，一种新的收入来源，但他错过了损害他们业务的许多其他方式，”Lane 说。

由于这些决策总是处于技术、商业和政治的交汇点，他认为创建不可靠的 API 可能是 Twitter 的一种商业策略，“因为你不希望每个人都使用相同的 API。你不希望人们在与你竞争时拥有可靠性、稳定性和舒适性，”所以你不再确保有人关心这些 API，或者运行它们的人，或者它们的用户。

“需要具有 [同理心的人类来正确运行 API](https://thenewstack.io/do-you-have-the-empathy-to-make-the-move-to-architect/)，而我认为这在今天的 Twitter 上并不存在，”莱恩感叹道。但是，现在，他说，“我不会放弃推特。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>