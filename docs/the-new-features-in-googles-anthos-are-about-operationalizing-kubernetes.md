# 谷歌 Anthos 的新功能是关于运营 Kubernetes 的

> 原文：<https://thenewstack.io/the-new-features-in-googles-anthos-are-about-operationalizing-kubernetes/>

谷歌正在为其 [Anthos 混合 Kubernetes 平台](https://cloud.google.com/anthos/)带来服务网状管理、无服务器和自动化策略和安全管理。谷歌云产品管理总监 [Jennifer Lin](https://www.linkedin.com/in/jennifer-lin-19a87a2/) 告诉新的堆栈，这个想法是通过利用谷歌管理和运行 Kubernetes 的经验，使容器和微服务更容易操作。

“我们经常听到的关于开源的抱怨之一是‘我不想自己构建、打包和部署它，我希望所有这些第一天的操作都非常简单。’这就是我们最初在产品中关注的。但她表示，像 Anthos Service Mesh 这样的新功能不仅仅是提供基础设施，而是在您自己的硬件上获得托管服务，从而实现服务水平目标。

“现在我们有了一个基于控制台的拓扑图视图，允许您实现 SLO 服务级别目标和 SLO 管理。因此，现在我们真正在管理服务，而不是担心如何建立基础设施和设置 DNS。如果你是一名开发人员，你希望了解源代码，以及你可以调整的一切，而如果你是一名用户，你希望别人给你最佳实践。”

Kubernetes 最初在她称为“精通技术”的数字原住民团队中很受欢迎，尽管企业越来越多地在 Kubernetes 中拥有至少一些内部专业知识，但她认为，他们永远不会像谷歌那样擅长管理和扩展它。

“至少有一个，通常是几个工程团队已经在 Kubernetes 环境中进行生命周期管理。但是随着规模的扩大，他们希望让其他人来管理。他们希望环境能够正常工作，运营生命周期管理由了解该领域的 sre 来管理。在谷歌，我们每周推出数十亿个容器，我们必须保持这些全球集群的稳定性和弹性。我们还试图通过 Istio 和 Kubernetes 强调的是，理解开发堆栈中的组件是一回事，实际大规模操作它是另一回事，确保我们管理 SLO 并对客户负责是另一回事。”

这是谷歌对 Anthos 一贯的论调的一部分；Kubernetes 可以跨云使用(这也是为什么担心厂商锁定的组织认为这是关键)，但谷歌运行它的经验给了它一个优势。她声称:“谈论 Kubernetes 发行版的人中，很少有人真正拥有实际大规模运营的日常运营领域经验，包括我们在云计算领域的竞争对手。”。

谷歌还需要将 Anthos 呈现为一个无处不在的基础设施层的托管版本，以避免被更多采用 PaaS 作为云的“下一阶段”的愿望所束缚。“如今，许多客户几乎像使用另一台服务器一样使用云；他们正在使用原始计算和存储，但他们对捆绑到更高层的服务非常谨慎，”Lin 指出。

与微软的 [Azure Stack](https://azure.microsoft.com/en-us/overview/azure-stack/) 不同，它在内部带来了许多 PaaS 服务，到目前为止，Anthos 是基础设施方面的解决方案，而 [Anthos Migrate](https://cloud.google.com/migrate/anthos/) 被用作容器化遗留应用程序的第一步，建立在 Velostrata 收购的技术基础上，最初将虚拟机从其他云迁移到[谷歌云平台](https://cloud.google.com/) (GCP)。

林说，现在，成千上万“准备好迁移到 Anthos”的工作负载不仅包括已经容器化的应用程序，还包括“没有很多其他依赖关系、易于迁移到托管环境中的虚拟机工作负载”将现有虚拟机置于 Anthos 中 Kubernetes 的编排控制之下的能力还处于测试阶段，她称之为“蛙跳路径”。

“我们有很多客户认为这是一个跳过提升和转变阶段的机会，并在第一天就将现有虚拟机置于 Kubernetes 流程编排层的管理之下。你不会得到所有的好处，就像你把它写成一个容器一样，但是对于许多客户来说，这是非常实用的。我们最初并没有把它写成一个容器，但我们可以把一个虚拟机当作一个容器来管理，并随着时间的推移把它精简，这样我们就可以获得容器化的所有好处，”Lin 说。

Lin 说，Anthos 也引起了那些希望在 Kubernetes 上提供产品的软件供应商的兴趣,“要么是为了 SaaS 化他们的服务，要么是为了用更现代的本地环境进入市场，他们要求我们也帮助他们管理正在进行的生命周期操作。一家时序数据库供应商已经在 Kubernetes 上构建了他们的 SaaS 服务，并且正在进行管理，希望迁移到 Anthos,“这样他们就可以进入 Anthos 市场，并允许客户点击部署到外包环境中。"

Google 运行的 Anthos 环境现在提供了更多的配置管理；这个想法并不是要更加自助化或者将用户推回到 Kubernetes API 服务器，而是通过提供声明式策略管理作为托管服务来简化多种环境下的工作。“假设我们有一个声明式配置，用于跨内部环境和 GCP 设置身份和访问管理。在这种情况下，资源模型不基于 GCP 资源，但策略仍然是相同的，比如“财务团队不允许访问此存储桶，因为它包含这种类型的数据。”"

该策略的高层次意图没有改变，但显然，在我的本地 Kubernetes 集群和 Amazon Web Services 或 GCP 中进行配置所需的脚本是不同的。因此，我们谈论的配置和策略管理是将 YAML 文件转换为 Python 脚本的第二个阶段，该脚本实际配置 GCP 资源和 Azure 资源。我们的做法是将本地资源模型的名称空间同步到 GCP 资源模型。这是一个自动化的过程，我不需要为任何东西重新配置或重写策略，无论它是存储在本地、第三方存储目标还是 GCS，我仍然需要执行相同的策略。"

这符合流行的“GitOps”方法。“我们的许多客户正在使用 GitHub 对已经得到安全团队或云平台团队支持的配置进行版本控制。与让 IT 管理员对设备或虚拟设备运行 CLI 命令相反，现在的趋势是越来越多地使用自动化系统，这样，一旦我在体系结构中验证了新的资源模型或新的系统组件，它就必须遵守声明的策略。”

新的二进制授权功能是这种受管自动化方法的一部分，通过安全检查来确保您仅部署受信任的工作负载。“您如何武装架构的每个粒度组件，以确保加入该环境的任何东西都是它所说的那样，并且它具有确保它可以参与服务网格或 Kubernetes 环境所需的证明？因此，我们在这里为进入托管环境的任何映像建立信任:在部署时，我只能将一个受信任的工作负载放入环境中，它会在工作负载进入部署环境的第二天操作之前检查工作负载是否经过评估和验证。”

将云运行引入 Anthos 是为了控制无服务器工作负载的运行位置；这与无服务器的基本思想有点矛盾，因为你不关心基础设施，但李指出，开发人员和管理员在这方面有不同的需求。

“作为一名开发人员，我应该能够编写一个函数或触发一个事件触发器，而不必真正关心基础设施。然而，如果我是集群管理员，我希望能够说，在这个集群环境中，开发人员可以做他们想做的任何事情，但要确保它在这个区域的这个集群上。我们可以在几秒钟内将现有的容器变成现有 Anthos 环境中的服务端点。一个开发人员做了一些很酷的东西，他们想把它发布到互联网上，或者通过 HTTPS 会议。这个端点可以定义为互联网可以到达的任何东西，也可以定义为私有端点，正如我们的许多企业客户所想的那样。不要将它暴露在公共互联网上，确保它在我的专用网络环境中工作。”

当我们问及 Anthos 和服务(如云运行服务)的兼容性时，李说目标是兼容性，但他指出“就我们正在做的事情而言，有一点滞后。”

Anthos 也不是为你的数据中心获取所有谷歌服务的一种方式。“Kubernetes API 服务器支持的一切在本地运行都是合理的期望，”她说，但“我们并不是说在 GCP 运行的一切突然都在本地运行了。GCP 的其他一些服务——例如，我们没有计划在本地部署[扳手](/google-takes-cloud-spanner-global/)

来自 Pixabay 的 Ionas Nicolae 的特写图片。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>