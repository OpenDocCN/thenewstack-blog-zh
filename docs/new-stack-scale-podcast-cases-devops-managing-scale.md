# 新的 Stack @ Scale 播客，Show 5:如何超越最初的 50，000 名用户

> 原文：<https://thenewstack.io/new-stack-scale-podcast-cases-devops-managing-scale/>

“你的大部分瓶颈，尤其是在一个小网站、一个初创公司的初级阶段，都在 SQL 数据库级别，”体育网站[看台报道](http://bleacherreport.com/about)的工程副总裁 Tung Nguyen 说。

在第五集 [The New Stack @ Scale](/tag/the-new-stack-at-scale/) 中，我们听到了 Bleacher Report 从一台虚拟机上运行的“糟糕”博客软件成长为每月吸引超过 8000 万独立观众的领先体育数字资产的不可思议的旅程。

Nguyen 被《新书库》的主编 Alex Williams 和 Fredric Paul 拷问。Lee Atchison 也在场，他提供了他在 New Relic(作为其主要云架构师和倡导者)的扩展经验，以及他在 AWS 的时间，在 AWS，他创建了 Elastic Beanstalk 并领导团队管理亚马逊零售平台从整体架构到基于 SOA 的架构的迁移。

New Stack @ Scale 是我们的月度播客，由 New Relic 赞助，研究伴随动态服务和系统的各种问题。

[显示 5:开发与管理规模](https://thenewstack.simplecast.com/episodes/show-5-devops-and-managing-scale)

Nguyen 在 Bleacher Report 的故事始于 2007 年，当时每月有大约 50，000 名独立观众。

“在那个时候，50，000 uniques 不是一个小数目，”威廉姆斯说。“那你是怎么做到的？”他问。

“非常混乱，”阮承认。“我的任务是建立一个工程团队，建立一个网站，而创始人却在那里试图获得风险投资。”

“当时，我们位于澳大利亚一家名为 RimuHosting 的公司的一台小型虚拟机上，”他说。“每天晚上，大约午夜时分，他们会重新启动系统，这将使我们的网站瘫痪大约 30 分钟。直到 [Pingdom](https://www.pingdom.com/) 出来我才真正知道这件事。然后 Pingdom 出来了，我连接了它，每天晚上，我都会在半夜收到一个页面。因此，我们很快解决了这个问题，并搬出了里穆霍斯汀。”

“有 50，000 个 uniques，这是很大的规模，不算小，但还没有达到这样的规模，也不需要我们现在拥有的高可用性需求，”他说。“我和几家公司谈过，我相信 Rackspace 是其中之一。我当时交谈的另一家公司是 Engine Yard，Engine Yard 当时是一家初创公司——他们自己的冒险和他们自己的旅程恰好与我们的完全重合。”

Nguyen 甚至不记得当时正在运行的博客软件 Bleacher Report 的名称，“但是，他们用这个可怕的软件获得了 50，000 个 uniques。他们不得不将开发团队外包出去，我最终雇了几个人，把它带到了公司内部。”

“我们刚刚运行了这个类似 WordPress 的小博客，并开始开发网站的 Rails 版本。今天，我们仍然在 Rails 上运行面向用户的站点，但是有了不同的组件。它不再仅仅是一个大的组成部分——这是一个漫长的旅程，”他回忆道。"不管怎样，我们从一个大型的整体式 Rails 应用程序开始——这就是 Rails 0.2 天."

Nguyen 说，一个挑战是一个列出常见可搜索网站标签的页脚，但它被证明包含“一个产生 560 个左右查询的 Ruby 循环”。“我把它减少到一个，然后缓存起来，然后突然每个人都喜欢，‘哦，哇，我们的网站真快。’"

艾奇逊也记得早期的铁路时代。“Rails 非常适合快速、方便地启动和运行应用程序。但是高效？没有那么多。不是因为 Ruby，而是因为它在优化 SQL 查询方面做得非常非常差，尤其是在早期。”

“这通常可以归结为非常简单的事情，”阮解释说。"你找出瓶颈，然后解决它们."

“这需要一些经验，”他继续说道。“我希望有一所职业学校来做这件事。我希望有一本书。我希望有一个会议。但不幸的是，你必须通过流血、流汗和流泪来学习。”

“我记得 Ruby 的基准测试是每秒 40 或 50 个请求。Python 也在那里；Perl 也在那里；PHP 也在那里，”他说。

“所以，我只想重申这一点，Ruby 本身并不慢，它只是取决于你想做什么，”他断言。“这取决于你想解决什么问题。先问那个问题；退一步，环顾四周。”

那么 Bleacher Report 在他们开始规模化的时候看到了什么？“我们需要扩张，我们需要建立一个销售团队，我们需要建立组织的其他部分，”阮说。“我们需要更多的数据来做出正确的决策。因此，我们开始在内部建立一个分析平台，因为谷歌分析无法处理我们试图做的事情。因此，我们开始分解应用程序，因为在 Ruby on Rails 应用程序中构建大数据收集器没有任何意义。”

“这大约从 2009-2010 年开始，”他继续说道。"那时我们有一个三人小组，最终，我们有了六个人。"

“我们的转变并不是从平台开始的，真的。我们对我们的组件进行了一些拆分，将其分为一个数据收集应用程序和一个内部分析工具。我们没有做 Java 他回忆道:“那时我们做了辛纳特拉。

“我们看了数据。我坐在那里，新的遗物，分析吞吐量通过我们的网站。吞吐量向我表明，我们的大多数请求实际上不是 web 请求；我们的大多数请求是 API 请求，交付 JSON 有效负载的只读 API 请求，大约 70-80%的时间。所以，把你的时间和精力放在那个组件上是非常有意义的。所以，这就是我们决定要做的。”

“我们决定将 Bleacher Report 分成两个主要项目:主要的 Bleacher Report monolith，它仍然做大多数事情，然后是 API 请求，它服务于我们吞吐量的 70-80%，”他说。“这将是一个只读服务，它今天仍然存在。这件事极大地帮助我们扩大了规模，只需做出决定，我们应该如何打破这种局面。”

“我们没有立即完全采纳所有理想化的 SOA 原则，”他说。“还是那句话，这取决于你在哪里，你的公司在哪里，你的工程团队如何，以及各种各样的变量。”

“New Relic 采取了非常相似的方法，”Atchison 说，“在我们如何从我们的整体 Rails 堆栈转移到我们今天拥有的分布式系统中。”

“我们接受数据，将其转换成 Java，这是我们第一个真正的服务。但从那时起，我们已经建立了一个完整的基础设施，一个完整的服务生态系统，因为我们一直在试图分离和分解这个单片 Rails 应用程序，”艾奇逊说。

“一个团队为了实现这一目标所承担的责任已经发生了很大的变化。现在你的开发团队担心规模，你的开发团队担心需要运行多少服务实例，它们应该在哪里运行，以及可用性问题，”他解释说。"你开始将这些额外的责任视为开发团队在许多方面的负担."

“它创造了一个环境，在这个环境中，您可以建立一个能够围绕扩展应用程序进行扩展的组织，”Atchison 说。“从应用程序的流量角度谈论应用程序的扩展是一回事，但应用程序本身也是从它有多大、它在做什么、它提供的功能等角度来扩展的。”

“这种规模也可能是一个问题，”他说。“因此，这种向服务的转移可以缓解这种情况，因为你最终会创建一个更好的模型，在这个模型中，应用程序的一部分归各个团队所有，各个团队之间有很强的界限和障碍，以便在团队之间提供可靠的 API 和可靠的[服务级别 argreements]。”

Nguyen 和 Atchison 一致认为，扩展挑战似乎永远不会结束。“你解决了哪个问题并不重要，”Nguyen 说，“它会以不同的方式，在不同的背景下重新出现。你只要坚持下去。”

“这些年来，我经历了从一项服务到，比方说，五项服务，八项服务，再到 20 项服务的转变，”他说。"所以，我们的橡皮筋也开始变得乱七八糟."

“很多人看到这种情况后会说，‘我喜欢组织事情，这是不对的，我感到不安。’但是你需要接受它。引用阿德里安·科克罗夫特的话来说，这实际上是互联网的模式。互联网实际上是一个非常有弹性的网络。但是互联网的问题是，你不可能描述所有的互联性，”Nguyen 说。

“我不知道谷歌什么时候部署。我不知道雅虎什么时候部署，或者脸书什么时候部署，但它确实有效，”他总结道。“它之所以有效，是因为一般来说，你授权这些公司，或者像 AWS 一样授权这些小的、只有两块披萨的团队，来运营和拥有整个堆栈。”

“我只是想解决 Bleacher Report 的问题，它有大约 20 种不同的服务。为了做到这一点，我不需要一个检查互联网上每一件事情的一致性猴子。我不想成为政府。所以，我只打算把重点放在 Bleacher Report 的问题上。“我们的问题很大，”他说，“你所要做的就是建立系统来自动化这个过程。你不能用简单的流程和人来对抗他们。这是流程、人和自动化的结合。”

新遗迹是新堆栈的赞助商。

特征图片:[蛇与梯子](https://www.flickr.com/photos/120600995@N07/14125947172/)由[杰奎琳·布朗](https://www.flickr.com/photos/120600995@N07/)制作，授权于 [CC GA 2.0](https://creativecommons.org/licenses/by-nd/2.0/) 。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>