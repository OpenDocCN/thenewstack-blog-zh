# 避免 Kubernetes 中多租户的陷阱

> 原文：<https://thenewstack.io/avoiding-the-pitfalls-of-multitenancy-in-kubernetes/>

[](https://www.linkedin.com/in/mikhailk/)

[Mikhail Kozorovitskiy](https://www.linkedin.com/in/mikhailk/)

[Mikhail 目前是 SUSE 客户成功组织的咨询工程师，专注于通过培训、设计和自动化帮助客户改善 k8s 项目成果。在他近 20 年的技术生涯中，他将自己的开发和运营技能用在了各种事情上，从构建和托管一线音乐家网站、为重工业编写内部 web 应用程序、直播活动，到领导 web 开发团队。](https://www.linkedin.com/in/mikhailk/)

[](https://www.linkedin.com/in/mikhailk/)[](https://www.linkedin.com/in/mikhailk/)

在 [DevOps](https://thenewstack.io/category/devops/) 中，我们讨论了如何像对待牛而不是宠物一样对待集群。当进入下一个阶段，把它们当成你所有宠物的一个混合体时，这变得更有影响力。这就是创建多租户集群时发生的情况。每个具有不同需求和要求的小组都被分组到一个基础架构中。多租户创建了一个可操作的整体——当然，有大量其他资源会告诉您，为什么整体在开发和操作的复杂性和可用性方面都不好。然而，我会给你一个建筑类比，并分享一个我个人的经历，在这种情况下，在一个多租户环境中托管几个高度可见的网站失败了。

就拿现代摩天大楼来类比吧。它们很强大，但不是坚不可摧的，很像我们的集群和基于它们构建的应用程序，以利用高可用性。有些只有一个租户，有些有很多租户，有些只有几个租户。这种差异产生了不同的管理和协调需求。安全，门，墙，平方英尺限制都必须由多租户的建设协调。另一方面，对于单租户建筑，这可以在内部处理，只要求建筑保护外部入口，可能还有顶层阁楼。

另一方面，多租户建筑必须投资于更多的内部安全和租户之间的协调，以应对影响建筑的事件。就人力和设备而言，实施这些强化措施的成本可能相当高。多租户的 Kubernetes 集群的情况大致相同。它们需要内部流量监控、资源限制和准入控制器，所有这些都必须进行配置，以确保受限访问和无干扰。想换楼宇安防系统还是集群入口控制器？在多租户环境中，这些都必须进行协调。在这样的建筑里工作过，我知道它可以做得很好，但是需要很多努力。

> 我们失败了，因为我没有花时间确保足够的隔离。同样的场景也适用于任何两个 Kubernetes 托管的应用程序。

如果您正在为每一个容易划分的组织单元或项目构建单租户集群，那么您就处于自然的划分和自由水平。这简化了您的运营和开发团队的管理负担。虽然牧场主可以很好地管理这两种情况，但当你开始偏离自然的组织分工时，你就会被迫做出取舍和限制。一个集群中有多个租户意味着更多的安全性和更多的隔离，这都需要更多的时间来测试和实现。这需要花费金钱并导致延误。要问的问题是:我们能单独或在外部帮助下有效地管理这种复杂性吗？袖手旁观，不要脸的插头随后就到……如果答案仍然是肯定的，那么继续。

我以前也犯过这样的错误。在我的经纪公司发展时期，甚至在 Kubernetes 之前，在千禧年的第一个十年，我在一家快速发展的音乐经纪公司 BubbleUp 为我们最大的两个顶级音乐客户提供托管服务。在那里，我们从 2009 年开始在[亚马逊网络服务](https://aws.amazon.com/?utm_content=inline-mention)中运行版本分离的 PHP 自动扩展集群。当时，这位第一个精通技术的艺术家在 Twitter 上向他的 500 万粉丝分享了一个商店链接。传入的流量带来了我们的电子商务集群，该集群与多家商店共享，并使第二位艺术家的品牌在大约 10 分钟的时间里缓慢移动，我们的应用服务器争相启动并变得可用。两家商店都暂时倒闭了。

商店没有关闭很长时间，但这是我一生中最长的 10 分钟。我们办公室也花了足够长的时间接到艺人经纪公司的电话。在事后分析中，我的首席执行官兼导师科尔曼·西松问了我一个问题，这个问题一直困扰着我，让我至今无法做出这些决定。我解释了一下，但本质上是这样的:“告诉我们最大的客户之一，他的商店因为另一位艺术家分享了一个链接而倒闭，这可以吗？”我想那天晚些时候我们开始为第二位艺术家划分一个新的集群。我们失败了，因为我没有花时间确保足够的隔离。同样的场景也适用于任何两个 Kubernetes 托管的应用程序。哦，顺便说一句，答案是“不”

总之，尽管 Kubernetes 确实支持多租户，但保护集群以安全地支持它的行为需要经验丰富的工程师和大量时间，而不花时间做好这件事将会带来灾难性的后果。评估您的多租户策略，以包括这些成本。然后，如果这是你想走的路，确保花时间和发展所需的专业知识和流程，以稳健和安全地完成它。如果您需要帮助， [SUSE Cloud Consulting](https://www.suse.com/services/consulting/) 随时为您最具挑战性的使用案例提供帮助。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>