# 一名研究人员的劫持暴露了国家代码顶级域名的弱点

> 原文：<https://thenewstack.io/researcher-hijacked-several-io-tld-nameservers/>

一名安全研究人员成功劫持了几个权威域名服务器。io 顶级域名(TLD)，允许他潜在地将计算机重定向到流氓网站。事件[凸显了域名系统](https://thenewstack.io/risks-dns-hijacking-serious-take-countermeasures/) (DNS)的脆弱性，以及为什么网站所有者实施额外的安全措施是重要的，例如 HTTP 严格传输安全(HSTS)。

这次不寻常的黑客攻击是由[马修·布莱恩特](https://www.linkedin.com/in/matthew-bryant-a9403289/)完成的，他是一名安全研究员，正在调查可能影响整个顶级域名的潜在 DNS 弱点。作为这项工作的一部分，他运行了一个自动化脚本，检查是否有任何托管各种 TLD 的 DNS 区域的域名服务器可供公众注册，原因可能是配置错误或其他原因。

上周，Bryant 收到了一份通知，通知他七个权威域名服务器中的四个。木卫一 TLD 可供购买。有时，这种提醒可能是假的，域名被列为可以注册，但上面有一个锁定标志，阻止用户实际购买。

在这种情况下，然而，科比的企图注册之一。io 名称服务器域名成功通过，他能够将其指向自己的 DNS 服务器。他立即开始收到各种 DNS 查询。来自世界各地计算机的 io 域。

“呀！我很快进入我的 DNS 测试服务器，现在托管这个域名，并很快杀死了运行的绑定服务器，”研究人员在[的一篇博客文章](https://thehackerblog.com/the-io-error-taking-control-of-all-io-domains-with-a-targeted-registration/index.html)中描述了这一事件。“如果我开始接收 DNS 流量，我当然不想给试图合法访问他们的网站的人提供不好的响应。io 域名。由于绑定服务器不再响应端口 53 上的查询，所有 DNS 查询将自动故障转移到 TLD 的其他名称服务器，并且不会对流量产生太大影响(除了在 DNS 客户端故障转移到正常工作的名称服务器时，解析时间略有延迟)。”

研究员立即通知了 [NIC 的管理员。IO](https://www.nic.io/) ，负责 TLD 的注册表，同时也注册了其他三个。io 名称服务器域名被列为可用，以防止潜在的恶意攻击者利用这一疏忽。注册管理机构随后从布莱恩特手中收回了域名的控制权，并向他进行了退款。

为了理解为什么域名服务器如此重要，我们必须了解 DNS 是如何工作的。DNS 通常被称为互联网的电话簿，它将人们容易记住的域名翻译成机器用来相互通信的互联网协议(IP)地址。

每当应用程序或浏览器试图访问某个域名上的资源时，计算机都需要找到托管该域名的服务器的 IP 地址。在 DNS 中，这被称为 IPv4 地址的 A 记录和 IPv6 的 AAAA 记录。

首先，应用程序向系统的 DNS 解析器请求答案，DNS 解析器又向其配置的 DNS 服务器请求答案，DNS 服务器在 DNS 层次结构中的位置会更高，直到查询到达所请求域的权威名称服务器。

这是一种简化，因为在现实中，DNS 是一个由递归、缓存、转发、权威和其他类型的服务器组成的复杂系统。有时答案已经可以在浏览器自己的 DNS 缓存中找到，或者可以从其中一个中间服务器的缓存中提供。但是，缓存的 DNS 记录有一个生存时间(TTL)值，当它们过期时，新的查询必须通过权威的名称服务器才能获得新的结果。

如果攻击者能够控制一个域名或整个 TLD 的 DNS 响应，他们可以将用户重定向到他们试图访问的网站的虚假版本。如果各种应用程序开始向攻击者的服务器而不是托管域的合法服务器发送敏感信息，这可能会导致强大的网络钓鱼攻击或数据泄漏。

的。io 名称服务器域名注册的弱点似乎是在 6 月份的迁移期间引入的。来自 NIC 的 io 注册表。IO，由总部位于英国的一家名为[互联网计算机局](http://icb.co.uk/) (ICB)的公司运营，到 [Afilias](https://www.afilias.info/) ，一家为许多其他顶级域名提供注册管理服务和管理 DNS 解决方案的公司。

Afilias 的高级副总裁兼首席营销官罗兰·拉普兰特(Roland LaPlante)在一份电子邮件声明中表示:“通常，当 TLD 过渡到 Afilias 系统时，100%的 DNS 也会被转移到 Afilias 的域名服务器上。”“上周，Afilias 发现一些与。当 TLD 在 6 月份过渡到 Afilias 的系统时，IO TLD 没有被阻止。在这种特殊情况下，ICB 继续运行其。过渡后的 IO 名称服务器。一经发现，Afilias 立即重新分配并阻止了与 ICBs 域名服务器相关的域名，以及。IO 现在按预期工作。"

根据 LaPlante 的说法，该公司并未意识到因短暂的域名服务器暴露而产生的任何问题，并且该公司的 TLD 过渡程序已经更新，以防止未来出现类似情况。

TLD 注册管理机构 Rightside 的高级 DNS 工程师 Matthew Pounsett 反驳了 Bryant 的说法。io 域实际上会到达他的流氓 DNS 服务器。

作者假设，因为他能够注册一个与几个权威域名服务器名称相匹配的域名。TLD 说，客户很可能会随机选择我们被劫持的域名服务器，而不是任何合法的域名服务器……这是错误的，”庞塞特在个人博客的[技术分析中说。](https://mpounsett.blogspot.ro/2017/07/the-io-error-problem-with-bad-optics.html)

然而，布莱恩特确信[他的服务器收到了价值千兆字节的 DNS 查询](https://twitter.com/IAmMandatory/status/884565612965638144)。在他关闭之前的短暂时间里。这位研究人员甚至声称他进行了数据包捕获，但他删除了生成的文件，因为它很快就填满了他的虚拟私人服务器的有限存储空间，还因为他不想被指控侵犯人们的隐私。

在[期间，关于最近的黑客新闻](https://news.ycombinator.com/item?id=14737322)的讨论。io 事件后，[一些人表示他们相信](https://news.ycombinator.com/item?id=14738143)大多数国家/地区顶级域名(ccTLDs)的注册管理机构的安全措施较弱，并且不如管理通用顶级域名的注册管理机构运行良好。

另一个问题是，ccTLD 注册管理机构受到的互联网名称与数字地址分配机构(ICANN)的监督较少，这可能是因为 ccTLD 通常由执行自己的政策和法规的政府直接控制。由于许多 ccTLD 注册管理机构是由政府授权的组织运营的，因此他们的资源和技术专长差异很大。

值得指出的是。近年来，io TLD 在开发群体中广受欢迎，它最终成为了与英属印度洋领地相对应的 ccTLD。也许将注册管理机构切换到 Afilias，AFI lias 在管理 TLD 方面经验丰富，会带来更多的稳定性和更好的安全实践，但是[有些人肯定对迁移的处理方式不满意](https://twitter.com/ziromr/status/884470863638212608)。

“想选择一个可爱的 TLD 像。io 对您的企业来说是个好主意吗？可能要再想一想，”[马修·普林斯](https://www.linkedin.com/in/mprince/)，CloudFlare 的首席执行官，[在推特](https://twitter.com/eastdakota/status/884499908937392128)上说。io 名称服务器劫持事件。在有人指出传统通用顶级域名的域名可用性非常有限后，他回答说:“我宁愿做 sprinkler.io，也不愿做 spreader . io。”

重要的是要明白拥有一个. com。net 或其他通用 TLD 域并不意味着 DNS 劫持得到缓解。安全漏洞可能发生在 DNS 信任链的不同点上，因为有许多方面对域名的 DNS 记录拥有权力:TLD 注册管理机构、域名提供商或注册商、域名所有者、域名所有者使用的任何第三方 DNS 管理服务等等。

“这是一个很好的例子，说明了 HTTPS 的重要性，以及像 HSTS 预加载这样的功能，这些功能可以确保一个网站在没有有效证书的情况下永远无法加载，”微软澳洲区域总监兼微软开发者安全最有价值专家(MVP)的[特洛伊·亨特](https://github.com/troyhunt)说。

HTTP 严格传输安全(HSTS)是一种服务器端安全策略，旨在防止协议降级攻击。它受到所有现代浏览器的推崇，网站可以用它来告诉客户在重复访问时总是通过加密连接(HTTPS)访问它们。

这意味着，在 DNS 劫持攻击的情况下，如果访问者的浏览器在以前的访问中记录了该网站的 HSTS 策略，那么试图通过普通 HTTP 将访问者引导到网站的假冒版本将会失败。要绕过这一点，攻击者还必须获得目标网站的合法 SSL/TLS 证书，以便他们可以设置启用 HTTPS 的克隆。这是很难实现的，因为它需要欺骗或侵入一个公共证书机构来给不是域所有者的人颁发证书。

还有其他针对 DNS 劫持的防御措施，如域锁和域名系统安全扩展(DNSSEC)，您可以在本文中了解更多关于它们和其他缓解方案[。](https://thenewstack.io/risks-dns-hijacking-serious-take-countermeasures/)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>