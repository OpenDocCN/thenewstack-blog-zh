# 是什么让亚马逊有了自己的微服务架构

> 原文：<https://thenewstack.io/led-amazon-microservices-architecture/>

新体系的真实故事一次又一次地讲述了具有巨大服务器需求的公司如何受到现有架构无法满足这些需求的限制，为自己解决问题，然后转身向世界其他地方转售他们的解决方案。我们很快忘记了最早的例子，但也许仍然是最好的例子，是亚马逊。

> “如果你回到 2001 年，”亚马逊 AWS 产品管理高级经理 Rob Brigham 说，“Amazon.com 零售网站是一个巨大的建筑单体。”

周三，在拉斯维加斯举行的亚马逊 re:Invent 2015 大会上，Brigham 在一个大多数人都参加的主舞台上发表了讲话。他附带的幻灯片显示了一个公认的“2001”巨石，这一次矗立在一个辉煌的华盛顿山湖旁边，可能在附近的某个地方。他对亚马逊的历史时机或他自己的聪明有点窃笑。

## 也是查拉图斯特拉

[![Amazon's Rob Brigham with the 'Amazon Monolith'](img/3d8b7a8a18ce6cb1eb88cf445912a840.png)](https://thenewstack.io/wp-content/uploads/2015/10/151007-Rob-Brigham-01.jpg)

“现在，不要误会我。它采用多层架构，这些层中有许多组件，”Brigham 继续说道。“但它们都非常紧密地结合在一起，就像一块巨大的石头。现在，很多创业公司，甚至大公司内部的项目，都是这样开始的。他们采取整体先行的方法，因为这样很快，可以快速行动。但是随着时间的推移，随着项目的成熟，随着你在上面增加更多的开发人员，随着它的增长，代码库变得更大，架构变得更复杂，这个庞然大物将会增加你的过程的开销，软件开发生命周期将会开始变慢。”

Brigham 提出了软件开发生命周期(SDLC)的主题，作为开发团队的结构——具体来说，作为一种物质，当处理像 Amazon.com 在 2001 年面临的单一应用程序时，使开发人员彼此分离，并使团队与其最终目标分离。他们解决这个问题的真正革命性的方法成为了原型之一([美国宇航局的星云项目是其他](http://readwrite.com/2011/07/21/from_a_basement_to_the_stars_how_the_openstack_clo)项目之一)，导致了云计算的诞生。

Brigham 还揭示了，最初的 Amazon.com 非常像柏油球一样的粘性激发了另一个革命性的概念:服务架构的解耦。也许亚马逊没有发明微服务，也许它不是敏捷方法论的先驱。但是进化并不总是首先发生在一个地方。有大量证据表明，亚马逊确实主动提出了这些概念。

Brigham 讲述了亚马逊工程小组的故事，该小组在 2000 年有一项令人羡慕的任务，即协调来自数百名开发人员的过程中的更改，解决他们之间的所有冲突，将他们合并成一个版本，并产生一个等待进入生产的主版本。“即使你有了那个很大、很大、很新的版本，”他说，“它仍然在这个交付管道上增加了很多开销。整个新的代码库需要重建。所有的测试用例都需要重新运行，以确保没有匆忙。然后，您需要获得整个应用程序，并将其全部部署到您的全部生产设备中。”

亚马逊的做法不是去掉管道，而是简化管道。该公司的持续部署工具——code deploy、CodePipeline 和 code commit——是围绕真正的云原生 web 应用程序构建的，在这些应用程序中，管道的各个部分可以编写脚本并实现自动化。Rob Brigham 说，从世纪之交开始，亚马逊在架构和后勤方面的变革直接导致了它现在向开发团队提供的工具。

亚马逊的 Brigham 回忆起上个月的 SpringOne 2GX 会议，Pivotal 工程师 Rohit Kelapure 在会上详细描述了整体架构的分解，他和他的同事们是如何将 Amazon.com 的整体架构“分解”成面向服务的架构的。

“我们仔细检查了代码，提取出服务于单一目的的功能单元，并用 web 服务接口将它们包装起来，”他说。例如，有一个服务在零售商的产品详细信息页面上呈现“购买”按钮。另一个具有在结账时计算正确税款的功能。

在创建的时候，这些单一用途的功能似乎很容易实现。但是想象一下成百上千的开发团队，其中一些在那时由几十个开发人员组成(而不是更舒适的不超过八人的“两个披萨”大小)，他们的足够简单、单一目的的功能必须一周又一周地合并在一起…后来，一个月又一个月，随着 SDLC 的结构变得越来越大，越来越庞大。

## 去耦流水线

单一用途函数问题的解决方案是创建一个规则，由开发人员遵守，即函数只能通过它们自己的 web 服务 API 与世界其他地方通信。“这使我们能够创建一个高度解耦的架构，”Brigham 说，“这些服务可以相互独立地迭代，而无需这些服务之间的任何协调，只要它们遵守标准的 web 服务接口。”

服务的分离使得最早的自动化部署系统之一得以创建，也是亚马逊今天向客户提供的大部分服务的原型——恰当地命名为“阿波罗”它有助于将管道模式引入亚马逊的文化，可能正是在这次会议上，Brigham 明智地应用了一些自由编辑，因为这个过程可能并不简单。

但他对此直言不讳:通过将管道视为具有大小和形状的图形，亚马逊的工程师可以更明确地了解他们需要对流程进行多大程度的改变。当然，它们可以自动化，但是为什么要自动化冗余呢？

![Amazon AWS senior manager Rob Brigham](img/0eaf6001a1971b64b0fed01ad7cb7929.png)

亚马逊 AWS 高级经理 Rob Brigham

“我们仍然注意到，代码变更从开发人员签入，到在客户可以使用它的生产环境中运行，需要很长时间，”他说。“作为一家数据驱动型公司，我们对此进行了研究。我们在许多团队中测量了代码变更通过部署生命周期所花费的时间。当我们把这些数据加起来，看看结果，看看平均花费的时间，我们真的很尴尬。这是周的订单。”

分解这些行为有助于工程师认识到管道中各部分的顺序和排列导致了“停滞时间”——即什么也没发生的间隔。他说，这尤其发生在部门之间的手动移交过程中，这种移交的个性化本应带来流程的完整性，但实际上却导致了效率低下、空间浪费和长长的队列。

> “对于像亚马逊这样以效率为荣的公司，对于一家在我们的履行中心使用机器人运送实物的公司，一家希望使用无人机将包裹送到你家门口的公司，你可以想象这是多么疯狂，”他说，“我们在软件交付过程中使用人类传递这些虚拟比特。”

Brigham 的演讲导致了 CodePipeline 在工作中的演示，其中包括部署管道中发生的事件的内联脚本，以及与 Amazon 和 GitHub 上的私有存储库的集成。亚马逊在这一点上小心翼翼地表明，它正在避免将开发商店锁定在亚马逊品牌的做事方式上，这与合作伙伴生态系统之外的一些人所声称的相反。

在这一点上，你可能会认为罗布·布里格姆(Rob Brigham)是在向唱诗班布道，或者他是在寻求亚马逊帮助创建这个行业而理应得到的一些迟到的赞美。事实是，亚马逊 2001 年的故事是他们 2015 年的故事，尽管这可能会让很多观众和观看直播的人感到尴尬。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>