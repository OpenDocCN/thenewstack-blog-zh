# 在 20 分钟内设置 CI/CD 管道的四个步骤

> 原文：<https://thenewstack.io/four-steps-to-set-up-a-ci-cd-pipeline-in-20-minutes/>

软件感觉需要速度。持续集成和持续部署保证了速度(和更好的质量)，但是仅仅安装管道是不够的。CI/CD 需要持续改进，以确保您从软件开发生命周期中获得最大收益。以下是我们采取的四个步骤，以确保我们的 CI/CD 渠道快速高效地运行。跟随来微调你的过程。

## 先学基础

 [达比·弗雷

达比是 Gitlab 的临时工程主管。他对所有与工程领导、DevOps 文化、创业公司和跑步相关的事情都充满热情。](https://www.linkedin.com/in/darbyfrey/) 

为了确保您从 CI/CD 渠道中获得最大收益，您首先必须了解许多活动部件。这是一个简单的步骤，但重要的是每个相关人员都要牢牢掌握这些术语。

这一切都始于一个管道，这是一个分成不同阶段的作业集合。代码更改通常被称为提交，而作业只是指运行者必须执行的指令。运行程序是单独执行每个作业的代理或服务器。得益于[微服务](https://microservices.io)和 Kubernetes 集群架构之美，跑步者可以根据需要加速或减速。还有阶段，指的是构建或部署等工作的不同流程。同一阶段的作业可以并行完成。

使用 [YAML](https://yaml.org) 文件配置 CI/CD 管道。您将需要设置管道的参数:执行什么以及当流程成功或失败时会发生什么。在多个领域具有依赖性的复杂项目(微服务就是一个很好的例子)将需要多项目管道。

最后，对于您正在处理的任何 CI/CD 管道，您都需要适应一些更宽泛的术语。版本控制跟踪随时间的变化，如果需要，可以很容易地切换回早期版本。审计追踪跟踪源代码变更。在这个上下文中，协作指的是整个团队访问代码以获得改进、建议和更新的难易程度。Lint 工具有助于确保 YAML 文件的有效性，并对新用户有所帮助。

## 让它自动驾驶

你已经知道 CI/CD 是一个非常不简单的过程的简单术语。事实上，大多数 CI/CD 管道至少有九个步骤，甚至更多。但是我们已经在 GitLab 证明了在 20 分钟内建立并运行[管道是可能的，我们的秘密成分是我们称之为 Auto DevOps 的东西。选择具有内置自动化功能的 CI/CD 解决方案可以简化一切。](https://about.gitlab.com/blog/2019/09/26/building-a-cicd-pipeline-in-20-mins/)

在这么短的时间内，我们将一个应用程序构建到一个容器中，检查它的漏洞、依赖性和许可证；将它部署到一个 Kubernetes 集群中，并设置主机名以及 DNS 和 TLS 认证(必要时会自动更新)。最后，对代码进行了性能测试。想在家试试这个吗？下面是你需要轻松连接到 Kubernetes 的代码:*kubectl git lab-bootstrap git lab-project-id*。结果是一个 URL，您可以跟随它查看 GitLab 项目中关于 Kubernetes 集群的更多信息。

但这也不是说在任何情况下都必须自动化。部署过程的每个组件的底层源代码都应该对您可用，这样您就可以决定哪些工作需要自动化。

## 停止等待构建

没有比这更烦人的了(而且浪费时间！)而不是坐在那里等待管道运行。但是有一个解决方案:自动缩放的跑步者。自动缩放为 CI/CD 管道带来了前所未有的灵活性和实时供应和需求。如果操作得当，它几乎可以消除流水线停机时间。

首先，你需要一个实例和一个运行程序[我们的是免费的](https://about.gitlab.com/blog/2019/08/21/making-builds-faster-autoscaling-runners/)，用 Go 编写，所以它可以在任何平台上运行，你可以在那里构建 Go 二进制文件，包括 Linux、OSX、Windows、FreeBSD 和 Docker。您需要配置跑步者，以便按需创建机器。一项工作完成后，跑步者可以等待下一项工作或被自动移除。也有可能在它们被关闭之前，说明你希望它们停留多长时间，即“空闲时间”。有了自动缩放的跑步者，什么都不会浪费。您的基础架构将达到“金凤花”状态——不多也不少，但正好满足您的需求。

自动缩放的运行器让开发人员专注于编写代码，并让运营专家从基础架构的担忧中解脱出来。这是一个容易实现的双赢。

## 简化流程

不幸的是，没有人足够幸运能够在真空中编写代码。因此，开发人员必须确保新代码不会践踏任何依赖的微服务，这意味着更多的测试。完成所有需要的测试的最有效的方法是建立一个跨项目的管道。

这是一个简单的过程，只需要在创建项目管道时触发跨项目管道。在 GitLab 中，可以只在 CI 配置文件中触发一个[作业。将“trigger”关键字添加到 YAML CI 文件(该文件概述了 CI/CD 阶段的顺序)将引发一个创建跨项目管道的桥接作业。可以在那些下游管道中设置参数，并定义要使用的分支。](https://about.gitlab.com/blog/2019/07/24/cross-project-pipeline/)

如果您担心是否能够跟踪所有顺序和并行作业以及下游管道的情况，管道图为所有移动部件提供了直观的指导。

不要让你的工具拖了你的后腿。加入 GitLab，观看我们的掌握 CI/CD 网络广播。[点击这里](https://about.gitlab.com/webcast/mastering-ci-cd/)观看。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>