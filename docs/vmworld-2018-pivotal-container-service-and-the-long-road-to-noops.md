# VMworld 2018: Pivotal 容器服务和通往 NoOps 的漫长道路

> 原文：<https://thenewstack.io/vmworld-2018-pivotal-container-service-and-the-long-road-to-noops/>

在 VMware 和 Pivotal 联合推出他们的 [Pivotal 容器服务](https://pivotal.io/platform/pivotal-container-service) (PKS)一年后，现在说组织已经“采用”它还为时过早。但企业正在调查商业 Kubernetes 平台是否足够强大，足以帮助他们将应用程序和服务从单片系统转移到分布式系统中，该平台可在谷歌云平台上使用，但也是 vSphere 和 IBM Cloud Private 的一部分。这次小组讨论是对这些公司所学知识的公开披露。

## 一听到声音

最初，PKS 承诺将持续滚动更新的 Kubernetes 核心自动交付到数据中心，以及[复杂的基础设施监控](https://thenewstack.io/vmware-pivotals-pks-distribution-marries-kubernetes-bosh/)，这将为网络和安全运营商提供大量的行为数据。

从那时起，至少对一些人来说，短语“ [Kubernetes 拨号音](https://thenewstack.io/vmworld-2018-whos-responsible-for-programmable-infrastructure/)”似乎已经成为一种狗哨，表明 IT 运营经理对其运营是不必要的，PKS 是某种完全托管的服务。事实上，VMware 确实[将 PKS 定位为托管服务平台](https://siliconangle.com/2018/06/28/vmware-updates-pivotal-container-service-latest-kubernetes-release/)。

去年 6 月，VMware 揭开了一个完全独立的 Kubernetes 平台的面纱，即 VMware Kubernetes Engine (VKE)，[它将](https://cloud.vmware.com/community/2018/06/26/pks-vke-consistent-kubernetes-experience-developers-operations-flexibility-control/)描述为“运行在 AWS 上的完全托管的基于 SaaS 的服务”因此，有一段时间，PKS 被描绘成运营商的福音，然后才出现了承诺解雇通知书。然后是 VKE，它提供了一些运营商担心 PKS(以及其他 PaaS 平台)不可避免会成为的无运营环境，将早期的产品重新定位在两个极端之间的某个位置。

[![](img/39d2ae13df78463051cbda835e157d4a.png)](https://cdn.thenewstack.io/media/2018/09/68a796c5-180829-vmworld-2018-day-3-05-paul-fazzone.jpg)“PKS 和 VKE 对我们的客户和他们的开发者都有一个共同的承诺。我们的客户是 IT 运营商，他们来这里是为了服务他们的开发团队，”VMware 高级副总裁兼云原生应用总经理保罗·法佐内在接受新堆栈采访时说道。

“这个承诺是什么，”Fazzone 继续说，“我们提供的 Kubernetes 拨号音是 100%的香草，无论你是在 PKS 内部运行它，还是在 VKE 作为 SaaS 服务的公共云环境中消费和运行它。就开发者互动而言，它们实际上是相同的。”

Fazzone 描绘的“拨号音”就像是对“公共运营商”存在的断言，这是为了有效消费服务和生产应用程序的开发人员的利益。早在电话使人联想到电路开关、电线和数不清的长线路的时候，拨号音是用户需要的唯一信号，表明服务已经打开，而且是正常的。拨号音并没有使接线员变得多余。恰恰相反:它提供了服务保证，保证成千上万的网络“线路工”(和女人)在做他们的工作。

这种类型的服务保证是 PKS 的早期采用者正在实现的吗？在拉斯维加斯 VMworld 2018 的第一天，该公司接待了一个由采用或积极评估 PKS 的公司的 IT 代表组成的小组。这是一次令人惊讶的坦率讨论，尽管您可以预期 VMware 不会选择那些不尊重 PKS 的客户，但他们的故事讲述了“第 2 天运营”的挑战，即将平台集成到他们的工作习惯和流程中，现在平台已经安装并完全投入运营。

### 当微分段既不微也不分段时

优先支付系统公司位于佐治亚州亚特兰大北郊的阿尔法雷塔。在过去三年的大部分时间里，它一直在构建一个集装箱化平台，直到最近才围绕 Hashicorp 的 Nomad scheduler 和 Consul service mesh 展开。但正如该公司云平台副总裁杰夫·利维(Jeff Levy)告诉观众的那样，该公司认为它需要“一个企业级的容器解决方案。”因此，它开始将已经完成的工作转移到直 Kubernetes，此外，转向集成其大数据平台功能的微服务架构。

[![](img/e3e189b01d497ea799be7d48dfb14813.png)](https://cdn.thenewstack.io/media/2018/09/e0f259c3-180827-vmworld-2018-day-1-12-pks-panel.jpg)

[从左至右:Paul Dul，产品副总裁。管理。，VMwareJeff Levy，云平台副总裁，优先支付系统；瑞士电信有限公司云实验室副总裁 Stephan MassaltNCB 牙买加有限公司高级系统管理员 Nesta Campbell

利维的团队一直在评估 PKS，将其作为公司的一个概念验证项目。因为他的开发人员已经在容器化微服务方面取得了进展，他们已经开始设计与 VXLAN 和 Weave 的容器网络。尽管 VMware 使用“普通香草”一词来描述 PKS 的 Kubernetes 实施，但它是为其自己的 NSX 网络虚拟化平台(特别是针对容器环境的 NSX-T 衍生框架)构建的交付机制。理论上，该系统可以继续使用“普通”的网络覆盖，尽管正如 Levy 承认的那样，尝试这样做存在问题。

“我们已经部署了微分段，”Levy 说，他指的是 VMware 将网络和安全策略应用于特定工作负载的体系结构。“我们在当前环境中面临的挑战之一是，因为我们无法在容器级别进行微分段，所以我们只能在虚拟机级别进行。因此，我们必须让这些要部署容器的虚拟机组拥有相似的网络策略。”

它从“微分段”中提取“微”，从“分布式系统”中提取“分布式”:根据适用于虚拟机的安全策略，有意识地将虚拟机用作容器的围栏。事实上，它消除了 Kubernetes 提供的全部好处，即把容器收集到豆荚里*，因为它们一起工作*。在会议上，首席执行官[帕特·基尔辛格](https://www.linkedin.com/in/patgelsinger/)正式宣布了他的公司的“微分段 2.0”计划，但没有许多人期待的细节:即，在容器或 pod 级别应用策略的选项，而不是虚拟机级别。

正是 Levy 告诉观众，架构师确实可以使用 NSX-T 将微分段策略应用于指定的名称空间。“这为我们提供了一个大型工作节点池的能力，”他说，“来部署我们的微服务，然后我们只需使用防火墙来划分容器工作负载。”

## 将名称空间绑定到人是不安全的

然而，对于瑞士主要电信公司 Swisscom AG 的云实验室项目来说，这可能还不够细分和隔离。[负责瑞士电信云实验室的副总裁 Stephan Massalt](https://www.linkedin.com/in/samassalt/) 告诉听众，他的公司提供云托管服务，特别是为该国的金融机构。

“根据这些客户目前的安全要求，”Massalt 说，“我们已经看到这种名称空间的分离是不够安全的，尽管市场上有一些解决方案声称他们可以做到这一点。你仍然会遇到很多问题，尤其是当你与 Kubernetes 和 Docker 合作时。”

Massalt 承认 VMworld 肯定不是一个开发者大会，他说，根据他的经验，开发者只要求对他们的应用程序进行合理的访问，但他们在为自己执行策略时很懒。因此，为了让运营商满足开发者的要求，以及他们所需要的众多安全策略，系统最终会以加密状态运行带有容器的开发者会话。由于加密通过 TLS 与开发人员的活动会话绑定在一起，因此整个节点都与开发人员绑定在一起。它不再是多租户节点；通过需要定制瑞士手工制作的精确度的策略，其他客户必须被重定向到其他节点。

想象一下一个用螺栓固定在 Kubernetes 节点上的飞机厕所的“已占用”标志，你就会知道 Massalt 的团队在做什么了。

他继续说道，作为服务提供商，Swisscom 需要在集群级别提供多租户服务。他建议，应该在这些集群中自由地创建名称空间，以便客户可以自由地隔离他们公司内的业务线(LOB ),而不必将每个 LOB 划分到单独的集群中。

Massalt 对观众进行了调查，询问他们中有多少人有更新 Kubernetes 集群的经验。在相当满的舞厅里，没有人举手。

“这是有原因的:因为这是一个痛苦的过程，”他说。这就是为什么 Swisscom 已经采用 BOSH 作为自动部署工具来替换旧版本和更新底层平台，从而处理大量的第二天操作。

## 对于开发商和运营商来说，PKS 是一个不同的世界吗？

我问 PPS 的 Levy 和 Swisscom 的 Massalt，当他们开始研究 PKS 作为他们组织的可行平台时，他们的开发团队是否必须做出任何可衡量的或有意义的战略转变。

Levy 告诉我，他的团队必须重新设计的支付处理模块就位于其中。NET 在前端，SQL Server 在后端。“你在谈论的是那个单片应用程序中的数万行代码，”他说。“所以对我们来说，非常敏捷地为应用程序添加新功能，甚至进行修补，是一项非常具有挑战性的工作……我们正在重构所有这些功能。NET 应用程序作为微服务运行。这一个应用程序现在可能有几百个单元，几百个微服务。”

没有开关投掷仪式；随着新体系结构的逐步引入，遗留环境继续运行。幸运的是，每个业务部门都参与其中，包括工程团队、平台团队和软件开发团队(注意，这些是独立的团队)。“它仍然拥有相同的核心功能，”他说。“我们推出了许多新功能，但也利用了各种分布式数据库系统，摆脱了 SQL[*Server*]固有的锁定和阻塞，以及消耗资源的长时间运行的查询，迁移到这些不再有这些功能的分布式数据库平台。应用本身的速度更快，响应能力更强，能够在一天中的任何时间部署微服务或容器，而不必等到晚上 10 点钟才部署修补程序。”

“在 PKS，你真的不再关心虚拟机了，因为波什会照顾它，”利维说。

Massalt 描述了架构师系统地将 Swisscom 的现有平台解构为微服务的努力，在这一过程中，小心翼翼地做到完全独立于供应商。他建议说，一旦在重新架构中消除了供应商两极分化这一因素，从大型机应用程序中为 Kubernetes 构建基于微服务的应用程序是完全可行的——也许不是在单个容器中，但仍然是在分布式环境中。

马萨尔说，但是重建可以集中在库贝内特斯，而不是特别在 PKS。“这实际上就是基于这些云原生原则运行微服务。PKS 只是让第 2 天的操作保持正常运行，这比我们迄今为止看到的其他解决方案要简单得多。”

Massalt 和 Levy 的经验都提到了早期尝试改进两种相对较新的技术，以更老和更可预测的方式工作——PPS 通过将共享安全策略的容器转储到相同的虚拟机中，Swisscom 通过加密容器会话，使托管容器的节点不能同时被其他任何人使用。在这两种情况下，*的新*技术带来了最大的挑战，因为它们与组织期望的工作方式不兼容。

与其说 VMware PKS 为这些困境提供了解决方案，不如说它并不干涉 Kubernetes 提供该解决方案。在某种程度上，这是更好的消息。

Pivotal 和 VMware 是新体系的赞助商。

斯科特·M·富尔顿三世。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>