# Matt Klein 谈特使的成功和服务网的未来

> 原文：<https://thenewstack.io/matt-klein-on-the-success-of-envoy-and-the-future-of-the-service-mesh/>

在上周的旧金山服务网日期间，我采访了马特·克莱恩，他是 T2 特使代理 T3 的创建者，也是拼车服务 T4 Lyft T5 的软件工程师。“我大大低估了对通用网格的需求，”克莱恩在会议的开幕主题演讲中说。

我第一次见到 Klein 是在 2017 年 1 月，在[微服务从业者峰会](https://www.microservices.com/summit/)上，他发表了关于 Envoy 的第一次公开演讲。他谈到了 Lyft 如何将其整体堆栈迁移到面向服务的架构(SOA ),并写道 Envoy to 作为一个快速的边站“通信总线”,处理诸如速率限制、负载平衡、电路中断、服务发现和主动/被动健康检查等事情。

今天，Envoy 参与了由云本地计算基金会(CNCF)资助的开源项目，是三个“毕业”进入全面生产准备状态的项目之一，另外两个是 Kubernetes 和 Prometheus。微软、易贝、谷歌、Airbnb 和亚马逊网络服务都在使用它。克莱恩本人是 CNCF 技术监督委员会的成员。

**[Varun tal war](https://www.linkedin.com/in/varuntalwar),[Tetrate](https://www.tetrate.io/)的创始人和 [Istio service mesh](https://istio.io/) (经常与 Envoy 一起使用)的共同创建者说，如果不是第一个收集服务数据而不是 IP 地址的产品，Envoy 是第一个，我没有意识到这一点。**

我认为这与它被采用的原因有很大关系。我的意思是，这是你所说的第一个完全基于云并且不依赖于硬件的通信总线……

我不会说 Envoy 是第 7 层或应用程序负载平衡的首选。实际上以前有很多案例，特别是从图书馆的角度来看。例如， [JRPC](https://github.com/dinstone/jrpc) 已经在做一些客户端负载平衡的事情，显然，Twitter 已经有了[欺骗](https://twitter.github.io/finagle/)，网飞有一整套围绕 [Hystrix](https://github.com/Netflix/Hystrix) 的技术。

![](img/8810b00d1519981c79d70e7d3aeab2a9.png)

Lyft 的马特·克莱恩。

这并不是说 Nginx 和 HAProxy 不能做一些第 7 层的负载平衡。他们当然可以。我认为特使的出现是出于我在演讲中提到的一些原因。我认为它变得非常流行有几个不同的原因，但我认为它允许人们收集应用层信息，进行路由负载平衡，并以一种以应用为中心的方式帮助检查，这种方式在以前是可能的。

我不会说这是一件容易的事情，但在正确的设置中，它可以用来从应用程序的角度提供真正强大的信息和功能。

**对。当我们听小组讨论的时候，我坐在红帽公司的红胡子旁边，他说，“我一直告诉人们这些。这就像不要开始使用它，直到它变得有用。”**

我完全同意，事实上，当人们总是问我关于服务网格和技术的问题时，我实际上和我总是建议人们的小组成员有完全相同的感觉:只考虑你需要的复杂性。从整体开始，从简单的数据库开始，从让你的产品工作所需的任何东西开始，只承担你需要的复杂性。

我认为我们倾向于将技术上的事情过于复杂化，我们也有一个很大的倾向——这是人类的本性——低估东西的成本，我不是指金钱成本，我是指时间成本。

人们不仅很难估计初始实现时间，还很难估计错误修复时间、维护时间和支持时间。它是巨大的。

他们应该在代码学校开一门这方面的课。

我同意。

因为在我将近 30 年的职业生涯中，从来没有人能够准确地估计实施需要多长时间。

即使是非常有经验的人或技术很强的人也不仅仅在时间估计方面做得很糟糕，在我所说的 TCO，即总拥有成本方面也是如此。这就是我要说的，不仅仅包括开发时间，还包括维护、支持、bug 修复等等。人家估计没那么好。

你能谈谈像《特使毕业》这样的 CNCF 开源项目的进展吗？

从 CNC 项目的角度来看，现在有三个阶段。有他们所谓的沙盒，然后孵化，然后毕业。

我会说，我认为从 TOC 的角度来看，我认为我们正在考虑细化一些在阶段之间移动的要求，但我认为在高层次上，沙盒是一个相互治理的地方，进入的要求非常低，基金会不会提供大量的信息，但它是一个项目可以轻松进入的地方，我们可以看到项目是否启动，有一个相互协作的地方。

我认为孵化背后的想法是一个沙盒项目，已经获得了一些牵引力，正在看到一些生产用途，但我要说的是，在非常高的水平上，孵化和毕业之间的巨大差异是，孵化项目仍有可能失败，对吗？比如它可能主要由一家风险投资公司支持，或者可能只有一个开发人员负责所有的编码和维护工作。

Tt 的开源软件，但我认为，如果发生什么事情，它可能无法长期持续下去。然而，我认为毕业背后的想法是，如果一个项目成为毕业，当然，事情可以过时，技术可以死亡，但不应该有任何人的理由为什么该项目应该停止运作。也就是说，如果一家公司倒闭，这个项目应该继续。如果一个主要开发者走了，它应该继续。

**在经历这些不同的阶段后，你学到了什么？我是说，过去的两年就像一阵旋风。**

是啊。老实说，特使成长得如此之快，以至于我真的没有太多考虑阶段，只是因为我们太忙了。我认为有时候项目真的很难成长。我想在很多方面我都遇到过相反的问题，增长如此之快以至于很难跟上。我现在已经说过多次了，但 2017 年，对我来说是艰难的一年。压力很大。项目正在爆炸，试图扩大我和其他维护者的规模，并让其他公司参与进来，显然在 2017 年，谷歌大规模上线。

2018 年，现在，我们有成吨的公司正在做出贡献，来自各地的积极维护者或贡献者，所以老实说，我只是去。我没有太多考虑在不同阶段之间转换。

**你能给我们分享一些人们用过的最有趣、最令人惊讶的用例吗？**

太多了。在过去的六个月里，我发现易贝在没有真正与我交谈的情况下，带着一个 10 人的团队离开了，基本上用 Envoy 替换了他们的整个边缘服务基础架构。他们构建了一些工具，基本上将他们的(我不知道是 F5 还是 Netscaler)配置转换为特使配置。实际上非常不可思议，这只是一个例子。我们现在看到大量的初创公司仅仅是在安全性和可观察性方面，以及所有类型的东西都是基于 Envoy 构建他们的产品。

正如我们在用户小组中所说的，Envoy 与服务网格相关联，但它不是特定于服务网格的。它是一个代理，所以人们把它用于 API 网关、中间内部代理或客户端负载平衡。到处都在用。

如果你真的看一下我们的 GitHub 页面，我们称之为云本地代理。我们并不称之为服务网格代理，对吧？它倾向于以这种方式使用，因为它是一个非常灵活的系统，它可以由 API 驱动和扩展，以及其他一些东西，但我个人不认为它与服务网格有联系。

**好的，太好了。因此，展望未来，今天晚些时候有一个小组将从用户的角度谈论服务网格的未来，但从你的角度来看，你认为 Envoy 将走向何方？**

我认为我们已经取得了如此惊人的增长，这太不可思议了。采用是令人难以置信的，我不敢相信我会这么说，但我认为我们正在走向特使，不一定是建立在上面的产品，但特使变得无处不在。

我实际上认为在五年内会发生什么，因为我认为许多人会与特使互动，但他们不知道他们正在与特使互动。他们可能会使用 Fargate 或 AKS 或 Google Cloud 功能或类似的功能，并且很可能会使用 Envoy 来提供一系列功能，人们会进行超时和重试以及服务发现等所有这些事情，但它们将被内置到平台和平台文档中。他们不会知道那是特使。

就像我在演讲中提到的，特使变成了一个普通的管道，人们可以用它做各种各样的事情，这就是我看到它的发展方向。我看到它变得无处不在，但实际上大多数人与它互动的方式隐藏了它。同样，在 5 到 10 年的时间框架内，我认为也不会有很多人与 Kubernetes 互动。它是管道，像时间表，计算。尽管我认为我们离…非常远，但我不喜欢“无服务器”这个术语我确实相信这个愿景，那就是最终人们想要运行他们的应用程序，想要与数据库对话，他们想要打网络电话。

如果我们可以给他们这些功能，而不必担心时间安排、管道、网络，当然，他们会使用这些功能，所以如果我看一下那个时间框架，Envoy 会被隐藏起来，就像 Kubernetes 被隐藏起来一样。我认为很多这些事情变成了较低层次的实现细节。

在标准方面有没有做一些工作来连接不同的服务网格系统？

据我所知目前没有。我知道 Istio 正在围绕他们的网格控制协议做一些事情。我认为有越来越多的人在谈论什么是我们的特使 API，或 XDS API？如果除了特使之外的东西开始使用它们意味着什么？

这实际上是现在提出来的，因为它在一次会谈中被提及，但 gRPC 有自己的内置负载平衡，并计划用 Envoy APIs 实际替换它，以便单个控制平面可以告诉 gRPC 客户端执行 X、Y 或 Z，然后 Envoy 可以执行 X、Y 或 Z。

但现在在这种情况下，不仅仅是 Envoy 在使用这些 API，所以我们可能需要比以前更严格地对待版本和弃用等问题。

**这是 CNCF 可以接受的吗？**

大概不会。我认为这是一个我们必须解决的项目问题，我认为实际上甚至有些人会问，“你会考虑为特使 API 做 IETF 吗？”

我不认为我们反对它，我认为它只是，再一次，即使在那种类型的工程中，我倾向于采取只承担你需要的复杂性的哲学，对吗？因此，如果人们不需要我们有 IETF 标准化，我宁愿不这样做。如果人们需要它，那么我们应该谈论它，因为如果有很多开销和这类东西。

我想有些人认为我的生活比实际上更有魅力和光彩，只是在维护或管理的意义上，对于你的文章，我现在使用引号，就像“管理”一个开源项目。这是混乱，因为它就像受控的无政府状态，对吗？

云计算原生计算基金会是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>