# 开源直方图:遥测监控的未来

> 原文：<https://thenewstack.io/open-source-histograms-the-future-of-telemetry-monitoring/>

延迟测量已经成为 IT 基础设施和应用程序监控的重要组成部分。各种事件的延迟，如请求、函数调用、垃圾收集、磁盘 IO、系统调用、CPU 调度等。—对操作和开发 IT 系统的工程师有很大的兴趣。然而，存在许多与管理和分析延迟数据相关的技术挑战。单个数据源发出的数据量很容易变得非常大。还必须从大量不同来源收集和汇总数据，并长时间存储，以便进行历史比较和长期服务质量评估(SLO)。

为了应对这些挑战，可以应用压缩方案，在存储和传输之前大幅减少数据的大小。直方图是最准确、最经济的压缩技术。

## **直方图数据**结构

 [西奥·施洛斯纳格勒

西奥于 2010 年创建了 Circonus，并继续担任其首席架构师。20 年来，他一直在设计、编码、构建和操作可扩展系统。作为一名连续创业者，他已经创建了四家公司，并帮助发展了无数的工程组织。西奥是*可扩展互联网架构(Sams)* 的作者，是*网络运营*(奥赖利)和*寻求 SRE* (奥赖利)的撰稿人，也是全球 IT 会议的常客。他是 IEEE 会员和 ACM 杰出会员。](https://www.linkedin.com/in/postwait/) 

直方图是一种数据结构，允许用户对一组样本的分布进行建模，例如地球上每个人的年龄。然而，不是将每个样本作为自己的记录存储，而是将它们分组放在桶或箱中。这允许显著的数据压缩，并且在经济上是优越的。这种数据压缩允许非凡的度量传输和摄取率、高频率、实时分析和经济的长期存储。直方图在处理由 Kubernetes 等容器技术产生的度量数据的广度和深度方面也特别有用。

在 [Circonus](https://www.circonus.com/?utm_content=inline-mention) ，我们对直方图及其对工程师和软件开发人员的价值充满热情，这也是我们向开源社区捐赠直方图技术 [OpenHistograms](https://openhistogram.io/) 的原因。

问题是[遥测和监控](https://thenewstack.io/monitoring-vs-observability-whats-the-difference/)行业没有直方图的单一标准，因此用户经常错误地利用直方图，这将产生代价高昂的后果。在本文中，我将分享为什么现在比以往任何时候都更需要直方图，以及为什么监控行业需要采用开源的单一标准直方图技术。

## **直方图:现在比以往任何时候都更需要**

当互联网很小，用户不能高速访问服务时，您可以更容易地存储和分析每个请求，并围绕足够准确和快速地服务所有请求设置标准。如今，越来越多的用户交互被生成、收集和分析。但更能改变游戏规则的是，组织现在有多层系统、服务和应用程序相互通信，产生了海量数据，远远超过了用户的能力。例如，如果您在一个系统上运行一个数据库，并且您希望您的磁盘以一定的速度执行操作，仅这一项活动就可以每秒生成一百万个数据点，最终几乎达到每天一千亿。

现在，无论从能力还是从经济角度来看，确保所有请求都得到足够快的服务都成为一个不切实际的目标。只是不值得追求完美。因此，工程师必须分析他们系统的行为，并从数量上确定什么是足够好的。如果你服务于网页或者 API 端点，你允许有多少个错误？您需要多快来满足请求？大多数人需要多快这个问题的问题是，你有两个变量:多快(以毫秒为单位)和多快(以百分比为单位)。

这是一个很难解决的统计问题。除此之外，组织要存储的数据要多得多。如果记录每一个事务都非常昂贵，并且对每一个事务的延迟进行数学分析也非常昂贵，那么工程师需要某种模型，使他们能够廉价地存储所有这些测量结果，并回答数量、速度的问题。直方图是所有这些的完美模型。

直方图可以收集、压缩和存储所有数据点(十亿！)并允许工程师以低成本和零开销的方式准确分析低于或高于特定速度的流量所占的百分比。至关重要的是，它们允许工程师在摄取数据后动态地改变这两个变量。因此，不要说“我需要 99%的请求得到快于 1 秒的服务”，你可以开始问，“当我有 98%的请求得到快于 5，500 毫秒的服务时，会是什么情况。”

如果没有直方图，你必须能够在开始之前明确地表达你的问题，而工程师无法事先做到具体而准确。直方图允许您存储无限的数据，并在事后回答更复杂的统计问题，这是当今以服务为中心的快速发布周期环境所需要的。

## **直方图必须开源**

在 Circonus，我们是开源的倡导者，并且相信大多数技术应该是开源的，因为它提供了用户可以成为其中的利益相关者的保证。然而，我们热衷于直方图技术开源的最重要原因是，用户绝对必须有一个关于直方图的行业标准，这意味着组织可以在他们的监控堆栈中使用单一直方图技术。

如果您在您的[监控和可观察性堆栈](https://thenewstack.io/monitoring-vs-observability-whats-the-difference/)中使用来自不同供应商的不同直方图来收集您的遥测数据，例如，来自您的云提供商的遥测数据和来自您的 APM 提供商的遥测数据，您不能合并直方图之间的数据，因为它们具有不同的宁滨或不同的技术。不幸的是，用户经常合并这些数据，从而给后续的数据分析带来严重的错误。这最终会伤害运营商和最终用户。

业界必须关注单一直方图模型的实现，因为它增加了服务之间的兼容性，并直接使最终用户受益。Circonus 的直方图实现， [Circhlist](https://openhistogram.io/wp-content/uploads/papers/openhistogram-research-paper.pdf) ，自 2011 年就已经进入行业。多年来，它已经过多次独立测试和评估，并一直被认为在平衡性能、准确性、正确性和可用性方面优于其他方法。为了培养和促进所有用户在供应商平台之间合并数据的可交换性和能力，我们最近在 Apache 2.0 许可下向开源社区发布了直方图技术 OpenHistograms。

Circonus 的 OpenHistograms 是供应商中立的对数线性直方图，用于遥测数据的压缩、合并和分析。OpenHistogram 的两个关键区别因素是，它的基数为 10，这简化了可用性，并且它不需要浮点运算，因此您可以在没有浮点单元的嵌入式系统上运行它。

OpenHistograms 允许用户在厂商平台之间无缝交换遥测数据，而不会引入错误。面临着消化和分析大量分布数据挑战的组织现在可以依赖于该数据的一致、可互换和稳定的表示，这是现在和未来监控的重要功能。

## **单个标准的时间**

IT 组织负责收集和分析的数据量逐年大幅增长。因此，用户越来越多地使用直方图技术来衡量服务质量。绝大多数是合并来自不同供应商直方图的遥测数据，输出虽然不明显，但却是错误的。组织不准确地断定他们达到或没有达到 SLO，并根据这些数据做出关键的运营决策，这可能会使他们每年损失数千美元。

每个工程师和应用程序开发人员都应该有信心，他们可以创建一个直方图，交给别人，并知道他们可以准确地使用它。通过采用供应商中立的行业标准直方图技术，用户拥有一个真实的来源，并可以放心他们的分析是准确的。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>