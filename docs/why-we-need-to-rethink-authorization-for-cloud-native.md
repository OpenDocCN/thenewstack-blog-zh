# 为什么我们需要重新思考云原生的授权

> 原文：<https://thenewstack.io/why-we-need-to-rethink-authorization-for-cloud-native/>

Styra 赞助了这篇文章。

 [蒂姆·辛里奇斯

Tim Hinrichs 是开放政策代理项目的联合创始人，也是 Styra 的首席技术官。在此之前，他共同创立了 OpenStack Congress 项目，并且是 VMware 的一名软件工程师。Tim 花了 18 年的时间为不同的领域开发声明性语言，例如云计算、软件定义的网络、配置管理、web 安全和访问控制。他于 2008 年获得斯坦福大学计算机科学博士学位。](https://www.linkedin.com/in/timhinrichs/) 

公司已经转向云原生软件开发，以便他们可以提高开发速度，改善产品个性化，并区分他们的买家体验，以便创新和赢得更多客户。在这样做的过程中，企业也从基础层面重新定义了他们如何构建和运行软件。例如，现代云原生应用程序现在可能由数十个微服务组成，这些微服务位于容器中，托管在不可变的动态扩展平台上，如 Kubernetes。

由于这些彻底的变化，公司实施基本应用程序要求(安全性、合规性和运营)的方式发生了巨大变化。基本要求基本保持不变:即使在云中，你也不希望在生产中运行从互联网上下载的随机二进制文件，让处理信用卡信息的应用程序与不处理信用卡信息的应用程序通信，或者让数据不加密或不受保护。同时，您仍然需要为应用程序 SLA 保持四个 9(99.99%)的可用性。

但是，与云时代之前相比，公司实际执行支持这些要求的策略的方式已经发生了巨大的变化。例如，在云中，如果您想要控制允许执行哪些操作，那么今天的决策取决于一系列上下文因素:哪个人或机器正在执行操作，该操作正在影响什么资源，该资源中会发布什么数据，该操作发生在一天中的什么时间或位置，该操作将对软件造成的负载，当前处于待命状态的 IT 人员，等等。出于这些原因，并考虑到云原生环境的普遍威力和复杂性，企业不得不彻底反思如何制定和执行这种基于策略的决策。

## **为什么云原生重塑了安全性和授权**

要了解授权(或管理“谁”(人)和“什么”(机器)在您的环境中可以做什么的策略)为何在云中发生了变化，关键是要了解构成云原生环境的基本构建块以及授权如何塑造和链接它们。一般来说，这三个组件是:

*   *   负责组装和部署代码块的 CI/CD 管道。
    *   像 Kubernetes 这样的平台负责运行这些代码。
    *   由这些代码块组成并在这些平台上运行的应用程序。

这些云原生组件中的每一个都必须处理授权，以解决广泛的安全性、合规性和操作问题，这些问题是每个开发团队的标准问题。但在容器化的云原生应用中，公司必须采用与云时代之前不同的授权方式。

## **应用级授权的新世界**

以应用程序级授权为例。在云中，许多应用程序已经转移到微服务架构，这意味着每个应用程序都由几十个或数百个单独的服务组成，每个服务都有自己的 API 集。这意味着安全团队不再依赖于单点授权，比如位于单一应用程序前面的网关或防火墙。相反，必须在所有不同的服务之间实施策略，以解决所有这些 API 造成的更大的攻击面。与此同时，应用程序现在也部署在任意数量的集群以及多个云中，这意味着 IT 团队也不能依赖单一的静态应用程序环境来实现安全性。此外，随着越来越多的人现在需要访问生产环境，包括开发人员、IT、安全、平台团队和支持工程师，围绕特权访问的规则不再能够在硬编码的 Active Directory 组或粗略的静态角色中进行管理。

和往常一样，必须在应用程序堆栈的每一层实施授权:微服务、网关、前端、数据库等等。即使是一个简单的政策，如阻止承包商访问客户 PII，也需要多个执行点。为了让应用程序本身允许正确的访问，显示正确的信息，并向承包商(例如)提供适当的 UI 体验，前端、后端和数据库都必须是策略感知的。

授权一直是应用程序的关键部分；事实上，团队通常将定制的自定义授权直接构建到应用程序中，或者作为各种应用程序必须与之交互的集中式系统来实现访问控制。云中的挑战在于，在微服务应用的所有组件中以一致的方式创建和实施授权策略变得更加困难。其中一个原因是，微服务(和策略)通常是用许多不同的编程语言编写的，这消除了使用单个共享库进行授权的可能性。将通用代码引入集中式授权服务是有问题的，因为网络跳跃/延迟会对应用的整体性能造成太大的损害。

与此同时，还有其他复杂的因素——例如团队通常希望选择“即插即用”的组件，以便他们可以在需要时通过更换新技术来创建最佳解决方案。这些新技术需要插入到应用程序正在使用的任何授权方案中，这意味着当开发团队用一项技术替换另一项技术时，授权可能会成为瓶颈——因为他们必须首先解决新技术的授权问题。

容器化应用的多样性和异构性意味着公司需要找到新的统一方法来管理生产中的这些应用。监控、日志记录、部署和授权都需要标准化，以便它们可以跨云、容器和代码工作。实际上，这已经成为真正享受云原生开发的好处的事实要求。事实上，在所有典型的横切关注点以统一的方式处理之前，应用程序组件在云本地意义上不能真正实现即插即用:授权、监控、日志、部署等等。

## **云原生平台的授权也发生了根本性的变化**

对于运行应用程序的云原生平台(如 Kubernetes)来说，授权故事是类似的。一般来说，公共云环境现在有数千个 API，公共云提供商已经意识到，传统的访问控制措施(例如 RBAC)远远不能提供真正实现可靠授权和保护它们所需的粒度级别。自然，公共云提供商*都*开发了自己的定制授权解决方案——每个都构建在(并致力于)自己的云环境中。

Kubernetes 是许多组织在生产中使用的平台，也有需要保护的 API。与公共云不同，Kubernetes 拥有自己的革命性模型，为所有集群资源提供统一的 API，用户和供应商可以通过 Kubernetes API 对其进行扩展，以本地管理客户构建和购买的软件。Kubernetes API 的授权必须在部署或更新之前检查每个资源的完整配置，无论该资源是由 Kubernetes 社区、最终用户还是第三方供应商开发的。与公共云的结果类似(但出于不同的原因)，Kubernetes API 需要一种比开发人员最熟悉的工具(如 RBAC、ABAC、ACL 甚至公共云开发的 IAM 策略)更细粒度、更具表现力的授权形式。[这里有一篇文章详细介绍了为什么 RBAC 对 Kubernetes 来说是不够的。](https://thenewstack.io/the-power-of-kubernetes-admission-control-why-role-based-access-control-isnt-enough/)

所有这些都表明，平台级别的授权也需要重新考虑，因为涉及的资源和数据量更大，复杂性更高。不仅仅是平台层面的授权必须统一，那么；但是，这些授权机制还必须能够考虑到现代平台的复杂性和功能，其粒度和表达能力在可用工具中是前所未有的。

## **CI/CD 的授权也发生了变化**

最后，还有 CI/CD 管道，它负责在云原生环境中构建、审查和部署代码。实际上，CI/CD 已经成为变更管理的云原生等价物，因为对生产环境(应用程序和平台)的每个代码变更都要经过它。此外，虽然应用程序代码更改通常会经历 CI/CD，但直到最近，随着基础架构即代码的出现，平台更改也经历了 CI/CD。这就是为什么 CI/CD 已经成为所有云原生开发流程的一个非常强大的控制点，并且是一个需要授权策略保护的重要工件。

今天，CI/CD 系统被公司许多领域的人员大量使用:操作员、开发人员、安全团队等等。事实上，应用程序甚至被构建为使得技术水平较低的员工能够为位于 CI/CD 管道后面的源代码库做出贡献。想要对安全性、合规性或运营策略进行例外处理吗？只需在正确的存储库中的正确的 YAML 文件中添加一行，就会出现异常。

同时，CI/CD 管道还实现了大量的自动化——不仅仅是运行单元测试或生成文件。事实上，自动化被用于构建许多版本的软件，便于部署前的手动批准，或者在一组服务器上部署软件——同时监控进度并在情况不佳时实现回滚。

由于这些原因，CI/CD 管道本质上与应用程序和平台一样强大；它们控制哪些代码在哪些应用程序上运行，以及哪些应用程序在哪些集群和平台上运行。因此，CI/CD 管道固有的复杂性、强大功能和庞大的用户群使其成为控制授权的关键领域。更重要的是，考虑到许多组织不只有一条管道，他们有很多。因此，公司需要跨 CI/CD 渠道实施统一授权*。例如，指定哪些上下文感知策略可以授予适当的随叫随到开发人员访问权限，这取决于时间或日期、他们在哪个集群中操作、他们从哪个代码存储库提取代码等等。此外，授权策略利用(并考虑)CI/CD 环境中固有的自动化级别是非常重要的。*

## **公司需要跨云原生堆栈的统一授权**

云原生开发的组件——CI/CD、平台和应用——并不存在于单个真空中。他们通过设计广泛互动。因此，真正管理应用程序行为、限制风险或维护合规性需要在它们之间建立统一的授权标准。事实上，在云中，您很难在平台上实施授权策略，除非您也在 CI/CD 管道中实施它们。例如，没有一个开发人员或工程师希望他们提出的基础设施即代码变更被 CI/CD 管道接受和部署，只是在部署到平台时被拒绝。相反，团队总是在寻找将授权和策略转移到左边的方法，在开发过程的早期，尽可能靠近试图做出改变的团队——转移到 CI/CD 管道，转移到开发人员的笔记本电脑，甚至转移到位于 Git 源代码库之上的应用程序。

与此同时，应用程序和平台之间的区别变得比以往更加模糊。当然，数据库是应用程序的一部分，但是现在每个云提供商都为你提供和运行数据库，这种区别变得模糊了。与此同时，Lambdas 或其他无服务器计算平台已经消除了你的源代码完全在你控制之下的想法。同样，这意味着应用程序的任何统一授权解决方案也必须适用于平台和 CI/CD 管道。不可避免地需要跨整个云原生体系进行统一授权。

## **开放策略代理(OPA)是为统一授权而设计的**

[OPA](https://www.openpolicyagent.org/)——一个开源的通用策略引擎——正是为了做到这一点而设计的:在云原生栈的每一层实现统一授权。OPA 最初由 Styra 开发，后来被捐赠给 CNCF，现已成为云本地策略的事实上的标准，允许公司在任何地方构建和实施一致的授权策略，无论环境如何。

虽然 OPA 只是开发人员可以随意使用的一种工具，但它是网飞、Capital One、高盛和 Atlassian 等领先企业用来解决其组织中的授权问题的一种工具。例如，网飞使用 OPA 来解决支持其流行的在线流媒体服务的数十个后端服务的服务级别授权。与此同时，Atlassian 使用 OPA 构建了一个全球授权平台，以集中管理和审计其服务套件的授权决策，如吉拉、特雷罗和 Confluence(以前，Atlassian 的许多服务都有自己的授权实施方式)。

实质上，OPA 为使用统一语言(减压阀)的策略提供了一种文件格式，这种文件格式足够灵活，可以跨应用程序、平台和 CI/CD 管道或任何其他地方处理您需要的所有策略(包括上下文感知策略)。然后，OPA 策略引擎可以根据策略语言做出决策，并且可以被注入任意上下文来做出动态决策。例如，OPA 策略可以为适当的随叫随到人员提供提升的访问权限，确保 CI/CD 管道中的基础架构代码更改符合平台的运营策略，或者确保应用程序决策不会给集群带来过度的负载。OPA 还提供了一个工具集，将策略带入了“代码时代”，使公司能够管理策略的整个生命周期，就像管理软件一样。

同样重要的是，OPA 旨在解决原生云的架构需求。具体来说，OPA 将策略从每个底层软件服务(包括应用程序、平台、CI/CD 或任何工具)中分离出来，以便公司可以使用相同的策略框架，而不管他们使用的是哪种软件。此外，OPA 在边缘运行，允许团队实现相同的可用性和性能，就像策略被硬编码到软件系统中一样。

随着公司采用云原生、软件定义的开发策略以前所未有的速度交付巨大价值，他们正面临解决云原生堆栈核心组件之间授权的挑战。对于许多公司来说，OPA 代表了一种在每个云环境中统一授权和策略的方式，以及将授权本身带入云原生时代的方式。

[https://www.youtube.com/embed/-_1wvU0v9UI?feature=oembed](https://www.youtube.com/embed/-_1wvU0v9UI?feature=oembed)

视频

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>