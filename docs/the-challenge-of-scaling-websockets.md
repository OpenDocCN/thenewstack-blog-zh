# 扩展 WebSockets 的挑战

> 原文：<https://thenewstack.io/the-challenge-of-scaling-websockets/>

[](https://ably.com/platform)

 [马修·奥莱登

马修·奥莱登是 Ably 的首席执行官和技术联合创始人，Ably 是一个实时同步数字体验的平台。Matthew 已经做了 20 多年的软件工程师，其中很多年都是担任 CTO。他第一次开始从事商业互联网项目是在 20 世纪 90 年代中期，当时 Internet Explorer 3 和 Netscape 还在争个你死我活。虽然他喜欢编程，但作为一名企业家，他面临的创业和扩大业务的挑战是他的动力。Matthew 之前创办并成功退出了两家科技公司。](https://ably.com/platform) [](https://ably.com/platform)

20 世纪 80 年代末，当蒂姆·伯纳斯·李在欧洲粒子物理研究所工作时，勾勒出超文本文档的第一个“网络”以便他可以更容易地获取、共享和交流时，甚至他都不太可能想到这会对我们所有人的生活产生影响。今天，我们认为我们的在线体验是理所当然的，但它需要很多伟大的想法和发展才能达到这一点。

蒂姆·伯纳斯·李最初的创造导致了 HTML、URI 和 HTTP 的建立，它们是互联网的三个最基本的组成部分。随着 90 年代的发展，HTTP 得到了发展和标准化，我们看到了 JavaScript 的诞生，它将脚本功能嵌入到浏览器中。

在 20 世纪末，我们看到 AJAX 加入了竞争，它突然允许更新网页的一部分，而不需要刷新整个页面。当我们进入 21 世纪时，AJAX 和 HTTP 一起奠定了实时互联网的基础，Comet 的开发也带来了重大进步，允许 web 服务器在有更新时将数据推送到浏览器。面临的挑战是，这些技术使新的“几乎”实时体验成为可能，但也带来了可扩展性、延迟和资源要求方面的挑战——在互联网增长加速的情况下，这不是一种可持续的模式。

2008 年，开发人员米迦勒·卡特和伊恩·希克森都经历了使用 Comet 实现类似实时解决方案的挑战和痛苦。因此，他们策划了一项计划，引入一种新的现代实时网络通信标准，该标准基于客户端和服务器之间通过单一连接进行的双向全双工通信。

“WebSocket 协议”于 2010 年首次被添加到谷歌 Chrome 浏览器中，不久后被添加到所有主流浏览器中，并由 RFC 6455 T1 标准化。我们进入了真正的实时互联网时代。

## WebSockets 让什么成为可能？

WebSockets 可以用于许多不同的目的，比如在后端服务(比如企业应用程序)之间传输数据，或者支持多向通信。我们可以将 WebSocket 用例大致分为两个不同的类别:

*   实时更新，在这种情况下，通信是单向的，服务器向客户端传输低延迟(并且通常是频繁的)更新。例如，实时体育更新、警报、实时仪表盘或位置跟踪。
*   双向通信，客户端和服务器都发送和接收消息。例子包括聊天、虚拟活动和虚拟教室(后两种通常涉及投票、测验和问答等功能)。WebSockets 还可以用于支持多用户同步协作功能，例如允许多人同时编辑同一个在线文档。

这些经历中有许多是我们在日常使用互联网时所期望和依赖的。这带来了新的挑战，例如如何处理大量访问服务的人和提供服务所需的大量数据。

## 规模的挑战

为了让 WebSockets 工作，为了让每个用户都能看到彼此，他们必须连接到同一个 WebSocket 服务器。这意味着您可以支持的活动用户的数量与您的服务器有多少硬件直接相关。现代 JavaScript 运行时环境非常擅长管理并发性，但是一旦用户达到几百到几千，就需要垂直扩展硬件以保持所有用户同步。

扩展既可以是纵向的，即尽可能获得最强大的硬件，也可以是横向的，一旦达到硬件所能达到的技术限制，从长远来看更好，但成本更高。两者都不是理想的解决方案。

但是为什么 WebSockets 很难扩展呢？主要的挑战是到 WebSocket 服务器的连接需要是持久的。即使您已经纵向和横向扩展了服务器节点，您也需要提供一个在节点之间共享数据的解决方案。任何状态都需要存储在进程外，以确保所有节点都有相同的状态视图。

除了必须使用额外的技术来共享状态之外，向所有订阅的客户端广播变得很困难，因为任何给定的 WebSocket 服务器节点只知道连接到它自己的客户端。有一些方法可以解决这个问题，比如在处理流量的集群节点之间使用某种形式的直接连接，或者使用外部的发布/订阅机制。这有时被称为给你的基础设施“添加一个底板”,但这最终成为另一个移动部件，使得扩展 WebSockets 变得困难。

## 向云迁移

解决整个服务器容量问题的一种方法是将流量转移到云中。无服务器 WebSockets 可以帮助组织建立、扩展和交付实时功能。企业可以拥有灵活的 WebSocket 功能，而不必管理或扩展 WebSocket 服务器，因为他们可以根据需要在其选择的云提供商上增加容量。

然而，许多开发人员选择基于服务器的方法，因为他们知道这是一种方法。此外，我们最近才看到像亚马逊网络服务这样的公司引入了无服务器网络套接字的方法，所以整个行业仍然需要教育。随着越来越多的服务依赖于流数据，以及对实时性的需求增长，我们可能会看到越来越多的云提供商引入无服务器 WebSocket 功能。

## 使您的实施获得成功

不可否认，WebSockets 是实时 web 的关键组件，但是组织必须仔细考虑它们的实现。您将为多少用户提供服务？你预计交通会突然拥挤吗？问自己这些问题，仔细想想自己需要什么；它将帮助您选择正确的道路，并确保您提供的数字体验符合标准。

是在自己的服务器上还是在云中托管这些服务是一个关键的决定，它会影响您有效地为不断增长的用户群提供服务的能力。但是即使是无服务器的实现也需要大量的开发时间，所以选择一种有效的方式来交付服务是明智的。

最终，使用 WebSockets 提供实时功能需要额外的架构和工程复杂性，尤其是在大规模使用时。与第三方专家合作可以帮助您构建和维护低延迟、可伸缩、容错的实时基础设施。这种方法正变得越来越有吸引力，允许开发团队专注于前端功能，而不是后台发生的事情。WebSockets 是一项伟大的技术，现在取决于组织以可扩展的方式最大化其潜力。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>