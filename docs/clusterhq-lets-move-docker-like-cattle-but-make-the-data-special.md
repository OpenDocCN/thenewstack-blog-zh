# 集群总部:让我们像牛一样移动码头工人，但让数据变得特殊

> 原文：<https://thenewstack.io/clusterhq-lets-move-docker-like-cattle-but-make-the-data-special/>

去年 8 月，一个新成立的名为 [ClusterHQ](https://clusterhq.com/) 的公司公开发布了一个全新的、不知名的开发工具，其版本号很少有其他公司敢在发布时使用:0.1。这是一个名为[弗洛克](https://thenewstack.io/flocker-a-nascent-docker-service-for-making-containers-portable-data-and-all/)的概念，命名的目的是希望它能与 Docker 更进一步的联系，而不仅仅是押韵。

起初，Flocker 的任务是解决大多数开发人员已经熟悉的应用程序模型和 Docker 在全世界托管的模型之间的差异。它将使用一种称为“应用程序清单”的东西来将共同构成应用程序的各种 Docker 容器图像连接在一起，目的是使它们共同具有可移植性。

可移植性是 Docker 一直声称可以解决的一个问题，但是它是在容器级别解决的，而不是在应用程序级别。Docker 的拥护者建议，如果我们将构建应用程序的模型更改为遵循无状态微服务原则的模型，那么唯一的问题在于我们对上下文的选择。如果我们不再认为应用程序是连续的汞齐，我们就可以按照 Docker 的形象构建一个更加和谐的世界。

这可能不是每个人都想要的。周三，ClusterHQ 正式宣布推出 Flocker 1.0。在这中间的一年里，它的使命发生了巨大的变化。其目的是在容器重新定位时，将持久数据卷移入容器中。

或者，换句话说，无状态容器到此为止。

## 国家地位在哪里？

“据我所知，集装箱数据管理不是一个行业术语。这是我们编造的一个词，”集群总部首席执行官马克·戴维斯在接受《新堆栈》采访时承认。“我们知道自己在解决什么问题，但我们基本上无法描述它。但我们真正要处理的是，您如何处理容器中的数据，以及如何在生产环境中有效地管理数据？”

也许到目前为止无状态服务最简单的定义来自 OpenStack，没有各种推断的社会、政治和经济含义。它说，一旦完成了与无状态服务的交互，服务就应该什么都不记得了。这似乎是一个足够简单的概念，直到您认识到企业中的大多数应用程序都生成某种形式或格式的文档。有些人理论上认为，如果您承认文档是在客户端生成的，那么在服务器端可能一切都是无状态的。

然后，当然还有数据库。使用无状态服务实现数据库管理的模型主要是一种心理模型。早在 2013 年 11 月，Docker CTO Solomon Hykes 在给开源开发者 Kris Buytaert 的个人博客的一封邮件中宣称，用 Docker 实现无状态服务的问题已经解决。

“容器引擎不仅仅用于无状态应用程序。“Docker 有持久数据卷的原语，”Hykes 写道。这些原语通常用于指定容器的持久部分，如数据库文件。卷继续独立于单个容器的生命周期而存在，并且可以跨容器共享或转移。”

嗯哼。就在几周前，The New Stack 发表了[运营 IaaS 提供商 ProfitBricks 的阿奇姆·维斯](https://thenewstack.io/the-docker-workaround-how-profitbricks-did-it/)的故事。Weiss 的服务提供持久的数据量，作为一种解决数据库关键的潜在问题的方法，不仅需要持久，而且用数据库开发人员的话说，需要持久。“Docker 本质上是短暂的，但应用程序，如数据库，经常需要数据在系统重启后保持不变，”Weiss 写道。"当然，让我们丢失状态，但是我不想丢失我的 PostgreSQL 数据."

显然这对某些人来说是个问题。

“房间里的大象是容器的设计方式，特别是 Docker 的设计方式，假设容器是无状态的，”ClusterHQ 的马克·戴维斯解释说。“所有的基础设施，一直到顶层，都假设一个容器随时可能死亡，它的任何状态都不重要，它可以从其他地方获得。”

Davis 认为，这迫使开发人员将他们的应用程序迁移到微服务架构中，只封装应用程序的一部分:无状态端。“当然，那太好了，”他说。“但数据是应用程序的中心，在过去一年半的时间里，我们接触过的客户都表示希望将他们的所有应用程序容器化，而不仅仅是无状态部分。”

如果你问 Docker Inc .，这真的不是一个大问题。如今，Docker 已经提供了数据卷，这种数据卷被放在单独的容器中，但是被移植到引用它们的容器的文件系统中。“如果你有一些持久数据，你想在容器之间共享，或者想从非持久容器中使用，”[阅读 Docker 的文档](https://docs.docker.com/userguide/dockervolumes/)，“最好创建一个命名的数据卷容器，然后从它挂载数据。”

## 第四和长

在去年 8 月他的公司正式成立期间向记者发表的一份声明中，戴维斯试图将该问题描述为 Docker 试图解决数据包含问题但失败了，而是将问题推给其他人解决。

“特别是，目前处理 PaaS 和容器的方法，”他写道，“是将数据管理的难题推给‘服务’，这要么最终将我们束缚在特定的云提供商身上，要么迫使数据服务以老式的方式正交于无状态应用层进行管理。”

在 Davis 最近与我们的讨论中，他试图将问题分解得更简单:习惯于虚拟机世界的客户期望高可用性、灵活的存储和无缝迁移数据的能力。人们期望容器数据管理，换句话说，因为他们期望数据管理。如果新环境不提供这些特征，它将被拒绝。

我让 Davis 想起了经常被引用的“宠物与牛”的类比，这表明适当的微服务管理环境对待容器更像对待牛而不是宠物。我说，人们可能期望新世界中的管理服务呈现类似于熟悉的旧世界中的行为和特征，但这可能不是这些人实际需要的。

鉴于这两个世界在架构上的显著差异，我问 Davis，Flocker 1.0 为客户提供旧世界期望的真正价值主张是什么？

“牛的类比绝对是世界想要去的地方，”戴维斯回应道。“这实际上与容器、虚拟机或任何其他技术无关。人们需要能够像对待牲畜而不是宠物一样对待他们的底层基础设施，无论是计算、网络还是其他任何东西。我们希望达到这样一种境界，即我们真的不在乎群体中的任何一个成员，无论任何一个成员发生了什么，我们的系统都会运行良好。

“我们今天在应用程序的无状态部分的容器中做得很好，”CEO 继续说道。“只要你看不到容器化无状态微服务的任何好处，那么你所说的就是关于架构的真实陈述。Docker 最初建造集装箱时的假设是，他们绝对都是牛，没有哪个集装箱是特别的。当人们想要将这些容器环境投入生产时，我们从 DevOps 团队那里听到的一件事是，“是的，这很好，但我仍然必须处理数据。”

> 无论我是否将其容器化，数据都将存在。这些数据是特殊的。我不能失去它；那是我的宠物。"

## 国务院

Davis 现在将 Flocker 1.0 描述为一个全新旅程的第一阶段，在这个世界中，事情看起来更像 Docker 理想中的赶牛场，而不是宠物店。与此同时，1.0 版将实现一种可移植性，即数据量可以随容器一起移动，而不是单独移动。他认为，这种增加的可移植性将使开发/测试环境更准确地再现生产环境的情况变得可行，在生产环境中，断开连接和重新安装过程不会也不应该每天发生。

他接着说，Docker 容器发展的下一步可能是实时迁移。他认为，除非应用程序的有状态和无状态方面能够有效地融合，否则实时迁移将是不可能的。

但是这样的合并会导致完美无状态架构的“圣杯”吗？在通往这种容器天堂的道路上，弗洛克是否仅仅代表了一种暂时的过渡状态？

“实际上没有无状态应用这种东西，”戴维斯最后说。“当人们说他们的应用程序是无状态的，他们在撒谎。每个 app 都有状态；问题是，我们把它放在哪里，我们如何与它互动？通过纯粹的 12 个因素，“我的应用程序是 100%无状态的，”你真的没有构建一个无状态的应用程序。你所做的是在有状态端和无状态端之间建立一个非常纯粹的墙，或者说 API。而你还是没有解决问题；你只是把它推开，说，‘我不打算处理它。’

“我认为有一个很好的理由来容器化和处理状态，”ClusterHQ 首席执行官继续说道，“而不是把问题推给其他人，让他们想出如何移动有状态的东西。无论任何人说什么——你、我或数据架构师——你都希望移动你的有状态服务。我可以向你保证。这只是现实生活。我们必须能够做到这一点。”

Docker 和 ProfitBricks 是新堆栈的赞助商。

特征图片:[润然](https://www.flickr.com/photos/runran/)的[脏手套公交车](https://www.flickr.com/photos/runran/3664614158/in/photolist-6zQ77J-7XNKA-7XNGv-3Jevn6-7XN1H-7XMp3-7XN4f-7XNoF-eLyCKa-7XNbn-7APuii-qTjfA5-5UUXZQ-7XPaC-7XNYS-7XP1g-h9bmH-7XLsn-7XMSN-7XNCt-7XNBq-yow4B-7XNza-7XLBP-7XNDR-7XMTz-7XNLR-7XN91-7XLWv-83oSK1-7XP6M-7XNHY-7XMLF-7XMjE-7XNsX-7XNzZ-7XNvf-7XNnH-7XMUU-7XMJN-7XMHT-7XMeg-7XLMC-7XLFK-7XP8J-7XP7K-7XP4P-7XNXX-7XNq7-7XNiP)的遮光罩在 [CC BY-SA 2.0](https://creativecommons.org/licenses/by-sa/2.0/) 下授权。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>