# 快速移动并在 Kubernetes 中测试，而不损坏任何东西

> 原文：<https://thenewstack.io/move-fast-and-test-in-kubernetes-without-breaking-things/>

迈克尔·凯德

迈克尔是卡斯滕公司的高级技术专家。他是一名技术思想领袖、社区拥护者和项目负责人，与社区密切合作。

应用程序开发中的持续集成和持续交付(CI/CD)是一种方法，它使开发人员能够快速可靠地进行代码更改，从而加快开发生命周期，并更快地将新应用程序推向市场。但是潜在的假设是开发人员可以在管道的不同阶段对数据进行测试。

这就是问题所在:从历史上看，恐惧和风险阻碍了开发团队将生产数据库集成到开发过程中。他们为什么害怕？有三个合理的理由:

*   **静态模式。**数据库传统上以雪花模式为特色，数据驻留在应用集群之外。性能和数据完整性是关键问题，雪花经常经历手动更改，这会导致风险增加。
*   **自动化差距。**对于许多数据库来说，自动化是缺乏的，因为它没有尽早构建到 CI/CD 管道中，并且测试可能会使用合成或陈旧的数据。
*   **筒仓心态**。即使 DevOps 的转变有助于开发人员和运营人员协同工作，数据库工程师在远离开发人员的孤岛中工作仍然很常见。

除此之外，数据损坏的风险也在增加。显然，在生产数据上进行测试并冒着破坏生产环境中数据的风险并不是一个好主意。那么，如何在没有风险的情况下将数据库引入您的云原生环境，从而提高您的敏捷性并加快开发呢？

## 一些入门的最佳实践

为了从将数据库放在云原生环境中所带来的灵活性中获益，您需要从与数据库所服务的应用程序代码紧密集成的源代码控制系统开始。您的应用程序存储库应该包括所有模式更改、升级工具和对源代码的修改。此外，您的数据库基础结构必须表示为同一应用程序存储库中的代码。

最后，自动化测试是关键。确保不仅将自动化构建到 CI/CD 管道中，而且尽可能早地构建。

## 为什么使用 Kubernetes？

虽然这些最佳实践适用于各种开发环境，但 Kubernetes 提供了许多关键优势，可以提高您的团队的敏捷性和性能:

*   良好的卫生习惯。最终，开发人员将不再在基础设施中使用雪花，事实上，将配置和基础设施表达为代码将使自动化和测试变得简单可靠。
*   **大规模试验。**在大规模测试环境中，开发人员可以处理数据库的单个副本，从而降低成本并提升性能。
*   **万能控制飞机。**从长远来看，为数据库服务提供一个控制平面，为应用程序的无状态组件提供一个单独的控制平面是没有意义的。在 Kubernetes 中结合这些可以提供更高的效率。

通过在开发生命周期的每个阶段进行自动化测试，将您的数据库引入您的云原生开发环境，可以更轻松、更快速地向最终客户交付更好的价值。更重要的是，它将导致更高程度的信心和更好的工程灵活性。更快的迭代过程将实现更好更快的部署，并能够在潜在问题影响您的生产环境之前捕捉它们。

## 成功的数据库集成的关键

为了达到数据库集成的理想状态，您必须针对堆栈中的不同层进行集成，包括存储、数据库和应用程序。

首先，为了提高效率，您可能需要使用卷级存储 API 来组合存储卷。这将使您的开发人员能够抓取快照并将其移动到他们的桌面上进行测试。其次，数据库集成对于一致的数据捕获和数据存储非常重要。您可能希望在 NoSQL 系统或关系数据库中创建挂钩，或者在拍摄卷级快照之前创建数据库。

在应用程序级别，您可能会在一个应用程序中使用多个同类最佳的数据服务，比如 Mongo 或 Redis。在基于微服务的应用程序中，这种多语言持久性需要应用程序级别的协调，就像数据屏蔽一样，以保护敏感数据。

从本质上讲，这些挑战与数据移动性有关。为了以一致的方式从各种来源提取数据，您需要应用程序上下文，特别是当您在将数据移动到测试/开发环境之前执行高级操作(如数据屏蔽和加密)时。

## 利用 Kanister 应对数据移动性挑战

当使用数据移动性来改善 CI/CD 管道时，考虑应用程序堆栈中不同层的数据非常重要。在许多情况下，您必须同时在应用程序的多个层上执行操作，并与 Kubernetes 本身进行交互。[由 Veeam 开发的 Kasten](https://www.kasten.io)开发了 Kanister 来应对这些数据移动性挑战，并使组织能够使用真实数据进行安全测试。

Kanister 是一个开源项目，为支持复杂数据管理工作流的应用级数据管理提供了一个 Kubernetes-native 框架。领域专家可以在 blueprints 中捕获特定于应用程序的数据管理任务，这些任务可以很容易地共享和扩展，消除了许多在 Kubernetes 上执行的繁琐细节。

Kanister 很容易与您的 CI/CD 管道集成，因为它使用称为自定义资源的 Kubernetes API 扩展。您可以轻松地扩展 Kanister，使其与定制应用程序以及几个常见的云原生数据库一起工作，从而简化测试操作，同时降低风险。

在 github.com/Kanisterio/kanister 的，kanister 是一个开源项目。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>