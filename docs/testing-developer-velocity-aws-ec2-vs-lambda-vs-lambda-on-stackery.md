# 测试开发速度:AWS EC2 vs Lambda vs Lambda on stack ery

> 原文：<https://thenewstack.io/testing-developer-velocity-aws-ec2-vs-lambda-vs-lambda-on-stackery/>

Stackery 赞助了这篇文章。

Lambdas 比传统的托管虚拟机(VM)如亚马逊的 EC2 提供更好的速度。但是到底多高的速度呢？我决定找出答案。

## 遇见你的赛车手

 [托比·费

Toby 是 Stackery 的社区开发人员。她的角色和经历结合了软件工程师、作家和技术讲师的工作，用新兴工具构建有趣的项目，并与世界分享她的发现。在加入 Stackery 之前，Toby 是 NWEA、瓦卡萨和新遗迹公司的工程师。](https://www.stackery.io/) 

我是一个聪明的开发人员:我已经做了几年的 web 应用程序和前端工作。我家里的机器运转良好。但我绝不是一个 Linux 呆子——我知道六个命令，当人们开始谈论*nix 的许多风格时，我的眼睛变得呆滞。

为了支持我，我有一个很棒的 Stackery 团队，他们所有人都可能更有资格，因为他们从事与 AWS 接口的产品。但我是他们的社区开发者，这意味着我希望能站在普通 web 开发者的角度。

我没有固定的规则，但一般来说，我会得到我需要的任何级别的帮助，除了让像[蔡斯·道格拉斯](https://twitter.com/txase)这样真正聪明的人在整个过程中坐在我旁边。正如我将多次提到的，这不是测量完成每一步所花费的原始时间，而是 web 开发人员计算菜单、配置和文档所花费的时间。

## EC2 服务: *5 小时 15 分钟*

我确信有 Linux 书呆子，或者 AWS 书呆子，他们可以在仅仅一个小时内运行 EC2 服务。但同样，这里的目标是测量 web 开发人员启动和运行这些服务所需的实际时间。我们来看看时间细分:

1.  创建并启动服务器: *1 小时 10 分钟。*
2.  挑选一个实例——我没有这个项目的预算，所以我花了一分钟来确定一个绝对免费的亚马逊机器映像(AMI)。我还需要一些时间来确保这个 Linux 版本不会离我习惯的拱门太远。
3.  添加存储— 8GB 似乎很多…对吗？
4.  配置安全组。该映像默认启用 SSH 访问，但是这默认抛出一个警告，如果我们真的想要服务 HTTP 请求，我们需要做一些配置。由于我的应用程序涉及敏感数据，我不能只设置 0.0.0.0/0 就让任何 IP 地址通过。
5.  启动—咖啡休息时间！这最后一步花了 10-12 分钟。重复几次后，部分原因可能是界面延迟，页面内的“刷新”并不像描述的那样工作…
6.  进入服务器: *1 小时 15 分钟。*
7.  设置我的本地密钥。花了这么长时间，我感到很尴尬。我以前从来没有这样设置过权限！但是我在一台新机器上，忘记了我必须 **chmod** 400 我的钥匙，当我试图使用它时，我得到的错误信息是……不清楚。
8.  实际登录。我一直使用默认的 **ssh -i** 命令，没有用户名，以 root 用户身份登录。这在 AWS 实例上显然是不允许的。
9.  安装节点: *15 分钟。*
10.  我开始尝试直接抓取节点。那对我不起作用，所以我需要获得节点版本管理器(NVM)并从那里安装。这似乎不是一个常见的问题，但我仍然建议从一开始就使用 NVM！

在这篇文章和其他文章中，我取笑虚拟机系统是快速建立 web 服务的糟糕工具。我第一个承认，一个专家在 EC2 实例上完成所有这些工作所需的时间不到我所花时间的一半。我只想提一下，在使用无服务器函数时，之前的所有步骤(实际编写一些 Javascript)都是零时间的。

11.  安装包: *1 小时 45 分钟。*

为什么花了这么长时间？交换空间。事实证明，试图在 nano 实例上运行 npm install 来获取几个基本包(包括 express)实际上会填满内存。令我惊讶的是，你不能在没有[清除实例存储](https://aws.amazon.com/premiumsupport/knowledge-center/resize-instance/)的情况下，仅仅拉动滑块来增加内存。通过一次只安装几个包，我设法达到了内存限制。我认为这种策略比在内存更大的实例上重新开始要快，但是？‍♀️.

12.  实际写点 Javascript: *15 分钟。*

我没有为我的 IDE 找一个合适的连接，而是直接复制/粘贴到 SSH 终端中。对于简短的服务器代码，我没有使用样板文件。但是我后来意识到我需要解除安全组配置中端口 3000 的阻塞，

13.  连接我的数据库: *30 分钟。*

对于这一点，我能够逐字使用 [AWS 指南](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Tutorials.WebServerDB.CreateVPC.html#CHAP_Tutorials.WebServerDB.CreateVPC.DBSubnetGroup)，但天哪，这仍然需要时间。我本以为会有一个简单的用户界面，因为这是一个如此普通的任务，但遗憾的是没有！

14.  回去连接我的 JavaScript 代码: *20 分钟。*

这部分没多久！我必须添加一些新的依赖项，配置连接，瞧。我真的不喜欢任何特殊的秘密配置，但是我不认为任何人可以访问这个实例。值得注意的是，这是 EC2 具有直接优势的一个领域:Lambda 代码隐藏得不那么安全，所以一个简单的实现(密钥/秘密就在源代码中)在 EC2 上更安全一点！

## 由 AWS 控制台配置的 lambda:*1 小时 16 分钟*

1.  创建 API 端点和 lambda: *35 分钟。*
2.  创建一个 API 端点。请记住，lambda 没有任何“在线”存在——没有 IP 地址，没有 URL——没有连接到它的 API 端点。这里唯一的问题是获得一个域名。
3.  创造一个λ:*1 分钟。*
4.  创建关系数据库服务(RDS)实例。没有一个选项提供任何真正的机会来做一些不可行的事情，所以我坚持使用默认设置，并很快设置好。
5.  连接并填充数据库: *40 分钟。*

连接到我的 RDS 实例只需要一点时间，但是之后，我写了一些 SQL，准备好了。为了走这条路，我不得不将 RDS 凭证硬编码到我的 lambda 中，这并不理想，但我不知道在我的 Lambda 代码中包含 auth 数据会有什么太大的安全风险，前提是该代码不在公共 repo 中。

6.  写代码: *10 分钟。即使是这个非常简单的例子，为 lambda 编写的代码也比 EC2 上的 express 服务少得多。*

## 由 Stackery 配置的 lambda:*14 分钟*

1.  创建所有资源并连接: *5 分钟。*
2.  所有的创建和配置都是从 Stackery 仪表板中的一个画布视图中处理的。
3.  这五分钟中的四分钟被用来等待三资源堆栈通过 CloudFormation 进行部署。
4.  写代码: *5 分钟。*
    由于我可以在自己的 IDE 中工作，并将更改从 GitHub 推送到我的堆栈中，这部分比其他路径要快一点。
5.  配置/填充数据库: *4 分钟。*

我在这里最大的挫折是，我想用可爱的 SAM CLI 进行本地开发，但 RDS 实例还不被支持(这似乎是一个很大的任务。)我不想浪费时间来设置本地 RDS 工具和连接 SAM CLI 本地映像。

6.因为 Stackery Lambdas 会自动获得访问 RDS 所需的所有参数和配置，所以我可以只做一次 lambda 来填充 DB。

## 这不是一场公平的战斗

我们试图衡量交付相同服务之间的差异，但有一个问题我们还没有解决:我们的 EC2 服务目前是一个黑箱。

我们的 Lambda 将产生非常详细的信息，包括它的执行时间、遇到了多少错误，以及它已经运行了多长时间。相比之下，EC2 只会从 OS 层自动报告:内存使用和正常运行时间。

从基本差异中更容易预测的是管理和动态加载。我们需要手动关闭 EC2 实例，或者在管理程序工具上投入更多时间。

这些都不是障碍:EC2 是一张空白的画布，我们完全可以添加观察和监控工具。我在 New Relic 的时候，随着我们交付越来越多的高级应用程序性能监控工具来检测应用程序代码的各个行，我们最畅销的工具一直是服务器监控，它不会告诉你比 Amazon CloudWatch 更多的关于 EC2 实例的信息。

关键是所有这些在 EC2 上都是可能的，但这是一场速度的竞赛，所以任何需要额外开发时间的东西都被忽略了。我只想说:这些特性已经内置到我们的 Lambda 堆栈中了。

## 结果呢

Lambdas 确实显著提高了开发人员的速度，Stackery 使这些任务更快。这些影响只会被更复杂的堆栈放大，这种比较忽略了在 EC2 实例上实现除关闭端口之外的任何安全措施。

如果你使用 Stackery，你能在 1/7 的时间内完成团队的任务吗？不。交付一个特性的大部分时间都花在了编码上，而编写实际的 JaveScript 所花时间的差异并没有显示出太多的变化。

## 下一步是什么？

我的下一篇文章将在生命周期的六个月后比较这三种设置:当我们的简单服务停止工作时，我们需要探索哪里出错了。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>