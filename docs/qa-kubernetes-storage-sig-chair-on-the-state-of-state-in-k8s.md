# 问答:Kubernetes 储物 SIG 椅关于 K8s 的状态

> 原文：<https://thenewstack.io/qa-kubernetes-storage-sig-chair-on-the-state-of-state-in-k8s/>

在 Kubernetes 中运行有状态工作负载有多困难？正如我们在 Kubernetes 谈论[开发人员体验时发现的那样，最大的挑战不一定是缺乏技术解决方案，而是从应用程序开发人员到集群管理员和传统存储管理员的每个相关人员的学习曲线。当然，仍然存在一些工具上的差距，生态系统还不成熟，还没有经过实战检验。](/reality-check-a-peek-at-the-developer-experience-with-kubernetes/)

我们与谷歌软件工程师兼云计算原生计算基金会 Kubernetes 存储特别兴趣小组主席 Saad Ali 就 Kubernetes 如何使运行有状态工作负载变得更容易、仍然存在的挑战以及未来的展望进行了交谈。

你能给我们介绍一下 Kubernetes 管理状态的背景吗？

**Ali:** 在较低的存储级别和较高的应用程序级别有很多创新，但在中间级别没有太多创新。您知道，随着工作负载的移动，使存储动态可用的问题还没有真正得到解决。

在 Kubernetes 出现之前，如果您在虚拟机上部署了工作负载，您必须创建一些卷，在您的存储阵列或云提供商中创建它们，确保它们连接到适合工作负载的虚拟机，并确保它是格式化的属性。您必须手动完成，或者使用您的 DevOps 团队提前编写的一些定制脚本。如果您需要将该工作负载转移到不同的虚拟机，这是一个非常手动的过程。

Kubernetes 简化了这一过程，引入了动态卷配置的概念，在这种情况下，您不需要提前配置卷，只需向您的存储系统提供 Kubernetes 凭据，让它自动进行配置。现在，容器存储接口(CSI)允许 Kubernetes 直接与任意存储系统交互。

**在 Kubernetes 中，与处理状态相关的主要挑战是什么？**

我认为对大多数人来说，理解整个生态系统是一个挑战。涉及到很多活动部件。您必须了解我的群集将可以使用什么存储，这能让用户满意吗？我如何将该存储与我的 Kubernetes 集群集成？我是否使用 CSI 驱动程序？有其他选择吗？我如何以对终端用户有意义的方式设置存储类？

我们关注作为应用程序开发人员的最终用户，让他们的生活变得轻松。但是，如果您是集群管理员，我认为在设置和运行一切方面仍然存在一些挑战。外面有 50 多个 CSI 司机，但他们都相当不成熟。存储供应商仍在试水，并试图弄清楚 CSI 驱动程序是否能够在集群扩展时处理它。这一切都朝着正确的方向发展，但还需要大量的教育。

我确实认为大多数原语已经存在，这将允许您在 Kubernetes 上成功运行绝大多数有状态工作负载。教育肯定有问题。我也认为有巨大的复杂性。如何将传统上在虚拟机上运行的应用程序移植到 Kubernetes 上呢？这是一项巨大的努力，令人望而生畏。

整个 Kubernetes 生态系统肯定还有改进的空间。Kubernetes 中软件定义的存储系统和本地存储支持的低级磁盘发现是可以变得更容易的领域。不过，一般来说，只要这些原语被容器化，它们就可以处理 Kubernetes 中绝大多数的有状态工作负载。

**在 Kubernetes 中，你看到人们处理有状态工作负载的最常见方式是什么？**

**阿里:**首先，存储有很多方面，我们一般会远离应用层存储，专注于块和文件。应用程序可以依赖于某种托管数据服务，这意味着您已经将这项工作卸载给了其他人，这不是您的问题—您只有一个 SDK。但是，如果人们想要运行自己的数据库或某种需要写入文件和块存储的有状态服务，我们会看到三种基本模式。它们是单写入程序块存储、多写入程序文件存储和某种真正快速的本地存储。如果您选择自己管理数据库并将其部署在 Kubernetes 上，那么您可以使用我们为 Kubernetes 中的块和文件存储接口提供的原语。

**Kubernetes 储物 SIG 目前正在开展哪些项目？**

**Ali** :我们的下一个前沿是让这种产品为企业和生产做好准备，并着眼于第二天和第三天的问题。我们正在关注数据保护，以及我们如何进行卷快照和卷备份。我们已经成立了一个专注于数据保护的新工作组，这是 Kubernetes 存储 SIG 和 Kubernetes 应用程序 SIG 之间的合作，因为当您开始谈论备份工作负载时，会有很多交集。不仅仅是存储，不仅仅是应用。

**Kubernetes 中有状态工作负载的未来会是什么样子？**

Ali: 我对我们将作为 Kubernetes 1.18 的一部分发布的一些大型项目感到非常兴奋。我们一直致力于增加对 Windows 的支持，Windows CSI 将在下一个版本中发布。Raw Block Volumes 是另一个项目，在工作了多年之后，它最终将正式推出。Kubernetes 上运行的绝大多数工作负载将存储用作文件系统，最终作为容器内的某种挂载目录。但是有些人更喜欢访问原始磁盘，而原始数据块卷使这成为可能。

我们也在寻找更好的接口用于 CSI 卷运行状况检查。在这一点上，一旦 Kubernetes 为工作负载提供了一个卷，就相当于放手了，并且您没有太多的信息。我们正在构建一些机制，允许存储系统不断地向 Kubernetes 显示卷的健康信息。最初，它只是为了提醒用户，但最终，我们希望 Kubernetes 能够以编程方式响应存储系统出现的事件，或者最终用户可以编写自己的工具来响应信息。

*为清晰起见，我们对答案进行了编辑和压缩。*

云计算原生计算基金会是新堆栈的赞助商。

由 [Jen Theodore](https://unsplash.com/@jentheodore?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/s/photos/ship-building?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的特写图片。

<svg viewBox="0 0 68 31" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Group</title> <desc>Created with Sketch.</desc></svg>