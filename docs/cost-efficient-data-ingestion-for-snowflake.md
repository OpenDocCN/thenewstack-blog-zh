# 面向雪花的经济高效的数据摄取

> 原文：<https://thenewstack.io/cost-efficient-data-ingestion-for-snowflake/>

[](https://www.linkedin.com/in/markv27/)

 [马克·范·德·维尔

马克·范·德·维尔是数据复制公司 HVR 的首席技术官。他在数据复制以及实时商业智能和分析方面有着深厚的背景，在 HVR 任职。最近，在 Actian Corporation，Mark 领导了一个高绩效解决方案架构师团队。在此之前，Mark 开发了 Oracle golden gate 复制产品的扩展。在他超过 15 年的职业生涯中，Mark 将他的职责从顾问扩展到了产品管理和业务开发。Mark 拥有埃因霍温理工大学的工业工程和管理科学硕士学位。](https://www.linkedin.com/in/markv27/) [](https://www.linkedin.com/in/markv27/)

[雪花](https://www.snowflake.com/?utm_content=inline-mention)是专为云打造的数据平台。它使用基于消费的定价方案提供了完全无限的可扩展性。你运营雪花的成本和它的使用量成正比。从根本上说，这不应该是一个问题，因为雪花的高超的分析能力可能会为您的投资带来积极的回报。

但是你能提高利润吗？有什么方法可以在不影响结果的情况下限制支出？

这篇文章关注的是数据摄取。更具体地说，这篇文章关注于将高价值的事务性关系数据复制到雪花中。示例包括行业无关的应用程序，如 ERP、CRM 和 SCM 系统，行业特定的应用程序，如 EPIC Clarity，以及自主开发的关系数据库应用程序。使用数据复制，在初始加载之后，您可以在源上使用变更数据捕获(CDC)来保持雪花中数据的副本是最新的。

数据复制支持对雪花中的源数据进行近乎实时的访问。我们在 HVR[发现](https://www.hvr-software.com/about-us/)和雪花的其他操作一样，你需要付费使用。

## 基于雪花消费的定价

在其核心，三个组件组成了[雪花数据云](https://www.snowflake.com/wp-content/uploads/2019/06/Snowflake_SIGMOD.pdf):

1.  储存；储备
2.  虚拟仓库形式的计算
3.  云服务，被称为“大脑”，使这一切工作

这些核心架构组件使雪花成为一个可靠的和可扩展的数据存储和处理服务。

三个核心架构组件也是雪花基于消费定价的基础:

1.  客户为使用雪花的存储付费。默认情况下，雪花在数据上提供时间旅行和故障安全功能。随着数据的变化，雪花在可配置的时间内保留数据的先前版本。数据总是被压缩的。
2.  使用虚拟仓库处理数据。t 恤大小的虚拟仓库决定了支付率，虚拟仓库在不使用时会自动停止运转。运行查询和 DML(插入、更新、删除)语句都需要计算资源。
3.  每天，云服务费用高达计算消耗使用的 10%。除此之外，云服务是收费的，并且在 metering_daily_history 视图中可见。

除了这三个核心组件之外，雪花还引入了许多无服务器特性，这些特性针对短时间的资源消耗进行了优化。无服务器特性的例子有自动表聚集和流数据能力 Snowpipe。无服务器功能按秒收费。

客户购买积分来支付计算和云服务费用，以及使用无服务器功能。每个积分的成本因所需的服务级别而异。存储成本是云提供商对其可扩展块存储(AWS S3、Azure Data Lake Store (ADLS)、谷歌云存储(GCS))中相同存储使用的简单交叉收费。

## 将数据复制到雪花中—基础知识

雪花的设计考虑到了分析工作负载。以每秒数千笔的速度处理在线交易从来都不是我们的目标。然而，对于任何组织来说，典型的雪花实施都是将来自多个高容量事务系统的数据整合在一起。需要将这些数据流式传输(仅插入)或微批处理(插入、更新和删除)到雪花中，以跟上总的更改量。

考虑源数据的事务表示在分析环境中的重要性。您需要满足所有数据源数据完整性规则的事务一致的数据视图，还是(暂时)不一致的视图是可接受的？例如，您的 ERP 系统可能在不同的表中跟踪装运和库存。您的分析系统是否要求发货和库存基于 ERP 系统的一致状态而保持一致？

## 经济高效的数据接收

延迟是数据复制的一个关键指标。您如何满足延迟方面的业务需求，同时限制雪花成本？

由于费用与处理量成比例，因此您必须平衡接收频率/速率与延迟要求:

*   更频繁地对现有数据应用更改会导致在不同的时间点产生多个较旧的数据副本，以支持雪花的时间旅行和故障保护功能。你能在特定的时间窗口(如晚上或周末)调整(降低)摄入率吗？
*   频繁的 DML 作为(接近)实时复制的结果，相对于不太频繁的(微)批处理，更多地使用云服务。根据每日总计算消耗，连续复制可能会导致单独的云服务费用。
*   雪花使用读提交隔离模型。一条语句只看到在该语句开始之前提交的数据，或者同一事务中以前完成的语句所做的更改。利用雪花的事务模型来确保所需的一致性，并允许在出现故障时进行恢复。为此，数据集成工具将利用事务。

您用于应用增量变更的工具/技术也会影响费用:

*   高效的 SQL 降低了对计算资源的需求。效率可能是智能数据过滤器的结果，但也利用了单个 merge 语句而不是多个单独的 insert、update 和 delete 语句。
*   对任何数据暂存使用瞬态对象，以避免时间旅行和故障安全的不必要费用。

## 结论

云服务使用按需购买模式为强大的技术提供可扩展性，由供应商提供管理。雪花的数据云也不例外。

你还能(在一定程度上)控制你支付的费用吗？事实证明，在数据摄取方面确实如此。这篇文章讨论了一些策略和技术选择标准，您可以部署这些策略和技术来将高价值的复制关系数据库数据调整为雪花型数据。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>