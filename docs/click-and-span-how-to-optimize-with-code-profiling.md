# 点击和 Span:如何使用代码分析进行优化

> 原文：<https://thenewstack.io/click-and-span-how-to-optimize-with-code-profiling/>

鉴于现代应用程序的规模、复杂性和需求，您的应用程序中的任何延迟都可能意味着用户采用率的提高和保留率的下降。尽管我们通过测试来优化和修复 bug 以防止这种情况，但是某些问题只会在生产中出现，这就是快速找到根本原因的重要性所在。优化调查中的一个重要工具是代码分析，它将增加运行时的可见性，节省用户的时间，同时节省环境中的宝贵资源。

## 现在它实际上做什么？

对于代码剖析，就像可观察性监控中的许多元素一样，上下文是关键。你需要一个工具来提取轨迹、跨度和代码，并将它们关联在一起。

对于我们今天的使用，我们将重点关注使用 OpenTelemetry 来收集数据，特别是将调用堆栈与应用程序的其余指标相关联。调用堆栈跟踪用其余的可观察性数据进行了扩充，例如来自特定用户会话的跨度，从而允许您全面了解后端代码对用户的影响，反之亦然。

这种对后端代码和用户体验之间关系的更好理解，将会在应用程序不断发展的过程中，突出代码中的哪些元素需要重点优化。

## 什么是调用栈？

 [斯科特·梅森

Scott 来自芝加哥，是 Splunk 的一名观察实践者。作为一名销售工程师，Scott 在开发人员和安全视角下领导了大型企业的云转型对话。在销售人员的要求下，对客户需求的同情已经成为 Scott 职业生涯中的一个焦点。斯科特是科技行业代表性的积极支持者，他用自己独特的视角，用更好的技术和人情味来推动行业发展。](https://www.linkedin.com/in/scott-mason-a0368a49/) 

代码分析的核心是为您的应用程序获取运行时快照的能力，通常称为调用堆栈**。**调用堆栈揭示了应用程序中特定函数的运行时间。从只查看“应用程序 A 正在运行”，到查看用户旅程如何调用到达后端基础设施的特定函数，代码剖析使开发人员能够知道他们的代码在其可观察性监控中的重要位置。

尽管深入到单个会话非常强大，但最好的代码分析工作是与您的标记和其他聚合方法结合起来完成的，现在可以在大量不同的跨度和调用堆栈中了解用户和会话的类型。

能够确定应用程序的不同用户使用什么样的代码路径，并了解他们的性能差异，这是代码剖析与应用程序性能监控(APM)集成的一个主要优势。).这通常是通过标记属于特定客户或客户类型的跨度，然后聚合这些跨度，按这些标记排序，以获得对性能的洞察。

查看通话记录的可读格式各不相同，但一种常见的方法是将其显示为火焰图。

查看每个特定功能相对于应用程序其余部分所用的时间，可以轻松识别哪些功能使用了过多的 CPU 或内存，并针对应用程序面临的所有客户旅程进行优化。

## 这对我意味着什么？

代码分析工具可以让您深入了解应用程序的 CPU 和内存使用情况，并根据用户任务进行细分。提高这些资源的利用率可以显著改善应用程序的整体速度、延迟和用户体验，同时使您可能不再需要大型实例来保持应用程序平稳运行。

随着硬件可用性的不断提高，再加上应用程序的可伸缩性，应用程序面临的许多问题可以而且很可能会在生产中通过“投入”更多的硬件来解决。尽管这样做的好处是不必担心月底的云提供商账单，但它也是以用户体验变慢为代价的。浪费的资产越多，用于附加功能的资源就越少；终端用户等待的时间越长，就意味着接触内容的时间越少。如果没有简化的概要分析，您将会看到资产负债表两边的成本。

有了工具包中的代码剖析，提高的效率可以降低成本，为您的最终用户提供更快的体验，并让您的工程师有更多时间开发新功能。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>