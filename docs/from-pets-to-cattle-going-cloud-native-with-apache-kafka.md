# 从宠物到牛:使用 Apache Kafka 实现云原生

> 原文：<https://thenewstack.io/from-pets-to-cattle-going-cloud-native-with-apache-kafka/>

新冠肺炎·疫情加速了 IT 行业已经开始的变革。它强调了在服务客户时对低延迟和速度的需求，并强调了新兴最佳实践的重要性。

在过去一年半的时间里幸存下来甚至蓬勃发展的组织提高了盈利速度，满足了及时更新和强大性能的需求。无论是什么行业，对实时用户体验的期望都不会改变。

有一点是不可否认的:高度分散的业务需要高度分散的运营。 [Apache Kafka](https://kafka.apache.org/) 是一个开源平台，用于持续、分布式的活动流媒体，被 Airbnb、[高盛](https://www.goldmansachs.com/)、[网飞](https://www.netflix.com/)、 [PayPal](https://www.paypal.com/) 、 [Spotify](https://www.spotify.com/) 和[优步](https://www.uber.com/)等公司使用。当 Kafka 在云中被正确利用时，它就成了发行版的驱动力。

“卡夫卡本身确实是这种新型快速、低延迟架构的核心元素。”全球市场分析师 [IDC](https://www.idc.com/) 智能过程自动化研究项目副总裁 Maureen Fleming 说。她告诉 New Stack[疫情业务弹性](https://thenewstack.io/how-covid-19-stresses-the-resiliency-of-both-systems-and-people/)是基于[事件驱动架构](https://thenewstack.io/gwen-shapira-on-the-power-of-event-driven-architecture/)的，该架构认为软件设计和数据是围绕用户旅程组织的。很有可能，当你看到分布式系统实时更新时，“卡夫卡会在那里跟踪这一切。”

但是，尽管 Kafka 确实为 70%的财富 500 强公司提供高性能数据管道、流分析、数据集成和任务关键型应用程序，但它通常不会顺利过渡到原生云。

将已经分布式的 Kafka 迁移到更加分布式的云——或者更有可能是多样化的多云和混合云——会耗费大量的时间和金钱。然而，利用像 [融合云](https://www.confluent.io/confluent-cloud/)这样的托管云服务，可以帮助你的卡夫卡从一只高维护成本的宠物变成可替换的牛。

## 当卡夫卡变成讨厌的宠物时

[融合云产品负责人丹·罗萨诺瓦](https://www.linkedin.com/in/danrosanova/)将卡夫卡的能力比喻为将数据移动到网状或网络中，以连接通常锁在筒仓、数据库或存储中的数据。

卡夫卡是 2011 年由杰伊·克雷普斯(T5)、内哈·纳克希德(T8)和饶俊(T10)创建的，他们当时是 LinkedIn 的工程师。创始人们看到各行各业的公司都需要像卡夫卡这样的系统。但是对于大多数组织来说，用开源组件构建数据基础设施并不是他们的重点，而且会分散他们的核心业务。因此，三人在 2014 年成立了 Confluent 来弥合这一差距。6 月，Confluent 启动了首次公开募股，帮助其市值增加到 115 亿美元。

弗莱明将 Kafka 描述为第一个将来自微服务和系统的高度分散的数据聚集到一个集中的地方的系统，在那里将数据分类、存储并作为“主题”发布，然后可以传播到任何地方。它在内部运行良好。

但是，当团队希望将大部分或所有这些主题迁移到云中时，Kafka 必须针对其部署到的每个环境进行定制和重新平台化。它成为决策开发团队关注的主要问题。甚至高管们也在权衡每项资产的位置，在哪个云或数据中心。

“项目被推迟是因为最重要的决定是你将把你的软件或资产放在哪里，”弗莱明说。“突然之间，将 Kafka 迁移到云架构意味着所有让你想变得灵活并想使用它的东西都消失了。”

Rosanova 说，挑战在于 Kafka 是一个分布式系统，它不会自动转化为云。他说，分布式系统就像养了一群宠物:“你必须喂养它们，照顾它们，跟在它们后面打扫卫生，所以你要控制环境，让这变得更容易。在云中，环境总是在变化——机器故障、网络变化、实例重启——所以你必须改变你的假设。”

当迁移到云时，组织通常会对投资回报延迟感到惊讶。本地数据中心一直是你的宠物，而云更像是你的牛，但这真的需要努力。

在云中运行 Kafka 最初的痛苦包括:

*   网络挑战。在您自己的数据中心，网络策略不会真正改变，但在云中，这一切都是虚拟的，可以非常快速地改变。Rosanova 说，因此，组织中的不同团队可以做出不同的选择。
*   安全挑战。把任何东西都搬到云上，尤其是 Kafka，意味着你不仅要保护机器之间的对话，还要保护你和机器之间的对话。做出和配置这些决定成为另一个时间吸盘。
*   惊喜成本。从内部部署到云的初始迁移实际上成本更高。过度调配或需要比您最初想象的更快的磁盘是很常见的，尤其是当您遇到无序蔓延时。根据 Rosanova 的说法，“这是一个庞大的云项目，然后你会比预期燃烧更多的钱”来寻找合适的规模。

而且不仅仅是一次性的搬家费用。他说，“如果你必须是多云，你又遇到了同样的障碍。每个云提供商都提供类似的功能，但有细微的差异，您的团队必须发现并解决。”

如今，越来越多的组织在多种云上运行，尤其是在频繁进行并购的行业。Rosanova 说，云迁移并不总是第一步，因为这会让一个已经很大的并购项目变得更大。

## 把云原生卡夫卡变成牛

从 Kubernetes 到云再到数据管理，有一个明确的趋势，那就是尽可能地获得更高的堆栈，减少管理，将更多的时间用于增加业务价值和削减成本。

Rosanova 说:“最高级别的抽象是最接近你可以在云中使用的简单按钮的方式。

他说，如果你自己用卡夫卡来运行 Kubernetes，你将需要几个月的时间来适应任何新的环境。但是，如果你使用 SaaS 或无服务器来管理和监控 Kafka，这将需要几天的时间。这极大地减少了你实现价值的时间。

Rosanova 说:“当你在云中处于有利位置时，你可以非常快速地旋转资源——你在抽象堆栈中的位置越高，你就可以更容易地做到这一点。”"或者，如果你正在使用 SaaS 提供商，你今天就可以得到一些东西."

毫无疑问，使用托管云对您的安全性、成本和环境都有好处。

“如果你正确使用云，你几乎肯定会获得比自己的数据中心更好的安全性，”Rosanova 说。“大型云提供商拥有庞大、先进的安全团队来监控他们的数据和网络，”引用实时监控、他们与联邦调查局的直接联系以及政府合作伙伴关系。他说，他们的经验意味着他们能很好地应对 DDoS 和恶意软件攻击，而且他们在硬件的物理安全方面一直做得更好。

云供应商像对待宠物一样对待他们自己的数据中心，因此您可以自动合规和安全，并可以将他们视为短命的牲畜。这很重要，因为安全性通常不是你的底线。

最后，通过将 Kafka 从内部迁移到云，您可以获得可扩展性。Rosanova 说，周期性工作负载过去需要一整年来维护。一家零售企业将在 7 月份开始为假日购物潮扩大规模，然后，到 1 月份，他们将花几个月的时间拆除，只是为了重新建设。

但是，他指出，“在云中，这里有一个滑块、一个按钮和一个 API 调用，它可以减少到几个小时。”

弗莱明说，虽然五年前，在哪里部署的决定占主导地位，但现在，随着 Kubernetes 和软件解决方案对云进行抽象和管理，对她所有的客户来说，这个决定已经变得微不足道了。云原生 Kafka 轻松赋予了它们可移植性。

这位分析师补充说，“有了云原生架构，你可以构建你需要的东西，而不用担心它会被忽略。”

## 为 AO 的高度个性化腾出空间

回到 2017 年，家用电器和电子产品在线零售商 [AO](http://ao.com) 希望提高客户满意度。为了在电子商务中获得优势，该公司决定专注于创建一个统一的、超个性化的用户之旅。

AO 一直依赖历史客户数据，但希望将这些数据与基于访问者行为的实时信号(如[点击流事件](https://thenewstack.io/the-role-of-event-driven-architectures-in-modern-application-workflows/))相结合，从而实现个性化营销自动化。例如，根据访问者的现场行为，包括产品和类别视图，他们会收到一张 10%折扣和免费送货的相应凭证。

为了打破数据孤岛以创建现场访客的视图，AO 客户个性化团队决定采用[事件流方法](https://thenewstack.io/the-big-data-debate-batch-processing-vs-streaming-processing/)来实现这一点，并采用了卡夫卡和[融合云](https://docs.confluent.io/platform/current/platform.html)。

AO 的数据工程和集成负责人 [Jon Vines](https://www.linkedin.com/in/jonvines/) 在 Confluent 发表的案例研究[中表示，托管云解决方案使 AO 能够“从我们的传统系统中解放数据，并将其与来自客户的实时信号相结合，以提供超个性化的体验”。"你不能用数据湖和批处理来做到这一点."](https://www.confluent.io/customers/ao/)

Vines 说，这种高度个性化的方法很快在 A/B 测试中显示出客户交谈率的显著上升。

在迁移到融合云之前，每当 Kafka 中出现[代理中断](https://www.confluent.co.uk/blog/how-to-survive-a-kafka-outage/)时，开发人员都要花费长达三天的时间进行重建。通过从自我管理的环境转移到融合云及其对 Kafka 集群的持续监控，可以更早地检测到故障并自动解决，从而避免重大事故。这意味着开发团队可以更加专注于新的特性和应用。

AO 的开发人员也能够更快地行动；Vines 表示，他们现在能够在半小时内从测试版部署到生产版。

“在疫情期间，速度变得更加重要，因为世界发展如此之快，从以店内购物为主转向网上购物，”他说。“我们能够创建新的用例来改善融合云的客户之旅，这种速度有助于我们巩固我们的在线市场领导地位，即使我们继续适应不断变化。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>