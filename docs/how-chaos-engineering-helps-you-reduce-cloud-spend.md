# 混沌工程如何帮助您减少云支出

> 原文：<https://thenewstack.io/how-chaos-engineering-helps-you-reduce-cloud-spend/>

[Gremlin](https://www.gremlin.com/) 赞助本帖。

 [安德烈·纽曼

Andre 是 Gremlin 的技术作家，他在那里写了关于混沌工程的好处和应用。在加入 Gremlin 之前，他是初创公司和 SaaS 提供商的顾问，撰写了关于 DevOps、observability、SIEM 和微服务的文章。他曾在 DZone、StatusCode Weekly 和 Next City 中出现。](https://www.linkedin.com/in/andrenewman/) 

云平台为工程团队打开了闸门，以比传统内部数据中心低得多的成本运行企业级应用程序。也就是说，云计算仍然会变得昂贵——尤其是当你扩大运营规模的时候。 [Flexera 2020 年云状态报告](https://info.flexera.com/SLO-CM-REPORT-State-of-the-Cloud-2020)发现，73%的组织将节约成本放在首位，23%的组织在云支出上超出了预算。

幸运的是，云平台提供了许多成本优化功能，如资源调整、按需基础架构和自动扩展。诀窍是知道如何使用这些特性，同时在应用程序中提供高性能和高可靠性。

在本文中，我们将探讨一些不同的方法来减少您的云支出，以及如何使用混沌工程来安全、智能地做到这一点。

## 适当调整您的基础架构

在调配足够的容量和不为未使用的容量付费之间需要找到一个平衡点，但是找到这个平衡点很难。例如，您如何:

*   调整虚拟机实例的大小，使其不会过度空闲，但仍能处理需求的变化？
*   缩减闲置资源，而不会无意中造成瓶颈？
*   知道您可以可靠地扩展您的应用程序吗？

我们需要一种安全的方法来验证我们的更改是否适合我们的环境；我们用混沌工程来做这件事。混沌工程是一种通过向系统注入精确的伤害量来故意测试系统故障的实践。通过观察我们的系统如何应对这种失败，我们可以使它们更有弹性。

这如何适用于规模合适的云基础架构？假设我们有一组虚拟机实例，当 CPU 使用率达到某个阈值时(例如，一分钟内所有节点的使用率达到 80%)，我们希望对其进行扩展。传统上，为了测试这个自动缩放规则，我们要么需要等待流量有机地达到这个阈值，要么我们自己使用复杂的脚本来模拟流量。但是有了混沌工程，我们可以[轻松消耗集群中的 CPU 周期](https://www.gremlin.com/docs/infrastructure-layer/attacks/cpu)。然后，我们可以监控我们的实例和应用程序，以确保:

*   新系统正常启动。
*   我们可以在系统之间实现流量负载平衡。
*   客户体验不会受到负面影响。

当然，我们还希望确保在资源闲置时能够缩减规模。我们不想为我们没有使用的资源付费。因此，一旦您的系统向上扩展，[停止您的实验](https://www.gremlin.com/community/tutorials/how-to-install-and-use-gremlin-on-ubuntu-18-04/#step-3---halting-an-attack),并继续监视您的实例组，以确保它自动向下扩展。

## 明智地对待冗余

拥有冗余系统对于在故障期间维持服务至关重要。没有冗余的组织面临每分钟停机时间损失高达[22 万美元的风险](https://www.gremlin.com/ecommerce-cost-of-downtime/)。一种常见的策略是创建您的环境的副本，并在单独的位置运行它(称为主动-主动冗余)。这在大停电期间有更好的机会保护你，但是也非常昂贵。您不仅要加倍运营成本，还要增加在两种环境之间传输数据的成本。

或者，您可以创建环境的副本，该副本保持备用状态，仅在主环境出现故障时运行(称为主动-被动冗余)。这具有成本较低的优势，但在故障转移期间可能需要更长时间才能启动。在这种情况下，我们需要一种方法来测试我们的故障转移策略，以确保副本自动启动并处理负载，而不会停机。

例如，假设我们有两个虚拟机实例组放在一个负载平衡器后面。一个实例组是我们的主要组，而第二个是我们的故障转移组。有了混沌工程，我们可以[丢弃负载均衡器和主要组中的实例之间的所有网络流量](https://www.gremlin.com/docs/infrastructure-layer/attacks/blackhole)，以模拟区域性或分区性中断。然后，我们可以监控流量和应用可用性，以确保:

1.  负载均衡器检测到主要中断，并将流量重定向到次要组。
2.  辅助实例组可以以最小的延迟启动和服务流量。
3.  用户不会经历明显的延迟或数据丢失。

如果我们不能满足这些条件中的任何一个，我们可以停止攻击，并在排除故障的同时，立即将通信流返回到主组。以这种方式实现冗余对于确保您的冗余系统正常工作以及在发生故障时得到保护是非常有效的。

## 查找未使用的资源

随着时间的推移，云资源很容易被抛弃，原因有很多:

*   团队创建了一个临时的测试或演示环境，但他们忘记了停止使用。
*   错误配置的自动缩放规则会创建新资源，但不会删除未使用的资源。
*   应用程序发生了变化，不再使用旧系统，但是工程师让这些系统继续运行，因为他们不确定它们是否还在使用。
*   工程师离开公司，忘记记录旧系统。

移除废弃资源的挑战在于不知道这些资源是否仍在使用。如果运行了三年的计算实例实际上正在托管一项关键服务，那会怎么样？即使服务不是关键的，破坏它会在我们的应用程序中引起一些其他的、意想不到的问题吗？

幸运的是，我们可以使用混沌工程来测试服务的重要性，而无需删除或关闭实例。与冗余一样，我们可以将网络流量丢弃到主机来模拟主机故障，然后观察对应用程序的影响。如果我们担心这是一个重要的生产服务器，我们可以通过[增加网络调用](https://www.gremlin.com/docs/infrastructure-layer/attacks/latency)的延迟来降低攻击的强度。如果我们注意到增加合理的少量延迟(例如 150 毫秒)对吞吐量有相应的影响，那么我们就知道这是一个关键服务器。如果没有，我们可以将攻击扩大到黑洞攻击。在任何情况下，我们都可以在进行额外的测试之前停止实验，让服务恢复正常。

## 结论

降低云支出是 SRE 团队面临的持续挑战，尤其是随着云平台推出新的服务和功能。Chaos Engineering 可以帮助您调整基础架构的规模，更加智能地实现冗余，并发现未使用的资源，从而帮助您降低成本，同时帮助您保持应用程序可靠运行。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>