# 脸书是如何存储的

> 原文：<https://thenewstack.io/facebook-storage/>

脸书上存储了大量数据，以及大量用户自己的内容。这些内容是这项服务最重要的资产，用户需要相信它是安全的，否则他们不会分享。获得正确的存储至关重要，这有助于定义脸书如何设计其数据中心。

存储工程师 Jeff Qin 在 Storage Visions conference 的一次演讲中说，在早期，其存储系统使用标准文件管理器增长，需要 10 次 I/O 操作来保存一张照片，并在目录遍历上浪费了更多时间。虽然公司 hack days 增加了照片标记等功能，但该服务的第一个真正变化是在 2010 年部署了自己的 [Haystack 存储服务](https://www.facebook.com/notes/facebook-engineering/needle-in-a-haystack-efficient-storage-of-billions-of-photos/76191543919)。Haystack 是一种 RAID-6 存储服务，具有照片的全局复制功能，每个照片请求使用一个 IOP。

照片存储是这项服务的最大需求之一，因此脸书了解用户在用照片做什么非常重要，因为如何查看和分享照片决定了照片存储的设计方式。事实证明，照片访问降温很快，初始浏览量是 18 个月后的 10 倍。

> 将所有照片保存在昂贵、快速的存储设备中很快会浪费性能，需要不必要的电力和冷却。

对这一点的理解导致了脸书存储架构的重新设计，为热门照片保留了 Haystack 服务，而 F4 是一个较慢的层，用于尚未完全停止观看的图像的热存储，最终删除了多余的副本，并将它们转移到离线冷存储设施。通过这种方式，朋友和家人可以在短时间内互相分享照片，通常是在活动结束后，然后关注长期的耐用性，这很可能只是你想访问旧照片。如果某个映像变得受欢迎，可以将其短期移出冷存储层，直到其重新受欢迎的程度再次降低。

脸书的冷藏设施与传统的数据中心非常不同。它不是为了性能而设计的，而是为了能效和 Quin 所说的“出色的数据持久性”而设计的。高存储效率意味着没有 UPS，没有冗余电源，没有发电机；一个机架接一个机架的存储。该设施是在 18 个月内从零开始建造的，包括它所使用的定制软件。它比典型的数据中心安静得多，因为该服务会关闭未使用的驱动器以节省能源。

使用捐赠给[开放计算项目](http://www.opencompute.org/)的设计构建的定制服务器目前充斥着脸书的数据中心。凭借自己的存储、计算和网络硬件，它现在专注于新的设计，这将使它能够扩展到另外 10 亿用户。

这就是“分解架”发挥作用的地方。与包含计算、内存、闪存和硬盘存储的服务器不同，的分散服务器模型将各种服务器组件分散在不同的机架上，使其能够针对特定服务调整组件，并使用秦所说的“更智能的硬件更新”来延长使用寿命。例如，通过分离服务器资源，可以将不同机架上的计算、内存和存储混合在一起，以提供一组可以运行 Hadoop 的服务器。随着负载和使用情况的变化，为服务提供动力的组件的平衡也会发生变化，从而将低效率保持在最低水平。

秦指出，这种方法的关键是更快的网络，采用最新的技术在爱荷华州建立了脸书第一个基于结构的数据中心。该系统旨在以高达网卡线路速率的速度工作——尽管它尚未以该速度运行，因为该服务不需要带宽。秦预计这种方法可以延长存储模块的寿命，因为可以按照不同的、更快的时间表交换内存和 CPU。

但是脸书想从存储供应商那里得到什么呢？秦提出了一个惊人的观点:

> “脸书想要的是冷光。”

为了支持其使用模式，即最少的写入和大量的读取，希望闪存供应商(尽管秦指出，任何其他固态存储器技术都可以)提供他所描述的“最差的闪存”。密集且成本低。长写入、低耐久性和较低的 IOPS/TB 都可以。”

冷闪存并不是脸书针对其存储需求进行调查的唯一技术。它也在考虑使用光盘作为其冷存储存档的一部分。使用光存储档案有很多很好的理由:它持久、持久、密集。秦谈到了预期寿命为 10 到 15 年的磁盘，以及机架中超过 1PB 的密度，以及几年内机架中 2 到 4PB 的密度。“我们需要对冷藏的介质类型保持不可知论，”他说。

构建网络规模的存储平台是一项复杂的任务，脸书的经验和未来的方向并不适合所有人。从脸书身上学到的最有用的东西是不要假设你需要其他人都使用的相同的存储架构；看看对你正在构建的东西真正重要的是什么，不管它可能与多少标准原则相矛盾，把一个能给你所需要的东西的架构放在一起。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>