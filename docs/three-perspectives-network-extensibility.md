# 集装箱联网的三种方法

> 原文：<https://thenewstack.io/three-perspectives-network-extensibility/>

任何基于云的部署的一个关键方面是管理各种容器之间的网络。在研究我们最新的电子书“使用 Docker &容器的[网络、安全&存储”时，我们通过插件确定了三种类型的集成容器网络。](https://thenewstack.io/ebookseries/)[在之前的文章](https://thenewstack.io/container-networking-landscape-cni-coreos-cnm-docker/)中，我们介绍了容器网络模型(CNM)和容器网络接口(CNI)。在这里，我们将讨论这些模型的起源，以及包含 Apache Mesos 生态系统的第三个领域。

## 集装箱网络模型和 Libnetwork

Docker 的可扩展性模型为守护进程增加了功能，就像库为操作系统增加功能一样。它确实涉及到了一个代码库，类似于 Docker 的运行时，但只是作为补充使用。这个库被称为 [libnetwork](https://github.com/docker/libnetwork) ，最初是由开发团队 SocketPlane 作为第三方项目开发的，Docker Inc .于 2015 年 3 月收购了 socket plane。

 [斯科特·富尔顿三世

首先是轮子，你必须承认，轮子很酷。在那之后，你有了船和汉堡包，科技正随着整个进化而突突前进。然后是网络，你不得不好奇，在轮子和汉堡包之后，事物是如何突然左转并如此迅速地变得如此混乱的？斯科特·富尔顿(通常被称为斯科特·m·富尔顿三世，以前被称为 d·f·斯科特，有时被称为角落里做手势的那个大声的家伙)表现出在技术新闻行业工作了 30 年的所有症状，他已经开始自己将进化带回更明智的轨道。保持联系，看看他能走多远。](https://thenewstack.io/author/scott/) 

本质上，libnetwork 提供了一种平台，开发者可以在上面编写网络驱动程序。libnetwork 的绑定原则被称为容器网络模型(CNM)，它被视为容器的权利法案。这些权利之一是对网络中所有其他容器的平等访问；分区、隔离和流量分段是通过划分网络地址来实现的。服务发现模型为容器提供了一种相互联系的方式。

目的是让 libnetwork 实现并使用任何类型的网络技术来连接和发现容器。它没有为任何网络覆盖方案指定一种优选的方法。Calico 项目是一个独立的开源项目，为第 3 层开发一个厂商中立的网络方案；开发人员最近将 Project Calico 的 calicoctl 库变成了 Docker 插件的可寻址组件。

ClusterHQ 是首批为数据库实现持久容器系统的公司之一，名为 [Flocker](https://clusterhq.com/flocker/introduction/) 。它使用 libnetwork，并可使用 Weaveworks 的[编织网](https://www.weave.works/products/weave-net/)覆盖进行寻址。正如 ClusterHQ 产品副总裁 [Mohit Bhatnagar](https://www.linkedin.com/in/mohitbhatnagars) 告诉我们的，“我认为我们正处于这样一个阶段，最初考虑无状态服务容器的客户需要意识到有状态服务的需求和潜力。实际上，我们对客户参与有状态服务的数量感到非常惊喜。”

Docker 方案的关键架构区别只涉及扩展的部分。在 Docker 体系结构中，Docker 引擎的守护程序运行在应用程序正在运行的主机服务器上。Docker Swarm 重新配置 Docker Engine 的网络视图，代之以集群中运行的服务器的合并视图。Swarm 是有效的指挥者，但插件可以在较低的层扩展 Docker 引擎。

## 集装箱网络接口

Kubernetes 项目发布了实现网络可扩展性的指南。它应该能够寻址其他容器的 IP 地址，而无需求助于网络地址转换(NAT ),并且应该允许自己以同样的方式被寻址。本质上，只要组件可以用 IP 寻址，Kubernetes 就没问题。在这种情况下，理论上任何东西都可以扩展你用 Kubernetes 做的事情，但是没有任何东西必须绑定到它。

“我们研究了我们将如何在 Kubernetes 中进行联网，”谷歌工程经理蒂姆·霍金解释说，“很明显，核心系统不可能处理所有的网络用例。世界上的每一个网络都是一片特别的雪花；它们都是不同的，我们没有办法把它们植入我们的系统。我们必须将它具体化，插件就是我们要做的事情。”

然后 CoreOS 生产了它的[容器网络接口](https://github.com/containernetworking/cni) (CNI)。它比 CNM 更基本，因为它只有两个命令:创建容器和删除容器。用 JSON 编写的配置文件实例化容器的内容，并用 IP 地址设置它。但由于该地址遵循了 Kubernetes 的指导方针，谷歌认为 CNI 没问题。因此，法兰绒和编织网已经用 CNI 实现为 Kubernetes 插件。

Hockin 承认，虽然这种扩展使 Kubernetes 环境中的新的和灵活的网络形式成为可能，但它们也产生了一些成本。“Kubernetes 对覆盖层的一般立场是，只有在非常非常必要的情况下才应该使用它们。他们带来了自己的复杂性、管理和桥接水平。我们发现，越来越多的 Kubernetes 用户直接使用 L3 路由，他们在这方面比在覆盖层上玩得更开心。”

在重新评估可扩展性框架的当前状态后，ClusterHQ 得出结论，您选择哪种模型可能完全取决于您需要在容器和预先存在的工作负载之间进行多大程度的集成。

ClusterHQ 工程和运营高级副总裁 Sandeepan Banerjee 解释说:“如果您的作业以前在一个虚拟机上运行，并且您的虚拟机有一个 IP，可以与您项目中的其他虚拟机进行通信，那么您可能更适合使用 CNI 模型、Kubernetes 和 Weave。”班纳吉接着引用了库伯内特公司的“不可侵犯”条款作为关键原因。

“如果这不是你来自的那个世界，”他继续说道，“并且你想拥抱 Docker 框架，认为它对你的整个堆栈都是必要和足够的——包括 Docker 的网络库，作为编排框架的 Swarm，等等——那么 Docker 提案是强大的，有优点的，总体上可能有更多的可调性。”

## 中间层和另一端的插件

Mesosphere 已经用 [DC/OS](https://dcos.io/) 制作了也许是最复杂的商业实现，并以其[马拉松](https://mesosphere.github.io/marathon/) orchestrator 的形式建立了对 Kubernetes 的有效竞争对手。

作为一个调度平台，扩展 Mesos 的工作一直是在众所周知的桥的对面完成的。Hadoop 中的大数据流程调度、Jenkins 中的作业管理流程以及 Docker 中的容器部署都是在这些平台中完成的。

但在 2016 年夏天，中间层开始采取不同的立场。中间层开始为正确接口的容器铺平道路，通过 CNI 扩展这个库。在撰写本文时，Mesosphere 已经发布了一个文档，声明它打算在 DC/操作系统路线图的近期内实现 CNI 支持。

[cyclone slider id = " ebook-4-赞助商"]

Mesosphere 的创始人兼首席架构师 Ben Hindman 说:“我们今天所处的世界有足够多的不同供应商，他们有不同的网络和存储接口和实现方式，我认为，做插件的方式是非常重要的一部分。我认为现在不太清楚的是，Docker 定义的插件是否会成为通用插件。我认为，你今天在业内已经看到的是，事实并非如此。”

目前，DC/OS 使用一个名为[民兵](https://github.com/dcos/minuteman)的开源负载平衡和服务发现系统来连接容器。它的工作原理是在数据包从一台主机上的容器交换到另一台主机上的容器时拦截数据包，并将其重写为正确的目的 IP。这实现了跨云范围，将 DC/操作系统与其他实施区分开来。或者，DC/OS 提供了一种机制，用于设置虚拟可扩展局域网(VXLAN ),并在该虚拟网络中的容器之间建立路由规则。中间层在这里根本没有重新发明轮子；实际上，它让用户根据性能或其他因素选择自己的覆盖方案。

Hindman 告诉我们，他看到了法兰绒、编织和其他网络覆盖系统解决集装箱联网问题的价值，这比拼凑 VXLAN 要高得多。他说，这种替代方案会出现的事实，“只是抓住了这样一个事实，即我们作为一个行业，正在经历和尝试几种不同的方式，来决定我们可能想要做的事情。我认为，我们可能会在少数几件事情上达成一致，叠加层仍然会存在。但是，人们将会有一些其他的方式来链接和连接容器，而不是使用预先存在的、基于 SDN 的技术。”

## 走向未来的一体化

如今，集装箱化在 IT 和数据中心预算中并不常见，集成才是。当签署支票的人不太理解他们资助的流程背后的概念时，集成通常会向他们提供尽可能多的解释，因为他们需要投入他们的信任和资本支出。有些人可能认为这是对这个话题的淡化。事实上，整合是将基本思想提升到一个共享的讨论层面。每个人都明白让旧系统共存、与新系统接口和通信的基本需求。因此，即使这些方法在几年后可能看起来令人费解或不切实际，但朝着一个值得称赞的目标努力背后的灵感将使这一切都值得追求。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>