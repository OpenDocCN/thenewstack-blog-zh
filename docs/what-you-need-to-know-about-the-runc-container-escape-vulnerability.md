# 关于 RunC 容器转义漏洞，您需要知道什么

> 原文：<https://thenewstack.io/what-you-need-to-know-about-the-runc-container-escape-vulnerability/>

在支撑 Docker 和其他 Linux 容器引擎的运行时 [runC](https://github.com/opencontainers/runc) 中发现了一个严重的漏洞。如果不对其进行修补，它将允许黑客突破沙箱并获得主机服务器的根用户访问权限，从而危及整个基础架构。

漏洞[被跟踪为 CVE-2019-5736](https://access.redhat.com/security/vulnerabilities/runcescape) ，但也被称为 [**运行场景**](https://access.redhat.com/announcements/3896281) 。它是由波兰研究人员 Adam Iwaniuk 和 Borys popawski 发现的，他们在一次捕获旗帜安全竞赛后，产生了研究基于名称空间的沙箱的想法。

“我们考虑了以下两种攻击载体:恶意 Docker 映像[和]容器内的恶意进程(例如，以根用户身份运行的受损 Docker 化服务)，”研究人员周三在博客文章中表示。“结果:我们已经在主机上实现了完整的代码执行，具有所有功能(即，在管理“根”访问级别)，通过从主机、在受损的 docker 容器上运行“Docker exec ”[或]启动恶意的 Docker 映像来触发。”

然而，由于 [runC 是将大多数容器引擎与 Linux 内核的沙盒特性联系起来的管道](https://blog.docker.com/2015/06/runc/)，Docker 并不是唯一受该缺陷影响的容器平台。RunC 还被 containerd、Podman 和 CRI-O 用来生成和运行容器。

根据 runC 维护者 Aleksa Sarai 的说法，LXC 也受到了同样缺陷的影响。然而，该漏洞只能在特权容器上被利用，LXC 项目默认认为这是不安全的。

这种攻击包括用/proc/self/exec 符号链接覆盖容器内的二进制文件，例如/bin/bash shell，这是内核为正在运行的进程(在本例中为 runC)自动创建的。因此，当/bin/bash 二进制文件在容器中执行时，运行时将实际执行一个指向自身的符号链接。然后，攻击者可以尝试使用文件描述符在循环中用恶意版本覆盖该文件，这最终会在 runC 进程退出时成功，因为它在运行时不能被覆盖。

 [CVE-2019-5736

Docker 18 . 09 . 2 之前版本和其他产品中使用的 runc 1.0-rc6 允许攻击者利用在以下容器类型之一中以根用户身份执行命令的能力来覆盖主机 runc 二进制文件(从而获得主机根用户访问权限):(1)具有攻击者控制的映像的新容器，或(2)攻击者以前拥有写访问权限的现有容器，该容器可以与 docker exec 连接。发生这种情况是因为与/proc/self/exe 相关的文件描述符处理不当。-来自常见漏洞和暴露数据库。](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5736) 

“为了防止这种攻击，LXC 已经打了补丁，当它启动或附加到容器时，会创建一个调用二进制文件本身的临时副本，”LXC 维护人员[解释说](https://github.com/lxc/lxc/commit/6400238d08cdf1ca20d49bafb85f4e224348bf9d)。为此，LXC 使用 memfd_create()系统调用创建一个匿名的内存文件，并将其自身复制到临时内存文件中，然后密封该文件以防止进一步的修改。然后，LXC 执行这个密封的内存文件，而不是原来的磁盘上的二进制文件

[Aleksa Sarai 表示](https://www.openwall.com/lists/oss-security/2019/02/11/2)一些发行版(如 Fedora)上的默认 AppArmor 或 SELinux 策略不会阻止对该漏洞的利用。但是，如果主机根目录没有映射到容器的用户名称空间内，它会被用户名称空间的正确使用所阻止。

根据 Red Hat 的说法，利用该漏洞的企图通过 Red Hat Enterprise Linux 和 Red Hat OpenShift 中的默认 SELinux 策略得以缓解，因为在这些系统上，该策略被设置为目标强制模式，并且很少在容器化环境中禁用。安全性增强的 Linux (SELinux)是一个内核安全模块，支持访问控制安全策略。

在通用漏洞评分系统中，该漏洞被评为 7.2 级(满分 10 分)。这表明严重性很高，而不是严重，因为它不能被远程利用，但就沙箱和容器而言，它是最糟糕的。这是因为它打破了容器旨在提供的基本安全隔离层，并允许获得单个特权 Docker 映像访问权限的攻击者危及底层服务器上运行的所有其他服务。

Shodan 搜索引擎显示[大约有 4000 个 Docker 部署暴露在互联网上](https://www.shodan.io/report/ol761bRb)，其中大部分托管在亚马逊的云计算基础设施上。去年，[安全公司 Lacework](/over-20000-container-management-dashboards-are-exposed-on-the-internet/) 的一项研究发现超过 22，000 个公开的容器编排和 API 管理系统，其中大约 300 个可以在没有任何凭证的情况下访问。

“这不是容器运行时出现的第一个重大缺陷，随着容器部署和对相关技术兴趣的增加，这不太可能是最后一个，”[Red Hat 容器首席产品经理 Scott McCarty](https://www.redhat.com/en/blog/it-starts-linux-how-red-hat-helping-counter-linux-container-security-flaws) 说。“正如去年的 Spectre/Meltdown 代表了安全研究从软件体系结构向处理器体系结构的转移，我们应该预料到，runc 等低级容器运行时和 docker 等容器引擎现在将受到研究人员和潜在恶意参与者的额外审查。”

针对该漏洞的概念验证利用代码预计将于下周发布，但黑客可能已经有足够的信息，甚至在此之前就开始发动攻击。组织应审查其容器部署，并尽快应用必要的补丁程序。

亚马逊[已经为各种服务发布了更新的 Docker 包和亚马逊 Linux AMI 映像](https://aws.amazon.com/security/security-bulletins/AWS-2019-002/)，包括亚马逊弹性容器服务(亚马逊 ECS)、面向 Kubernetes (EKS)的亚马逊弹性容器服务、AWS Fargate、AWS IoT Greengrass、AWS Batch、AWS Elastic Beanstalk、AWS Cloud9、AWS SageMaker、AWS RoboMaker 和 AWS Deep Learning。

Lacework 首席产品官丹·哈伯德(Dan Hubbard)通过电子邮件表示:“这是我们在一段时间内看到的第一个重大容器漏洞，它进一步增强了使用 docker 和其他容器的云和传统数据中心对主机和容器可见性的需求。”。“这里的安全性始于深入了解谁在安装容器，他们的行为是什么，当然，还有及时打补丁。”

红帽是新堆栈的赞助商。

由 [Jason Leung](https://unsplash.com/photos/83MCWeYaovs?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 在 [Unsplash](https://unsplash.com/search/photos/escape?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上拍摄的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>