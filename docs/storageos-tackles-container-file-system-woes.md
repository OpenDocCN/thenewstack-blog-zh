# StorageOS 解决容器文件系统难题

> 原文：<https://thenewstack.io/storageos-tackles-container-file-system-woes/>

自十多年前亚马逊推出网络服务和 S3 以来，存储和云就一直紧密联系在一起。不幸的是，随着云开始从虚拟机转向容器，持久存储的工作变得更加困难。

毕竟，容器的全部意义在于，当它们坏掉的时候，你可以把它们扔掉，然后简单地用另一个代替它。而存储则基本相反。当存储实例损坏时，您必须修复它，否则其中的数据将永远损坏。当容器消失时，数据必须保留。

这意味着将存储附加到容器，但也意味着在分配文件系统、给予适当的权限以及从长期存储系统复制其数据时需要很长的等待时间。这是按需、短暂计算的对立面。

输入 [StorageOS](https://storageos.com/) 。在一个市场中，上一批新的存储公司都是在 7 年前被收购的，并且所有这些公司都要求您购买物理机箱，StorageOS 有自己的工作要做。

StorageOS 的联合创始人兼首席技术官[亚历克斯·奇尔科普](https://www.linkedin.com/in/alexchircop/)指出，这是因为该公司的主要关注点是基于容器的持久存储，填补了市场空白。他上辈子还在[高盛](http://www.goldmansachs.com/)负责存储平台工程。他说，现有的用于容器环境存储的产品大多是不彻底的解决方案。

StorageOS 的联合创始人兼首席执行官克里斯·布兰顿表示，他们的产品是一种“基于容器的存储阵列，完全可移植，与编排无关，与内核无关，在应用层运行，将卷配置到容器，并提供基于策略的规则引擎，用于放置存储在何种类型的存储上。我们负责复制、快照、克隆以及与该存储相关的所有性能。”

“我们开始致力于 StorageOS 的原因之一是，当 Chris 试图在云环境中构建存储系统时，他发现很难配置解决方案，因为缺乏 API 集成，而且还因为很难通过应用程序移动数据，”Chircop 说。"我们从第一天起就设计了这个 API 集成来与 Docker 或 Kubernetes 一起工作."

## API 驱动

据该公司称，这就是 StorageOS 与其他基于云的文件系统解决方案之间的巨大差异:StorageOS 是完全由 API 驱动的全新设计。对于存储系统来说，这似乎有些奇怪，但云的其余部分是由 API 配置和处理的，因此向这种混合中添加存储使其更容易访问，也更容易以编程方式控制。

Chircop 表示，其他解决方案并不能满足基于云的存储的所有需求。“[厨师](https://www.chef.io/)和[木偶](https://puppet.com/)需要时间。现有系统旨在向操作系统实例而不是容器或应用程序本身呈现存储。除了定义或声明应用程序在卷和属性方面的需求之外，还必须将应用程序映射到一半连接了存储的节点上，这非常复杂。我们在应用程序级别运行，将存储呈现给应用程序或容器，因此我们绕过了这一级别的复杂性。”

该团队将存储层从通常与硬盘和持久文件存储相关的较低层中抽象出来。

该产品被部署为一个容器，在该容器中，控制平面管理集群中的配置，数据平面为卷的数据部分提供功能。该控制平面管理这些卷的运行状况、配置、集群状态和计划更改。数据平面有一个虚拟化层，允许它查看每个节点中可用的不同类型的存储。裸机中的物理磁盘或虚拟机中的虚拟磁盘。

Chircop 说:“我们从中构建了一个全球性的、高度可用的存储池，然后从中分割出卷。这些卷被命名，然后可以附加到正在运行的容器。

面对如此多的现有解决方案，StorageOS 不得不特别关注其理想的使用情形。因此，Chircop 表示，它可以做大多数其他基于云的存储解决方案无法做到的事情。Chircop 说，例如，GlusterFS 是一个共享文件系统，虽然它可以同时供全球许多用户使用，但由于一致性问题，延迟可能会成为一个大问题。

Chircop 说，同样，NFS 也不适合集装箱运输。“NFS 是一种点对点协议，因此您在某个地方有一个文件系统，它通过 NFS 服务器导出，而服务器本身总是会出现单点故障。有多种方法可以对 NFS 进行集群，但它们倾向于商业解决方案或设备。虽然 NFS 无处不在，因为它是最古老的文件共享协议之一，但它是一种无状态的服务。状态在客户端维护，像锁定和一致性这样的事情是应用程序要处理的。

“虽然使用 NFS 共享文件非常常见，”Chircop 说，“但在 NFS 更改文件和发布内容的现实生活应用程序往往具有相当高的复杂性，当 NFS 服务器因失去锁定状态而发生故障时，会有非常复杂的解决方案，那里有很多腐败的机会。

“通常，因为 NFS 不是性能最好的协议，”Chircop 说，“总会有一定量的缓存。如果像锁定这样的事情没有正确实现，您在应用程序中看到的一些一致性问题就会出现。我们确实看到了 NFS 的一个用例，以及像 Gluster 这样的共享文件系统。然而，我们确实认为，使用容器来公开 NFS 等服务会变得非常复杂，因为容器通常在私有 IP 名称空间内运行，所以每个容器都有自己的网络服务定义，而在 NFS 内维护的打开文件句柄实际上是 IP 地址和文件句柄的散列。”

自然，云提供商自己提供最特定于云的文件托管解决方案。然而，Chircop 特别指出，StorageOS 比亚马逊的 [Elastic Block Store](https://aws.amazon.com/ebs/) (EBS)提供了更好的复制和全球分发能力。

“所有的云提供商都有可用性区域的概念。每个可用性区域都有一组独特的基础设施和 API，它们应该完全独立于其他可用性区域。本质上，Amazon 不提供跨可用性区域的复制功能。你必须使用第三方软件来做到这一点，”Chircop 说。因为我们可以跨一个或多个可用性区域虚拟化副本，所以我们可以确保您的卷高度可用，并且在单个节点出现故障或可用性区域出现故障时也不会受到影响

Chircop 说，这还不是 EBS 的最大问题。“EBS 更像一个传统的磁盘:它被呈现给一个单独的 EC2 实例。当你的容器需要移动时会发生什么？该 EBS 实例必须分离并重新连接到另一个 EBS 节点并进行配置。有时这些过程可能需要相当长的时间:我们已经看到了长达一个小时，”Chircop 说。“将容器从一个节点移动到另一个节点的简单概念变得复杂得多。也没有全局名称空间。”

然而，作为高盛(Goldman Sachs)的前成员，Chircop 认为 EBS 有一个缺点是金融机构永远不能接受的。“尽管 EBS 具有内置的加密功能，但它要求 AWS 控制加密密钥。这对银行和政府来说是不合适的。StorageOS 对磁盘加密没有这种要求。

StorageOS 仍在为全面上市做准备，但该公司预计将在今年年底向所有用户开放。它的路线图还包括增加跨多个容器的共享文件系统，这一新特性预计也将在今年晚些时候推出。

特征图像通过 px here[。](https://pxhere.com/en/photo/1188230)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>