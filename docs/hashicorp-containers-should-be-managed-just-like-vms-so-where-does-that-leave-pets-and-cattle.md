# HashiCorp:管理容器和虚拟机的新工具，那宠物和牛怎么办？

> 原文：<https://thenewstack.io/hashicorp-containers-should-be-managed-just-like-vms-so-where-does-that-leave-pets-and-cattle/>

自 7 月 14 日发布以来，我们已经更新了这个故事。在我们发表最初的故事后，我们采访了 HashiCorp 首席执行官 Mitchell Hashimoto。在桥本的要求下做了一些改动和调整。

对于传统上使用虚拟机来管理基础设施的公司来说，容器之路有许多转折。这些公司正在试验容器。他们知道容器的好处，但他们希望虚拟机环境的安全性，直到他们找到自己的立足点，并可以利用不可变基础架构带来的密度和轻量级。

显而易见的是，这种新形式的基础架构需要不同类型的工具来有效管理不同的环境。例如，用于测试和开发的容器也可以用于生产。但是，如果你愿意的话，消除某些检查或障碍的方法会带来某些风险。

尽管如此，还是有一个关于如何对待类似于容器的虚拟机的比较。将开发人员的 VMware 虚拟机带入生产环境可能不安全。同样，如果集装箱被搬运，也会有风险。“我们不建议开发人员构建他们在生产中使用的 Docker 容器，”HashiCorp 的销售和营销总监 Kevin Fishner 在接受新堆栈的采访时说。Fishner 认为，如果开发者没有意识到存在漏洞，他们用错误的版本构建 Docker 容器，那是极其危险的。"

上周，HashiCorp 发布了其 Atlas ALM 工具，它将其归类为“基础设施管理”,可以在虚拟机和容器共存的世界中使用。HashiCorp 已经开发了一款名为 [Packer](https://www.packer.io/) 的工具，它可以创建虚拟机映像以部署到 AWS 公共云、OpenStack 私有云以及 VMware vSphere。打包机最近已适用于码头集装箱。现在，Atlas 自动使用 Packer 来生产容器，然后可以通过哈希公司的服务发现工具[consult](https://www.consul.io/)进行监控，从而实现虚拟机和容器的混合环境。

Atlas 没有做的是利用 Packer 来生产超越生命周期阶段的持久容器，而 Fishner 是这一过程的积极反对者。

他告诉我们，“我们认为，投入生产的黄金映像应该由一个运营商来驱动，一个本质上负责管理它的人。”“但是，作为一名开发人员，如果您觉得需要对 Docker 容器进行更改，您当然可以在本地完成，然后提交一个 pull 请求来更改 Docker 配置。此时，运营商团队——或者无论您如何组织您的公司——可以审查该拉动式请求。”

Fishner 继续说，如果这个请求被批准，那么容器在生产级别被重新构建，然后为了一致性而逐步回到开发人员级别。他说，虽然开发人员应该有权构建容器，但任何类型的虚拟机的黄金映像都应该由独立的运营商集中存储和管理。这样，当 API 进入生产时，从开发人员到客户的每个人都可以确信他们使用的是相同的功能。

## 规模的问题

在这个问题上有不同的思想流派，由于集装箱化的突然兴起而产生了对立。在基于 Apache Mesos(受谷歌 Borg(T3)启发的 T2 编排系统)构建的系统中，新旧版本的容器在生产系统中共存。正如 Twitter 工程师 Bill Farner 几个月前告诉我们的那样，这是故意这样做的，以便可以仔细检查新代码的行为，并且如果行为降级，可以回滚更新。

这些新环境带来了各种各样的复杂性。例如，对于多个版本，开发人员可以使用 Packer 在本地生成它们，但将它们安全地保存在开发沙箱中。

Fishner 说，一个未经检查的容器开发到生产的工作流程可能会导致一个活动容器使用 OpenSSL 的补丁版本，而另一个容器使用未打补丁的版本。只有管理得当的部署环境才能确保在整个生产阶段使用最新的补丁版本。

最近，微软开始使用[的宠物与牛的类比](https://thenewstack.io/pets-and-cattle-symbolize-servers-so-what-does-that-make-containers-chickens/)，象征着管理员如何最佳地对待虚拟机映像和她如何对待容器映像之间的差异。在 DockerCon，数据中心全面变革浪潮的倡导者认为，管理员应该学会将容器视为短暂的，他们应该停止对它们的尊敬和昵称，而是将它们视为少量功能的临时交付单位。

哈希公司对生态系统有一个更为具体的看法。例如，保持数据库运行是有意义的，把它当作宠物，而应用程序本身可能被抽象成多个服务，更短暂，就像牛一样。

“我们认为虚拟机和容器应该得到同等对待，”Fishner 说。“就我们构建工具的方式而言，我们完全不受基础设施和技术的限制，让您的应用从开发代码进入生产环境。”

在与一群银行家共进晚餐时，有人幽默地提出了牛与宠物的类比，这是 RedMonk 的 James Governor 最近写的关于 T1 的文章。州长的观点支持哈希公司的立场。

> 总之，我谈到了微服务，当然，还有我的理论，吊桥比护城河更重要。我们还愉快地讨论了牛与宠物微服务的区别。虽然大多数牛多少都是一次性的，但并不是所有的牛都是一次性的——想想获奖的公牛吧…

“此外，我们不知道您打包应用程序并将其部署到生产中的方式，”Fishner 说。“因此，如果您想要构建虚拟机，无论是亚马逊、VMware 还是谷歌云映像，都非常酷。如果你想建造集装箱，完全没问题。如果你想在容器和虚拟机方面拥有一个混合基础设施，这将是这个过渡时期的绝大多数人，再次，令人惊讶的是，非常乐意支持这一点。”

在这里，我们开始踏上一些摇摇欲坠的土地。HashiCorp 声称虚拟机和容器可以使用相同的工具集进行管理。

这直接意味着，这两类运载工具，如果你愿意，应该在一个层面上被视为相同的。
但这实际上不是我们应该得出的结论，正如 HashiCorp 首席执行官 Mitchell Hashimoto 对新堆栈所说。

“Atlas 的一个好处是，你可以隐藏容器的许多复杂性。但是如果你走这条路——这可能是开始的正确路线，”Hashimoto 说，“你确实像对待虚拟机一样对待你的容器，但是你不能得到容器的所有好处。”

Hashimoto 说，Atlas 不是一个以容器为中心的解决方案，这一事实是该产品套件的关键区别。他将 Atlas 描述为一种管理模式，这种模式更类似于已经在管理虚拟机方面有经验的数据中心期望看到的模式，满足这种期望可以为他们提供更容易的基础设施，支持与虚拟机共存的容器。

“当我们开发这些工具时，我们确保它们能够很好地与容器配合使用，因此无论公司使用虚拟机还是容器，我们都可以解决这个问题。现在肯定有很多公司正在转向容器，我认为这可能是未来的发展方向，但肯定有很多公司坚持使用虚拟机来实现许多核心功能，这也需要适应。这就是我们正在努力做的。”

## 谷仓舞

我向 HashiCorp 的 Fishner 提到，正如在上一次 DockerCon 上概述的那样，容器化的新兴最佳实践涉及到比虚拟机更精细的容器粒度。一个容器可能包含像一个服务一样简单的东西，用最少的库代码打包，使该服务在任何地方都可以运行。因此，我认为，通过分别包含 OpenSSL 并同时将其与其他容器联网，可以缓解两个容器使用不匹配的 OpenSSL 库的情况。

虽然 Fishner 承认将容器集中在单个功能上可能是一个值得称赞的目标，但他并没有看到公司实际上在这么做。“这将在很大程度上取决于企业文化，”Fishner 告诉 New Stack，“在这些更老、更大的组织中，无法对构建 Docker 容器进行集中控制，也无法确保它们遵循正确的规范。我会很震惊的。在我们所有的对话中，这从来都不是真正的考虑因素。”

正如首席执行官 Hashimoto 明确指出的，不可变的基础设施仍然是容器化架构最值得称赞的目标之一，即使组织实现该目标的路线不一定是最直接的。

“我认为微服务是一个重要的趋势。Hashimoto 说:“这一切都与实现不变基础架构的目标紧密相关，朝着更快部署、更安全部署、能够回滚等更大目标发展。微服务肯定是未来的发展方向。”

容器管理领域仍然相当新，对于该领域的参与者来说，有时很难确定他们相信什么，直到他们看到写下来。

但是 Fishner 确实很清楚地表明了这一点:如果一个组织不打算一下子切换到全容器化的部署环境，那么对于它来说，按照虚拟机的最佳实践来管理容器要比改变其实践(也许是其文化)来管理遵循新的容器标准的虚拟机更容易。

HashiCorp 首席执行官桥本对此表示赞同。

“我们当然同意从宠物到牛的转变，”他说。“我认为，在不久的将来，有些事情是不现实的，比如把数据库当成牲口——这不是一个在不久的将来可以解决的问题。但把没有国家的东西当成牛是一种很好的做法，所以我认为我们试图兼顾两者。”

我向 Fishner 提到，正如在上一次 DockerCon 上概述的那样，容器化的新兴最佳实践涉及到比虚拟机更精细的容器粒度。一个容器可能包含像一个服务一样简单的东西，用最少的库代码打包，使该服务在任何地方都可以运行。因此，我认为，通过分别包含 OpenSSL 并同时将其与其他容器联网，可以缓解两个容器使用不匹配的 OpenSSL 库的情况。

虽然 Fishner 承认将容器集中在单个功能上可能是一个值得称赞的目标，但他并没有看到公司实际上在这么做。

“这将在很大程度上取决于企业文化，”他说。“在这些较老、较大的组织中，无法集中控制 Docker 容器的构建，也无法确保它们遵循正确的规范。我会很震惊的。在我们所有的对话中，这从来都不是真正的考虑因素。”

简而言之，从 HashiCorp 的角度来看，如果一个组织不打算一下子切换到全容器化的部署环境，那么对它来说，遵循虚拟机的最佳实践来管理容器要比改变其实践(也许是文化)来管理遵循新的容器标准的虚拟机更容易。

Docker 是新堆栈的赞助商。

特征图片:[汤姆·马洛尼](https://www.flickr.com/photos/lamoney/)的《[牛和狗](https://www.flickr.com/photos/lamoney/97461242)》在 [CC BY-SA 2.0](https://creativecommons.org/licenses/by-sa/2.0/) 下获得授权。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>