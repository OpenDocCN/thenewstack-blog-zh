# 通过应用性能监控避免架构变更灾难

> 原文：<https://thenewstack.io/avoid-architectural-change-disaster-with-app-performance-monitoring/>

[Raygun](https://raygun.com/) 赞助本帖。

如果您正在考虑对您的应用程序或其架构进行大规模改造，应用程序性能监控可能不是您首先想到的。事实上，它可能不是第二个、第三个[、]或第四个——但也许它应该是。

今天，让我们来看看[应用程序性能监控(APM)](https://raygun.com/platform/apm) 和主要结构代码变更之间令人惊讶的关系。这些类型的变化不可避免地伴随着巨大的风险。战略性地使用 APM 可以帮助您降低风险。

## 重大的应用程序变更会带来很多风险

 [埃里克·迪特里希

Erik 是 Raygun.com 的一名作家，他是软件界的资深人士，几乎担任过 it 行业的所有职位:开发人员、架构师、经理、首席信息官，最终还会成为独立管理和战略顾问。这种广泛的经验使他能够与所有的行业人物交谈，并在几十个网站上写了几本书和无数的博客文章。](https://raygun.com/) 

软件世界中的任何事情都伴随着风险。这是一个不断快速发展的领域，因此即使是停滞不前——跟上操作系统和服务器更新等——也是有风险的，就像在火山边缘徘徊一样。一旦你开始构建东西和发布特性，这种风险就会增加。

但是没有什么比对基础设施进行实质性的改变更冒险的了。考虑从整体服务向一系列微服务转移的例子。如果你只是发布一个功能，这可能意味着额外的用户和额外的收入。用户不会购买、欣赏甚至可能不会关心转向微服务——除非情况变得很糟糕。

有了这样的改变——一个主要的架构改变——你就在赌你当前的努力会让未来的特性变得更顺利。你同时也在赌你不会在短期内炸了任何东西。

这是很大的赌博。所以你应该抓住一切可能的优势来避免这些固有的风险。

通常，你会听到关于如何抓住这些优势的合理建议。例如，确保你有一个好的自动化测试套件。以薄片形式迁移您的应用程序。这些都是很好的建议，但这是典型的。

让我们来看看一些非典型的建议，并看看如何使用 APM 来帮助管理一次重大的架构检修。

### 1.避免不必要或不合理的变更

我要介绍的第一个风险来源是人们经常忽视的:我说的是进行不必要或无益的变更的风险。这浪费了时间和金钱，而且在架构变更的情况下，会给用户带来不方便的风险。

通常，这里的勤奋包括依赖开发团队成员的专家意见。他们会坚持认为当前的架构充满了技术债务，会阻碍未来的功能工作。他们可能是对的，但他们也可能经历了一点点认知偏差。与一个更新、更干净的架构一起工作更令人愉快，而且，作为工程师，让我们面对它:我们都受制于新闪亮物体综合症。

如果我们有一些与用户体验相关的实际数据不是很好吗？

嗯，通过在野外监控应用程序，你可以准确地获得这类数据。[真实用户监控(RUM)](https://raygun.com/platform/real-user-monitoring) 可以告诉你性能瓶颈和整体用户体验。例如，某些请求是否比一个合理的用户预期等待的时间要长？很多用户在他们的旅程中的某个点离开或结束他们的会话吗？

回答这样的问题可以让您深入了解您的用户有哪些烦恼，是什么导致了这些烦恼，以及重大的架构转变是否会解决这些根本原因。因此，监控你的用户让你有能力降低仅仅为了改变而改变的风险。

### 2.超越回归缺陷

前面，我提到了自动化测试套件。从历史上看，这代表了针对回归缺陷灾难的最常见的预防措施。但是，再说一次，这不是你唯一的选择。

简单地说，当你发布一个软件变更，并且它破坏了一些曾经工作的东西时，就会出现回归缺陷。即使你不知道这个术语，你大概也能理解。你的健身追踪器发布了一些你不关心的辅助功能，现在告诉你你有多少步的东西不再工作了。这是绝对的用户体验杀手。

自动化测试套件非常适合这一点，但是它不能捕获所有的东西。当你在做大量移动部件的大修，而不是小的重构时，这一点更是如此。除了测试环境之外，您还需要一个在生产环境中有效的策略。

APM 在这里也大放异彩。有了[崩溃报告](https://raygun.com/platform/crash-reporting)，你可以比其他方式更快地发现错误，并更快地修复它们。一般来说，当用户真正开始*报告*一个缺陷时，更多的用户已经经历过了，沮丧地耸耸肩，放弃了。通过密切关注崩溃和错误，您甚至可以在您的用户之前意识到产品中的回归缺陷。

这种增加的智能有助于消除用户在进行重构时遇到错误的风险。

### 3.防止性能下降

回归是行为问题，回归测试可以帮助你发现它们。但是一个真正复杂和全面的测试方法也包含了所有其他类型的测试。这包括各种形式的性能测试，如负载测试、压力测试等。

所以*如果*你有一个全面的测试策略，并且*如果*那个策略包括了良好构建的性能测试，你*可能*有机会在生产之前发现所有这样的问题。但那是很多“如果”如果你想看看这种推理有多脆弱，就拿网飞这个经典例子来说吧。他们有如此独特的资源密集型生产环境，根本无法模拟。

无论是在网飞的环境中还是在您的环境中，性能问题都可以避免巨大的风险。这总是正确的，但是当你推出一个大的架构变化时，这是最正确的。你认为这支微服务舰队会像你的巨石柱一样快速传递信息。你的假设在你们所有的低级环境中都成立。但是你知道吗，当你完全转换成新代码时，生产中也是如此。

APM 再次在这里大放异彩。您可以在显微镜下观察性能和错误，并在事情开始偏离轨道时立即制定补救计划。

## **保护底线**

让我们以哲学和商业为导向的注释来结束。不要误解我。作为一名终生的软件开发人员，我亲身体会到部署一个非常干净的代码库的快乐，以及交付一个非常漂亮、实现良好的特性的满足感。

但如果软件和业务开始亏损或流失用户，这一切都是徒劳的。

如果发生太多这种情况，你将只知道更新简历的喜悦和提交开源请求的满足感。因此，重要的是减轻最大的风险:损害底线的问题。

APM 以多种方式帮助您做到这一点。使用前面提到的真实用户监控，您可以留意用户正在做什么，或者他们没有做什么。例如，如果你注意到注册和结账页面的流量下降，你可以采取相应的措施。

同样，您可以设置特殊的高优先级警报，让您随时了解业务关键位置的异常错误或问题。也许您可以忍受轻微的性能下降或应用程序中其他地方偶尔的回归缺陷。因此，相应地设置您的监控，并对威胁底线的问题保持高度警惕。如果结帐微服务消息从付款记录器中反弹回来，您会想要了解它并回滚到旧的 monolith post haste。

## 知识是风险的解药

无论你做什么，你都无法消除你所承担的变革的所有风险。如果你发现自己处在一个正在彻底检查你的架构的位置上，这意味着，从定义上来说，你并不是处在一个好的位置上。争先恐后地让自己进入一个更好的位置会迫使你去冒险。

接受现实吧。让它冲刷你，让你颤抖一下，与它和平相处。然后意识到，虽然你不能消除风险，但你肯定可以将其最小化。

为了最大限度地降低风险，尽可能确保安全，您需要随机应变。无论如何，要有一个好的计划，为自己建立一个好的测试套件，制定应急计划和所有你本来会做的事情。但是请确保您也利用 APM 来帮助您使事情变得更安全。如果你以前从未想过这是你可以支配的资源，请理解它是，而且是一个强大的资源。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>