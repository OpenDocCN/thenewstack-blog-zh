# DevOps 是制作微服务的秘密原料

> 原文：<https://thenewstack.io/devops-is-the-secret-ingredient-to-make-microservices-cook/>

这篇文章是探索微服务基础的系列文章中的最新一篇。请参阅上一篇文章

[Microservices Deployments](https://thenewstack.io/deploying-microservices-doesnt-have-to-be-a-pie-fight/)

.

向微服务的[转移通常需要大量的自动化，而自动化意味着运营。在今天的多云、敏捷的世界中，操作科学正转向良好的开发运维实践。自然，自动化需要代码，今天的运营商拥有一些最强大的工具和系统，用于将这种环境的复杂性简化为更容易编程的小块。](https://thenewstack.io/migrating-to-microservices/)

然而，要实现这一点，微服务的真正挑战是必须有错综复杂的系统，平衡流量，监控网关，并在部署 bit one 之前在整个应用程序堆栈中分发安全模型。这有点像厨师为了准备晚餐服务，需要一个适当清洁、工具齐全、准备好的厨房。这甚至延伸到服务员和售票系统，人们需要将煮熟的小牛肉盘子递给饥饿的顾客。

DevOps 的技能不是成为一个伟大的厨师，而是一个伟大的经理:管理服务员，热窗口，准备厨师和钱，所有这些都是从地面上的有利位置，对整个流程链，产品和人员的完全可见性。

在微服务领域，这意味着开发人员通常有责任建立构建大规模环境所需的所有基础设施。这意味着 Web 应用服务器、注册中心和存储库、操作系统和容器映像、虚拟化网络、防火墙、负载平衡器、消息队列和反向代理。支持开发团队所需的新技术也取决于 DevOps 团队: [HTTP2](https://http2.github.io/) 、 [GRPC](https://grpc.io/) 和可靠的 SSL。

[GitLab](https://about.gitlab.com/) 的首席执行官 Sid Sijbrandij 说，“随着微服务的爆发，你会得到越来越多的项目。公司发现，他们不仅需要自动化开发运维生命周期，还需要开箱即用的自动化。对于每个项目，您必须设置您的创建工具、打包和管理。如果你每次都要这么做，那会花很多时间。微服务复杂性的增加使得开发和运营之间需要更紧密的协作。让它们在同一页上更重要。”

### 是数据，笨蛋

一个可能变得棘手的领域是数据。从让数据库在 Kubernetes 中可靠地大规模运行，到开发人员在被微服务架构释放后可以采用的外部数据存储的突然激增，数据是基于云的基础设施的一个大问题:以至于云的早期看到了“从应用程序中驱逐状态”的整体建议。

今天，我们知道有状态和无状态应用程序可以在云中愉快地共存，但是实际的日常数据管理工作并不总是容易的。[Kasten](https://www.linkedin.com/in/georgimatev/)的产品主管 Georgi Matev 说，“我们看到的是，数据正遵循我们在计算方面看到的相同模式。随着事物分解成更小、更符合逻辑的组件，在数据方面也是如此。”

虽然这听起来不错，但敏捷地移动数据和移动代码完全是两码事。首席技术官罗伯特·里维斯说，这不是不自动化数据层的借口。“每个人部署应用程序的速度都快了很多；编译后的位。但是，他们仍然依赖手动更改数据库来支持该应用程序。这造成了速度差距。你让房子的一部分按时回家，而房子的另一部分——数据库人员——处于自杀监视中，”里维斯说。

> 准备微服务有点像厨师为了准备晚餐服务，需要一个经过适当清洁、工具化和准备好的厨房。

“我们需要让人类摆脱这种困境，”里维斯说。“我们需要取消干预。过去，系统管理员认为构建服务器就像构建手工制作的咖啡桌。看看我的线路！“看看数据中心有多漂亮，”今天，谁在乎呢，伙计？"

“你需要克服的第一件事是，我们需要一个人来手动检查和执行我们的 SQL 脚本，”Reeves 说。“我们的第一个企业客户是一家非常大的银行。当我们的执行发起人开始与数据库管理员交谈时，他说，“嘿，你对数据库自动化有什么看法？”他说，“这不是我们这里做事的方式。”"

“我们是微服务的忠实粉丝，但你需要将更新这些服务和支持微服务的数据库的权力交给产品团队，”Reeves 说。“我们有使用 Pivotal 的客户，他们可以在几秒钟内更新，但必须等到外部服务团队可以在数据库上运行脚本后才能更新。他们要等 10 到 12 天。有什么意义？”

## 复杂的问题

Kubernetes 作为容器编排的新标准的引入增加了这种复杂性。随着 Kubernetes 应用的增长，围绕它是否适合现有基础设施模式的一些问题仍在回答中。尽管如此，理解和管理 Kubernetes 仍然是 DevOps 的责任，这样开发人员就可以获得他们的按需数据库、管道和部署。

IBM 只是众多已经在 Kubernetes 上构建基础设施的公司之一。例如，Istio 项目允许 DevOps 团队完全控制其微服务周围的数据和流量。 [Daniel Berg](https://www.linkedin.com/in/daniel-berg-18b2bb3/) ， [IBM](http://www.ibm.com) 杰出的工程师，容器服务和微服务，在一封电子邮件中写道，“在开放社区中，IBM 已经与其他技术领导者合作，如 [Google](https://www.google.com) 和 [Lyft](https://www.lyft.com/) 建立了 [Istio](https://istio.io/) ，它为开发者在其容器之上配备了一个编排层，以更好地保护和管理流经它们的流量。我们还与谷歌合作推出了 Grafeas，这有助于在部署和使用容器时保护容器周围的代码供应链。”

IBM 的工作还专注于让 Kubernetes 更容易使用，这样 DevOps 就不会被如此复杂的系统所垄断。Berg 写道:“虽然使用 Kubernetes 构建基于容器的解决方案仍有一个学习曲线，但我们正在 IBM 内部以及与社区合作开发工具和功能，以使在 Kubernetes 中开发应用程序变得更容易，而不必成为 Kubernetes 专家。”。

在所有这些服务的背后，是对一套统一流程的需求。公司内部投资微服务的各种团队需要开放的沟通渠道，并且需要以无法回避或避免的方式实现。这是一项事业，是关于将人类行为编码到自动化、部署和开发管道中。

[Nginx](https://www.linkedin.com/in/cstetson/)的首席架构师兼微服务工程高级总监 Chris Stetson 说，“在如何进行应用程序开发方面，你必须改变你的想法。我们最近一直在做的事情之一是创建统一的开发和部署流程，让您的应用程序开发人员在应用程序的 Docker 版本中工作，并在 Docker 环境中进行编码和测试，这非常接近我们最终为客户部署的环境。Stetson 说:“建立这样一个过程，让开发人员可以很容易地开始，这是非常有价值的。

Stetson 说 Nginx 已经实现了一个几乎古老但同样有效的解决方案来解决这个问题。“我们使用 makefile，我们一直在大量使用 makefile 来封装我们放在一起的更复杂的 Docker compose 命令，以便为我们的前端开发人员创建一个构建目标，使他们能够进行 Webpack 前端开发。他们正在连接回他们需要的所有服务，动态地重新加载他们正在处理的更改，我们喜欢使用 Makefile，因为它本质上就像声明性的 Bash 脚本，”Stetson 说。

阅读本微服务系列的下一篇文章:[用分阶段方法为微服务做好准备](https://thenewstack.io/get-ready-for-microservices-with-a-phased-approach/)

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>