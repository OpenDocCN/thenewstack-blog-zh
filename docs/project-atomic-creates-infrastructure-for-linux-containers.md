# Project Atomic 为 Linux 容器创建基础设施

> 原文：<https://thenewstack.io/project-atomic-creates-infrastructure-for-linux-containers/>

Project Atomic 是一个容器优化的极简操作系统。同样明显的是，公司需要考虑如何更新服务器。我们欢迎关于开源技术的故事，解释它们是如何工作的。虽然是 Red Hat 发起的，但 Project Atomic 的源代码可以在 GitHub 上获得。请联系

[The New Stack](mailto:info@thenewstack.io)

了解更多关于为开源项目的新堆栈做贡献的信息。

Atomic 项目的启动是为了响应 Docker 技术的广泛应用。它填补了目前可用的基础设施和运行 Linux 容器所需的基础设施之间的空白。

我确信你们中的一些人可能会想，“为什么我们需要一种不同的基础设施来运行容器？”要回答这个问题，您需要了解一点容器技术，以及容器如何改变应用程序的部署方式。

由于[智能手机](http://www.telegraph.co.uk/technology/mobile-phones/11287659/Quarter-of-the-world-will-be-using-smartphones-in-2016.html)、平板电脑和支持互联网的设备的快速崛起，应用程序现在需要根据需求进行扩展，而不是 100%运行，没有停机时间。此外，还需要降低成本，以更高的灵活性进行开发和创新，并更快地部署应用程序(从开发到生产)。如果您已经尝试用您的应用程序来实现这些目标，那么您很有可能已经遇到了微服务架构和[面向服务架构](https://en.wikipedia.org/wiki/Service-oriented_architecture) (SOA)的想法。

SOA 和微服务并不是新概念。然而，与过去相比，Linux 容器和 Docker 技术使得它们的实现更加现实。Docker 让 Linux 容器变得易于运行，这要归功于它。另一个重要因素是私有云和公共云基础设施的可用性和可靠性的提高。云基础架构被设计为具有 100%的正常运行时间。这并不意味着基础设施中使用的组件不会出现故障。相反，整个系统被设计成在不停机的情况下处理故障。这种设计还提供了在不停机的情况下更新或升级基础架构的灵活性。

Linux 容器是实现微服务的好方法。Linux 容器是独立运行的，所以当一个应用程序被打包成一个容器时，它就是一个独立的实体。容器在运行时不依赖于基础操作系统。与虚拟机相比，容器通常需要更少的资源来运行，具有更快的启动时间，并且同样具有可移植性。同一个容器可以由开发团队构建和打包，并且可以直接通过测试然后生产。这些属性使得容器非常适合与云平台和微服务一起使用。

然而，Linux 容器也带来了一系列新的挑战，特别是:

*   基础设施现在必须能够水平扩展，并且应该专门为运行容器而优化。
*   容器的编排和生命周期管理需要工具。
*   部署和管理多容器应用程序应该很容易——而不会因此而失眠。
*   安全性是所有应用程序和基础架构的关键问题。Docker 利用了 Linux 内核提供的名称空间和功能。虽然这些特性在同一主机上的容器之间以及主机和容器之间提供了某种程度的隔离，但它并不完美。一个合适的容器基础设施需要带来额外的特性，比如安全性增强的 Linux ( [SELinux](https://en.wikipedia.org/wiki/Security-Enhanced_Linux) )，它可以在容器和主机之间提供一个类似虚拟机的隔离环境。
*   当我们在容器内部运行应用程序时，运行时依赖关系从主机转移到容器。主机操作系统只需要为 Linux 容器技术提供运行时。这极大地改变了主机操作系统的角色。这给了我们一个机会，让我们再看一眼基本操作系统。

为了应对运行容器的挑战，我们需要一个新的基础设施。这种新基础设施的基本构件是操作系统。[项目原子](http://www.projectatomic.io/)的诞生就是为了解决这个问题。

## 对为容器环境设计的操作系统的期望

操作系统应该是轻量级的，并针对云和非云环境进行了优化。操作系统需要能够作为服务来使用。这是一个重要的设计考虑因素。为了将操作系统部署为服务，操作系统必须在所有环境中保持一致(即，每次产生新的操作系统实例时)。典型的 web 级环境需要数千个相同操作系统的实例。对于传统的操作系统来说，在成百上千个安装之间保持一致的环境并不容易。一个关键挑战是确保所有实例都运行相同版本的操作系统，并始终确保应用程序在升级或更新(例如，安全更新)后不会中断。所有系统都应用相同的更新也很重要。为了解决这个问题，我们需要一个更新是原子性的操作系统(要么全部应用，要么不应用)，并且它尽可能是只读的，以避免意外的定制配置。

考虑到一致性，操作系统也可以针对 Linux 容器进行优化。操作系统可以削减到核心，消除所有未使用的软件包。拥有包含少量软件包的最小操作系统还可以提高基本操作系统的可维护性，因为系统管理员需要跟踪的软件包更少了。软件包数量的减少也减少了安全问题，因为操作系统中没有不必要的代码。

这些问题产生了原子工程。

首先，认识到 Project Atomic 不是一个新的 GNU/Linux 发行版是很重要的。相反，它是一个从 Red Hat Enterprise Linux、CentOS 或 Fedora 创建轻量级和最小化操作系统的框架。这个想法是从现有的、经过验证的和可信的包中派生出一个新的操作系统，而不需要创建一个新的发行版，该发行版需要一整套新的测试才能被信任。新操作系统在创建时被称为 Red Hat Enterprise Linux/CentOS/Fedora Atomic host。这种新的操作系统可以继承底层发行版的关键特性，例如对 SELinux 和 systemd 的支持，这种支持被嵌入到 Red Hat Enterprise Linux/CentOS/Fedora 中。

原子主机没有提供一些东西:

1.  YUM 命令(例如 install)在原子主机中不起作用。
2.  Red Hat Enterprise/CentOS/Fedora 的官方原子主机映像中可能缺少您最喜欢的工具或 RPM 包，因为它只有一个最小的包集。

原子主机由以下组件组成:

### RPM-奥斯特里

这是从 [Gnome OSTree 项目](https://wiki.gnome.org/Projects/OSTree)中派生出来的。RPM-OSTree 提供了一种完全原子化的操作系统升级和回滚机制。它的工作方式类似于您所期望的 Git 在操作系统层面上的工作方式。用一个命令升级整个操作系统，用另一个命令完全恢复到以前的版本。

RPM-OSTree 使文件系统不可变——即只读——除了 **/var** 和 **/etc** 。 **/var** 不是只读的，因为 Docker 图像将存储在那里。 **/etc** 将有配置文件，需要修改才能使编排工具工作。但是，对 **/etc** 所做的任何更改都会在升级过程中通过三路合并向前传播。只读特性确保所有原子主机都有相同的软件包集，这反过来提供了原子主机的多个安装之间非常需要的一致性。所有数据(如 **/var** 中的容器)在升级前后保持不变。

RPM-OSTree 让我们在更新操作系统时更有信心，因为我们知道可靠的回滚系统总是可用的。而且，不会有任何中途升级的系统，因为升级本质上是原子性的。

### 码头工人

Atomic Host 有内置的 Docker 运行时，所以只要登录 Atomic Host 就可以运行 Docker 容器。

### 库伯内特斯

这是一个开源项目，用于管理跨多个主机的容器化应用程序。它给出了容器化应用程序的部署、维护和扩展的基本机制。

### 原子命令行(/usr/bin/atomic)

原子命令的目标是为系统提供一个高级的、一致的入口点，并填补 Linux 容器实现中的空白。它使用与 Docker 容器相关联的元数据。

这里有几个原子命令的例子:

*   **原子运行 http** 获取标签**运行**及其所有命令行细节并执行它们。
*   **atomic install foo** 可以安装一个包含所需 systemd 单元文件的容器，将其作为服务运行。

atomic 命令在非原子平台上也可用。你可以在标准的 RHEL、Fedora 和 CentOS 上运行它。有关详细信息，请参考“介绍原子命令”

### 战场

Cockpit 是一个服务器管理器，用于通过 web 浏览器管理 Linux 服务器。它旨在管理多台服务器。现在支持 Docker 和 Kubernetes，未来还会支持 Nulecule 和 Atomic App。

### 超级特权集装箱(SPC)

如前所述，原子主机的思想是创建一个最小的操作系统，并将其他所有东西作为 Linux 容器来运输。从抽象角度来看，这是有意义的。然而，有时我们需要专门的工具来调试或监控问题，因此我们需要将它们作为容器运送。这些容器需要更多的特权——并且安全性被拒绝——以便它们可以按预期工作。

SPC 是一个在关闭安全性(特权)的情况下运行的容器，它将主机 OS 的一个或多个名称空间关闭到容器中。这意味着它会暴露给更多的主机操作系统。在“[介绍超级特权容器概念](http://developerblog.redhat.com/2014/11/06/introducing-a-super-privileged-container-concept/)”中提供了更多详细信息

### 核裂变和原子化学

此外，原子主机支持多容器应用程序的规范和系统工具:

[Nulecule](https://github.com/projectatomic/nulecule) 是一个规范，它定义了打包复杂的多容器应用程序的模式和模型。它在一个容器映像中引用它们的所有依赖项，包括编排元数据，用于构建、部署、监控和主动管理。

根据 GitHub 的说法， [Atomicapp](https://github.com/projectatomic/atomicapp) 是 Nulecule 规范的参考实现。它可以用来引导容器应用程序，并安装和运行它们。Atomicapp 被设计为在容器上下文中运行。

Lalatendu Mohanty 是 Red Hat 的高级软件工程师，Red Hat 是新堆栈的赞助商。Docker 也是 TNS 的赞助商。

特征图片:[罗伯特·库斯-贝克](https://www.flickr.com/photos/29233640@N07/)的[回旋](https://www.flickr.com/photos/29233640@N07/6781174568/in/photolist-91gdyR-bkehWU-dPoPnW-dF3Mqx-puYeqm-62Jyvo-qaDbmt-gykRC-gykLx-gykNq)由 2.0 在 [CC 下授权。](https://creativecommons.org/licenses/by/2.0/)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>