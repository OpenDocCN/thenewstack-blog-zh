# 借助 Chef InSpec 2.0 超越基础设施测试的限制

> 原文：<https://thenewstack.io/moving-beyond-limits-infrastructure-testing-inspec-2-0/>

[](https://www.chef.io/)

 [张秀坤·里希特

张秀坤是一位创始人、产品负责人和工程经理，他共同创建了 InSpec、Chef Compliance 和 dev-sec.io 项目。他的公司 VulcanoSec 被 Chef Software 收购，负责推动其安全性和合规性解决方案。他在工程、黑客和领导成功团队方面有 15 年的经验。](https://www.chef.io/) [](https://www.chef.io/)

随着 InSpec 2.0 的发布，InSpec 刚刚迎来了它的下一次重大升级[。作为一个开放源码项目，经过两年多的时间和上一个主要版本发布一年后，它在范围、稳定性和社区方面都有了相当大的发展。](https://thenewstack.io/chef-bulks-security-compliance-automation-cloud/)

自 InSpec 1.0 以来，该版本增加了 30 多项新资源、重大性能改进、错误修复和稳定性。然而，亚马逊网络服务和 Azure 支持看似无辜的添加指向了 InSpec 本身基础的重大转变。

在本文中，我们将了解操作系统(OS)和服务器测试的开端，以及 InSpec 如何从简单的节点验证扩展到覆盖整个计算设备的承诺。InSpec 2.0 悄悄地打开了自动化和安全测试新世界的大门，它统一了不同的系统，并将它们暴露在您的指尖。

## 操作系统培训

InSpec 的灵感来自于服务器测试框架 Serverspec。因此，它非常适合测试操作系统和节点配置和服务。

InSpec 建立在 train 之上，即传输接口——一种与本地和远程操作系统对话的 API。Train 允许 InSpec 提供资源，而无需处理操作系统检测和处理的所有细节。

## 超越操作系统

当我们第一次在更大的真实世界用例中部署 InSpec 时，我们开始注意到对数据库和 API 端点的测试。虽然 InSpec 本身并没有阻止我们添加这些，但它导致了一些我们无法解决的缺点:

1.  概要文件将报告他们运行的操作系统，而不是他们正在验证的组件。例如，您将测试一个 AWS API，但是报告将指出测试在 RedHat Linux 机器的节点`xyz`上运行。我们希望 InSpec 报告实际的目标，而不是当前的执行环境。
2.  为 API 编写的概要文件不能测试它们是否针对正确的系统。例如，一个配置文件可以表明它只支持 Windows Server 2012R2，不会在 Linux 上运行。嵌入在代码中的 API 端点不允许这些检查运行。
3.  资源无法表明它们是为基于 API 的目标编写的。例如，一个`aws_iam_role`将只在 AWS 上工作。为了在执行概要文件之前验证这一点，我们需要知道用户想要测试 AWS。

我们可以轻松地在这里停下来，决定创建另一个工具来测试 API 端点。最终，我们决定不这样做，因为我们看到 InSpec 开始测试完整的基础设施，我们意识到我们没有达到这个目标。

当然，一个简单的补救方法也可以是在 InSpec 的当前执行层中加入 Frankenstein API 支持。然而，这个想法在早期讨论中引起的混乱很快决定了它的命运。

## InSpec 2.0 中的平台支持

我们决定将 InSpec 的视野从操作系统扩展到更广泛的平台。在这个模型中，操作系统构成了目标的一个分支。API 端点是另一种，专门用于低级套接字(TCP/UDP)、中级目标(HTTP/REST)和高级 API(AWS、Azure)。在这种模式中，很容易支持到数据库和网络设备的远程连接。

随着 InSpec 2.0 的发布，我们这个奇妙的团队和社区终于达到了它的崇高目标。酝酿了一年的 [RFC](https://github.com/chef/inspec/issues/1661) 终于迎来了实施。InSpec 现已向操作系统之外的所有其他组件开放了基础设施设备的全栈测试。

这一版本不仅增加了 AWS 和 Azure 支持，还使我们能够轻松地使用其他组件来扩展这一框架，以适应您的计算设备的不断发展。

## 检查更新稳定性

InSpec 的 2.0 版本也展示了我们更新理念的一个重要方面。我们的目标是将重大变更的数量保持在最低，并尽可能容易地升级到另一个主要版本。这可能看起来像是一个巨大的更新，但如果你一直在定期升级，它真的不是。

通过使用前滚方法，我们在开发过程中对稳定的 1.x 代码库引入了大多数 2.0 更改，而没有破坏兼容性。所有突破性的变化已被收集在一个单独的问题，主要是在形式上的反对，将被删除的升级。如果您今天运行 InSpec 时没有任何反对警告，那么您可以安全地继续前进。

非常感谢推动 InSpec 发布的团队和整个社区！我很期待这个项目的未来。

厨师是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>