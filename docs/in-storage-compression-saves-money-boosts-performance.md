# 存储内压缩节省了资金，提高了性能

> 原文：<https://thenewstack.io/in-storage-compression-saves-money-boosts-performance/>

[](https://www.linkedin.com/in/tong-zhang-2451607/)

 [张彤

张彤博士是一位在数据存储系统和 VLSI 信号处理领域做出重大贡献的知名研究员。张博士是 ScaleFlux 的联合创始人兼首席科学家，负责开发计算存储产品的关键技术和算法，并探索其在数据库等主流应用领域的优化使用。他目前是伦斯勒理工学院(RPI)的教授。他目前和过去的研究跨越了广泛的领域，包括数据库、文件系统、固态和磁性数据存储设备和系统、数字信号处理和通信、纠错编码、VLSI 架构和计算机架构。](https://www.linkedin.com/in/tong-zhang-2451607/) [](https://www.linkedin.com/in/tong-zhang-2451607/)

存储内透明压缩为企业带来的好处远远超出了人们的预期。通过将压缩直接透明地构建到存储驱动器中，企业以更低的成本体验到增强的性能，并且没有采用障碍，但故事并未就此结束。对于那些希望通过试验和对其数据管理软件进行更改来更进一步的人来说，进一步提高性能的潜力是无限的。

在我们深入研究什么是可能的之前，让我们看看这项技术是如何产生的，以及更广为人知的好处。

在透明压缩之前，存储驱动器仅充当存储数据的物理设备。没有处理、压缩或解压缩:如果您在一个设备上存储 2TB 的数据，它将占用 2TB 的物理空间。这就是当今固态存储驱动器(SSD)的工作原理。只有计算存储驱动器(CSD)能够压缩(和解压缩)数据量，以便占用更少的空间。例如，如果用户将 2TB 的数据写入 CSD，压缩后可能只占用 500GB 的物理空间。

存储透明压缩是开始 CSD 商业化之旅的最佳选择，原因有二。

## **存储内透明压缩的主要优势**

首先，没有采用障碍:用户只需即插即用就能体验更低的成本和更高的性能。这是可能的，因为存储内透明压缩不需要对现有存储 I/O 软件堆栈(例如文件系统、数据块层或驱动程序)或 I/O 接口协议(例如 NVMe、SATA)进行任何更改。这确保了它与现有基础设施的无缝集成和部署，而无需用户应用程序更改一行代码。

其次，它提供了无价的好处。除了其非常广泛的适用性，无损数据压缩(例如众所周知的 LZ77 及其变体，如 lz4、zlib 和 ZSTD)涉及大量的随机数据访问，这不可避免地会导致非常高的 CPU/GPU 缓存缺失率。这导致 CPU/GPU 硬件利用效率非常低。出于这个原因，非常需要存储内透明压缩来减轻主机 CPU/GPU 执行无损数据压缩的负担。

## **什么是可能的:巨大的创新潜力**

乍一看，人们可能会认为这就是存储内透明压缩的全部好处，但这远远不是全部。除了显而易见的成本和 IOPS 津贴，透明压缩打开了一扇令人兴奋的系统级创新机会的大门，这些机会在很大程度上仍未被探索。

这种探索的缺乏是因为在过去的四十年中，数据管理软件基础架构的构建受制于固定大小的块 I/O 约束。但是，虚拟可变大小块 I/O(通过存储内透明压缩实现)的到来为重新思考数据管理软件的设计和实施带来了独特的机会。

## **案例研究:PostgreSQL**

让我们研究一下存储内透明压缩如何让使用最广泛的关系数据库之一 PostgreSQL 受益。

该数据库应用 B+树索引来管理其数据存储，默认 B+树页面大小为 8KB，通过将所有行版本存储在表空间中来实现多版本并发控制(MVCC)。因此，PostgreSQL 首先将新的行版本存储在新的位置，并依靠后台真空处理来回收死行版本所占用的空间，而不是直接更新一个 B+树页面中的行。

因此，更新操作的每秒事务数(TPS)性能在很大程度上取决于 PostgreSQL 是否能将新行版本存储在旧行版本所在的页面中。

当 PostgreSQL 运行在普通的 SSD 或 HDD 上时，不管一页的用户数据有多满，它总是会消耗 8KB 的物理存储空间。这导致了由填充因子(PostgreSQL 中可由用户调整的参数)配置的 TPS 性能与存储成本之间的明显权衡。

存储内透明压缩在存在 4KB 数据块 I/O 接口的情况下，支持虚拟可变大小的数据块 I/O。换句话说，当 PostgreSQL 在内置透明压缩的存储驱动器上运行时，用户数据在一个页面中的填充程度直接决定了该页面所占用的物理存储空间量。

这将 PostgreSQL 从 TPS 性能与存储成本的权衡中解放出来:当我们降低填充因子的值以便在每个页面中为将来的更新留出更多空间时，物理存储的使用不会成比例地增加。通过支持虚拟可变大小的块 I/O，存储内透明压缩允许 PostgreSQL 大幅降低填充因子，从而提高 TPS 性能，而不牺牲物理存储成本。

这只是存储内透明压缩如何使一个数据库受益的一个例子，但是还存在更多的可能性，有待进一步探索。

随着存储内透明压缩的出现，对于数据库来说，现在是试验可能性的最佳时机。除了成本和 IOPS 优势之外，用户还能够在性能方面取得前所未有的进步，这在以前是不可能的。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>