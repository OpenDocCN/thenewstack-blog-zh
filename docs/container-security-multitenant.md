# 多租户环境中的容器安全性

> 原文：<https://thenewstack.io/container-security-multitenant/>

在让这个怪异、疯狂的分布式容器化应用程序世界与大多数企业所依赖的虚拟化基础设施兼容的竞赛中，可能没有哪个项目比 [Kata Containers](https://thenewstack.io/kata-containers-secure-lightweight-virtual-machines-container-environments/) 取得的进展更大。作为 Hyper.sh 项目和英特尔 Clear Containers 的合作产品，Kata 旨在将单个容器与虚拟机管理程序配对，创建与第一代虚拟化典型硬件的直接链接，并将主机 Linux 内核相互隔离。

一些人认为，这些架构可能会使许多为集装箱化环境设计的更激进的安全系统变得不必要或多余。但是在与[新堆栈制造商](https://thenewstack.io/podcasts/makers)播客的对话中， [Aqua Security](https://www.aquasec.com/) 联合创始人兼首席技术官 [Amir Jerbi](https://www.aquasec.com/about-us/management-team/) 告诉我们，他认为即使是 gVisor 和 Kata 引入的进程隔离模式也会带来一些安全挑战。他建议，尝试在多租户环境中编排一个具有隔离实例的微服务环境，看看会发生什么。

“集装箱的挑战之一是多租户，”Jerbi 说。他说，在一个典型的容器化环境中，你仍然有一个容器利用一个主机 Linux 内核的理论上的可行性，从而利用这个利用来影响共享那个主机的任何其他容器。他承认，Kata 将通过“添加一个处理共享内核和多租户挑战的层”来消除这个问题。通过创建每个容器一个内核，对内核的利用不会影响同一台机器上运行的其他容器。”

但是更大的应用程序安全问题，他继续说，对任何试图最小化应用程序的攻击服务的人来说都是挑战。“不一定是内核漏洞，对吧？它可能是一个错误的应用程序逻辑，允许某人访问您的容器和数据。如果发生类似的事情，Aqua 将会控制并降低风险。”

Jerbi 承认，解决基础设施安全问题是有好处的。但在类似于 SDN 将控制平面与用户平面分离的模式中，容器隔离将安全问题分为基础设施平面和应用程序平面。这意味着应用程序行为问题现在可以单独解决，但也意味着它们可能需要紧急解决，因为这种隔离的多租户服务在生产中的行为方式在很大程度上仍未探索，更不用说解决了。

斯科特·富尔顿:大家好，我是斯科特·富尔顿。这是新的栈制造者，他们让分布式应用安全为你工作。这个版本的 Makers 是 Kubernetes orchestrator 上新的 Stack 正在进行的电子书系列的第二本书。它的标题是 Kubernetes Deployment&Security Patterns，这个版本的赞助商是 Aqua Security，它是 Aqua Container 安全平台的开发者，该平台用于评估和规范分布式应用程序的行为。立即在 Aqua Security 的网站上注册，访问 Forrester Research 的最新分析报告《保护软件容器的十个基本步骤》,了解容器和虚拟机之间的主要行为差异。是 AquaSec，A-Q-U-A-S-E-C.com。

**斯科特·富尔顿:**你以前听过我问这个问题，但现在它变得更加重要了。在像 Kubernetes 这样的分布式环境中，我们是否对单个容器的行为有足够的了解，从而对什么是正常的、什么是不正常的做出可靠的判断？如果我们这样做了，我们可以训练一个分析系统来识别这样一个应用程序何时做了一些不寻常的事情。所以，我们可以决定什么时候它在做危害安全的事情。

**Scott Fulton:** 有了防火墙，我们可以编写规则来切断对网络资源的访问，直到我们确定了请求的来源和目的。在分布式环境中，托管的容器已经共享相同的 Linux 内核，我们没有机会切断已经可用的内容。我们不能像在 web 应用程序中那样假定默认的不信任状态。

斯科特·富尔顿:阿米尔·杰比是 Aqua Security 的联合创始人兼首席技术官。他告诉我们，在实践中，即使在最分散的 Kubernetes 环境中，这些应用程序也倾向于落入一个相当谨慎的模式。我们可能不需要人工智能，当然也不需要心灵感应来识别这种模式。但是，随着容器化环境向多租户发展，随着数据中心本身采用新的形式和架构，我们能相信这些模式会按预期发展吗？

斯科特·富尔顿:几天前，我和阿米尔·杰比谈过话。Aqua Security 的联合创始人兼首席技术官阿米尔·杰尔比(Amir Jerbi)。阿米尔，你好。你好吗

阿米尔·杰尔比:嗨。早上好。我很好。我很好。

斯科特·富尔顿:你现在是傍晚，对吗？

**Scott Fulton:** 当新的 Stack 要进行一次关于集装箱安全的讨论时，很多次他们都把我从樟脑丸里拽出来谈论这个话题。所以，我们的许多听众以前听过我讨论这些事情，关于什么是容器安全，容器安全的发展是什么，如果我们不太谨慎，我可能会谈论这个话题。但是 Aqua Security 专门讨论了运行时容器安全性。他们使用那个术语，我经常从你和网站上看到。容器空间中有许多被称为“运行时”的组件。

### 探索运行时安全性

**Scott Fulton:** 那么，当 Aqua Security 谈到运行时安全性时，你指的是平台的哪一部分？尤其是当它涉及到像 OpenShift 这样的东西时。

阿米尔·杰尔比:是的。所以，当我们看应用程序时，对吗？您的 OpenShift 环境中运行着一个应用程序。因为这是一个瘦应用程序，对吗？它是一个容器，通常被重构为微服务，然后你实际上可以准确地识别这个应用程序在做什么。您可以分析网络活动。您可以分析文件访问。您可以分析正在运行的进程。甚至是应用程序模拟的用户。因此，当我们谈论运行时潜力时，我们实际上是在谈论查看所有这些活动向量，创建正常活动的配置文件，然后如果我们发现异常情况，我们可以提醒您。我们可以告诉你，“嘿，你的应用程序现在正在访问一个它以前没有访问过的网络，”或者我们甚至可以阻止这种情况发生。因此，我们可以阻止进程、阻止文件访问等等。

**Scott Fulton:** 就分析应用程序的行为而言，尤其是使用 Kubernetes 时，我被告知微服务应用程序的特征很容易随着时间的推移而变化和发展。你如何将这些配置文件的进化考虑在内，以便你的系统能够理解什么时候进化看起来正常，什么时候进化看起来不正常？

**Amir Jerbi:** 所以，当我们看容器时，它们有一些非常独特的属性。它们在运行时不会改变，对吗？因此，当我们谈到容器时，它们通常是不可变的，如果发生变化，它是基于一个非常明确的过程，该过程由开发人员启动，创建一个新版本的图像。假设您在生产环境中部署了版本 1。现在，你想改变什么。方法就是去找开发商，要求改变。开发人员将创建一个新的调用，将它打包，将它发送到注册中心，然后生产，然后您将拥有该应用程序的第二个版本，对吗？

Amir Jerbi: 现在，它们可以在同一个集群上共存。你可以滚动升级，从第一版升级到第二版，没关系。但事实是，改变是一个定义明确的过程。现在，如果在 Aqua，当我们分析一个应用程序时，我们确切地知道我们分析的应用程序的版本，并且我们搜索该特定版本的配置文件的异常行为。当我们看到有一个新版本时，就像我说的，一个来自明确定义的过程的新变化，我们知道如何重新配置，或者让应用程序进入我们再次学习的阶段。这一次实际上是快速学习，因为我们已经处于前一版本的良好基线。我们了解新版本的变化，然后锁定。我们在新版本上应用概要文件。

**阿米尔·杰尔比:**所以，当你想一想，因为一切都是一个明确定义的过程，意想不到的事情不会发生。如果发生这种情况，如果您的应用程序突然表现不一样，这意味着，您知道，有东西坏了。这意味着，很可能，有人能够侵入你的应用程序，现在正在做一些不是该应用程序的原始行为的一部分。

**Scott Fulton:** 那么，在这种情况下，对行为的学习是否可以称为机器学习，作为一种人工智能过程？或者有没有更明确的逻辑、直接和自动化的东西呢？

阿米尔·杰比:出...我们称之为侧写。创建配置文件是为了知道何时停止记录，基本上，因为您可以监视网络文件、进程的活动，您可以这样做...多久了？几天，几个月。对吗？那么，你什么时候开始录音？什么时候你决定，“好的，我已经学得足够多了，现在我已经有了一个涵盖我的应用程序的所有流程的良好配置文件？”这就是我们产品的机器学习功能。我们所做的是，对应用程序的所有不同行为进行分类，直到我们决定，“好的，我们已经涵盖了所有可能的情况。应用程序所做的一切。”这是我们决定的点，“好吧，让我们停止记录，让我们开始执行我们已经记录的配置文件。”

Scott Fulton: 安全领域的许多人倾向于使用让他们听起来像罗伯特·陆德伦小说主题的短语。其中之一是攻击面。你或许可以写一部小说，用《攻击表面》这个名字出版，它可能会自动登上《纽约时报》的畅销书排行榜。但是我想知道，在一个不断变化的微服务环境中，我认为很难分离出表面是什么。

### 微服务和安全性

斯科特·富尔顿:对我来说，表面意味着一种坚固。正如之前向我解释和演示的那样，微服务是一个非常灵活的概念。不仅仅是上下的快速可伸缩性，还有工作流的快速分布和发展。那么，在尝试保护微服务应用程序方面，Aqua Security 能否将攻击面思想应用于此？

**阿米尔·杰尔比:**是的，可以。所以，微服务...在容器内部运行的应用程序，或微服务，它们在攻击面方面与常规应用程序没有什么不同，对吗？所以，你还是有弱点，对吧？您的应用程序中有许多开源代码，其中一些开源代码已经过时，存在众所周知的漏洞。你仍然有你的网络安全问题，对不对？您的应用程序可能暴露在互联网上，甚至可能不使用任何密码进行配置，因此匿名标识是可用的，并且您仍然有您的应用程序不检查输入验证的不良应用程序逻辑，对吗？应用程序不检查 SSN 证书。

**Amir Jerbi:** 所以，所有这些也存在于容器和微服务中。和常规应用没什么区别。唯一的区别是你的代码更少。这是一个微服务。它是你整个应用程序的一小部分，这意味着它的漏洞更少。尽管如此，还是有漏洞，但可能在数量上有所减少。在 Aqua，当我们看到这一点时，当我们看到攻击面时，我们实际上试图解决常规应用程序存在的相同问题。我提到的所有这些问题。

**阿米尔杰尔比:**不同的是，因为洞少，网络跨度更小。应用前景更小。他们称之为表面模型。漏洞比较少。那里没有成熟的操作系统。用户没有登录微服务，所以攻击面，顾名思义，要小一些。因此，我们所看到的，实际上是一个机会，因为一旦您能够解决这些问题，阻止这个小型微服务的攻击面，并且您在所有微服务上一致地这样做，那么您实际上阻止了整个应用程序的攻击面。对吗？

**Amir Jerbi:** 因此，我们认为这是在更小的部分上实现安全性的巨大机会，但是您的整个应用程序的结果，即影响，是相当大的。

Scott Fulton: 这个想法很吸引我，本质上，即使你谈论的是一个在运行时环境中寿命短暂的组件，它的出现和闪现就像是总统竞选中的一个好主意，你也可以应用与你所说的基本相同的逻辑。你可以寻找你知道的行为，甚至当某样东西的寿命有限时，你知道它的行为应该是什么。

**阿米尔·杰尔比:**正是。事实上，容器是短暂的...因此，容器有许多属性，允许您拥有比以前更好的安全环境，您知道，使用主机。事实上，容器是短暂的，这意味着，即使有攻击，即使有人能够进入你的应用程序，一致性将是一个问题，对不对？因为集装箱可能在几小时或几天后就不在了。因此，即使你受到攻击，几天后有人会刷新容器，黑客就会消失。导致违规的代码或违规的结果将不复存在。

**阿米尔·杰尔比:**因此，有许多属性可以使 container 更加安全，这将使您拥有比以前更高的安全性，这是 Aqua 等安全公司实际利用的东西，对吗？当我们看到容器长时间没有刷新时，我们可以通知并告诉您，“嘿，您的容器运行了太长时间，如果它被破坏了，那么也许通过刷新它，您可以消除攻击。”因此，当我们查看攻击面和运行时间时，不仅我们可以防止这些攻击的发生，而且容器本身的一些属性也会造成攻击...管理攻击要复杂得多。

**Scott Fulton:** 您可能已经关注了容器架构的一些发展，特别是最近由 Content Containers Coalition 等设计小组所做的工作，他们正在研究一种创建容器安全性的方法，将每个容器包装在一个相当小的虚拟机中，使虚拟机能够像第一代虚拟机绑定到虚拟机管理程序那样绑定到虚拟机管理程序，他们对 Kubernetes 运行时做了非常小的更改，以便 it 知道如何有效地协调这些小虚拟机。当人们与我谈论这种架构时，他们说，通过将容器与虚拟机管理程序重新集成，他们正在消除他们所说的 Kubernetes 的固有漏洞，或者说，攻击面中的固有漏洞。我认为如果有这样一个固有的漏洞，你在 Aqua Security 应该已经看到了。他们说的有道理吗？

阿米尔·杰尔比:有两个问题。因此，容器的挑战之一是多租户。对吗？如果您想运行一船来自不同安全级别的不同应用程序，您会遇到一个挑战，因为那些应用程序、那些容器将在一个共享内核上运行。如果你有一个问题，你有一个内核漏洞，那么基本上这意味着什么，这意味着一个容器将能够利用这个漏洞，并影响在同一台机器上运行的其他租户。

**Amir Jerbi:** 如果你将它与虚拟机进行比较，你就不会有这个问题，因为每个虚拟机都有自己的内核，一个内核中的漏洞不会影响运行在同一虚拟机管理程序上的其他虚拟机。因此，当我们看到 Kata Containers 等解决方案时，他们试图添加一个层，通过为每个容器创建一个内核来应对共享内核和多租户挑战。基本上，内核漏洞不会影响同一台机器上运行的其他容器。

**Amir Jerbi:** 所以，当你想到它的时候，它是整个容器隔离的一部分。在 Aqua，我们把它视为基础架构的一部分，对吗？基础设施应该给你提供非常好的隔离环境。你知道吗？集装箱之间不应该有任何泄漏。这就是我们现在与社区紧密合作的事情，所以有了像 Kata 容器这样的解决方案，以确保确实如此。

**Amir Jerbi:** 另一方面，你知道，它允许你做什么，它允许你现在更专注于你的应用安全。现在，您有了一个虚拟机管理程序，或者有了 Kata 容器，现在您有了一个隔离的环境和一个专用的内核，您可以专注于应用程序的安全性，确保您在容器内运行的应用程序将有一个最小的攻击面，如果出现问题，不一定是内核漏洞，对吗？它可能是一个错误的应用程序逻辑，允许某人访问您的容器和数据。因此，如果发生类似的事情，Aqua 将在这里控制并降低风险。

**Amir Jerbi:** 我们实际上看到了容器之间非常好的隔离的良好组合，您可以使用 gVisor 或 Kata 容器或 second profiles 来实现，有许多方法可以实现这种级别的隔离，一旦实现，您就可以专注于您的应用程序安全性。

**Scott Fulton:** 因此，你认为像 Kata Containers 这样的解决方案可以解决基础设施问题，这只会有所帮助，但它并没有真正改变 Aqua Security 提供的东西，除了它可能使你能够更清楚地关注应用程序安全性。

阿米尔·杰尔比:是的，就像我说的，有很多解决方案。例如 Windows，他们有 Hyper-V 容器，这几乎是相同的解决方案。它是每个容器一个内核。因此，当环境、当基础设施在容器之间具有更多隔离时，它实际上将允许 Aqua 对您的应用程序进行更好的控制。因为这样既可以实现与邻居的隔离，又可以为运行在容器内部的应用程序提供更好的安全性。因此，我们实际上将其视为一个改善安全性的巨大机会。

**Scott Fulton:** 让我们稍微改变一下焦点，因为我们一直在谈论机器、技术和非常非常没有人情味的东西。我喜欢人。在试图适应集装箱化新时代的组织中，规则正在改变，我们看到更多的是以 DevOps 为中心的组织。

### 组织中的中心开发

**Scott Fulton:** 尽管如此，在这些组织中仍有关于谁最终要对安全负责的讨论。监控和维护运行时的工作仍然是运营商的工作，还是我们，借用您以前多次使用的一个术语，稍微左移一点，成为 DevOps 争论的左边，并赋予开发人员比以前更多的安全责任？

Scott Fulton: 在我跟踪的组织中，我总是认为开发人员应该从一开始就承担更多的责任。真的不应该有向左的转变。但是，如果我们做到了这一点，我们是否有效地将责任转移到了他们所属的组织中心，在这种情况下，使开发人员和操作人员平等地参与安全中心的建设？

阿米尔·杰尔比:是的。你知道，当你看组织时，对，你看每个组织中开发人员的数量和信息安全专业人员的数量，你看到有一个平衡的问题，对吗？比信息安全人员多几倍的开发人员。另一方面，DevOps 和敏捷软件正变得比过去更快。我们看到一些组织一天多次部署到生产环境中。所以，如果你把它乘以开发人员的数量，你会得到一个安全团队的巨大瓶颈，对吗？

**Amir Jerbi:** 因此，传统上，安全团队是生产前的最后一道关口，但现在，如果一个小团队必须检查和批准一个非常大的团队的工件，那么当然，您会有延迟，并且您希望能够一天部署多次。因此，考虑到这一点，我们需要找到新的安全方法。你提到了左移。因此，通过左移方法，组织正在做的事情实际上是在查看管道。持续集成，持续交付管道，左边是开发人员构建代码，中间是代码的交付，右边是运行代码的生产。

**阿米尔·杰尔比:**所以，当你看到这条管道时，你想在整个管道中传播安全，在处理软件交付时增加许多关卡，在这种情况下，你会损失很少或一些安全检查。因此只有当人工制品具有足够的安全级别时，它才会通过门进入下一阶段。对吗？

**阿米尔·杰比:**通过这种方式，你可以做什么，你可以发挥杠杆作用。您可以利用您的开发人员，您可以发挥安全性，这样它就不会只是在最后一英里，它将被划分到整个过程中。我们还没到那一步，对吧？但是它在运动。我们看到一些公司正转向这种方式。我们看到一些公司采用流水线方法，在这些流程中，除了常规的质量和性能检查之外，还增加了这些安全门。

斯科特·富尔顿:这些门需要添加到程序观察的不同层次吗？换句话说，不同的自动化水平？或者，这些管道可以集成到他们已经拥有的 CI/CD 管道框架中吗？

阿米尔·杰尔比:是的。因此，人们肯定希望在现有的管道和工具上增加闸门。他们不想在新的门槛或新的定义上增加或制造一些摩擦。因此，通常我们看到的是，安全性被集成到组织中现有的三个步骤中。所以，在开发阶段，你让开发人员拿着代码，构建软件。在这个阶段，通常所做的事情是静态代码分析，运行一些单元测试。所以，已经有一些测试在开发阶段完成了。你可以给这些门增加安全测试。所以，我提到了静态代码分析，但是您也可以添加漏洞扫描，确保开发人员不会使用有漏洞的开源包。

阿米尔·杰尔比:下一个门是装运。所以，你的开发人员只是在软件通过了最初的关卡之后才发货，发货之后，代码进入一些健全性测试。性能测试。回归测试。夜间测试。重新计算周期。现在，您可以添加安全测试，实际分析应用程序，实际识别应用程序正在执行的操作，尝试映射网络文件、进程等的所有活动，并验证没有新的活动。对吗？所以，你可以在那里加一个门。

**阿米尔·杰尔比:**当你投入生产时，通常你会进行最后一英里的检查，你会测试软件是否得到各方的认可，你会测试软件是否没有任何非问题，任何高敏感度的错误。因此，在这一阶段，您还可以检查软件的完整性是否受到损害，并且由开发人员签名的确切软件就是您将进入生产环境的软件。

**阿米尔·杰尔比:**所以，通过在你现有的大门上增加额外的安全检查，你实际上可以自动化所有现有流程的安全。所以，这就是为什么我看到这一点，而不是试图增加更多的摩擦，更多的步骤，如果它会自然地集成到开发人员今天已经在做的事情中，那么你实际上可以以一种自然的方式利用安全性，你不会有任何摩擦。

**Scott Fulton:** 在剩下的几分钟时间里，我觉得您刚才描述的渠道涉及到了组织中的每个人，但您也说过，如今组织中的开发人员往往比信息安全专业人员多得多。如果是这样的话，如果您正在构建一个集成的管道，将安全性放在主要的交付管道中，而不是作为一种事后的想法，那么安全专业人员甚至需要被组织雇用吗？可以想象，多余的信息安全专业人员可以从一个组织中带走吗？

不，不，不，不，还没有。不。所以，当然，你需要安全专家。你需要具有特定安全专业知识的人来定义需要什么样的测试，定义那些门，定义什么是可接受的，什么是不可接受的。因此，在我看来，如果您考虑供应链、CI/CD 是如何构建的，安全专业人员的角色就是跨管道集成适当的安全自动化，对吗？确保有漏洞扫描，确保有分析，确保有完整性检查，对吗？

阿米尔·杰比:所以，这一切的造型和设计都是安全专家的手笔。然后还有反馈方面。所以，有些情况下，你知道，会有攻击。在您的生产环境中会发生一些事情。因此，您确实希望您的安全团队、意外响应团队对此次攻击进行第一次分析，或者对您的生产环境中发现的风险进行第一次分析。然后去做代表团，对吗？在需要的地方利用开发人员。

**Amir Jerbi:** 所以，如果攻击是基于漏洞，那么您的风险是基于在生产中发现的漏洞，那么您的安全团队可以进行评估并决定，“好的，我们需要立即修复它，”然后将工作委托给开发人员来创建新版本，以确保该版本没有漏洞，并将其推向生产。

**Amir Jerbi:** 如果攻击来自网络，那么您的安全专家可以进一步调整策略，以确保这种情况不会在未来发生。因此，当然，我们仍将安全专业人员视为组织整体安全的重要组成部分，但其角色将从实际工作人员的角色转变为能够委派和设计组织中安全程序的人员。

Scott Fulton: 听众在哪里可以找到更多关于 Aqua Security 的信息，或许还能在舞台上看到你和你的一些同事？或许在即将到来的会议上？

斯科特·富尔顿:然后去找那个戴酷酷帽子的人。Alex Williams 可能会找到你，并把麦克风放在你面前，问你更多的问题，特别是关于容器漏洞的演示。Aqua Security 的 Amir Jerbi，感谢您今天的参与。

阿米尔·杰尔比:谢谢。

斯科特·富尔顿:非常感谢。

阿米尔·杰尔比:这是我的荣幸。

**斯科特·富尔顿:**阿米尔·杰尔比是 Aqua Security 的联合创始人兼首席技术官。他在特拉维夫的公司总部接受了我们的采访。我们感谢 Amir 和他的工作人员对我们新的 Stack 电子书 Kubernetes Deployment &安全模式的支持。Aqua Security 可以在 A-Q-U-A-S-E-C.com 的 AquaSec 网站上找到。你可以在 TheNewStack.io/podcasts.的新堆栈中找到更多信息丰富和好奇的音频你可以在 iTunes 上给我们评分和评论，就像在 YouTube 上给我们评分和在 SoundCloud 上关注我们一样，但正如我的阿姨莎莉会说的那样，如果你偶尔在 TheNewStack.io 上回到我们身边，你会把我们逗乐死的。我们的播客制作人是 Kiran Oliver，我们的执行主编是 Joab Jackson，我们的编辑主任是 Libby Clark。让这台机器继续运转的女士是朱迪·威廉姆斯，让这一切堆积起来的男人是亚历克斯·威廉姆斯。我是斯科特·富尔顿。