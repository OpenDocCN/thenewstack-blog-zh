# 保护 Kubernetes 的秘密

> 原文：<https://thenewstack.io/the-secret-to-securing-kubernetes/>

[](https://www.linkedin.com/in/walshsec/)

[John m . Walsh](https://www.linkedin.com/in/walshsec/)

[John 作为 lord security 开发人员、产品经理和开源社区经理在 realm 任职超过 15 年，从事网络安全产品的工作，如魔术师、LDAP、防火墙、JAVA 密码、SSH 和 PrivX。他有一个妻子、两个孩子和大波士顿地区的一小块土地，这使他没有资格加入“骑士观察”，但他仍然是一名经验丰富的网络安全专业人士和开发人员。](https://www.linkedin.com/in/walshsec/)

[](https://www.linkedin.com/in/walshsec/)[](https://www.linkedin.com/in/walshsec/)

毫无疑问，容器已经正式成为主流。今天，四分之一的企业每年为这些技术投入超过 25 万美元。

仅仅六年前，Kubernetes 已经成为最流行和最强大的容器编排开源平台之一。它自动化了启动和停止支持应用程序的各种容器所需的许多过程，并自动在集群内的不同主机服务器之间分发容器，并平衡它们之间的负载。对于希望在本地、云中或混合环境中编排容器的组织来说，Kubernetes 是理所当然的首选。事实上，所有主要的公共云提供商现在都支持该平台的一致版本。

随着 Kubernetes 逐渐成熟，围绕网络安全风险的对话继续发展——很大程度上是由于迄今为止最严重的 Kubernetes 漏洞 [CVE-2018-1002105](https://nvd.nist.gov/vuln/detail/CVE-2018-1002105) 的余震。同时,“特权”的定义已经从强大的人类用户扩展到包括这些环境中的大量机器和应用程序。此外，Kubernetes 的普通用户机密——如凭证、密码、SSH 密钥、证书和 API 令牌——可能与传统系统的管理员级凭证一样强大。如果落入坏人之手，这些秘密可能会引发灾难。

Kubernetes 开发人员和安全团队越来越认识到需要更强的安全实践，但可能需要一些帮助。这里有五种保护 Kubernetes 的行之有效的做法，以及一些需要避免的陷阱。

## 保护你的秘密

Kubernetes 中的所有容器和单元都需要相互交互来完成它们的工作。为此，他们必须共享秘密以安全地访问资源。类似地，人类开发人员经常被提供秘密以获得对环境中所有容器和单元的高级访问。如果这些秘密被错误处理或无意中暴露，攻击者可以获得 root 访问权限，使用 bot 爬虫搜索出暴露的秘密，然后泄露敏感数据，恶意破坏数据或 crypto-jack 云资源。例如，在 2018 年特斯拉违规事件中，网络攻击者发现了一个未受保护的 Kubernetes 控制台，其中包含 AWS 访问密钥。攻击者能够复制密钥，并使用它们在组织的云中安装加密货币挖掘软件。

随着 DevOps 团队大规模构建和部署应用程序，自动化产生了[秘密](https://kubernetes.io/docs/concepts/configuration/secret/)。结果是:更多的秘密。保护 Kubernetes 豆荚和容器的关键是持续管理和保护人类和机器对这些强大秘密的访问。

大多数组织已经建立了在传统 IT 系统(如 Windows)中保护凭据的要求。为了保护 Kubernetes 中的秘密，应该实现类似的实践:基于强大的安全策略授权访问(基于角色的访问控制，或 RBAC，在这些弹性环境中工作得很好)；定期轮换机密，并考虑对最高级别的机密实施即时临时访问；和审核对关键系统的访问，以最大限度地减少未经授权的访问。对于人类用户，考虑击键或视频记录，以灌输责任感并展示合规性。

## 授权外交部

网络攻击者不断进化他们的方法。最近，威胁研究人员观察到一系列利用 RBAC 权限针对 Kubernetes 集群的攻击。一旦成功，这些攻击可能会危害应用程序或出于恶意目的滥用资源。

这些攻击提醒我们，虽然 RBAC 是确保正确访问授权的可靠方法，但它不是银弹。一些秘密提供者通过要求经由…另一个秘密的认证来保护秘密。这意味着，如果攻击者通过 RBAC 获得了这个秘密，他们可以打开第一扇门，拿到钥匙，打开下一扇门，等等，直到他们到达目的地。

为了最小化风险，对任何试图请求机密的人或机器实施强多因素身份验证(MFA)。这样，如果没有额外属性的认证，例如随机 UUIDs、密钥或用 Kubernetes APIs 生成的证书，被窃取的秘密对攻击者来说就没有任何价值。

## 保守你的秘密，秘密

犯错是人之常情。事实证明，申请也没有很好的记录。

保守秘密的最好方法是将它们与应用程序和开发人员隔离开来，同时仍然给予他们所需的访问权限。通过使用一个充当中介的系统，人类开发人员和应用程序都不必看到真正的秘密，因此也不会暴露它们。

应用程序可以安全地连接到数据库、服务和其他受保护的资源，而无需获取或管理机密。与此同时，这种“无秘密”的方法使开发人员为他们的应用程序编写代码变得更加容易和安全:他们不必编写 API 调用来从 Kubernetes secrets 存储中获取访问秘密，并且他们可以访问资源，而不必求助于不安全的做法，如硬编码凭据。在 Kubernetes 中工作的开源工具使这一关键的安全步骤变得容易。

## 为了简单而标准化

的确，Kubernetes 拥有自己处理秘密的内置能力，被恰当地命名为 [Kubernetes Secrets](https://kubernetes.io/docs/concepts/configuration/secret/) 。使用这种功能，可以将密码和密钥等敏感数据存储在 Kubernetes Secret 对象中。这些信息存储在 [etcd](https://etcd.io/) 中，默认情况下不加密，但是 etcd 可以使用基本的访问策略进行静态加密。这种功能提供了基本的秘密安全，就像云供应商和容器平台提供的许多工具和服务一样。问题是每个本地工具处理安全性的方式不同，成熟度不同，使用的接口也不同。

如果你像今天的大多数数字企业一样，你依赖于多种 DevOps 工具和平台——从 Kubernetes 和 Chef，到 Ansible 和 OpenShift，到 Amazon Web Services 和 Docker。那么，在您不断发展的工具集中，每个工具都有不同的秘密管理功能，会有什么问题呢？实际上，很多。集成可能会很痛苦(或者完全不可能)，每个工具都会建立自己独立的"[安全孤岛](https://www.conjur.org/blog/security-islands/)，这可能会导致危险的缺口。

建立一个集中、标准化的机密管理系统，以控制、实施、监控和管理对您的应用程序、云和工具的访问。这将帮助您的组织最大限度地提高运营效率，加强安全性，满足审计要求，并降低破坏性安全违规的风险。

## 找到你的盲点

你无法保护你看不到的东西，或者你甚至没有意识到存在的东西。

发现工具可以帮助您识别整个云和开发运维环境中不安全的秘密，并发现之前未知的漏洞。您还可以利用[开源工具](https://github.com/cyberark/KubiScan)来确定角色、用户和 pods，网络攻击者可以利用这些工具来危害整个 Kubernetes 集群并造成深远的损害。这对于识别大型环境中的潜在弱点特别有帮助，为管理员提供了降低风险所需的可见性。

与所有伟大的开源项目一样，Kubernetes 将继续发展，由声音、愿景和专业知识的多样化融合形成。令人鼓舞的是，随着平台的发展，安全成为了[对话](https://discuss.cyberarkcommons.org/)的重点。通过采取这五个步骤，您的组织可以加强整体网络安全，提高开发人员的效率和速度，并最终帮助 Kubernetes 社区经受住时间的考验。

要了解更多关于集装箱化基础设施和云原生技术的信息，请考虑今年晚些时候来阿姆斯特丹参加 [KubeCon + CloudNativeCon EU](https://events.linuxfoundation.org/kubecon-cloudnativecon-europe/) 。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>