# 网飞为多语言编程建立管道

> 原文：<https://thenewstack.io/netflix-builds-pipeline-polyglot-programming/>

网飞曾经是一家 Java 商店，它专注于一种编程语言，这使得该公司能够简化流水线，以便开发人员尽可能快地将代码投入生产。但视频流媒体服务的程序员越来越多地使用 Java 以外的语言，特别是 JavaScript (Node.js)、Python 和 Ruby-on-Rails。

因此，该公司的工具团队必须努力建立一个可以容纳这些语言以及其他语言的管道，网飞开发人员生产力经理迈克·麦克加尔在上周于纽约举行的[奥赖利速度系统工程会议](https://conferences.oreilly.com/velocity/vl-ny)上说。

其结果是一个名为 NEWT(网飞工作流工具包)的新工作流开发工具，这是一个独立于编程语言的应用程序，为开发人员提供了一种根据网飞官方规范指定他们自己选择的构建工具来打包他们的应用程序的方法。

“我可以告诉纽特去做我想做的任何事情，纽特不在乎。它对构建没有偏见。它对你的应用程序的依赖管理没有主见。

当它开始作为一家通过邮件运送 DVD 的公司时，网飞是一家在私人数据中心运行 Oracle 软件的 Java 商店。然而，随着该公司转向流媒体，它经历了一些“规模挑战”，这种基于 Java 的整体设置无法应对。“我们开始重新评估我们的架构应该是什么样子，”他说，并指出这种重新设计已经使该公司像许多其他公司一样，走上了云计算、微服务和 NoSQL 的道路。

这条路被证明是有问题的，因为其管道中的大多数开发工具都是围绕 Java 栈构建的。“构建”开发者创建的应用程序由以 Java 为中心的 [Gradle](https://gradle.org/) 监督。它们在一个虚拟机中被“T8”烘烤，在那里它可以作为一个“不可变的工件”(意味着它一旦部署就不会被篡改)，使用由网飞开发的名为 [Nebula](http://nebula-plugins.github.io/) 的 Gradle 插件。该公司开发了自己的持续集成和部署软件[，名为 Spinnaker](https://medium.com/netflix-techblog/global-continuous-delivery-with-spinnaker-2a6896c23ba7) ，用于自动化部署。

操作的部署方面是相当不固执己见的——它不需要知道所使用的编程语言。然而，操作的构建部分与 Java 紧密相连。但是如果一个开发人员想要构建一个节点应用程序呢？起初，工具团队针对这些用例调整了 Gradle，要求开发人员设置配置以使用 Apache，而不是默认的 Java 应用服务器 Tomcat。

然而，这种方法让 JavaScript 开发者成为了网飞的二等公民，McGarr 解释道。他们没有得到 Java 开发人员的全面支持，工具团队发现他们自己做了许多小的修改来支持非 Java 应用程序。

转折点出现在一个新的计划中，该计划使用 Node.js 来重新设计一个主要的网飞组件。“我们不能忽视这种非 Java 的增长趋势，”McGarr 说。“在网飞，我们通常不强制使用工具。McGarr 说，在开发人员中，工具必须胜出。

简而言之，该公司需要一种方法来将非 Java 应用程序打包成其首选的**。deb** 封装格式。尽管找到非 Java 的构建工具来打包所有的依赖项，但是这被证明是有问题的。这么多选择！ [Webpack](https://webpack.github.io/) ， [Brunch](http://brunch.io/) ，[browser forly](http://browserify.org/)， [Grunt](https://gruntjs.com/) ， [Gulp](https://gulpjs.com/) ，npm 的 [Bower](https://www.npmjs.com/package/bower) ，以及 Broccoli.js，作为第一批。

在他的研究中，McGarr 发现，在许多情况下，开发部门使用了不止一个这样的工具，每个工具执行一部分依赖管理工作。“作为一名 Java 开发人员，这让我有点震惊。我没想到会这样，”他坦白道。他预见到 JavaScript 社区可能会继续以如此快的速度推出新的构建工具，这使得企业几乎不可能只选择一种工具来满足其开发人员的需求。

McGarr 的团队不再担心提供特定的构建工具，而是开始考虑开发人员工作流工具。“我们希望建造一些东西，使工程师能够做他们的工作，但只在最重要的地方有意见，”麦克加尔说。McGarr 说，“我们想要的东西对开发者来说是本土的或类似本土的”。换句话说，不要再把 Gradle 硬塞进 JavaScript 工作中。

于是团队开始构建 NEWT，一个命令行工具，用 Go 编程语言编写。Go 依赖项没有二进制文件，因此开发人员可以在他们喜欢的任何机器上工作。

NEWT package 命令检查应用程序需要哪些依赖项，并将它们和应用程序本身一起安装在 Docker 容器中。这确保了每个开发人员为每个应用程序获得正确的支持工具和系统依赖。该团队为不同的应用程序开发了配置文件，称为“应用程序类型”，指定了 Node.js 应用程序、Python 应用程序或其他类型的 YAML 文件中所需的配置和约定。开发人员可以在 YAML 文件中指定他们想要使用哪些构建工具来构建他们的应用程序。

当其他选项，如 Chef's Habitat 刚刚进入市场时，为什么要在内部构建开发人员工作流工具呢？麦克加尔在演讲结束后说，网飞确实试图在任何可能的地方购买而不是建造。但是其他的工作流工具，对于网飞的目的来说，是固执己见的错误观点。在这种情况下，最好从头开始构建。

目前，NEWT 不是开源的，尽管将来可能会是。这个项目只由少数几个开发商管理。他说，随着更多的人被雇佣，McGarr 将有足够的人力来准备对外发布的软件。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>