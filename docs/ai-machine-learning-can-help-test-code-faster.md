# 机器学习为自动化软件测试助一臂之力

> 原文：<https://thenewstack.io/ai-machine-learning-can-help-test-code-faster/>

自动化测试在开发中变得越来越重要，尤其是在发现安全问题时，但是模糊测试需要高水平的专业知识——而且开发人员处理的大量代码，从第三方组件到开源框架和项目，使得很难测试每一行代码。现在，一系列人工智能驱动的选项，如微软的[安全风险检测](https://www.microsoft.com/en-us/security-risk-detection/)服务和[diff blue’](http://www.diffblue.com/)的安全扫描器和测试生成工具，旨在使这些技术更容易、更快，并可供更多开发人员使用。

“如果你问开发人员他们工作中最讨厌的方面是什么，那就是测试和调试，”Diffblue 首席执行官和牛津大学的计算机科学教授告诉新堆栈。

Diffblue 工具使用通用算法来生成可能的测试，并将强化学习与求解器搜索相结合，以确保它给你的代码是最短的可能程序，这迫使机器学习系统进行归纳，而不仅仅是坚持训练集中的例子。

“我们所构建的就是为您做到这一点的东西。如果你给我们一个 Java 程序，可能是类文件或编译的 Java 字节码，我们会以测试的形式给你一堆 Java 代码，供你最喜欢的测试框架使用，”Kroening 说。

这些结果也可以用一些合适的 mock 框架作为 JUnit 测试。

Diffblue 从 Java 开始，因为测试自动化在 JUnit 社区中非常普遍，但它正在增加对 Python、JavaScript(从 Node.js 开始)、C#和最终 PHP 的支持。对于所有语言，这些工具都可以处理源代码和二进制文件。您可以保留生成的测试，这样您就可以在整个开发周期中继续使用它们。安全扫描器也提供建议。“如果它发现一个 SQL 注入漏洞，它会给你触发漏洞的输入字符串，”Kroening 解释说。

今天的产品是一个运行在 Docker 容器中的 web 服务，您给服务提供代码报告的 URL。这使得它很容易与现有的 [DevOps](/category/devops/) 流程集成。“如果你有像詹金斯设置的东西，它非常适合那里，”他指出。“从长远来看，我设想一个轻量级的环境，在一个 ide 中运行在一台笔记本电脑上；把它集成到 Eclipse 或 Visual Studio 中。在你写完一段代码后立即提供反馈是非常有价值的，而不是在 Jenkins 构建失败后的第二天。”

## 给你弄模糊了

Microsoft 安全风险检测(以前称为 Springfield 项目)采用了一种略有不同的方法。这是一套在 Windows 和(目前在 private preview 中)Linux 应用程序中发现安全漏洞的 fuzzer，以及一个在 Azure 虚拟机中使用这些 fuzzer 创建的许多输入测试您的二进制文件的自动化平台。

微软安全研究员[大卫·莫尔纳尔](https://www.microsoft.com/en-us/research/people/dmolnar/)向我们解释说:“我们正在将一些我们在微软内部使用了十多年的人工智能打包成云服务，客户可以根据需要使用它们来启动测试实验室，并在他们即将发布的二进制文件中使用它们。”。这个想法是:“我们如何帮助人们在他们的二进制文件上，在他们发布的代码上，在他们购买的代码上，在运行他们业务的代码上使用一个服务，这真的可以帮助他们找到他们以前找不到的错误？”

斯普林菲尔德的人工智能结合了两种技术；时间旅行调试和约束求解。莫尔纳尔将时间旅行调试比作研究车祸是如何发生的。“如果你看到一场车祸，你可以通过观察挡泥板是如何弯曲的，以及车轮转动的方式或挡风玻璃的状态来试图找出发生了什么，但你只能通过这种方式了解到这么多。现在想象一下，你有一段汽车坠毁前两分钟的视频，你可以一帧一帧地浏览。我们可以在你的程序执行的时候这样做。我们将其与一种叫做约束求解的人工智能形式相结合，这种人工智能允许我们提出“如果...会怎样”的问题。我想知道，我需要对我的输入进行哪些更改来增加我的覆盖范围，并使我的 if 语句为真？”

他解释说，求解器背后的想法可以追溯到 20 世纪 70 年代，但最初他们只研究小例子。“现在我们可以快速解决问题，而且解决的规模在以前似乎是不可想象的；我们能够处理超过 10 亿条指令的动态指令跟踪。”该服务中的模糊技术组合也已经开发了多年(该名称来自于拨号线路噪声，它启发了通过注入噪声输入使软件崩溃的第一种模糊技术)。

“我们正在后端添加更多的模糊器，并探索如何提高模糊器的功效，”Molnar 说；来自微软研究院和开源世界的新技术可能会及时进入这项服务。

莫尔纳尔是管理斯普林菲尔德团队的研究员；此前，他帮助将相同的技术应用于 Windows 和微软 Office 等产品，发现了通过在 Windows 7 客户端中进行模糊处理而发现的三分之一的安全漏洞。这需要大量的试错和动手工作，以及模糊化方面的专业知识。

“现在，我们能够将大部分内容隐藏在 GUI 后面；除了引擎盖下，你不必转动任何旋钮，”莫尔纳尔说。

他解释说，你确实需要有一些服务的初始测试用例。“这些测试可以是你可能有的相同的功能或回归测试，或者你可以在网上搜索一些初始测试用例。”

服务产生的信息被设计成对测试人员和开发人员都有用，所以它不仅仅是发现 bugs 这也有助于你对他们进行分类。“我们确保 bug 是可重现的；我们谴责它五次。我们的系统中有一部分可以查看每一次崩溃，并告诉你这是什么类型的问题，以及我们是否认为这是可利用的。”

他称这项技术为“最大努力”,但建议该服务甚至为熟悉模糊器的安全专家提供一定程度的重复数据删除和分类，从而简化他们的任务。

在您的代码上运行服务意味着将二进制文件上传到一个虚拟机上，您可以在其上安装任何必要的先决条件。“我们喜欢为客户提供完整的虚拟机，因为我们已经看到了有依赖关系的客户。如果我们告诉您只需上传一个 zip 文件或让我们访问您的源回购，有些客户将无法使用我们，他们可以使用我们，因为这是一个虚拟机。他说:“如果你需要安装 SQL 或内核驱动程序，或者(为你的软件)疯狂修改注册表项，你可以做到。

因为该服务工作在二进制文件上，所以您可以在没有源代码的第三方代码上使用它。“您可能有一个贵公司多年来构建的 DLL，或者您可能想要测试您正在考虑使用的新软件。一些客户说，“我有服务器端代码来支持我的业务，却忘记了安全性，它就是不能崩溃，我不想要任何可能导致它崩溃的东西。”你不需要知道库的细节或者源代码或者如何调用它。当我们在 Windows 上使用这项服务时，Windows 团队编写了一个包装器，包装了构成 Windows 一部分的库，但他们不必编写注释或向我们解释源代码。"

使用虚拟机的缺点是很难构建到现有的开发运维及测试工作流中。它将是实体库的理想伴侣，如 Sonatype T1 和 T2 white source T3，它们帮助你跟踪你在开发中使用了哪些第三方代码。这是 Molnar 希望这项服务在未来能够做到的。

当你在第三方代码中发现你无法改变的错误时，他建议了一系列缓解措施，如沙箱、虚拟化、EMET 和 Windows 10 中的漏洞利用保护。“这就是我们称之为服务风险检测的原因，因为我们帮助您找出风险所在，然后提供一整套选项来控制风险。”

## 超越 bug

一些研究人员正试图走得更远，不仅仅是找到漏洞并修复它们。来自[微软研究院](https://www.microsoft.com/en-us/research/)、[北京大学](http://english.pku.edu.cn/)和[电子科技大学](http://en.uestc.edu.cn/)的新[精确条件系统](https://www.microsoft.com/en-us/research/publication/precise-condition-synthesis-program-repair/)使用在线可用开源代码的自然语言分析和统计分析的组合来生成补丁，旨在修复底层漏洞，而不仅仅是通过测试套件。

Kroening 还希望 Diffblue 最终也能创造代码。“最终目标是让编程成为非专业人士也能完成的事情。我想让你能够通过学习引擎从头开始编写代码，而不是调试现有的代码。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>