# 细粒度授权:安全问题是什么？

> 原文：<https://thenewstack.io/fine-grained-authorization-whats-the-security-buzz-about/>

[](https://www.aserto.com/)

 [奥姆里·加齐特

奥姆里是授权创业公司 Aserto 的联合创始人/首席执行官，也是他的第三次创业。他 30 年职业生涯的大部分时间都在从事开发人员和基础设施技术方面的工作，最近的职位是 Puppet 的 CPO。此前，他是惠普云原生平台的副总裁兼总经理(负责 OpenStack、Cloud Foundry、CloudSystem 产品和服务的业务、产品和工程监督)，也是微软的总经理，负责 Azure、SQL Server、应用服务器和。NET 框架。](https://www.aserto.com/) [](https://www.aserto.com/)

授权已经成为一个相当热门的话题: [Intuit](https://medium.com/intuit-engineering/authz-intuits-unified-dynamic-authorization-system-bea554d18f91) 、 [Airbnb](https://medium.com/airbnb-engineering/himeji-a-scalable-centralized-system-for-authorization-at-airbnb-341664924574) 、 [Google](https://research.google/pubs/pub48190/) 和其他公司最近描述了围绕大规模授权的[架构挑战](https://www.aserto.com/blog/the-architectural-challenge-of-authorization)，以及他们内部构建的解决方案。

作为一个 B2B SaaS 应用程序的开发人员，你可能会挠头，这与你有什么关系。在应用程序生命周期的早期，这些挑战可能并不明显:应用程序通常从“普通用户”和“管理员”开始；对于管理员级别的操作，您需要编写一些代码来检查登录的用户是否拥有管理员权限。生活很简单。

但是随着您的应用程序获得用户，粗粒度的授权模型肯定不再适用:您的客户会要求您在多个维度上添加更细粒度的授权，这时事情就变得有趣了。

在本文中，我们将回顾推动商务 SaaS 应用程序发展的需求，并提供一些建议，帮助您在向高端市场发展时向企业客户销售您的应用程序。

## 细粒度授权

“细粒度授权”到底是什么？有两个基本方面需要考虑:你的应用程序公开的**授权模型**，以及你的客户**如何将他们的用户映射到你的模型**。

### 授权模型

对于您的授权模型，有三件主要的事情需要考虑:您定义的**资源类型**，您针对这些资源类型定义的一组**权限**，以及您的客户可以设置这些权限的**资源粒度**。

让我们用一个大多数人都熟悉的例子来说明这些:一个*申请人跟踪系统(ATS)* 。

### 资源类型

每个应用程序都有一组“名词”:在我们选择的例子中，ATS 有*个候选人* **，** *个工作*，以及*个报告*。这些是应用程序管理的**资源** **类型**。

### 许可

这些名词中的每一个都有一组“动词”，或者可以对它们执行的操作:例如，你可以列出、创建、阅读、更新、删除候选人或工作。这些的笛卡尔积表示您的应用程序可以向用户公开的一组权限:

### 角色:权限汇总

我们简化的 ATS 提供了合理数量的权限，但是大多数现实世界的应用程序都有几十甚至几百个不同的操作，因此有不同的权限。您的大多数客户很少想要单独管理这些权限，所以您最终定义了一组**角色**，它们在通用配置中“汇总”这些权限。例如，您可能有一个对候选人具有只读访问权限的*候选人查看者*角色，以及一个可以创建、编辑和删除候选人的*候选人管理*角色。类似地，*作业查看者*和*作业管理员*可以汇总各自的作业权限。

## 资源粒度

如果您的应用程序中的(“名词”)是资源*类型*，那么您的应用程序管理的**资源**是那些类型的*实例*。

您可以在授权模型中调整的另一个重要参数是**资源粒度**，您可以为其设置这些权限。对于我们的 ATS 示例，我们可以在不同的点设置刻度盘:

*   租户级:权限扩展到该类型的所有资源(例如*所有作业*)
*   组织级:租户由多个组织组成，权限扩展到每个组织内的该类型资源(例如*所有工程作业*)
*   单个资源:每个资源的权限都可以单独设置

### 资源组:组织资源的实用方法

为每个资源分配不同的权限可能会提供最高级别的粒度，但这种灵活性通常会带来额外的管理负担:每个资源都必须单独管理，并且通常很难全面了解谁可以访问什么。

实际上，大多数应用程序都定义了一个组织结构——一个项目、组织单元或组——并将权限统一分配给该结构中的每个资源。我们将这些**资源组称为**。

### 检查点

到目前为止我们有什么？授权模型有两个重要的元素:它定义的一组**权限**(操作 x 资源类型)，以及这些权限适用的**资源粒度**。我们还有两个简化的构造——**角色**是一个实用的权限“汇总”,而**资源组**是一个实用的组织构造，围绕着可以一起管理的资源集合。

## 您的客户如何将他们的用户映射到您的模型

到目前为止，我们已经描述了在设计授权模型时可以进行的一系列权衡。您还需要考虑客户如何将他们的用户映射到这个模型上。

### 将用户分配给角色(“RBAC”)

我们在 SaaS 应用程序中看到的最常见模式是通过企业单点登录提供商(如 [Okta](https://developer.okta.com/?utm_content=inline-mention) 、Auth0 等)将您客户的用户映射到您的身份提供商，并要求应用程序管理员将这些用户分配到您的应用程序定义的角色中。这通常被称为基于角色的访问控制(RBAC)。

有时，该过程可以自动化，客户目录或身份提供者中的角色可以清晰地映射到您的应用程序定义的角色。随着您的应用程序向高端市场发展，您向更大的企业销售产品，这些客户倾向于在他们的用户如何映射到您的角色方面需要一定程度的灵活性和自动化。

### 将用户属性映射到权限(“ABAC”)

当将客户的用户映射到您的角色和权限时，从静态的简单流程到用户属性到权限的动态映射，您已经进入了基于属性的访问控制(ABAC)领域。主要优势是让您的客户能够更精细地控制来自客户身份提供者的哪些属性用于确定该用户在您的应用程序中拥有哪些权限。挑战在于，这种定制通常需要某种形式的解决方案工程，并且会延长实施时间。

将用户属性编码为烘焙到 SAML 令牌中的断言可以使这变得更加标准，但也会遇到困扰具有烘焙范围的 [JWT 令牌的相同问题:也就是说，在这些令牌过期之前，用户拥有这些令牌授予的所有权限。](https://www.aserto.com/blog/oauth2-scopes-are-not-permissions)

对于我们的 ATS 示例，一个企业客户可能希望将*候选人-管理*和*工作-管理*角色分配给具有“部门”属性的用户，该属性等于“人才获取”(ABAC)。他们可能还希望将 *job-admin* 角色分配给经理，但是其作用域仅限于该经理的组织中的作业(角色到组织范围的资源集的 ABAC 映射)。

## 离别的教训

每个成功的 SaaS 应用程序都经历了授权模型的演变。演进的两个主要方面是公开的参数(从粗粒度的角色到细粒度的资源组权限)，以及客户组织将其用户映射到授权模型的方式。

一些实用的经验可以帮助你完成这一转变:

*   为系统中的每个不同操作定义一个权限(动词和名词的笛卡尔乘积)。这为您的授权模型提供了发展空间，无需任何额外的重新架构。
*   定义一些作为这些权限的“汇总”的常见角色。您的大多数客户会更喜欢使用这些角色，但是允许这些角色增加额外的权限使您的客户能够从默认设置开始，并根据他们的环境进行定制。
*   假设您的客户有他们自己的身份提供者，并且他们希望从该身份提供者获取用户，则让您的客户能够灵活地在他们的身份提供者属性与您的角色和权限之间进行映射。

应用这些经验是向企业客户销售您的应用程序的一大步。

## 您的客户要求什么授权要求？

在 [Aserto](http://aserto.com) ，我们正在为授权构建一个企业就绪的开发人员 API，因此我们每天都在生活和呼吸着授权:)我们很想知道您在开发应用程序时遇到了哪些授权需求——请在 [Twitter](https://twitter.com/aserto_com) 或 [Medium](https://aserto.medium.com/) 上告诉我们，并查看我们的 [beta](https://aserto.com/#sign-up) ！

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>