# 如何增强您的灾难恢复计划

> 原文：<https://thenewstack.io/supercharge-your-disaster-recovery-plan-in-5-simple-steps/>

[](https://www.linkedin.com/in/maximmelamedov/)

 [马克西姆·梅拉德夫

马克西姆是 Zesty 的联合创始人兼首席执行官。马克西姆在科技行业拥有超过 13 年的经验，擅长解决复杂的问题和打破以前建立的规范。](https://www.linkedin.com/in/maximmelamedov/) [](https://www.linkedin.com/in/maximmelamedov/)

这是每个工程师最糟糕的噩梦:我们的云提供商突然停电，导致你的系统故障，产品故障，愤怒的客户发微博说你的服务中断了。这种中断会对你的商业信誉造成严重影响，并使你的产品的可靠性受到质疑。

这个噩梦般的场景萦绕在每个工程师的脑海中，主要的云提供商也注意到了这一点。事实上，AWS 首席技术官沃纳·威格尔谈到了故障架构设计，指出无论你或你的云供应商在数据中心运营方面有多好，数据中心总有一天可能会中断。当然，他的预言实现了。

我们已经看到，即使是最大、最成功的公司也会成为停机的受害者——最近发生在[脸书](https://www.theguardian.com/technology/2021/oct/05/facebook-outage-what-went-wrong-and-why-did-it-take-so-long-to-fix)、 [Slack](https://www.theverge.com/2021/9/30/22702876/slack-is-down-outage-morning-disruption-work-chat) 和 [AWS](https://techcrunch.com/2021/12/22/aws-just-cant-catch-a-break/) 的故障就是一些最突出的例子。虽然并不是所有的停机都可以归咎于云，但 AWS 最近的例子证明，拥有可行的主动业务连续性(BCP)和灾难恢复(DR)计划以及相关的操作手册可以带来巨大的变化。

虽然 BCP 和灾难恢复通常被归为一类，但业务连续性往往比灾难恢复更常见，而且不需要太多人力。BCP 通常指的是典型的云中断，而灾难恢复指的是由于恶意行为者或其他破坏性事件而导致所有数据被完全破坏的情况。对于 BCP 计划来说，拥有一份以上的数据和服务器副本通常就足够了，而灾难恢复计划则需要更多的备份和协议。

要确定的另一个重要方面是您的恢复点目标(RPO)和恢复时间目标(RTO)。RTO 是指从灾难中恢复时，您的企业能够承受的断开时间，而 RPO 是指在不损害企业声誉或违反服务级别协议(SLA)的情况下，您可以在灾难中丢失的数据量(例如，24 小时)。

既然已经确定了这些重要因素，那么在发生另一次云中断或任何其他可能出现的问题时，您如何保护您的组织呢？一旦最坏的情况发生，您可以采取以下一些步骤来准备和恢复您的服务。

## 创建多可用性区域部署

对于 BCP 来说，最简单也是最常见的架构是在同一个区域内使用至少两个可用性区域(az)。例如，在 AWS 上，每个区域由三个 az 构建而成，这三个 az 彼此相对靠近，并通过专用光纤和低延迟连接进行连接。这允许你保持你的服务，这样当一个 AZ 失败时，你可以继续为你的客户服务。

云提供商倾向于将他们的服务分布在多个 az 上(例如亚马逊 S3、亚马逊 DynamoDB、谷歌云扳手等。).因此，它们被设计用来处理 AZ 故障。

考虑到这种架构可能涉及 AZ 间的成本，需要在设计阶段加以考虑。

## 在多区域部署中使用单个 AZ

在这个场景中，您将在两个不同地区的一个 AZ 中实现您的应用程序和数据库。这使您能够在一个地区出现停机时提供服务。

这两个 az 可以通过几种方式部署:

1.  每个区域将使用负载平衡器或 DNS(域名系统)路由服务 50%的工作负载。

2.  主区域将服务于大部分或全部流量，第二区域将在出现故障时为用户提供服务。如果您选择走这条路，您可能希望自动执行此故障转移任务。

## 使用多 AZ 和多区域部署

最近一次 AWS 断电发生在北弗吉尼亚(US-East-1)地区，并因网络影响而波及整个地区。如果您的所有基本工作负载都在该地区运行，您的服务将不可避免地受到影响。这意味着在该地区的 AWS 服务恢复之前，您的所有服务都将中断。说到孤注一掷！这是网络故障影响多个 AZ 的罕见情况。

对于这种情况，最好的保护是在不同的位置运行不同的工作负载和备份，这样，如果一个地区出现故障，您可以从不同的地区继续为您的客户提供服务。

当然，您运行的区域越多，您的环境就越复杂，您的云账单也会变得越贵。因此，考虑到你的产品实际上有多重要，你要战略性地确定你想在哪里和多少地区建立业务。它能救命吗？如果是这样的话，你需要付出额外的努力来确保你的产品在各种情况下都能发挥作用，因此要保证尽可能多的地区多样化。

## 在多云或混合部署上运行

在多个云提供商上运行变得越来越流行。但事实是，维护多个云环境相当困难，当您使用托管服务时，这一挑战变得更加困难。例如，如果您正在使用 Amazon DynamoDB，类似的解决方案无法通过其他云提供商获得。

因此，行业趋势是在一个特定的云(在一个多 AZ 或多区域架构上)上运行每个工作负载，但允许不同的工作负载在各种其他云上运行，这意味着您在两个不同的云提供商之间划分一些服务。在这种情况下，当发生中断时，并不是所有的系统都停止运行。

或者，另一种常见做法是在内部部署灾难恢复站点。当客户将其工作负载迁移到云中时，他们倾向于将内部部署用作灾难恢复站点，因此如果出现问题，他们将能够在本地运行一些关键服务。当您公司的云成熟度处于初始阶段，并且您没有使用托管服务时，这是一个很好的做法。

## 创建备份

虽然上述所有解决方案都非常适合 BCP，但它们无法覆盖您的数据被加密或删除的情况，这需要可靠的灾难恢复策略。因此，除了为您的服务提供多个实施方案之外，您可能还需要一个可靠的备份计划来满足公司的 RPO 和 RTO 要求。

有许多第三方备份解决方案和云备份服务可用，例如 AWS Backup，它们可以帮助您自动备份并将其保存在单独的帐户和区域中。您应该像保护保险库一样保护备份帐户，以便它能够承受您受到攻击并且您的数据被加密的情况。

如果发生这种攻击，备份帐户上的数据将用于恢复您的服务，以便您可以继续为客户服务。

我们已经介绍了构建云环境 BCP 和灾难恢复计划的最常用方法，现在让我们来讨论可用于实施这些方法的工具:

## 利用基础设施作为代码

代码或 IaC 形式的基础设施支持环境的自动化配置。一旦您配置了想要使用的参数，它将被保存到一个主文件中，也称为清单。从那里，您的环境可以自动重新创建，用于测试、灾难恢复或各种其他情况。

## 对容器使用缩放规则

如果您使用容器，基于各种度量实现缩放规则会非常有帮助。您可以纵向扩展以增加同一个块中的集群数，也可以横向扩展以复制实例。通过实施扩展规则，您可以轻松备份和恢复基于容器的应用程序，以便在出现停机时可以检索所有重要的工作负载。理想情况下，您需要在容器和实例级别上向上和向外扩展，这样才能最有效。

## 重新路由 DNS 请求

如果一个位置的服务器出现故障，您可以将所有请求重新路由到运行服务的其他位置。Cloudflare 等 DNS 提供商可以配置为检测系统何时关闭，并自动执行基于地理位置的重新路由。

同样，您也可以设置容器编排器来定义和自动化用于重新路由请求的各种规则。我们建议实现自动伸缩以确保可用性，并使用 [Amazon ECS](https://aws.amazon.com/ecs/) 来实现重新路由请求。

## 设置指示灯在多个位置运行

另一个推荐的业务连续性策略是运行一个[指示灯](https://aws.amazon.com/blogs/architecture/disaster-recovery-dr-architecture-on-aws-part-iii-pilot-light-and-warm-standby/)，它本质上是您的工作负载的一个复制版本，在不同的区域备用运行。如果灾难发生了，你所有的数据都在那里，随时可以建立。在事故发生后，只需部署您的基础架构并扩展您的资源，您的产品就可以立即投入运行。

如果你不能承受任何停机时间，你可以考虑运行[热待机](https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/disaster-recovery-options-in-the-cloud.html)来代替。据 AWS 称，“热备用方法包括确保在另一个地区有一个规模缩小但功能齐全的生产环境副本。这种方法扩展了指示灯的概念，并缩短了恢复时间，因为您的工作负载在另一个区域始终处于工作状态。”

虽然成本明显更高，但热备用比指示灯启动和运行更快，因为不需要基础设施设置。

## 总结

当谈到灾难恢复时，抱最好的希望和做最坏的准备是最重要的规则之一。没有什么是准备得太充分的，因为即使是我们中最优秀的人也可能在毫无察觉的情况下遭遇云中断。

通过遵循上述策略，您可以确保您的服务在多个位置可用，可以轻松地将流量转移到未受影响的区域，并在发生灾难时做好备份和准备。最重要的是，您可以更轻松地呼吸，因为您不必在半夜醒来进行任何紧急配置。您企业的功能和信誉保持在最高标准。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>