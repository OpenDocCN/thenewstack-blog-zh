# 为自助式开发平台采用 GitOps:实用策略

> 原文：<https://thenewstack.io/adopting-gitops-for-self-service-developer-platforms-practical-strategies/>

[Cloud Native Computing Foundation](http://cncf.io/)赞助了这篇文章，期待虚拟 [KubeCon + CloudNativeCon 北美 2020–虚拟](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/)，11 月 17-20 日。

 [安妮塔·布尔勒

安妮塔是 Weaveworks 的内容总监。
她在软件开发方面有超过 20 年的经验，这些年来已经写了许多技术指南、文章、电子书和白皮书。](https://www.linkedin.com/in/anita-buehrle-8b196789/) 

DevOps 通过管理基础设施和代码，承诺更快的工程团队。但是对于大多数采用 Kubernetes 和 DevOps 最佳实践的人来说，现实是平台或 SRE(站点可靠性工程)团队需要保持对基础设施的控制。那么，您如何在不牺牲速度(或者更糟，安全性)的情况下弥合这些团队之间的差距呢？

虽然 Kubernetes 和其他云原生技术的优势众所周知，包括运营效率和可扩展性的提高，但实现这一点可能意味着应对配置复杂性的增加。在大多数情况下，这种复杂性可以通过集中式自助服务开发人员平台来解决。

GitOps 是开发团队走得更快的有效方法，即使他们不是 Kubernetes 的专家。通过 GitOps 实现自动化的自助式开发平台，可以为您的应用工程师提供增加部署频率和可靠性的自主权。

但是在探索采用自助服务平台的策略之前，有必要讨论一下 GitOps 的含义。GitOps 的核心是这两样东西:

*   Kubernetes 和其他云原生技术的运营模式；以及一组统一了容器化集群和应用程序的部署、管理和监控的最佳实践。
*   实现管理应用程序和基础设施的通用开发人员体验的途径；其中端到端部署管道和 Git 工作流应用于运营和开发。

为了正确实现 GitOps，需要有一种机制来比较期望的状态(保存在 Git 中)和运行状态，并对漂移发出警报。如果团队可以在任何时间点观察他们的系统，并在系统偏离期望状态时得到警告，那么缓解就可以发生。使用 GitOps，您的整个系统都可以用 Git 进行声明式描述和版本化。这给了团队一个唯一的真理来源，一切都是从这个来源衍生和驱动的。GitOps 还利用软件控制器来确保正确性，这些控制器会对任何偏差发出警报，为应用程序和操作任务建立反馈和控制回路。

## **通过 GitOps Automation 实现开发人员自治**

运营团队可以通过允许应用工程师从一组集群插件和其他工具中进行选择来实施自助式 Kubernetes 平台，这些工具解决了常见的使用问题，如 Git 中的监控和 CI/CD 部署管道。这是可能的，因为 Kubernetes 不仅是以声明式配置描述的，它的云原生工具生态系统也是如此。有了 Git 中的声明性配置版本，开发人员和操作人员就有了一种方法，可以通过拉请求，根据用例来启动正确配置的集群。

实施自助服务平台并通过拉式请求实现其自动化为平台和开发团队带来了多项显著优势，例如运营和应用程序开发团队的共同开发体验、内置审计跟踪、护栏和安全保障。关于自助式开发者平台以及如何实现它们的实际讨论，请听 Steve Wave 和 Cornelia Davis 在最近的播客中讨论这个话题。

## **入职工程师的 GitOps 战略**

这里有五个实用的策略，当开发团队采用自助 Kubernetes 平台的 GitOps 时可以使用。

### **1。定义、协作和记录常见的云原生模式**

一开始，建立一个保持最新并为您的组织工作的文档范例是至关重要的。为了保持信息流动，您可以创建一个 wiki 站点来记录常见的云原生模式；例如，设计抽象和原始定义，甚至关于如何实现和管理秘密的指南。

记住，团队需要一个学习曲线来理解用老方法做事和使用新模型之间的区别。

透明度是关键。记录并支持您关于如何管理安全性、秘密以及如何使用持久数据的策略。记录您所拥有的安全性和为什么需要它，以及强制执行那些安全性要求是很重要的。

### **2。采取小步骤，重复这个过程**

最好的方法之一是从您已经熟悉的部件开始，这对较大的工作流程有较小的影响。如果有一件事做不到，那么修正方向就不会太难。从一个更雄心勃勃的项目开始可能会有更大的负面影响，并且更难撤销。

例如，您可以从平台工作负载开始，将开发人员工作负载放在一边。或者你可以专注于如何更新平台本身。针对不同的方面重复一些不同的方法，例如如何部署入口控制器或如何部署监控和警报堆栈。

从小处着手，首先对试运行和开发环境进行小的改动。当您刚刚开始向 Kubernetes 环境添加 GitOps 工具[如 Flux](https://github.com/fluxcd/flux) 时，这一点尤为重要。如果您首先在分段集群上启用它们，您可以感受一下您喜欢和不喜欢的特性。这允许您决定哪些特性更适合您的环境，以及您将如何集成它们。

### **3。从您的本地开发机器到登台**，开发一个好的 UX

在开发人员机器上开发某种沙盒环境，这样他们就可以自己试验流程。这个空间有很多工具可以选择，比如[类](https://kind.sigs.k8s.io/)、 [kubeadm](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/) 、 [eksctl](https://eksctl.io/) 、 [Minikube](https://kubernetes.io/docs/setup/learning-environment/minikube/) 和 [Ignite](https://github.com/weaveworks/ignite) 。除了这些工具，你还可以利用[公共舵图](https://artifacthub.io/)和公共 Docker 图像进行实验。一旦你建立了第一个管道，开发人员将会更好地理解和遵循这个过程。

### **4。主持人信息会议**

人们通常以不同的方式学习，因此认识到这一点并尽早制定一个计划来满足团队的需求可以带来持久的收益。这一点尤其重要，因为现在很多工作都是虚拟的。通常，你可以在办公室举行信息会议，但现在这些会议需要通过 Zoom 或团队来举行。但是你可以把它们录下来，让那些想按照自己的进度学习的人也能看到。

### **5。传达变更**

交流。交流。交流。记住，你正在采用一种新的做事方式。你会在前进的道路上学习，会有挫折让你从中吸取教训。你永远不能过多地交流这些教训和你所做的改变。随意尝试不同的交流方式，比如虚拟会议、维基、闲聊和面对面的会议(希望有一天能实现)。

## **最后的想法**

为了在开发团队中建立自主性，您需要选择最有效的工具和语言。GitOps 可以扩展到 YAML 之外，并与 Python、Typescript、 [cdk8s](https://cdk8s.io/) 和 [jkcfg](https://github.com/jkcfg/kubernetes) 一起工作，以表达您的声明式配置。尽管 GitOps 的名字中有 Git，但是您可以使用任何版本控制系统——所以不要扔掉您现有的系统。最后，GitOps 不仅仅是部署您的应用，还适用于基础设施和完整的集群平台。

> “今天，您可能会瞄准 Kubernetes，因为您已经有了复制集控制器和部署控制器。但是我们可以扩展这些目标，将云、裸机和许多其他环境包括在内。这意味着我不仅可以获得云原生应用，还可以获得整个基础设施。”— Cornelia Davis，Weaveworks 首席技术官

*要了解更多关于 Kubernetes 和其他云原生技术的信息，请考虑参加 11 月 17 日至 20 日举行的 [KubeCon + CloudNativeCon 北美 2020](https://events.linuxfoundation.org/kubecon-cloudnativecon-north-america/) 。*

云计算原生计算基金会是新堆栈的赞助商。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>