# 以容器为中心的操作系统的兴起

> 原文：<https://thenewstack.io/docker-fuels-rethinking-operating-system/>

自从 Docker 推出以来，以容器为中心的新操作系统激增，包括 [CoreOS](https://coreos.com/using-coreos/) ，Ubuntu Snappy，RancherOS，Red Hat 的原子主机，VMware 的 [Photon](https://blogs.vmware.com/cloudnative/introducing-photon/) ，以及微软的 [Nano Server](https://technet.microsoft.com/en-us/library/mt126167.aspx) 。

当然，您可以在任何 Linux 发行版上运行 Linux Containers (LXC ),大多数其他主流操作系统现在都有某种类似的技术。但是使这些新的以容器为中心的操作系统与众不同的是，它们比传统的 Linux 发行版要轻得多。

“这些传统的 Linux 发行版只有大量的软件包，”VMware 副总裁兼云原生应用 CTO Kit Colbert 说。“他们有 4、6 GB 的数据，应用程序看不到任何数据。对于一个 Java 应用程序，你必须在容器中有一个 JRE(Java 运行时环境)来运行这个应用程序。它不需要容器外的任何东西来运行。那么，为什么你有 4 或 6 GB 的东西，你只是不再需要了？”

同时，容器必须在某个地方运行，并且主机也运行在操作系统上。因此出现了这些新的以容器为中心的“微操作系统”

极简操作系统的想法并不新鲜。从交通灯到数字视频记录，精简的操作系统早已嵌入电子系统。自 20 世纪 90 年代以来，可以从光盘甚至软盘启动的最小操作系统已经出现，通常基于 Linux。但是这些操作系统通常被设计为仅运行单个节点。

今天的微操作系统是为这样一个世界设计的，在这个世界中，由于容器，整个数据中心被视为一个跨越数百甚至数千个节点的巨型操作系统。

这引发了对操作系统的新思考。在这一章中，我们来看看主要的玩家和他们对操作系统未来的展望。

## 科里奥斯

甚至在 Docker 出现之前，竞争对手就对 CoreOS 在微操作系统领域的开拓性给予了支持。该公司最近从谷歌风险投资公司获得了 1200 万美元的投资，并推出了一项名为“构造”的技术，结合了其 CoreOS 产品组合和 Kubernetes——谷歌用于管理容器化应用程序的开源项目。

CoreOS 首席执行官 Alex Polvi 表示:“容器操作系统是为了在可以改变的情况下构建运行应用程序的理想环境。“在传统的 Linux 服务器环境中，很难做出改变，因为应用程序太脆弱了。”

有了 CoreOS，操作系统被视为更像一个网络浏览器，如 Chrome，它会随着新组件的发布而自动更新。加密签名有助于确保更新的有效性和整个系统的完整性。

虽然其他精益操作系统针对特定的技术，但 CoreOS 旨在成为通用选择。该公司官方支持许多部署选项，还有更多社区支持的选项可用。

“我们已经弄清楚的事情之一是如何构建操作系统，并在所有这些不同的环境中运行它，”波尔维说。“我们非常专注于为生产就绪型环境构建 CoreOS，但感觉所有其他(新操作系统)离这还有很长的路要走。”

## 大牧场主

RancherOS 仅由内核和 Docker 本身组成，是最小的微操作系统之一，联合创始人兼首席执行官盛亮表示，其重量约为 22 MB，而 VMware 的 Photon 约为 300 MB。

虽然 RancherOS 也经历了与 CoreOS 类似的挫折，但该公司在开发其操作系统时采取了不同的方法，梁说。为了开发 Docker 优化的微操作系统，该公司试图构建在 Linux 内核上运行 Docker 守护程序所需的最低限度的技术。为了实现这一点，它首先决定取消 systemd，即大多数 Linux 发行版中内置的服务管理系统，而是使用 Docker 本身来引导系统。

梁表示，systemd 经常与 Docker 发生直接冲突。因为容器经常是在 systemd 的视图之外创建的，所以它经常试图杀死它们，但最终只是在容器保持运行的同时杀死了客户机。他说，RancherOS 长期以来一直致力于寻找一种方法来弥合这两种技术背后的分歧，但不再确定有什么方法可以解决这个问题。

“就目前行业的发展来看，systemd 和 Docker 社区有点冲突，”梁说。“双方都认为自己是不断扩张的宇宙中心，很难听从另一位大师的意见。”

## Ubuntu Snappy

Canonical 自夸说 Ubuntu 是最受欢迎的 Linux 容器发行版，在 Ubuntu 上运行的 Docker 容器是其他操作系统的七倍多。

Snappy 是“一个非常小、非常薄的操作系统，”Canonical 的 Ubuntu 云解决方案产品经理和策略师 Dustin Kirkland 说。Snappy Ubuntu Core 是 Canonical 在努力为移动设备创建一个小巧而强大的操作系统的过程中吸取经验教训的结果。为了支持运营商和用户对可靠的系统和应用程序更新的需求，该公司开发了 Snappy 技术，该技术对系统和应用程序使用“事务性的、基于映像的增量更新”，只传输差异以保持较小的下载量，并确保升级总是可以回滚。

为了增强移动设备的安全性，Canonical 创建了一种隔离机制，将设备上运行的每个应用程序隔离开来。Canonical 认为，这种相同的功能提供了比单独使用 Docker 更高的隔离级别，但是细节很少。

除了 Snappy 之外，Canonical 还在 LXD 发布了其集装箱化世界愿景的第二个元素，一个基于 LXC 的轻量级管理程序，正是这个 Linux 特性使得 Docker 成为可能。最初设计的目的是将 LXC 的容器整合到 OpenStack 云中，LXD 的推出让一些人质疑 Ubuntu 是否打算用这项技术取代 Docker。

然而，根据柯克兰的说法，Docker 和 LXD 是互补的技术。他补充说，Canonical 继续推荐 Docker 来打包和运行应用程序。但外人不一定信服。

Janakiram & Associates 的首席分析师贾纳奇拉姆·MSV 说，Canonical 的真正动机是控制整个堆栈。“Snappy 将成为他们的核心操作系统，而 LXD 将成为替代的本机虚拟机管理程序，”他说。“然后他们有了更多类似虚拟机的容器。他们也有自己的编排和容器生命周期供应故事的魅力。”

## VMware 光子

Docker 本质上是一种虚拟化技术，它的迅速崛起让许多人预测到了 VMware 的反应，甚至在两家公司于去年 8 月宣布合作之后。今年早些时候，随着其轻量级操作系统 Photon 的发布，它终于做出了第一次回应。

Colbert 说，应用程序和基础架构之间不断变化的关系对 VMware 至关重要。“当你看到这种分裂时，过去的操作系统过去有一些应用程序和一些基础设施，”他说。“现在应用程序的东西在容器里面；基础设施就在外面。光子是 Linux 操作系统的基础设施的一部分。这就是我们希望将其内置于[其虚拟机管理程序] ESX 的原因。”

CoreOS 将支持光子。根据 CoreOS 的 Polvi，Photon 实际上是针对 VMware 产品线的。“要在服务器环境中运行容器，您需要 Linux，这意味着 VMware 现在需要在虚拟机管理程序之上进行管理，实际上是在 Linux 操作系统中，”他说。“这并不意味着 VMware 不允许您运行 CoreOS 或 Red Hat 或任何其他操作系统。这意味着他们需要一个专门的工具来向 VMware 的产品添加容器。他们需要将其虚拟机管理程序扩展到操作系统中。”

Janakiram 认为，由于担心从虚拟机管理程序到容器的转变会侵蚀现有业务，VMware 被迫推出自己的操作系统。

“VMware 也知道在容器的管理层可以赚更多的钱。他们想用容器重复 v 系列产品的魔力。

## 红帽原子主机

红帽在三月份推出了 RHEL 7 原子主机。它只有不到 200 个二进制文件，相比之下，完整的 RHEL 7 版本有 6500 个。

Red Hat Enterprise Linux 产品营销高级总监马克·科金(Mark Coggin)称之为精益操作系统世界中的“快乐媒介”:比传统操作系统更轻，但不像一些竞争对手那样小。他警告不要使用更“极端”的方法，比如 RancherOS 的方法，他说这可能会导致更大的复杂性，因为除了应用程序容器之外，还需要运行额外的系统容器。

“我们说过，‘我们认为这些是需要在主机平台中的核心系统服务，将解决容器应用程序 80%到 90%的用例，’”他说。“如果客户需要其他东西，如系统活动数据收集、系统日志记录、身份识别，我们也有容器化版本，但我们将许多我们认为必要的东西放在主机平台上。”

他说，Atomic Host 带来了一个由 Red Hat 的工程团队测试的企业级操作系统衍生而来的基础。根据 Red Hat 的说法，这一点很重要，因为在动态主机配置协议(DHCP)控制台的版本或容器中需要的安全外壳(SSH)的版本与内核之间，存在可能不明显的交叉依赖性。

“我们已经完成了确保你正在使用的 SSH 或 DHCP 版本能够与 RHEL 原子主机内的版本兼容的工作，”Coggin 说。

Red Hat 还与独立软件供应商(ISV)合作，以证明他们构建的容器是基于已知的、经过测试的和安全的映像。

## 微软纳米服务器

微软的轻量级操作系统 Nano Server 针对两个用例。第一种侧重于支持云基础架构，如集群化虚拟机管理程序和集群化存储。第二个重点是支持云原生应用。在后一个角色中，Nano Server 将适合在基于 Azure 的新开发环境中开发和部署的一类新的应用程序，而不是传统的基于客户端的 Visual Studio。

这些新应用将成为 Windows 开发者进入容器世界的入口。

为 Nano Server 编写的开发人员将保证与预先存在的 Windows Server 安装兼容，因为 Nano Server 实际上是 Windows Server 的一个子集。然而，可能会有一个重要的调整期，直到开发人员习惯了微服务的概念。Windows 开发人员习惯于在全局范围内为他们的代码提供大量预先存在的功能库。写入 Nano 服务器的应用程序运行在物理主机、虚拟主机或容器中。有两种类型的容器可以在 Windows Server 和 Nano Server 上工作:一种是为 Linux 开发的 Docker 容器，另一种是由微软为自己的 hypervisor 平台开发的，称为 Hyper-V 容器。

“这些提供了额外的隔离，”[微软杰出的工程师和首席架构师杰弗里·斯诺弗解释道。“它们实际上用于多租户服务或多租户平台即服务之类的事情，在这些情况下，您将运行可能是您不信任的恶意代码。”](https://thenewstack.io/microsofts-lightweight-os-and-its-deep-linux-connection/)

这个概念的灵感来自 Drawbridge，这是一个由微软研究院开发的容器化系统，主要用于进程隔离和沙箱化可能导致系统崩溃的不可信应用程序。

## 动荡的市场

看到如此多的供应商争夺位置并不奇怪。Janakiram 说，两个阵营正在形成:一边是红帽、Docker 和他们的盟友；另一方面是 VMware、CoreOS 及其盟友。“红帽越靠近 Docker，VMware 就走得越远。”

他说，谷歌正在观望。“谷歌在微笑，因为他们非常了解如何做容器，”他说。

“Kubernetes 将与 rkt 一起工作，他们正在努力使它与任何其他容器一起工作。但他们想在公共云上赚钱；他们想在谷歌云上运行容器。但他们不介意放弃一些编排上的创新。”

微软虽然与 Docker 紧密合作，但在努力克服 Windows 和 Linux 之间的不兼容性时，它面前还有一场艰苦的战斗。“24 个月后尘埃落定，我们将看到谁是赢家，”Janakiram 说。“谁在市场上仍然有影响力。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>