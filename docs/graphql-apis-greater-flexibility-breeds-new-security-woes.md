# GraphQL APIs:更大的灵活性滋生了新的安全灾难

> 原文：<https://thenewstack.io/graphql-apis-greater-flexibility-breeds-new-security-woes/>

在复杂的应用环境中，API 是众多数据存储、容器、函数和微服务之间的桥梁，API 越灵活、越动态越好。这就是为什么开发人员越来越喜欢用 GraphQL 来编写 API。但不要被愚弄了:在所有这些发展创新的背后隐藏着相当大的风险。

通过了解 GraphQL 的工作方式，您可以开始减轻来自组织内部的潜在安全威胁——导致大规模数据泄露的那种威胁。

## **graph QL API 是敏感数据的映射**

 [彼得·克利梅克

Peter 是 Imperva 首席技术官办公室的技术总监。他专门研究新兴安全技术和威胁媒介，同时帮助组织保护云原生应用程序和工作负载。在 Imperva 之前，Klimek 曾在卡巴斯基、TransUnion 和 Zebra Technologies 担任解决方案架构师、安全分析师和工程师。](https://www.linkedin.com/in/peter-klimek-37588962/) 

GraphQL 是一种开发语言，它简化了客户端与数据存储的通信，并帮助开发人员快速实现更改，而不会中断生产的其余部分。正如首字母缩写“QL”所暗示的，它是一种查询语言。它像 SQL 一样运行，并使用 API 从数据存储中请求、插入和修改数据。

GraphQL 最初由脸书在 2012 年开发，后来在 2015 年向[公众发布，被认为是一种无状态的、基于 SDL(模式定义语言)的查询语言。虽然 REST APIs 构成了大多数 API 生态系统的大部分，但随着应用程序和云环境变得越来越复杂，这种趋势正在发生变化。](https://graphql.org/foundation/)

与 REST 不同，GraphQL APIs 可以从单个请求中快速提取数据，即使是在较慢的网络连接上。在前端，GraphQL APIs 更灵活，更易于使用，而在后端，开发人员可以在不中断应用程序的情况下快速更改或发展相同的 API。

由于许多原因，与 SQL 的相似性是有益的，但是同样的益处也是令人担忧的原因。例如，查询语言为客户机提供了创建相关数据的子选择的能力，允许服务器在单个请求中返回客户机指定的确切数据。

但是，如果 API 没有用于实施对象级授权的强大模型，就有可能为客户机无权查看的相关数据创建子选择。这些漏洞将被归类为对象级授权的破坏和过度的数据暴露，分别是 OWASP API Top 10 的第一和第三大问题。此外，GraphQL APIs 为攻击者提供了大量机会来编制过于复杂和计算开销大的查询，这可能导致应用层分布式拒绝服务(DDoS)攻击。

更复杂的是，很少有安全专家知道或理解软件开发是如何工作的，更不用说 GraphQL 的细微差别了。因此，GraphQL APIs 经常在没有适当的安全审计的情况下就投入生产。开发人员可以通过了解风险来帮助安全团队并采取几个步骤来减少潜在的安全事故。

## **面向内部的 GraphQL APIs:警惕**内部的威胁

当用 GraphQL 编写时，API 对数据的访问可以通过不同环境的通用标准接口来实现。这使得内部团队能够以灵活的方式立即消费和处理数据，以满足他们的特定需求。因此，GraphQL 用于面向内部的 API 越来越普遍。然而，大多数开发人员不一定知道客户计划如何使用数据。他们可能不理解各种用例，或者他们编写的 API 如何被利用。

粗心大意、受到危害和怀有恶意的内部用户是组织数据安全的显著威胁，而 API 是获取这些数据的重要途径。大多数大型数据泄露都是由恶意行为者获得敏感数据库的访问权限并利用 SQL 语言的灵活性来泄露数据造成的。

对于大多数组织来说，面向内部的 GraphQL APIs 是这种攻击媒介的主要盲点，因为它们提供了与 SQL 相同的查询语言灵活性，但缺乏用于保护数据库的特定检测和监控工具。

内部威胁的挑战在于风险来自合法访问和用户凭证。内部威胁有多种表现形式:心怀不满的员工、受到威胁的用户、无车用户或有动机的攻击者。

这就是为什么在对美国、英国和日本的 456 名 It 和工程领导者进行的在线调查中， [52%](https://www.imperva.com/resources/resource-library/white-papers/improve-api-performance-with-a-sound-api-security-strategy/) 表示，他们担心 API 会将敏感数据暴露给错误的人。这种担忧是有根据的: [58%](https://www.imperva.com/resources/resource-library/white-papers/forrester-insider-threats-drive-data-protection-improvements-full-report/) 对敏感数据产生负面影响的事件是由内部威胁造成的。

## **小心保护 API，像对待敏感数据一样对待它们**

虽然 GraphQL 的灵活性使开发变得更加容易，但它也迫使开发人员重新审视 API 的安全性。

处理和存储敏感数据的组织也要对这些数据的机密性、完整性和可用性负责。通常，这是通过各种行业和政府法规来管理的。尽管每个法规的细节可能有所不同，但它们通常都侧重于拥有健壮的审计和安全检测机制。这包括记录所有数据请求，并能够回答以下问题:谁访问了数据，访问了什么数据，他们是如何以及何时访问的，以及这种访问是否合适。

开发人员应该特别小心，确保访问服务和发起客户端的身份在请求审计中得到保留。实施高级 API 安全控制可以防止利用业务逻辑和软件依赖关系中的漏洞，此外还可以提供控制来缓解应用层 DDoS 攻击。

GraphQL 提供的灵活性对开发人员来说是有利的，但是伴随创新而来的是风险。通过采用数据安全思维来减轻现在和未来潜在的内部威胁，重新审视保护 GraphQL APIs。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>