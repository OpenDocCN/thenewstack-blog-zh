<html>
<head>
<title>Off-The-Shelf Hacker: Use the Processing Programming Language to Build an On-Screen Gauge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现成的黑客:使用处理编程语言来构建屏幕上的标尺</h1>
<blockquote>原文：<a href="https://thenewstack.io/off-shelf-hacker-use-processing-build-screen-gauge/#0001-01-01">https://thenewstack.io/off-shelf-hacker-use-processing-build-screen-gauge/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">上周<a href="https://thenewstack.io/off-shelf-hacker-use-servo-gauge/" class="local-link">我们看了使用伺服作为一个衡量标准</a>。这个项目有它的困难:我把伺服系统的疯狂运行归因于时间问题。</p>
<p class="translated">由于无法保持足够的独立，我考虑使用我的一个用<a href="https://processing.org/" class="ext-link" rel="external ">处理</a>编程语言编写的旧计量器程序，来取代我的蒸汽朋克会议徽章中基于伺服的计量器。屏幕上的响应要好得多，尽管有一个物理模拟型仪表仍然很有趣，在徽章的前面上下扫动它的小手。</p>
<p class="translated">为了让屏幕上的仪表工作，我们需要改变一些东西。许多物理计算项目的酷之处在于，如果你聪明地使用硬件，许多行为和特性很容易通过软件更新来改变。<a href="https://store.arduino.cc/usa/arduino-pro-mini" class="ext-link" rel="external "> <img decoding="async" loading="lazy" class="size-medium wp-image-2964970 alignright" src="../Images/4f2495df46bf7aa58d258cfd09b84f05.png" alt="" data-id="2964970" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2017/08/49f190fc-e000025_featured-300x190.jpg"/> </a></p>
<p class="translated">首先，我们必须修改伺服代码，一点点，为Arduino Pro Mini 。然后，我们必须在Raspberry Pi 3上加载处理语言。最后，还有仪表代码的小问题。</p>
<p class="translated">我喜欢<a href="https://processing.org/" class="ext-link" rel="external ">处理</a>，因为它易于使用，并且是为可视化应用而设计的。它运行在Linux上，在笔记本和树莓Pi上都可以运行。开发环境和代码结构也与我们用来编程Arduino Pro Mini的相同。如果你能为一个Arduino编码，你当然能在处理中编码。</p>
<h2 class="translated">从Pro迷你伺服代码开始</h2>
<p class="translated">让servo gauge项目中的Arduino代码与屏幕上的gauge一起工作相当简单。更改以粗体突出显示。<br/></p>
<div id="crayon-642311c50c9c5694241238" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-c">/*</span>
<span class="crayon-c">HC-SR04 Ping distance sensor]</span>
<span class="crayon-c">VCC to arduino 5v; GND to arduino GND</span>
<span class="crayon-c">Echo to Arduino pin 7; Trig to Arduino pin 8</span>
<span class="crayon-c">*/</span>
 
<span class="crayon-p">#include &amp;lt;Servo.h&amp;gt;</span>
 
<span class="crayon-e">Servo </span><span class="crayon-i">myservo</span>;<span class="crayon-h">  </span><span class="crayon-c">// create servo object to control a servo</span>
 
<span class="crayon-p">#define echoPin 8</span>
<span class="crayon-p">#define trigPin 7</span>
<span class="crayon-e">int </span><span class="crayon-i">val</span>;
 
<span class="crayon-e">void </span><span class="crayon-e">setup</span>()<span class="crayon-h"> </span>{
<span class="crayon-h">  </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">begin</span><span class="crayon-h"> </span>(<span class="crayon-cn">115200</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-i">trigPin</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-i">echoPin</span>,<span class="crayon-h"> </span><span class="crayon-i">INPUT</span>);
<span class="crayon-h">  </span><span class="crayon-i">myservo</span><span class="crayon-st">.</span><span class="crayon-e">attach</span>(<span class="crayon-cn">9</span>);
}
 
<span class="crayon-e">void </span><span class="crayon-e">loop</span>()<span class="crayon-h"> </span>{
<span class="crayon-h">  </span><span class="crayon-c">// send a pulse on the trigger pin to initiate measurement</span>
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-i">trigPin</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);
<span class="crayon-h">  </span><span class="crayon-e">delayMicroseconds</span>(<span class="crayon-cn">2</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-i">trigPin</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">delayMicroseconds</span>(<span class="crayon-cn">10</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-i">trigPin</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);
 
<span class="crayon-h">  </span><span class="crayon-c">// the length of the pulse on the echo pin is proportional to the distance</span>
<span class="crayon-h">  </span><span class="crayon-e">long </span><span class="crayon-i">duration</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e">pulseIn</span>(<span class="crayon-i">echoPin</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">long </span><span class="crayon-i">distance</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span>(<span class="crayon-i">duration</span><span class="crayon-h"> </span>/<span class="crayon-h"> </span><span class="crayon-cn">2</span>)<span class="crayon-h"> </span>/<span class="crayon-h"> </span><span class="crayon-cn">29.1</span><span class="crayon-h"> </span>*<span class="crayon-h"> </span>.<span class="crayon-cn">3937</span><span class="crayon-h"> </span>;
 
<span class="crayon-h">  </span><span class="crayon-e">if</span><span class="crayon-h"> </span>(<span class="crayon-i">distance</span><span class="crayon-h"> </span><span class="crayon-sy">&amp;gt;</span>=<span class="crayon-h"> </span><span class="crayon-cn">200</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span><span class="crayon-i">distance</span><span class="crayon-h"> </span><span class="crayon-sy">&amp;lt;</span>=<span class="crayon-h"> </span><span class="crayon-cn">0</span>)<span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-h">&lt;</span><span class="crayon-i">strong</span><span class="crayon-h">&gt;</span><span class="crayon-c">// Serial.println("Out of range");&lt;/strong&gt;</span>
<span class="crayon-h">  </span>}
<span class="crayon-h">  </span><span class="crayon-e">else</span><span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-i">Serial</span><span class="crayon-st">.</span><span class="crayon-e">println</span>(<span class="crayon-i">distance</span>);
<span class="crayon-h">    </span><span class="crayon-h">&lt;</span><span class="crayon-i">strong</span><span class="crayon-h">&gt;</span><span class="crayon-c">// Serial.println(" in");&lt;/strong&gt;</span>
<span class="crayon-h">  </span>}
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-i">val</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e">map</span>(<span class="crayon-i">distance</span>,<span class="crayon-h"> </span><span class="crayon-cn">1</span>,<span class="crayon-h"> </span><span class="crayon-cn">70</span>,<span class="crayon-h"> </span><span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-cn">180</span>);<span class="crayon-h">     </span><span class="crayon-c">// scale it to use it with the servo (value between 0 and 180) </span>
<span class="crayon-h">  </span><span class="crayon-i">myservo</span><span class="crayon-st">.</span><span class="crayon-e">write</span>(<span class="crayon-i">val</span>);
<span class="crayon-h">  </span><span class="crayon-h">&lt;</span><span class="crayon-i">strong</span><span class="crayon-h">&gt;</span><span class="crayon-c">// Serial.println(val);&lt;/strong&gt;</span>
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">300</span>);
}
</pre>
</div>
</div>

<p class="translated"><br/>我对Arduino代码所做的唯一真正的更改是注释掉“超出范围”、“进入”和“val”串行打印语句。这些信息被用来使输出对人类可读。当通过串行线路向Raspberry Pi和处理程序发送距离值时，我们不需要包含这些内容。</p>
<p class="translated">我把伺服系统的代码留在了程序中，想着将来可能会回来试着修改它。通过简单地从连接器上拔下伺服系统，我们不会浪费宝贵的电池能量，而且在代码中留下这些行也不会有什么损失。我喜欢使用连接器和插座来为我的项目添加硬件组件。把东西焊接在一起需要一点额外的时间，但是调整你的设计更容易。</p>
<p class="translated">这里有一个三线伺服连接器的镜头，上面有一片胶带，以防止短路。</p>
<div id="attachment_2960226" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-2960226" decoding="async" loading="lazy" class="size-full wp-image-2960226" src="../Images/962aa602eebd833d0e95af50ece86165.png" alt="" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2017/08/d880489f-connector.png"/><p id="caption-attachment-2960226" class="wp-caption-text translated">3线伺服连接器，用透明胶带绝缘</p></div>
<p class="translated">修改之后，我使用通常的技术编译并上传代码到Pro Mini。我通过启动Arduino的嵌入式串行控制台来检查来自串行端口的数据。</p>
<h2 class="translated">在Pi 3上安装处理</h2>
<p class="translated">在使用屏幕上的探头代码之前，处理包必须安装在Pi 3上。我在命令行使用<strong> wget </strong>到<a href="https://processing.org/download/" class="ext-link" rel="external ">下载3.3 (ARM)版本</a>到Pi: <br/></p>
<div id="crayon-642311c50c9cc665155488" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-i">cd</span><span class="crayon-h"> </span>/<span class="crayon-i">home</span>/<span class="crayon-e">pi</span>
<span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-e">wget </span><span class="crayon-i">http</span>:<span class="crayon-c">//download.processing.org/processing-3.3-linux-armv6hf.tgz</span>
</pre>
</div>
</div>

<p class="translated"><br/>一旦文件在Pi上，使用tar将其解压到一个目录:<br/></p>
<div id="crayon-642311c50c9cf850507819" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-i">tar</span><span class="crayon-h"> </span>-<span class="crayon-e">xzvf </span><span class="crayon-i">processing</span>-<span class="crayon-cn">3.3</span>-<span class="crayon-i">linux</span>-<span class="crayon-i">armv6hf</span><span class="crayon-st">.</span><span class="crayon-v">tgz</span>
</pre>
</div>
</div>

<p class="translated">使用Processing非常简单，但有一点需要注意:首先必须设置串行端口，以便通过串行端口传入的数据符合程序的预期，尤其是比特率。</p>
<p class="translated">很多次，我发出了<strong> cat </strong>命令来读取串行线路(或USB)上的数据流，结果只是坐在那里想知道为什么没有任何值向下滚动到屏幕上。我选择了115，200的比特率。您可以使用任何您喜欢的速度，只要您将串行线(使用<strong> stty </strong>)以及Arduino和加工量规代码设置为相同的值。如果串行线路速度或代码中的内容被关闭，你将得到一堆有趣的字符，最好的情况下或者根本没有，最坏的情况下。在开始加工程序前不发出<strong> stty </strong>，会导致量规不显示指针。<br/></p>
<div id="crayon-642311c50c9d1665997041" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-e">sudo </span><span class="crayon-i">stty</span><span class="crayon-h"> </span>-<span class="crayon-i">icrnl</span><span class="crayon-h"> </span>-<span class="crayon-m">F</span><span class="crayon-h"> </span>/<span class="crayon-i">dev</span>/<span class="crayon-i">ttyS0</span><span class="crayon-h"> </span><span class="crayon-cn">115200</span>
</pre>
</div>
</div>

<p class="translated"><br/>完成后，进入目录并启动处理交互开发环境(IDE)。它的工作方式与<a href="https://www.arduino.cc/en/Main/Software" class="ext-link" rel="external "> Arduino IDE </a>相同。<br/></p>
<div id="crayon-642311c50c9d2076645518" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-e">cd </span><span class="crayon-i">processing</span>-<span class="crayon-cn">3.3</span>
<span class="crayon-i">pi</span>%<span class="crayon-h">  </span>./<span class="crayon-v">processing</span>
</pre>
</div>
</div>

<p class="translated"><br/></p><div id="attachment_2959972" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-2959972" decoding="async" loading="lazy" class="size-large wp-image-2959972" src="../Images/5ac4fc61a960056ee60e1fbfe5ae1ab7.png" alt="" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2017/08/3ad1e030-processing-screen-576x1024.png"/><p id="caption-attachment-2959972" class="wp-caption-text translated">在Raspberry Pi 3屏幕上处理IDE。</p></div>
<p class="translated">单击文件下拉菜单，然后单击“新建”菜单项。</p>
<p class="translated">因为我在我的Linux笔记本上开发了处理代码，所以我必须把代码交给Pi。最简单的方法就是简单地将<strong> scp </strong>的代码从笔记本转移到Pi上。<br/></p>
<div id="crayon-642311c50c9d4709354796" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-i">pi</span>%<span class="crayon-h">  </span><span class="crayon-i">scp</span><span class="crayon-h"> </span>/<span class="crayon-i">home</span>/<span class="crayon-i">rob</span>/<span class="crayon-i">sketchbook</span>/<span class="crayon-i">processing</span>/<span class="crayon-i">gauge2</span>/<span class="crayon-i">gauge2</span><span class="crayon-st">.</span><span class="crayon-e">pde </span><span class="crayon-i">pi</span>@<span class="crayon-cn">192.168.1.102</span>/<span class="crayon-i">home</span>/<span class="crayon-i">pi</span>/<span class="crayon-i">gauge2</span><span class="crayon-st">.</span><span class="crayon-v">pde</span>
</pre>
</div>
</div>

<p class="translated"><br/>读者可以从这个故事中复制/粘贴文本，到一个新的处理文件中，然后将其保存到sketchbook中。</p>
<p class="translated">以下是Pi屏幕仪表的处理代码:<br/></p>
<div id="crayon-642311c50c9d5649795009" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-c">/**</span>
<span class="crayon-c">Gauge code for the ARM chip in the Raspberry Pi 3. </span>
<span class="crayon-c"> </span>
<span class="crayon-c">The angle of each segment (in radians) is controlled by the data streaming in from the serial line. </span>
<span class="crayon-c">**/</span>
 
<span class="crayon-e">import </span><span class="crayon-i">processing</span><span class="crayon-st">.</span><span class="crayon-i">net</span>.*;
 
<span class="crayon-e">PFont </span><span class="crayon-i">font</span>;
<span class="crayon-i">float</span><span class="crayon-h"> </span><span class="crayon-st">x</span>,<span class="crayon-h"> </span><span class="crayon-t">y</span>;
<span class="crayon-e">String </span><span class="crayon-i">angle</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">"0"</span>;<span class="crayon-h"> </span><span class="crayon-c">// angle in degrees</span>
<span class="crayon-e">String </span><span class="crayon-i">distance</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">"0"</span>;<span class="crayon-h">  </span><span class="crayon-c">// distance in inches</span>
<span class="crayon-e">float </span><span class="crayon-i">anglef</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-cn">0.0</span>;
<span class="crayon-e">float </span><span class="crayon-i">angle1</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-cn">0.0</span>;
<span class="crayon-e">float </span><span class="crayon-i">segLength</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-cn">110</span>;
<span class="crayon-e">BufferedReader </span><span class="crayon-i">reader</span>;
<span class="crayon-e">String </span><span class="crayon-i">line</span>;
 
<span class="crayon-e">void </span><span class="crayon-e">setup</span>()<span class="crayon-h"> </span>{
<span class="crayon-h">   </span>
<span class="crayon-h">  </span><span class="crayon-e">size</span>(<span class="crayon-cn">350</span>,<span class="crayon-h"> </span><span class="crayon-cn">300</span>);
<span class="crayon-h">  </span><span class="crayon-e">strokeWeight</span>(<span class="crayon-cn">2</span>);
<span class="crayon-h">  </span><span class="crayon-e">stroke</span>(<span class="crayon-cn">255</span>,<span class="crayon-h"> </span><span class="crayon-cn">160</span>);
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-st">x</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e ">width *</span><span class="crayon-h"> </span><span class="crayon-cn">0.5</span>;
<span class="crayon-h">  </span><span class="crayon-t">y</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e ">height *</span><span class="crayon-h"> </span><span class="crayon-cn">0.8</span>;
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-i">font</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e">loadFont</span>(<span class="crayon-s">"LiberationSans-20.vlw"</span>);
<span class="crayon-h">  </span><span class="crayon-e">textFont</span>(<span class="crayon-i">font</span>);
<span class="crayon-h">  </span><span class="crayon-e">textAlign</span>(<span class="crayon-i">CENTER</span>);
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-i">reader</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-e">createReader</span>(<span class="crayon-s">"/dev/ttyS0"</span>);
<span class="crayon-h">  </span>
}
 
<span class="crayon-e">void </span><span class="crayon-e">draw</span>()<span class="crayon-h"> </span>{
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">background</span>(<span class="crayon-cn">0</span>);
<span class="crayon-h">  </span><span class="crayon-e">try</span><span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-i">line</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-i">reader</span><span class="crayon-st">.</span><span class="crayon-e">readLine</span>();
<span class="crayon-h">  </span>}<span class="crayon-h"> </span><span class="crayon-e">catch</span><span class="crayon-h"> </span>(<span class="crayon-i">IOException</span><span class="crayon-h"> </span><span class="crayon-st">e</span>)<span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-st">e</span><span class="crayon-st">.</span><span class="crayon-e">printStackTrace</span>();
<span class="crayon-h">    </span><span class="crayon-i">line</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-i">null</span>;
<span class="crayon-h">  </span>}
<span class="crayon-h">  </span><span class="crayon-e">if</span><span class="crayon-h"> </span>(<span class="crayon-i">line</span><span class="crayon-h"> </span>==<span class="crayon-h"> </span><span class="crayon-i">null</span>)<span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-c">// Stop reading because of an error or file is empty</span>
<span class="crayon-h">    </span><span class="crayon-e">noLoop</span>();<span class="crayon-h">  </span>
<span class="crayon-h">  </span>}<span class="crayon-h"> </span><span class="crayon-e">else</span><span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-c">// println("distance = ", line);</span>
<span class="crayon-h">  </span>}
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-i">distance</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-i">line</span>;
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">if</span><span class="crayon-h"> </span>(<span class="crayon-i">angle</span><span class="crayon-h"> </span>!=<span class="crayon-h"> </span><span class="crayon-i">null</span>)<span class="crayon-h"> </span>{
<span class="crayon-h">    </span><span class="crayon-i">anglef</span><span class="crayon-h"> </span>=<span class="crayon-h"> </span>(<span class="crayon-cn">180</span>-(<span class="crayon-e">float</span>(<span class="crayon-i">distance</span>))*<span class="crayon-cn">1.8</span>)*<span class="crayon-cn">3.1416</span>/<span class="crayon-cn">180</span>*-<span class="crayon-cn">1</span>;
<span class="crayon-h">    </span><span class="crayon-c">// scale the distance to an angle for the gauge</span>
<span class="crayon-h">        </span>
<span class="crayon-h">    </span><span class="crayon-c">// println(distance, " ",  anglef);  //in radians</span>
<span class="crayon-h">  </span>}
<span class="crayon-h">  </span><span class="crayon-e">pushMatrix</span>();
<span class="crayon-h">  </span><span class="crayon-e">segment</span>(<span class="crayon-st">x</span>,<span class="crayon-h"> </span><span class="crayon-t">y</span>,<span class="crayon-h"> </span><span class="crayon-i">anglef</span>);<span class="crayon-h"> </span>
<span class="crayon-h">  </span><span class="crayon-e">popMatrix</span>();
<span class="crayon-h">   </span>
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"Distance (in)"</span>,<span class="crayon-h"> </span><span class="crayon-cn">175</span>,<span class="crayon-h"> </span><span class="crayon-cn">50</span>);
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"0"</span>,<span class="crayon-h"> </span><span class="crayon-cn">35</span>,<span class="crayon-h"> </span><span class="crayon-cn">250</span>);
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"25"</span>,<span class="crayon-h"> </span><span class="crayon-cn">65</span>,<span class="crayon-h"> </span><span class="crayon-cn">150</span>);
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"50"</span>,<span class="crayon-h"> </span><span class="crayon-cn">175</span>,<span class="crayon-h"> </span><span class="crayon-cn">100</span>);
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"75"</span>,<span class="crayon-h"> </span><span class="crayon-cn">285</span>,<span class="crayon-h"> </span><span class="crayon-cn">150</span>);
<span class="crayon-h">  </span><span class="crayon-e">text</span>(<span class="crayon-s">"100"</span>,<span class="crayon-h"> </span><span class="crayon-cn">320</span>,<span class="crayon-h"> </span><span class="crayon-cn">250</span>);
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">noFill</span>();
<span class="crayon-h">  </span><span class="crayon-e">arc</span>(<span class="crayon-cn">175</span>,<span class="crayon-h"> </span><span class="crayon-cn">245</span>,<span class="crayon-h"> </span><span class="crayon-cn">240</span>,<span class="crayon-h"> </span><span class="crayon-cn">245</span>,<span class="crayon-h"> </span><span class="crayon-i">PI</span>,<span class="crayon-h"> </span><span class="crayon-i">TWO_PI</span>);
<span class="crayon-h">  </span>
}
 
<span class="crayon-e">void </span><span class="crayon-e">segment</span>(<span class="crayon-i">float</span><span class="crayon-h"> </span><span class="crayon-st">x</span>,<span class="crayon-h"> </span><span class="crayon-i">float</span><span class="crayon-h"> </span><span class="crayon-t">y</span>,<span class="crayon-h"> </span><span class="crayon-i">float</span><span class="crayon-h"> </span><span class="crayon-st">a</span>)<span class="crayon-h"> </span>{
<span class="crayon-h">  </span><span class="crayon-e">translate</span>(<span class="crayon-st">x</span>,<span class="crayon-h"> </span><span class="crayon-t">y</span>);
<span class="crayon-h">  </span><span class="crayon-e">rotate</span>(<span class="crayon-st">a</span>);
<span class="crayon-h">  </span><span class="crayon-e">line</span>(<span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-i">segLength</span>,<span class="crayon-h"> </span><span class="crayon-cn">0</span>);
<span class="crayon-h">   </span>
}
</pre>
</div>
</div>

<p class="translated">代码中有几个值得注意的地方。</p>
<p class="translated">在版本3之前，Raspberry Pi上的有线串行端口被指定为/dev/ttyAMA0。Raspberry Pi 3将这个名字重新分配给了蓝牙接口。相反，对Pi上的有线串行端口使用/dev/ttyS0，一切都会正常工作。当然，如果你想从USB连接的设备中获取数据，可以使用常规的/dev/ttyUSB0、/dev/ttyUSB1等。名字。</p>
<p class="translated">关于这个程序的另一个有趣的事情是角度测量是以弧度计算的，而不是以度。我必须缩放距离，从0到200英寸，到0到180度，这是手从水平左(0度)到水平右(180度)的扫动。值1.8将测量范围从0-180扩大到0-200。</p>
<p class="translated">最后，仪表上读数的刻度值放在带有“文本”线的仪表面上，靠近程序的底部。我只是选择了X和Y值，使它看起来正确。当然，有一点尝试和错误，以获得正确的。</p>
<p class="translated">将程序保存为文件名，如“gauge ”,然后按下处理IDE中的“运行”箭头按钮。在短暂的等待之后，液位计应该出现在LCD屏幕上，并根据超声波测距仪检测到的距离扫过一个弧。在开始处理之前，确保Arduino已通电，并且不要忘记那个<strong> stty </strong>语句。</p>
<p class="translated">这种仪表工作得很好，反应也很灵敏。把我的手放在徽章前面大约一英尺的地方，显示出大约12英寸，在仪表上。徽章放在我的桌子上，仪表显示大约70英寸，这是到天花板的距离。</p>
<h2 class="translated">下一步是什么</h2>
<p class="translated">屏幕上的仪表比伺服模型好得多。读数一致且快速。而且，硬件基本上没有变化。这就是物理计算堆栈的魅力所在。</p>
<p class="translated">我的原型小工具旨在通过古怪的设计，彩色视频屏幕，有时灯光和强烈的蒸汽朋克氛围来吸引注意力。当然，它们也是我在<a href="/tag/off-the-shelf-hacker/" target="_blank">现成黑客专栏</a>中使用的各种真实世界物理计算想法的测试平台。</p>
<p class="translated">当我们可以制造出你可以佩戴、触摸和展示给人们的东西时，为什么要在只会存在于工作间的项目上使用无聊的旧白色塑料试验板呢？</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>