# Adobe 内部开发人员平台之旅和课程

> 原文：<https://thenewstack.io/adobes-internal-developer-platform-journey-and-lessons/>

在过去 25 年多的时间里，我创建了软件组件和分布式服务开发框架，组建并领导了团队，最近，我正在为 Adobe 的服务开发、部署和管理系统提高开发人员的工作效率。我的团队在去年的 ArgoCon 上介绍了基于 Argo 的服务交付，并在博客中介绍了我们如何在 Adobe 推动云原生转变。

在整个过程中，特别是在平台开发的背景下，出现了许多主题——如果你愿意，可以说是警示故事——抽象、定制、支持、过度专业化、过度规划和平台团队自大。

## **纯粹的抽象是一个陷阱**

 [斯里尼瓦斯·佩里

Srinivas 是 Ethos 的总监，Ethos 是 Adobe 云平台工程的内部开发平台。在 Adobe 工作的 19 年中，他从负责发布一个核心组件的工具工程师变成了 70 多个 Creative Suite 组件的每日发布系统的所有者。他领导了共享云和创意云的早期部署系统的创建，然后通过构建云服务和云服务框架，最后到 Ethos。他的职责已经扩展到领导整个开发人员生产力和增长工程团队，为服务框架、供应、CI/CD、可观察性、诊断和开发人员支持提供能力。](https://www.linkedin.com/in/srinivas-peri-904b262/) 

在云的早期，Adobe 的每个团队都有自己的云账户、自己的部署系统和自己差异极大的成熟度。很快我们就意识到，我们应该实现标准化，这样成本节约、合规性、安全性和可靠性等关键问题就可以得到一次性解决，从而让所有人受益。

当我们在 2016 年开始这一旅程时，Kubernetes 还处于早期，尚未准备好大规模支持 Adobe 的云产品。最佳选择是 Mesos，但即便如此，我们也知道我们正处于一个不断变化的环境中。

因此，我们没有将用户暴露给原始平台，而是创建了一个抽象——一个“服务规范”服务规范描述了应该如何提供和部署服务的所有内容。然后，定制的内部软件在部署时将服务规范转换成必要的原语，我们的平台起飞了，迅速发展到支持 1000 多个服务和开发人员

但是随着我们的规模和需求的增长，我们基于 Mesos 的自主解决方案开始陷入困境，Kubernetes 已经成熟。是改变的时候了。这里是我们的抽象，我们的服务规范，拯救了这一天。

我们构建了一些定制迁移工具，能够在不停机的情况下将所有正在运行的服务从 Mesos 集群迁移到 Kubernetes 集群，我们的新后端只是将服务规范转换为 Kubernetes 配置，除了一些小问题，一切都正常工作。Mesos 集群被关闭，成本节约被庆祝。

再过几年，事情就不那么乐观了。我们的服务规范允许一种非常简单的“铺路”方法，适用于为 REST APIs 或 workers 服务的基本应用程序，我们支持近 4000 个这样的应用程序！随着 Adobe 越来越多的团队开始寻找平台成本节约以及安全性、合规性和可靠性的保证，他们的需求越来越多样化，不太符合我们的抽象所能提供的模式。

最大和最熟练的团队能够直接在我们的托管集群上构建定制解决方案，而不使用我们的抽象，因此他们可以利用 Kubernetes 的全部自由和功能。当然，他们还必须对部署系统承担全部责任，并在安全性和可靠性方面承担更大的负担。甚至那些对我们的固定解决方案相当满意的人也在鼓动要求更大的权力和更大的灵活性。

这是我们开始意识到我们被自己的抽象所困的地方。通过不允许团队使用部分抽象，同时在需要直接定制固定解决方案时绕过它，我们提供了一个不可伸缩的“全有或全无”的解决方案。

## 国产软件的诱惑是有代价的

随着时间的推移，我们的定制解决方案变得越来越复杂，添加功能以及跟上 Kubernetes 的新发展消耗了团队越来越多的时间，几乎没有创新的空间。我们落后了。更糟糕的是，我们没有考虑可扩展性。即使有最好的意图，当我们不能优先考虑他们的时候，让我们的用户贡献他们需要的改变是不实际的。

## **狂热支持推动大规模采用，但消耗平台团队资源**

在每一个阶段(首先是 Mesos，然后是 Kubernetes，以及我们接下来要做的一切)，我们都必须与制度惰性和对变化的(并非不合理的)恐惧作斗争。我们可以承诺很棒的事情，但是我们如何让我们的用户参与进来，从一个工作但过时的解决方案转换到更新更好的解决方案，同时解决他们对生产服务的任何变化的风险的合理担忧？总有一些勇敢的早期采用者对这项技术感到兴奋，但其他 90%的人是巨大的挑战。

这时你需要了解你的组织。找出几个在当前系统中挣扎的关键人物。也许他们在铺好的道路上，但没有更多的自由，他们无法成长。也许他们一直在维护一个定制的解决方案，但厌倦了那里所需的运营管理。看看那些最努力的团队，他们也在为公司的关键业务需求而工作。然后和他们一起工作。

找一些一直在构建新解决方案的工程师，让他们加入那些客户团队。带来专业知识，以身作则，尽一切努力让他们成功。将学到的经验应用到产品中。那些成功的故事将会在公司里传播开来，对变革的抵制将会开始减弱。

这是一个奇妙的开始方式，但它是不可持续的。它没有伸缩性。总会有一些业务关键型项目或团队值得“白手套”支持，但我们总会有少数工程师构建平台。如果没有精心的管理，支持可能会扩大到消耗他们所有的时间。实际上，我们不会雇佣一群支持工程师来为他们做这件事。

所以自助服务就成了关键。包含故障排除链接的智能错误消息。可以搜索可用文档来回答问题的智能代理。为能够为其团队解决问题的社区“冠军”提供认证和认可计划。各个层面的自动化。我们尽我们所能应用每一个乘数，然后对于进入团队的少数支持票，我们奖励快速解决和客户满意度。

## **开发者需要在广度和深度上进行投资**

无论我们构建什么样的解决方案，我们都需要主题专家(SME)来创建和维护它们。但是多年来我们与之斗争的另一个趋势是过度专业化。开发人员找到了他们的位置，他们成为他们组件的专家，不用担心其他任何事情——他们变成了孤岛。

这有一些好处，但也带来了很多问题，尤其是在平台的环境中。专家通常在他们关注的领域表现出极高的生产力。但是他们更有可能面对他们不了解的系统的集成问题。如果他们离开，就会成为组织的单点故障。

> 没有神奇的解决方法，但是我们发现如果我们能发现我们什么时候陷入困境并改变我们的模式，我们会得到很好的结果。

我们用三种方法解决了这个问题。我们通过培训和日常使用我们自己的交付物，确保每个团队成员都是平台的专家用户——我们吃自己的狗粮。然后，我们将每个团队成员分配到一个支持轮换小组，他们在那里为整个平台筛选新出现的问题。最后，我们鼓励移动性。我们根据开发人员的愿望和组织的需求，定期在组件之间转换开发人员。

然而，我们做这一切都很小心。开发人员专注于完成他们的工作仍然是至关重要的。将支持轮换分散到整个团队意味着这些轮换不会出现得太频繁，并且对于任何单个开发人员来说，组件转移都相对不频繁。这让我们能够创建我们的“T 型”开发人员，他们具有跨整个平台的知识广度和在几个组件中的深度。

## **完美是进步的敌人**

这些年来，我们还不得不应对另一件事，那就是短期胜利和长期规划。特别是当开始一些新的、有风险的事情时，随着时间的推移，组织倾向于转向谨慎。成立了规划小组。规格被写得非常详细，并且被无休止地审查。排班延长…

显然有一个更好的方法，“敏捷”，“早期失败”，所有的行业智慧。但是很容易陷入打折扣的运营模式——资源总是有限的，我们不想在没有确定性的情况下做出承诺。

没有神奇的解决方法，但是我们发现如果我们能发现我们什么时候陷入困境并改变我们的模式，我们会得到很好的结果。不要写完美的规范。找一个开发人员(或者两三个),给他们一个臭鼬工程，排除一切干扰，让他们创新几个星期。通过与选定的 lighthouse 用户密切合作来评估他们的概念证明，如果有希望，将它放回团队的其他成员和路线图中。利用这些见解，写一份简短的“一页纸的详细说明”,以确保愿景是清晰的。迭代并交付平台客户所依赖的价值。

## **平台团队将成为瓶颈**

随着时间的推移，任何平台团队的另一个自然趋势是忽视我们的客户。像“没有雪花”和“你的用例不适合”这样的短语开始变得很自然。但是如果平台团队迷失在草丛中追逐他们的完美解决方案，他们就变得无关紧要了。当我们告诉用户的都是“不”的时候，我们的用户就会开始寻找其他的解决方案。然后，拥有一个平台所带来的那些最初的乘数效应(对公司来说是关键的好处，如成本节约、合规性、安全性和可靠性)就失去了。平台就是这样消亡的。

我们通过与高层领导和关键客户保持联系来避免这种情况，特别是公司的新业务关键计划。我们确保平台不断发展以满足他们的需求。该平台必须足够通用，以使开发人员的生活足够简单和灵活，以支持所有需要的用例。不容易；这需要不断的再发明。

## **接下来是什么**

这是我们的旅程——从我们可以做得更好的想法，到大规模和持续的适应。现在我们又在重塑自己。我们处在一个转折点，我们的抽象太受限制，维护我们的定制解决方案消耗了团队，而我们的用户想要更多。

所以我们思考了我们学到的东西——抽象是好的，但是不灵活的抽象可能是一个陷阱；内部构建解决方案允许完全自由，但这种自由是以持续维护为代价的，我们开始寻找新的解决方案。一些可以区分我们罐装的“铺路”解决方案和未加工的 Kubernetes 的东西。

所以我们启动了臭鼬工厂项目，并派了几个开发人员去了解开源 CNCF 项目，特别是 Argo，以及我们如何将它们应用到我们的世界中。我们挖到了金子！

我们正在用服务规范的高度抽象来换取舵图的高度抽象。我们要用我们的定制组件交换阿尔戈。我们为可扩展性而设计。

> 我们的下一个挑战是通过创建与云提供商、监控解决方案、可观察性、分布式跟踪等更紧密的集成，将开发人员的生产力提升到另一个水平。

我们从一开始就把我们的主要 lighthouse 用户包括在开发过程中，结合了开源和内部资源的力量。我们再次构建定制转换工具，这一次是将我们的旧服务规范转换为 Helm charts 和 Argo 模板，然后我们的用户可以随意定制，为所有 Adobe 产品解锁我们的平台。

但我们不会就此止步。我们的下一个挑战是通过创建与云提供商、监控解决方案、可观察性、分布式跟踪等更紧密的集成，将开发人员的工作效率提升到另一个水平。我们开始将 Adobe 所有不同的内部产品整合到一个内部开发平台或 IDP 中。

有了这些，我们就能以更低的成本提供一个更好的平台，为我们的用户提供更高的灵活性和更低的摩擦。每个人都赢了。

## **成交记录**

我将是 9 月 19 日至 21 日在加州山景城举行的 [ArgoCon](https://events.linuxfoundation.org/argocon/) 的主题演讲人，我鼓励任何有兴趣的人[注册](https://events.linuxfoundation.org/argocon/register/)并加入 [Adobe 的 IDP 研讨会](https://events.linuxfoundation.org/argocon/program/schedule/)。

在本研讨会中，本着社区开放讨论的精神，我们将与您和其他社区思想领袖分享我们的旅程，并基于 Argo 和其他开源项目就如何实现 IDP 进行头脑风暴。

我们期待您的积极参与，并听取您对这些主题的想法和意见。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>