# 私有云与公共云:Kubernetes 如何改变平衡

> 原文：<https://thenewstack.io/private-vs-public-cloud-how-kubernetes-shifts-the-balance/>

[](https://www.linkedin.com/in/drew-dipalma/)

 [尼克·蔡斯

尼克是米兰蒂斯公司的技术和营销内容主管。他是一名前软件开发人员，Oracle 讲师，数百本教程的作者，以及十几本关于各种编程主题的书籍的作者或合著者，包括《理解 OPNFV》、《OpenStack 架构指南》和《面向普通人的机器学习》。](https://www.linkedin.com/in/drew-dipalma/) [](https://www.linkedin.com/in/drew-dipalma/)

有一点是肯定的:如果你是一家企业，你要么正在使用云，要么很快就会拥有某种能力。您的组织很有可能正在成为混合云用户。2021 年 Statista 对 750 家企业的调查发现，82%的企业采用了混合云计算战略。

然而，这个[混合采用统计数据](https://www.statista.com/statistics/817296/worldwide-enterprise-cloud-strategy/)并不意味着私有云与公共云的问题可以简单地通过采用两种云风格的混合来解决。相反，这意味着部署架构很复杂，发展很快，以“一劳永逸”的方式决定云架构毫无意义。

事实上，我们认为现在云技术堆栈中正在发生的事情释放了新的潜力。多年来，全球趋势是更多地采用公共云，这些新的动态正在改变云经济，重振私有云的理念，为管理公共云提供新的战略选项，并支持裸机模式，如 edge、物联网和“裸机云”产品。

## 云经济:1.0 版

云之旅之所以开始，是因为本地数据中心的构建和维护成本高昂。服务器价格昂贵，而且已经过时。他们需要来自多个服务提供商的设施、电力、冷却、内部网络、WAN 连接和主干连接。数据中心有架构师来隔离故障域和分配冗余资源，从而实现弹性。工作人员维护、操作、保障和保护这些设施。全职人员在优化它们之前分析它们的性能、利用效率和其他特征，以反映技术和业务需求，这通常是缓慢而昂贵的。承诺这一点，您仍然会被锁定在特定的位置、运营商、劳动力池，并可能陷入弹性悖论——为未使用的容量付费，但无法快速扩展以满足意料之外的需求。

这只是开始。为了实现低水平的运营效率，许多用户继续实施带有许可操作系统的“标准”数据中心堆栈(我指的是您，Red Hat)，添加用于服务器配置和许可证管理的工具，并最终将自己锁定在该解决方案集中。然后，为了提高速度并支持开发人员和业务部门自助服务，他们添加了一个类似的基于成本的私有云基础架构即服务解决方案(我看着你呢，VMware)。这提高了一些效率，但也带来了新的技能要求、新的锁定因素和大量新成本。

当然，与此相比，公有云看起来很棒。一切都是 OpEx。没有物理工厂，也没有运行物理数据中心所需的直接开销或人员。你永远不需要和运营商打交道。您可以从小规模起步，快速发展壮大，或者根据需要随时改变规模。您可以将工作负载放在提供商所在区域的任何地方，并且可以使用一组 web UIs 和/或 API 来提供和配置任何您想要的东西。这就像跳过整个“物理基础架构”步骤—所有的复杂性和限制—直接进入“弹性计算云即服务”部分。

### 暗示云的复杂性

除了没有免费的东西。每个使用公共云的人都知道每月收到一份奇怪的账单时的震惊。此外，雪上加霜的是，账单无法详细理解或证明，当然不符合正常的数据中心预期，例如，“好吧，我知道为什么我要为南北流量付费，但东西流量呢？”一旦受到冲击，云定价的复杂性也会使开发和实施降低成本的策略变得困难。即使是摘容易摘到的果子，比如关掉所有你不使用的虚拟机，也会感到困难。

与此同时，很少有组织在迁移到公共云时不考虑一些遗留问题。为了获得敏捷性和弹性，许多人牺牲了一致性。他们花了数年时间在内部构建以 VMware 为中心的基础架构代码，现在他们雇佣了经过 CloudFormation 认证的人员来为 AWS 环境创建和维护新的代码库。这样做的成本是巨大的和持续的。它可能会引入安全漏洞，为人为错误提供新的机会，并使一切变得更加困难 N 倍，其中 N 是您需要支持的平台数量。

在其他情况下，组织可能会尝试通过双倍下注来保持一致性，当他们进入公共云时，会带着他们的“这是我们的标准操作系统”和“这是我们的标准 IaaS”操作模型，保持传统的成本结构，尽管是按实例小时计量的。或者，他们可能会转向相反的方向，购买由公共云 Web UIs 和 API 驱动的私有云解决方案，获得一致性并减少对多样化技能的需求，但代价是更大的锁定。

## 云经济学:2.0 版

然而，将 Kubernetes 放入这个组合中，事情就变了:

*   Kubernetes 并不关心，或者说不应该关心 Linux 内核之外的事情。 如今，采用任何真实或虚拟的 box 和 Linux 变体来运行设计良好的 Kubernetes，通常只需要适当的资源供应(box 需要足够的内核/RAM/存储/网络+安全性来安全地完成工作)。)也许，但越来越少，需要一点 Linux 级别的改动(例如，在启动时创建一个内存 cgroup，在 ARM64 上运行 Ubuntu 20.04+时需要)。
*   **一致的 Kubernetes 支持激进的工作负载和配置可移植性*。*** 除非工作负载对硬件有特定的要求——大多数根本没有——否则您会期望在 Linux Spin X 上开发的工作负载可以在任何地方的任何 Linux X 机器上运行。部署在逻辑上自相似的 Kubernetes 集群上的容器和配置也是如此，或者应该如此。事实往往不是这样，因为人们构建或获得分散的集群，然后试图将它们编织到更大的架构中，以加速软件交付，使用 CI 自动化和其他工具，或进行手工劳动，以掩盖增量。
*   **除了在极端情况下，Kubernetes 保持复杂和棘手的应用程序像炸弹一样运行，不需要紧急的人工关注*。毕竟，这是它的设计初衷。只要您正确设计的工作负载不局限于某些稀缺资源，您就可以将插头从墙上踢下来，让固态硬盘填满，而客户甚至不会注意到。您还可以对堆栈中的所有内容运行滚动更新，而无需让应用程序或操作离线。***
*   **Kubernetes 允许您添加自定义功能来观察和维护复杂的系统状态，并根据声明性配置的变化将系统聚合到新的状态上*。这些异能可以从库伯内特所在的堆叠向上或向下发挥作用。因此，Kubernetes 运营商和类似的结构可用于管理应用(向上)和底层基础设施(向下)，如物理和虚拟主机、虚拟网络和云服务。***
*   **Kubernetes 可以配置和扩展，为应用程序提供一系列服务*。*** 存储、DNS，无论应用需要什么，Kubernetes 都可以代表工作负载提供和编排服务。这也是它的设计初衷。
*   **Kubernetes 鳞片像疯了一样，速度极快*。*** 不算启动节点所需的时间，一个现代的 Kubernetes 发行版基本上可以在几分钟内扩展到任意数量的节点。
*   **Kubernetes 可以是非常粒状的*。*** 一个现代的 Kubernetes 发行版应该允许开发者在一个单独的桌面容器或一对 Raspberry Pis 上启动控制器和工作器。同一个发行版应该同样能够运行 50/100/500 节点的集群。正如大多数长期用户所发现的那样，有机的“大量集群与一个巨大集群”模型在许多方面表现最佳(安全性、有限的爆炸半径等。).然而，只有当“许多小集群”都能够自我一致并集中进行生命周期管理时，才会产生真正的好处。

Kubernetes 的超能力在重要方面改变了游戏。如果您可以部署、扩展和管理 Kubernetes 的生命周期，您可以使用它来铺设公共和私有云基础架构，积极优化成本和开销，并将 Kubernetes 下面的一切都视为商品。

**降低云运营成本*。*** 用户的早期实验表明，这种方法可以快速降低私有云运营的总体拥有成本。如果您可以保持电源和空调运行，以 Kubernetes 为中心的基础设施在很大程度上可以自我管理，运营商可以“向上”优化工作负载，“向下”管理主机、操作系统和其他支持服务和层。这使得运行私有云，尤其是当它们变得更大时，成本和风险都大大降低。

**降低主机/来宾操作系统许可和支持成本*。*** Kubernetes 稍微关心一下 Linux 内核和 CPU，其他的就不多了。一个以 Kubernetes 为中心的基础设施并不能真正从昂贵的“企业级”Linux 中获益。由 enterprise Linux spins 提供的诸如专用加密(例如，FIPS)之类的特性正在迅速进入容器运行时和 Kubernetes 发行版。Kubernetes 本身可以管理原始裸机基础设施，使服务器池管理解决方案变得不那么重要，尽管这些解决方案在上下文中肯定会有所帮助。

**降低硬件成本*。例如，全球向更便宜的 ARM64 CPUs 的转移正在加速，部分原因是容器和 Kubernetes 使转移和重建工作负载变得更容易。在某些领域甚至有人说，以性能为导向(相对于以成本、能源或其他为导向)的硬件发展可能会停滞，特别是在公共云中，因为“降低”硬件的经济性对最大规模的提供商非常有吸引力。与此同时，可以说更重要的是出于监管、管辖和主权原因的位置和连接性(例如，对客户的 ping 时间短)。***

这对私有云运营商来说是个好消息。如今，构建集中式计算/存储/网络比以往任何时候都更便宜。数据中心本身正在发生变化，变得越来越小，使用更少的电力和冷却，分布在更多的位置，并向边缘移动，进入微小设备的星座。

**运行私有 IaaS 云的新的、更便宜的方式*。*** 以 Kubernetes 为中心的基础设施是运行复杂、关键软件的理想选择，能够以较低的运营成本稳定、灵活地运行。例如，裸机服务器池可以在开源基础设施即服务 OpenStack 下运行 Kubernetes 作为底层，而没有性能损失(KVM 虚拟机管理程序直接在主机上运行，由 sidecars 管理)，提供更高的弹性、无缝更新和轻松扩展，同时为传统虚拟机、网络和存储提供强大的支持。

**自动化成本降低*。*** 精心打造一个安全、可靠、高性能的工具链，用于开发、测试、试运行和交付生产应用，这对于保持客户满意度和降低业务风险至关重要。如果您的目标是一致的 Kubernetes 集群模型(而不是不同的私有云和公共云基础架构)，您只需要做一次，然后花时间改进与您的底线相关的内容。

## 到处都是一致的 Kubernetes

使用 Kubernetes 作为“基础设施”的底线要求是，您需要能够在任何地方部署、观察和管理一个一致的 Kubernetes 集群模型的生命周期。这使得以 Kubernetes 层为目标的应用程序、配置、CI/CD 和操作自动化能够以相同的方式工作，无论它是针对运行在服务器机房中的刀片式服务器上的集群还是运行在 AWS 实例上的集群。这意味着有人(希望不是你)正在启用这一功能，并使 Kubernetes 能够优雅地积极管理各种底层基础设施。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>