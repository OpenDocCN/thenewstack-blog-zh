# 如何解决 Kubernetes 持续的存储挑战

> 原文：<https://thenewstack.io/how-to-solve-kubernetes-persistent-storage-challenges/>

[](https://www.linkedin.com/in/rvandepoel/)

[Romuald vande poel](https://www.linkedin.com/in/rvandepoel/)

[Romuald 是 Ondat 的云解决方案架构师，带领客户踏上数字化转型之旅。他在企业 IT 领域拥有丰富的技术经验，曾在 Red Hat 和 NetApp 担任过客户支持、咨询和交付方面的领导职务。Romuald 就企业架构、开发运维、云原生和敏捷实践为组织提供建议。](https://www.linkedin.com/in/rvandepoel/)

[](https://www.linkedin.com/in/rvandepoel/)[](https://www.linkedin.com/in/rvandepoel/)

与传统的云部署方法相比，Kubernetes 和容器化可能会带来变革——或者至少，这是它在开发环境中的表现。然而，平台经理、基础设施负责人和其他负责监督生产环境的专业人士都知道，集装箱化的变革性好处是有限的。

这是因为 Kubernetes 的快速故障转移、可伸缩性、资源效率和其他优势通常只适用于短暂的工作负载。无状态应用程序——那些不需要从一个会话到下一个会话存储数据的应用程序——在 Kubernetes 基础设施中的表现确实令人钦佩。另一方面，需要持久存储的有状态应用程序在生产时仍然依赖于遗留的基础设施。因此，只要您的应用程序依赖于持久的工作负载，Kubernetes 带来的所有这些好处都是遥不可及的。

幸运的是，与 Kubernetes 持久存储系统相关的挑战可以通过正确的方法解决。让我们探索一下为什么在 Kubernetes 中使用有状态应用程序如此困难，平台经理是如何应对的，以及他们有哪些选择。

## 库伯内特持久存储悖论

按照设计，容器最适合无状态应用程序。Kubernetes 能够以快速和动态的方式创建和删除容器，因为这些容器中的应用程序打包了它们运行所需的所有依赖项。无论新的容器在哪里建立——同一个集群还是不同的云提供商——Kubernetes 都能确保应用程序能够访问其运行所需的基本资源。

容器的动态创建和删除对于需要持久存储数据的应用程序来说不太好。当一个有状态的、容器化的应用程序在 Kubernetes 集群中被创建或销毁时，它必须始终知道它的数据在哪里，拥有对该数据的高度访问权，并且能够确保其完整性。如果应用程序的存储状态在每次容器关闭时都被破坏，这是不可能的。

开发人员和平台经理想要两个世界的最好的东西:他们想要快速的故障转移、容易的部署和容器的效率以及有状态工作负载的持久性。有多种方法可以为基于云的应用程序建立持久存储。但是，正如我们将看到的，许多常见的方法都有其缺点。

## 平台管理者在做什么？

### 建立他们自己的系统

在金融和医疗保健行业等不允许停机和短期解决方案的行业中，许多人投入了大量时间和精力来部署传统的存储系统，以管理其有状态的应用程序。

这种方法的主要缺点是它不能提供使用 Kubernetes 所带来的好处。它将不受平台限制，需要在非常特定的环境中运行，难以扩展，更有可能经历停机，并且您必须以高度手动的方式管理存储、故障切换等事项。

此外，除非加入您的组织，否则任何人都无法发展传统存储阵列方面的专业知识。对他们进行系统培训需要时间，一旦完成，在你的组织中仍然只有少数非常重要的人理解系统如何工作。它还会减少 Kubernetes 一等公民(开发人员)的自助服务体验，从而促成一个主要的云反模式。

也许最重要的是，传统存储系统缺乏像 Kubernetes 这样的大型开源项目所固有的知识和创新。您的系统将更快地遭到破坏，问题将需要更长时间来修复，更新将会以更慢的速度进行。

### 构建解决方案

显然，不使用 Kubernetes 会带来很多负面影响。为了给 Kubernetes 提供持久存储并使其与有状态应用程序一起工作，一些开发人员选择构建神秘的工作区。但是这些解决方法的问题是，它们通常会抵消使用 Kubernetes 的好处。

例如，您可以将应用程序的存储固定到其容器中，这意味着如果该节点发生故障，Kubernetes 不能移动您的应用程序。或者，您可能会找到一种方法来将云存储附加到您的容器中，但这可能会大大降低您的系统速度，并造成另一个潜在的故障点。

## 替代方法:软件定义的云原生存储

理想情况下，您的应用程序可以将存储视为另一个声明的需求。例如，一个容器化的应用程序在访问它声明的负载平衡器时，不会突然遇到问题。为什么存储不能以类似的方式工作？

幸运的是，有一类解决方案可以提供这样的功能。 [Storage orchestrators](https://storageos.com/orchestrated-storage-containers) 是软件定义的云原生解决方案，支持应用将存储视为另一项公开的需求。它们提供的存储与应用程序本身连接在同一个容器上，并且能够在节点故障时继续运行。

这些解决方案通过将集群的所有存储数据聚合到共享池中来工作。当应用程序请求访问其数据时，存储协调器充当中介。它们从池中获取相关卷，并将其提供给集群中发出请求的任何容器。这样，当给定容器关闭或节点离线时，存储的数据在群集的池中仍可访问。

对于平台经理来说，这意味着他们不需要为有状态工作负载建立复杂的外部存储解决方案来匹配开发人员的工作环境。相反，Kubernetes 以与无状态应用程序完全相同的方式编排其有状态应用程序。

## 确定合适的存储协调器

与使用传统存储阵列或变通解决方案相比，使用 storage orchestrator 将大幅提高性能、可靠性和可扩展性。但这并不意味着每个存储协调器都同样适用于相同的使用情形。

我们委托进行了一项研究，比较了四种领先存储协调器的性能:

*   长角牛
*   OpenEBS
*   鲁克/CEPH
*   翁达特

在这项研究中，每个 orchestrator 都在相同的硬件和软件配置上接受了相同的测试，以评估它们在不同环境下的性能。对于希望实施最佳存储协调器来管理 Kubernetes 生产中的持久存储的平台经理来说，这可以作为确定正确解决方案的第一步。[你可以在这里阅读研究结果。](https://resources.storageos.com/downloadbenchmarkreport)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>