# GitOps 中的推与拉:真的有区别吗？

> 原文：<https://thenewstack.io/push-vs-pull-in-gitops-is-there-really-a-difference/>

[](https://www.linkedin.com/in/williamchia/)

 [威廉·基亚

威廉·基亚是一位注重产品的讲故事者，自 90 年代末以来，他一直在精心制作代码和副本。在 GitLab，William 领导着产品营销团队。在加入 GitLab 之前，William 的职业生涯主要是为 Twilio 和 Digium 等公司的技术用户和买家服务，Digium 是开源 Asterisk 的赞助商。](https://www.linkedin.com/in/williamchia/) [](https://www.linkedin.com/in/williamchia/)

GitOps 在有人给它起名字之前很久就存在了。自从第一个基础设施即代码工具出现以来，人们发现对环境定义进行版本控制并自动执行变更是非常有意义的。你可以说那些早期的开拓者是在用 Git 做操作。或者你可以叫它 GitOps。就像敏捷、DevOps 或原生云一样，通常具有工程倾向的人可能会问，“我们真的需要另一个营销术语吗？”作为一个既是工程师又是营销人员的人，我认为术语 GitOps 更多地来自工程需要，而不是营销需要。

软件工程的一个基本原则是抽象的实践。我们将可重复的步骤抽象成函数，将函数抽象成库，将库抽象成框架，然后我们将这些框架一起构建成工具，你不断地抽象，直到你得到 Kubernetes。这与我们语言中使用抽象的概念非常相似。你可以用一个词“GitOps”作为一个简单的接口来表达更丰富和更深刻的含义。

然而，正如当您知道如何调用 API 但不理解底层执行时会出现问题一样，调用 GitOps 也会返回意外的结果。

对于 GitOps 的两种主要风格:“推”和“拉”来说，情况确实如此。当使用术语“GitOps”时，有些人非常明确地指出他们指的是哪种风格，而其他人则更笼统地使用这个术语来表示“推”或“拉”

那么，push 和 pull GitOps 真的有什么区别吗？

是的，有。你现在可以停止阅读了。

但是，如果你想知道区别是什么，为什么它很重要，留下来寻找答案。

## 推:老可靠的 GitOps

在这种风格中，您使用 CI/CD(持续集成/持续交付)管道来将变更推送到您的环境中。管道由代码提交或合并触发。

### 为什么要推？

**简单性**:因为 push 使用了广为人知的 CI/CD 工具，它将是您组织中最广泛的工程师最容易使用的工具。这通常意味着您可以更快地开始工作，并拥有更广泛的协作。

**灵活性**:今天，大多数拉式 GitOps 代理只在 Kubernetes 运行。如果您想部署到 Kubernetes 之外的任何地方，您需要将配置推送到那个环境。有可能使用运行在 Kubernetes 集群中的 pull GitOps 代理来协调部署到外部目标——如虚拟机和裸机——但最终您还是要回到 push。代理正在向这些环境推进。您最终需要管理许多相同的安全问题，例如将凭证存储在环境外部，以及打开网络防火墙端口以允许入站连接。

**效率**:针对您的云原生和传统工作负载采用相同的部署方法进行标准化，可以提高您的效率。通过减少认知开销，您可以使新团队成员的入职和培训更加容易，同时确保现有团队成员专注于解决问题，而不是理解多种技术。

**优化带宽**:让一个 Kubernetes 代理不断轮询您的 Git repo 是否有变化，这对于一些集群来说可能不是问题，但是在大规模上，您会体验到网络资源的大量消耗。此外，如果您的 Git 和容器注册工具需要处理来自数百个持续轮询状态的集群的请求，它会承受很大的负载。您可以减少轮询间隔，但这样也会增加代码提交和部署之间的延迟。使用推送式 GitOps，您可以在快速、低延迟部署的同时最大限度地降低网络和工具负担。

## 吉托普斯的新成员

使用 pull GitOps，在您的环境中运行的代理会不断地轮询您的 Git repo 和/或容器注册表是否有变化。当代理检测到定义的状态和运行状态不匹配时，它会将定义的配置拉入环境中。

### 你应该什么时候拉？

**云原生**:如果您的所有或大部分工作负载都在 Kubernetes 上运行，那么使用代理来引入部署可能是简单而高效的选择。使用和管理 CD 代理的方式与所有其他 Kubernetes 操作员类似。

**安全性**:使用 pull GitOps，您可以降低安全性和合规性风险。因为 CD 代理在集群内部运行，所以不需要在外部 CI 中存储凭据。同样，您可以减少或消除防火墙中允许入站连接的漏洞。

**一致性**:推送 GitOps 通常只在一个方向上起作用，从 Git repo 到环境。将 GitOps 工作拉向相反的方向。代理不仅可以轮询您的 Git repo 和容器注册表的变化，还可以将集群的状态与 Git 中定义的状态进行比较。如果手动或从其他来源对群集进行更改，这可以检测和修复配置漂移。推送式 CI/CD 可以设置为定期轮询您的环境，将运行状态与定义的状态进行比较，并在发生配置漂移时恢复到定义的状态，但这是[您需要设置](https://www.youtube.com/watch?v=Jh3pjr0uqWc)的额外工作。大多数 Pull GitOps 代理都附带了这种双向比较功能，您只需使用该代理，无需额外设置即可利用这一功能。

## 底线

说到底，没有必要过分严格。当谈到如何练习 GitOps 时，可以有一些推拉动作(双关语)。权衡您的团队或组织的需求与每种方法的利弊，将有助于您决定采用其中一种或两种方法。虽然每种风格都不相同，但两者都将为您带来好处，例如通过合并请求/拉取请求管理运营带来的增强的协作和法规遵从性，以及自动化基础架构和部署带来的增强的稳定性和弹性。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>