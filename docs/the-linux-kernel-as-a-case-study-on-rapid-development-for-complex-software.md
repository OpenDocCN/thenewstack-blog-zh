# Linux 内核作为复杂软件快速开发的案例研究

> 原文：<https://thenewstack.io/the-linux-kernel-as-a-case-study-on-rapid-development-for-complex-software/>

应用程序开发是一个过程，应用程序越大越复杂，过程就越复杂。在开源世界中，有许多开发项目超出了 most 的范围。像 Kubernetes、Nextcloud、OpenShift、SUSE Manager 和(当然)Linux 内核这样的项目。

这些项目完全超出了可以由少数用户编码和管理的应用程序的范围。以 Linux 内核为例。自 2005 年以来，超过 15，000 名开发人员参与了这个项目。这是为什么呢？Linux 内核是一个非常复杂的生态系统，包含了比大多数人意识到的更多的活动部分。

但是开发过程并不仅仅取决于项目的规模。也受快速发展需要的影响。Linux 内核驱动着全球大量的设备。成千上万的企业依赖于 Linux 内核，所以当内核出现问题时——比如发现了漏洞——开发的速度只有一个速度:快速。

## 内核开发人员面临的挑战

为 Linux 内核进行开发面临许多严峻的挑战。你不仅要和全球的开发人员打交道(在不同的时区工作，说不同的语言，以不同的速度工作)，你还会有一种被孤立的感觉。

想想看，Linux 内核是这个星球上最大的软件项目，有超过 2100 万行代码。所有这些代码不仅仅是在一个旗帜下开发的。相反，有许多专业领域。

“内核涵盖了大量领域，从硬件支持到调度算法，”[红帽的首席内核工程师劳拉·阿博特](https://www.linkedin.com/in/laabbott/)说。这些领域中的每一个都很容易被认为是一个独立的项目。“当你在一个领域工作时，你不仅要熟悉技术细节，还要熟悉该领域的流程特点。如果你最终需要在内核的不同区域工作，感觉就像是在一个完全不同的项目中工作。”

按照 Abbott 的说法，这种“区域隔离”使得内核开发既有挑战性又有趣。“总有一些别的东西要学，没有人能知道内核的每一个方面，”Abbott 说。

来自 [Nextcloud](https://nextcloud.com/) 的开发团队采取了完全不同的方法。当询问他的团队关于快速开发的问题时，Nextcloud 的联合创始人 [Jos Poortvliet](https://twitter.com/jospoortvliet) 回答道:“团队中有一半人告诉我我们不这样做。就像我们不做敏捷等一样。你知道，对于开发者来说，这是黑白分明的。如果你做了 90%，你就不会去做，因为要么全有，要么全无。”

Poortvliet 还要求他的团队列出复杂项目面临的挑战。他收到了以下回答:

*   不确定你所追求的解决方案，不确定你自己的代码。难题让你感到哑口无言。
*   利益冲突。首席执行官想要 X，营销想要 Y，销售想要 z。工程师只想清理，不想淹没在技术深度中。
*   理解客户/顾客的要求。

## 贸易工具

每个开发人员都有他们最喜欢的项目工具。Linux 内核也不例外。事实上，对于这样一个复杂的项目，拥有合适的工具意味着完成工作和落后之间的差别。

对于雅培来说，最重要的工具是那些能够更快发现问题并帮助确保正在开发的东西是正确的。

“内核有许多树内特性，可以在运行时捕捉问题。“lockdep 是几年前实时内核为捕捉死锁等锁定问题而开发的一个特性，”Abbott 解释道。另一个特性是 KASAN (KernelAddressSANitizer)，它是为了在运行时发现不正确的内存使用而开发的。这些特性“有助于立即暴露错误，否则可能需要数千小时的测试才能暴露。”

一个不可忽视的贸易工具是文件。如果没有可靠的、写得好的文档，复杂项目的开发就会经常停滞。

“我依靠内核中包含的文档来解释我可能不熟悉的部分代码，”Abbott 说。“记录流程，让每个人都遵循相同的流程，有助于让每个人的事情都变得更顺利。”

Canonical 的工程总监 Patricia Gaughen 表示，对于开源项目来说，“最重要的开发工具是 git，它已经成为开源事实上的版本控制系统。”为什么她觉得饭桶变得如此重要？“协作软件开发中最大的减速集中在与他人合作上，git 使得在协作环境中迭代、共享和集成变更变得更加容易。”

Nextcloud 开发人员提供了一个工具列表，这些工具是他们开发特定复杂项目所依赖的。他们的贸易工具包括:

*   饭桶。
*   GitHub 和它的工作流，以及来自那里的许多 bot(替代方案如 Bitbucket 和 GitLab 提供了类似的工具和工作流)。
*   自动化测试工具，例如 Jenkins，它是 GitHub 及其工作流程的一部分。
*   偶尔亲自见面。

“我认为，虽然它不是一个工具，但我们从这样的分布中受益匪浅，”Poorvliet 补充道。“我们有五名工程师在办公室工作，其余的在家里工作，遍布欧洲甚至更远的地方。这迫使人们在交流中遵守纪律。(你)不能把不在现场的人排除在外，因为每个人都不在现场。”

## 补丁提交流程

根据 Abbott 的说法，上一届内核维护者峰会的成果之一是推动了整个内核工作流程的改进。关于她自己的工作流程，Abbott 说，“在我的个人工作流程中，我比我认识的许多开发人员更不注重过程。作为一名发行版维护人员，我最终会接触到大量我可能不熟悉的内核领域。”

雅培的过程包括通过她正在查看的任何测试或用例来确保特定的补丁工作。她确保打开相关的调试选项，并运行相关的单元测试。至于她提交过程的具体细节，Abbott 说，“我仍然使用 git-send-email 来发送补丁，并总是确保在最终发送之前对补丁进行最后一次人工审查。”

对于 Canonical，根据 Gaughen 的说法，补丁提交过程是这样的:“我们从 git 导出补丁，使用 [get_maintainer.pl](https://github.com/torvalds/linux/blob/master/scripts/get_maintainer.pl) 脚本来确定补丁应该发送到的维护者和邮件列表，然后使用 git-send-email 发送补丁。”

## 开源与闭源

哪种类型的开发最适合复杂软件的快速开发？任何做过任何类型开发的人都应该知道这个问题的答案。如果有任何疑问，Abbott 明确表示，“我认为在这一点上可以肯定地说开源已经赢了。”

与类似的闭源项目相比，开源开发有很多优势。例如，在开源开发中，你让每个人一起合作解决一个问题。

“没有一个人能回答所有的问题，所以通过合作，在困难的问题上更容易取得进展，”艾伯特说。"在公开场合工作还能让别人指出你可能没有想到的错误."

从规范的角度来看，Gaughen 说，“开源并不一定有什么固有的东西使它更适合快速开发。”对于 Gaughen 来说，更多的是关于开发过程。

“虽然，我认为，开源已经被迫完善这些过程，以适应为单个项目工作的大量开发人员，但没有理由为什么相同的过程不能被用于闭源项目，”她说。

Nextcloud 开发人员提供了开源模式提供的一系列东西:

*   “从源头解决问题”的障碍要比解决问题低得多。根据 Poortvliet 的说法，“我们在 Nc 经常超越我们的代码库，讨论问题，提交修复，或者审查我们所依赖的项目的代码。显然，这种情况在我们自己的代码库中发生得更多。”Poortvliet 意识到这可能发生在封闭源代码的公司，他说，“……由于更‘封闭’的文化，这往往不会发生，例如，我相信 MS Office 团队以重写大量 Windows APIs 而闻名。这还不是说他们组织外部的代码，而是组织内部的代码。”
*   因为你知道你的代码对每个人都是可见的，所以在质量和可读性上有更多的社会压力。对此，Poorvliet 提到了一个涉及 Linux 创建者 Linus Torvalds 的例子。“关于代码中的注释，Linus 有一句名言，他们应该总是描述代码的目标，而不是它做什么，因为‘许多内核开发人员说 C 语言比英语好，因此 C 语言本身应该是可读的，注释是可选的’。”
*   由于相对较高的新人比率和人员流动率，项目更加习惯和适应可维护性并让人们跟上速度。第一个意味着更多的分裂。在这个问题上，Poortvliet 说，“有一个著名的 Linux 与 Windows 内核的依赖图——两者都很复杂，但 Linux 更有组织性。这在很大程度上是因为团队能够相对独立地工作非常重要，因为整个代码库一直都在发生变化。”Poortvliet 将这个问题带到了一个想法上，这个想法可能是项目中封闭与开放源代码的核心。“在一个大型、复杂的项目中，相互依赖是地狱，可能是封闭源代码世界中大型软件项目容易出错的主要原因之一。我们也是如此，我们非常模块化——‘一切都是应用’当然是一个生态系统，但也是一个技术优势，让我们的代码库更加模块化。”他补充道，“新人很少(如果有的话)从为‘核心’做贡献开始，但几乎总是为应用做贡献——随着时间的推移，他们开始熟悉核心。所以核心要小，给我们更有意义的贡献。”
*   工具和测试。Poortvliet 说，由于新来者的不断涌入，这意味着，“更多的自动化测试和检查，以及严格、协作和经常强制执行的流程已经到位，新东西得到迅速实施，因为‘这很酷’(我们必须酷到吸引新人:D)，因为有人觉得做这件事很有趣，我们不会告诉所有人该做什么。”

## 开发过程中的故障

不可避免的是，开发管道会在某个时候中断。每个项目都会发生。但是随着 Linux 内核的发展，你有了许多经验丰富的维护者，他们负责确保工作流程向前发展。

“维护人员只是人，有时在代码审查期间会错过看到补丁或 bug，这会减慢速度，”Abbott 说。

正在考虑的一项努力是将自动化应用到工作流程中。根据 Abbott 的说法，这样做是为了让维护人员可以把时间花在其他有价值的工作上。她特别提到，“我很高兴看到人们越来越关注内核中的持续集成和自动化。内核有各种形式的自动化已经有一段时间了。英特尔开展了为期 0 天的 bot 项目，构建并测试补丁程序。这已经成为内核开发过程的一个关键部分有一段时间了。”

但是因为我们是在和人类打交道，如果在补丁系列上有分歧，开发可能会停滞不前。艾伯特说，解决办法是沟通。“提交者能清楚地说明为什么他们希望该系列被包括在内吗？维护者能解释为什么他们不同意所采取的方法吗？当交流停止时，开发过程就完全停止了。”

从 Gaughen 的角度来看，“特别是对于内核来说，故障通常源于这样一个事实，即维护人员可能是他们维护的子系统补丁的单点故障。”

考虑到内核代码库有多大，这应该是显而易见的。但不仅仅是内核的范围问题，还有维护人员有生命等情况使其不可用。对此，她说，“当发生一些事情使它们在一段时间内不可用时，为该子系统合并补丁的进度会大大减慢。有时其他维护者会在这种情况下通过合并一些补丁来提供帮助。”

## DevOps

但是 DevOps 呢？这种独特的开发方法已被全球众多企业级公司采用。对于那些不熟悉这个术语的人来说，DevOps 是一组实践，它将软件开发和 IT 运营结合起来，目标是缩短系统开发生命周期，并提供 CI/CD。

但是 DevOps 可以应用到 Linux 内核吗？Gaughen 说，一个完整的 DevOps 过程对于这样一个项目可能没有意义。然而，她说“……devo PS 的元素可以用于内核开发。”高根提出了一个可能的因素。“一个例子是 linux-next 树，它是一个持续集成环境，用于将进入 linux 下一个开发版本的变化。许多集成和测试都在那里进行，这有助于社区更快地找到并修复 bug 和集成问题。”

Linux 内核是一个庞大的项目，需要许多开发人员和开发团队的快速开发。多年来，这个项目一直是一个标准的旗手，展示了一个大型项目如何像一台运转良好的机器一样运转，以及当问题出现时如何解决的研究。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>