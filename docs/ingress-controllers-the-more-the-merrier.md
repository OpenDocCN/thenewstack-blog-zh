# 入口控制器:越多越好

> 原文：<https://thenewstack.io/ingress-controllers-the-more-the-merrier/>

就像软件开发领域的一切一样，尤其是在今天的云原生世界中，碎片化无处不在。与任何单一类别的工具(服务网格、编制器和可观察性工具)一样，您会发现大多数组织都在使用多个“品牌”和各种工具。

我们可以确定这种分裂的两个主要原因:一个是故意的，另一个不是。让我们先谈谈非故意原因，以及它与我自己的服务网络公司 [Traefik](https://traefik.io/) 的关系。

## 非故意碎片化

### 原因 1:违约的力量

 [埃米尔·沃奇

Emile Vauge 是 Traefik Labs 的创始人兼首席执行官，trae fik Labs 是一家领先的云原生网络公司，被世界上最大的在线企业使用，包括易贝、康泰纳仕和美国宇航局。Emile 也是 Traefik 的创始人，该项目是 Docker Hub 的十大项目之一，下载量超过 20 亿次。在 Traefik Labs 之前，Emile 花了 10 多年时间为网络规模和大型企业组织构建应用程序，他在云原生网络挑战方面的第一手经验激发了他创建 Traefik 的灵感。](https://twitter.com/emilevauge) 

入口控制器在很大程度上已经成为一种商品——更像是一种工具。开发者刻意选择入口控制器的日子已经一去不复返了。当然也有例外。总有例外。

这并不是说开发人员没有首选的入口控制器，但这意味着他们最终使用的大多是他们正在使用的 Kubernetes 发行版(或另一个容器编排平台)附带的东西。换句话说，像大多数人一样，大多数开发人员对“包含”的内容非常满意这是有道理的。拆除和更换你的入口控制器并不是大多数开发者的首要任务，尤其是当你有一个功能或一些其他紧张的截止日期(或有趣的项目)要开始的时候。

假设我是一名在 x 公司工作的工程师，我的老板过来让我开始一个新项目。我有两周时间来完成概念验证。我的经理没有指定我可以或不可以使用哪些工具。重点是确定项目和业务需求的范围。这不是一个复杂的项目。

在我管理的所有其他项目之间，以及不想把所有时间都花在工作上的愿望，我启动了一个新的开发集群，为了这个例子的目的，我选择的发行版碰巧与 Traefik 捆绑在一起。举例来说，我不打算花宝贵的精神周期把 Traefik 去掉，换成 [Nginx](https://www.nginx.com?utm_content=inline-mention) 。我将设置集群，然后开始构建我的应用程序。

想象一下，这种情况发生在您组织中的许多其他团队身上。每个团队对给定的 Kubernetes 发行版都有轻微(或没有)的亲近感或偏好。大多数 Kubernetes 发行版都有一个默认的入口控制器。无论发行版附带什么，团队或个人通常都会坚持使用，直到有人找到时间和精力来改变它。基本上从来没有。这就是违约的力量。

### 原因 2:开发与生产环境

入口控制器碎片的另一个重要驱动因素是，在许多组织中，运营部门使用他们选择的入口控制器来加速集群。为了便于论证，姑且说那是 Nginx。但是对于我的本地开发环境，我更喜欢使用 K3s，它是与 Traefik 捆绑在一起的轻量级 Kubernetes 发行版。在这个例子中，您使用了两个不同的入口控制器。在这些场景中，工程师们经常会问自己如何才能确保将他们的应用程序从开发环境顺利移植到生产环境中。

### 原因 3:缺乏(Kubernetes)标准化

入口控制器领域碎片化的第三个驱动因素是 Kubernetes 本身缺乏标准化，尤其是在用户需要的特性和功能方面(例如访问控制、证书管理、中间件等)。这种缺少用例的空白允许供应商开发他们自己的解决方案。一旦每个人都开始分叉项目，分裂随之而来。像我们这样的入口控制器提供商创建了我们自己的实施和独特的解决方案来满足这些用例需求，经常需要依赖新的和/或自定义的调整，如自定义注释或自定义资源定义(CRD)。谷歌本身就是一个很好的例子，也是填补 Kubernetes 留下的空白的先行者。他们在标准化 API 规范方面取得了一些进展(Traefik Labs [为](https://traefik.io/blog/kubernetes-ingress-service-api-demystified/)做出了贡献)。

这里需要注意的是，Kubenetes 缺少的功能是有意这样设计的。入口规范是一个基本接口，开发人员可以根据它编写代码，有意将实际处理留给第三方(如 Traefik)。开源项目本质上使得派生或构建一个衍生项目变得容易。Kubernetes 也不例外。这实际上是在开源世界中作为“第三方提供商”工作的最大乐趣之一。它使得 Traefik 这样的项目成为可能，甚至是必要的。换句话说，我并不是说这种不单调是一件坏事；如果有的话，它为像我们这样的项目和公司创造了机会。用户更能感受到这个问题，尤其是组织，他们必须处理开发团队使用各种衍生解决方案的后果。

## 蓄意分裂

当您有特定的技术或业务需求，而您的首选或默认入口控制器不支持(或支持不好)时，通常会发生“故意”碎片，这迫使您使用另一个入口控制器。例如，一种解决方案可能最适合大型二进制数据流，如数据集或视频流，而另一种解决方案则提供对 web 套接字的强大支持。HTTP/2 更适合实时双向通信，比如聊天应用和游戏。

不管是不是有意为之，组织内部的生态系统开始变得越来越像外部的生态系统——支离破碎，变化多端。供应商应该接受入口控制器的多样性——有些确实如此(参见上面的 Google API Gateway 示例)。他们应该决定入口控制器如何互补——或至少具有互操作性——并让我们的用户生活更轻松、更美好，而不是试图互相排挤。因为最终，供应商战争和内讧只会真正有利于供应商——甚至这也是有争议的，尤其是从长远来看。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>