<html>
<head>
<title>How Drone Solved ownCloud’s Continuous Integration Woes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无人机如何解决ownCloud的持续集成困境</h1>
<blockquote>原文：<a href="https://thenewstack.io/how-drone-solved-ownclouds-continuous-integration-woes/#0001-01-01">https://thenewstack.io/how-drone-solved-ownclouds-continuous-integration-woes/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">在采用<a href="https://github.com/drone/drone" class="ext-link" rel="external ">无人机</a>之前，云存储提供商<a href="https://owncloud.org/" class="ext-link" rel="external "> ownCloud </a>在持续集成和交付方面处于“黑暗时代”，ownCloud DevOps工程师<a href="https://github.com/tboerger" class="ext-link" rel="external "> Thomas Boerger </a>断言。</p>
<p class="translated">在此之前，公司的前进势头已经停止了太多次，因为开发团队清理了旧的Jenkins jobs，或者等待几天来完成Travis CI测试集。</p>
<p class="translated">ownCloud的解决方案架构Patrick Jahns 说:“这令人沮丧，因为测试没有完成，一个功能发布不得不被推迟。本周在德国汉堡举行的<a href="https://containerdays.io/" class="ext-link" rel="external ">集装箱日</a>会议上，两人展示了他们使用无人机的经验。</p>
<p class="translated">他们指出，转向无人机让该组织清理了许多困扰公司的CI问题。该软件的自动扩展功能使该公司能够大幅增加可以在新功能和升级功能上完成的单元和集成测试的数量，而不增加每项工作所需的时间，从而使该公司能够推出更多功能，同时保持成本稳定。</p>
<p class="translated">ownCloud以促进“开源协作”为使命，是一项共享和同步文件的在线服务。它建立在一个开源软件栈之上，包括PHP、JavaScript、JavaScript、Elastic、memcached和Redis。</p>
<p class="translated">云服务由GitHub上的1800个存储库构建而成。直到最近，该公司一直通过社区(免费版)<strong> <a href="https://travis-ci.org/" class="ext-link" rel="external "> Travis CI </a> </strong>托管服务以及公共和本地版本的<a href="https://jenkins.io/" class="ext-link" rel="external "> Jenkins </a>持续集成(CI)软件的组合来运行其开发管道。</p>
<p class="translated">Travis CI运行了基于DAV的测试，如Litmus，以及特定于PHP的测试和<a href="https://www.seleniumhq.org/" class="ext-link" rel="external "> Selenium </a>测试。多个Jenkins实例(公共的和云中的)针对用户可能部署的内容运行代码的单元测试，包括不同版本的PHP、各种数据库和存储接口，如Swift、Ceph和Samba。詹金斯还进行了T21的测试。</p>
<h2 class="translated">四面受敌</h2>
<p class="translated">Boerger指出，ownCloud是一家预算仍然很少的成长型公司，这两种CI工具都遇到了限制，他将无人机引入了ownCloud(他现在管理无人机名称空间)。</p>
<p class="translated">使用Travis CI，开发人员会遇到某些东西在开发中可以工作，但在生产中却不行的情况。由于没有办法用插件来扩展Travis CI，Travis CI很难满足公司自己的特定需求。开发人员也经历过超时，通常是由于测试的复杂性。由于他们需要运行大量的作业，一项作业可能需要几天才能完成。</p>
<p class="translated">诚然，ownCloud只使用Travis CI的免费版本，它不提供为额外吞吐量付费的能力。但ownCloud不想为高级版本付费，因为需要完成的工作量会使其成本过高。</p>

<p/>
<p class="translated">柏格指出，詹金斯有自己的一套问题。升级Jenkins是件苦差事，因为每次升级都会破坏作业配置。詹金斯是磁盘空间的贪婪者。使用的一个实例运行在具有32个内核和128 GB RAM的专用机器上，它仍然需要定期重置。随着ownCloud转向容器，这个问题变得更糟:Jenkins在容器被使用后不清理它们。“詹金斯不是为Docker有效载荷制造的，”Boerger说。</p>
<p class="translated">和Travis CI一样，Jenkins对于ownCloud的快节奏开发周期来说太慢了。</p>
<h2 class="translated">进入无人机</h2>
<p class="translated">Jahns解释说，Drone是一个开源的容器原生CI系统。工作空间从Docker卷引导，而服务(如数据库)是从Docker合成文件创建的。然后，工作空间和服务可用于管道的每一步。“这都是自包含的，”Jahns说:克隆步骤在容器中完成，构建步骤在容器中完成，发布步骤在容器中完成。</p>
<p class="translated">因为是集装箱包装的，无人机很容易升级。因为它是作为静态Go语言二进制文件提取的，所以非常紧凑。管道本身被描述为一个YAML文件，因此它可以被版本化。整个设置可以在本地运行，也可以在云中以相同的配置运行。对于每个测试，ownCloud可以简单地提取容器，或者在没有合适的环境下创建一个容器。“无论你测试什么环境，你都可以把它作为一个可以测试的定义好的栈，交给你的开发者来测试，”Jahns说。</p>
<p class="translated">对于一个接口来说，Drone建立在Docker Compose之上，因此熟悉容器的开发人员很快就会熟悉它。它还提供了很多可扩展性:它可以轻松地与GitHub(以及GitLab等其他存储库)集成，并且通过插件，可以直接发布到云提供商，如Amazon Web Services和Google Cloud Platform。</p>
<h2 class="translated"><strong>准备好稳走</strong></h2>
<p class="translated">最初，ownCloud推出了无人机和其他CI工具，使用Ansible来管理设置。该公司从几个测试工作负载开始，但很快扩大了业务。随着团队学习如何使用无人机，他们给软件增加了越来越多的负载。最终，他们完全停止使用特拉维斯CI和詹金斯。</p>
<p class="translated">无人机最棒的地方在于它能够轻松扩展。因为提供公共服务，该公司必须针对每个可能的用户配置测试其代码，这一数字还在急剧增长。无人机的创造者Bradley Rydzewski也在开发软件，根据需求自动调整无人机的大小。它可以根据需求调配更多的节点，当工作完成时，这些节点就会退役。然而，它仍然是一个实验性的功能，只支持少数云提供商。</p>
<p class="translated">Boerger和Jahns向观众展示的图表最好地展示了ownCloud在这项技术上的优势。它显示了每次构建的测试时间量如何随着无人机的采用而急剧增加——每次构建30，000分钟——即使每次构建的等待时间<em>基本保持不变，</em>大约9小时的构建时间，45分钟的测试结果。</p>
<p class="translated"><a href="https://storage.googleapis.com/cdn.thenewstack.io/media/2018/06/ab567d08-droneci-01.jpg" class="ext-image" rel="external "> <img decoding="async" loading="lazy" class="aligncenter size-full wp-image-5017873" src="../Images/c78a52e0914665418225b27e7d418f95.png" alt="" data-id="5017873" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2018/06/ab567d08-droneci-01.jpg"/> </a></p>
<p class="translated">虽然持续集成工具为更快的开发周期铺平了道路，但容器化和云原生计算正在展示进一步自动化运营的方式。他们的收益被折回CI/CD工具产生的速度。无人机等软件展示了这种协同作用的巨大可能性，这种可能性仍然存在。</p>
<p class="attribution translated">专题图片:Thomas Boerger(左)和Patrick Jahns在ContainerDays。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>