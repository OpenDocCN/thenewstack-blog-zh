# 正如我们所知，这是网络自动化的终结(我感觉很好)

> 原文：<https://thenewstack.io/end-network-automation-know-feel-fine/>

[](http://jameskelly.net/work/)

 [詹姆斯·凯利

James 是 Juniper Networks 市场部的首席云计算和软件定义网络架构师。此前，他在加拿大渥太华创办了一家资本管理公司，并担任私人瑜伽教练。](http://jameskelly.net/work/) [](http://jameskelly.net/work/)

网络自动化并不是一个自动化的网络。今天的网络工程师经常犯两个错误。首先，自动化黑客的随机行为。第二，追求宏伟的网络愿景——用“[自动驾驶](https://www.juniper.net/us/en/dm/the-self-driving-network/)”和“意图驱动”这样的文学装饰来完成——而没有一个计划或健康的自动化实践来实现它们。

能否找到一条中间道路，让工程师能够设定可实现的目标，同时实现作为代码的自动化网络的更广泛愿景？从我们正在进行 [DevOps](/category/devops/) 的软件工程兄弟那里获得一些灵感，我相信是这样的。

## 如何不自动化

我们这行流传着一句话:“人非圣贤，孰能无过；大规模传播错误就是自动化。”

对于任何组织来说，自动化都是加速不良实践和#失败越来越大的好方法。不幸的是，当你的业务是网络运营时，想要成为一个有一些“开发”才能的酷“运营”孩子——而不仅仅是一个 CLI 骑师——将很快把你引向自动化之路。这条路可能不会把你引向那些渴望的目标，尽管它肯定会扩大你失败的爆炸半径。

在我们进一步思考自我驱动、意图驱动的网络以及当今风靡一时的每一个短语之前(尽管我和 Juniper 的其他人一样对这种思考感到内疚)，我们应该花时间来定义短语“正确地构建自动化网络*和*中的“正确”是什么意思

如果你还没有猜到，这不是关于编写 Python 脚本。编程当然很好，但是二十分钟的设计确实可以节省两周的编码时间。立即着手解决一个问题可能是错误的方法。你需要从我们的目标退一步，思考是什么赋予了它们意义，将这些目标应用到更广阔的图景中，并据此制定计划。

为了了解自动化的可能性，我们应该看看网络之外的成功自动化模式及其背后的原因，这样我们就可以避免已知的坏习惯和反模式，并避开可避免的陷阱。对于经过充分测试的自动化模式，我们不需要看得比 DevOps 领域丰富的知识和经验更远。

我们对事物的称呼很重要。不管是好是坏，一个名字会引起人们的注意。提高我们应用程序的速度、弹性、质量和智能的总体 IT 策略不叫自动化或流程编排。虽然 [ITIL 卷](http://www.bmc.com/guides/itil-introduction.html)稳步进军博物馆，但实现业务速度和智能的新战略是无可争议的，它被称为 DevOps。

> 很少有网络运营商了解 DevOps 工具的生态系统，也很少有人考虑将这些工具应用于网络。

最初，该术语可能会引起空白页面甚至转换难题。但是你可以学习实践成功的 DevOps 文化、过程、设计、工具和编码意味着什么。DevOps 可以定义您的网络方法，这就是为什么我们不应该提倡网络自动化(这可能会将注意力集中在错误的目标上),而应该将 DevOps 作为应用于网络的 devo PS 模式的应用来讨论。

## **网络为代码**

基础设施即代码(IaC)的想法已经存在了一段时间，但令人惊讶的是很少应用于网络。Juniper Networks(我挂帽的地方)和其他网络供应商，如 [Apstra](http://www.apstra.com/) 多年来已经做出了一些努力，推动人们朝着这个方向前进，但仍有许多工作要做。例如，Juniper 拥有大多数系列硬件系统的虚拟外形，像用于云中网络建模的 [Junosphere](https://www.juniper.net/us/en/products-services/nos/junosphere/) 这样的项目(我们中的许多人现在都使用 Ravello)，以及在 IaC 和专业服务咨询方面令人印象深刻的演示。Juniper 的高级营销总监 Mike Bushong(之前在 Plexxi 工作)在 2014 年以代码形式写了关于网络的文章。

IaC 通常很好地应用于云基础设施，但是很难应用于裸机。为了证明这一点，只要看看 Triple-O，Kubernetes 上的 Kubernetes，或 Kubernetes 上 OpenStack 上的[Kubernetes](https://thenewstack.io/openstack-summit-boston-kubernetes-ends-openstack-begins/)！底部的金属层是相当的困境。

对我来说，这意味着在网络领域，我们应该能够轻松地将 IaC 应用于软件定义的网络(SDN)。但是我们能把它应用到我们的网络设备上并管理物理网络吗？我问了 Siri，她说这是个恶作剧问题。作为一名纸上谈兵的建筑师，我没有所有的答案。但是在我看来，用 DevNetOps 设计网络时，有一些考虑不周的地方:

### 1.工具作业

在科技界，每个人都喜欢闪亮的物体，所以让我们从这里开始。很少有网络运营商——即使是那些学过一些编程的人——了解 DevOps 工具的生态系统，很少有人考虑将这些工具应用于网络。学习 Python 和 Ansible 只是皮毛。有大量用于 CI/CD、站点可靠性工程(SRE)和大规模云原生运营的 DevOps 工具。

### 2.链接工具链:作为代码的管道

当我们将网络视为代码时，我们需要将网络元素及其配置视为在开发/测试/试运行/生产阶段的代码开发管道中创建的构件。将这条管道串联起来不应该是一个手工过程；它应该主要被编码为自动的。

与软件工程一样，网络工程也有硬件和基础软件元素，例如运营商不会自己创建操作系统，而只是配置和扩展。这些配置和扩展，以及它们的底层依赖关系，可以一起构建、版本化、测试和交付。将网络视为开发中的一项练习，自动化应该从开发基础设施本身开始。

### 3.不变的基础设施

虚拟化，尤其是容器，使得烘焙映像的概念变得非常容易理解，不可变的基础设施也变得流行起来。虽然在网络软件分解、容器化和服务解耦方面还有很多工作要做，但是采用不变的基础设施有很多同样适用于网络的好处。今天的网络设备是配置漂移的典型代表，但是称它们为“雪花”是对真正雪花的侮辱。

应用不变基础设施的原则，我想象一个网络，其中每个设备 [PXE 引导](https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/sn-booting-from-pxe-x86.html)进入最小操作系统并运行签名的微服务构建模块。每台设备都有[声明式](https://blog.gruntwork.io/why-we-use-terraform-and-not-chef-puppet-ansible-saltstack-or-cloudformation-7989dad2865c)配置，解耦的秘密管理和轮换，以及日志和其他具有良好整体审计能力和可追溯性的监控数据——所有这些都是为了尽快将网络开箱即用。

有趣的是，像 SSH'ing 到盒子里这样的做法将变得不可能，而今天“精明的”网络自动机所做的像对设备清单运行可翻译剧本这样的做法将被摒弃。

### 4.升级

通过金丝雀测试和滚动升级模式，可以自动管理网络软件甚至设备上的固件/微码的升级。要在每个盒子或每个端口的基础上做到这一点，或者在更精细的流或流量处理组件级别上做到这一点，我们需要能够协调流量平衡和排出。

如果这听起来很复杂，我们可以把事情简单化。我们可以像对待牛而不是宠物一样对待设备和它们的流量，并依靠它们的弹性。杀死和复活一个组件会用一个新版本重新启动它。虽然这适用于某些软件应用程序，但将流量视为可任意处理的流量并不适合所有网络应用程序和 SLA。尽管如此，这对于正确设计弹性仍有很大的帮助。

### 5.弹性

所有这一切的一个含义是网络路径中存在冗余。与任何网络组件一样，这对于弹性非常重要。从 DevOps 中的横向扩展架构和微服务应用模型中汲取灵感，冗余和扩展将通过实例复制的方式齐头并进。因此，冗余既不是 1:1，也不是主动-被动。我们应该始终对包含这些反模式的架构持怀疑态度。

好的设计会容忍一个名副其实的网络混乱猴子。烧毁网络软件会切断电路以减少故障。终止链接甚至机器，我们会像今天经常做的那样快速重新聚合，但死机器、死 SDN 功能或死虚拟网络功能将像[凤凰服务器](https://martinfowler.com/bliki/PhoenixServer.html)一样，在重复故障或检测到硬件故障的情况下，重新启动或停止运行。

防止黑天鹅事件失败的模式是练习强制这些失败，并因此练习绕过它们的自动化，以便连接性或其他网络服务及其性能在其自己的 SLA 测量杆上是容忍的和可接受的弹性，无论所讨论的元服务可能是什么。

## **做发展计划**

上述每一个主题都比我在这里深入探讨的要复杂得多。通过在这里介绍它们，我的目的是证明我们可以从中得出一些有趣的模式，一些运营商已经在这样做了。如果你曾经听到过[的老禅宗公案中一只手拍手的声音](http://www.ashidakim.com/zenkoans/21thesoundofonehand.html)，一旦将 DevOps 应用于 DevNetOps 的明显性让你眼前一亮，你很可能会从自己的额头上听到这种声音。

正如采用 DevOps 最困难的部分经常被引用为一次分解一个可管理的目标并专注于此，我想我们会发现 DevNetOps 也是如此。在我们谈到网络之前，我认为我们需要正确地审视应用 DevNetOps 来应对网络挑战的转变，特别是基本的物理连接和传输问题。

虽然“网络自动化”会让人们想到应用配置管理工具和编写今天的手动任务，但是 DevNetOps 应该提醒我们，还有比仅仅自动化编码更大的范围。这个范围包括文化、流程、设计和工具。总的来说，它们可能会把我们带到一个更快乐的地方。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>