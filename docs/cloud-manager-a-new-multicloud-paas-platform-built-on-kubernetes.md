# 云管理器:构建在 Kubernetes 上的新的多云平台即服务平台

> 原文：<https://thenewstack.io/cloud-manager-a-new-multicloud-paas-platform-built-on-kubernetes/>

[](https://www.einnovator.org/)

[Jorge SIMO](https://www.einnovator.org/)

[Jorge SIMO 是 EInnovator 的董事/首席技术官。经过培训的软件工程师，拥有计算机科学和工程专业的博士、理学硕士和理学学士学位。EInnovator 是一家欧洲初创公司，致力于构建工具来实现云计算和微服务架构。他在构建复杂软件系统方面有 20 年的经验。](https://www.einnovator.org/)

[](https://www.einnovator.org/)[](https://www.einnovator.org/)

寻找合适的 PaaS(平台即服务)一直是云计算的圣杯。我们宣称实现这个目标终于触手可及，现在还不是放手的时候。

经过了多代技术，通过半独创性、半试半错的方式，越来越多地简化了部署和管理在计算集群中运行的应用和服务的流程，无论是在远程云中还是在本地。

最近两个创建通用 PaaS 软件的尝试——Cloud Foundry 和 Kubernetes——已经非常接近实现终极梦想。然而，通过在设计或焦点上的选择，两者都有其自身的问题和局限性，并且有改进的空间。可以从构建和使用这些平台的经验中吸取教训，结合两者优势的前景正在上升。在下文中，在了解了一些动机和背景之后，我将预览我们在构建我们认为更好的 PaaS 方面的方法——如 Cloud Manager 中所体现的。

[云管理器](https://medium.com/faun/do-it-all-kubernetes-dashboard-81375833e01c)是 Kubernetes 之上的一个抽象层，但完全是为多集群/多云开发应用而设计的，同时考虑到了开发人员和运营人员。

它从 Cloud Foundry 获得了一些灵感，Cloud Foundry 的目标是整洁的工作流，同时仍然保留了 Kubernetes 的所有功能和非家长式观点。

## 全新的多集群/多云

Cloud Manager 是一个新的 PaaS，它利用 Kubernetes 的所有功能来管理单个集群，但它是从头开始构建的，以支持可能位于多个云中的多个集群。Cloud Manager 使用自己的数据库来保存有关集群的高级管理信息(例如凭证)和其他信息，这有助于在多集群 PaaS 中实现许多所需的功能。

集群访问设置可以通过多种方式导入:上传/提供 kubeconfig 文件，直接从云提供商(支持 10+个)导入，或者手动导入。

Cloud Manager 提供了跨不同集群的平面空间列表，它定义了创建资源的名称空间。

每个空间都直接映射到某个集群中的 Kubernetes 名称空间，但是开发人员和 DevOps 不需要在集群之间不断指定和切换。由于这种扁平的虚拟空间列表，一些集群间操作也得到了简化。可以附加 Kubernetes 集群中预先存在的名称空间，使它们成为一个完全托管的空间。

## 没有供应商锁定

云管理器对于 Kubernetes 的底层集群来说是完全不引人注目的。集群完全不知道云管理器或其管理数据库。Cloud Manager 对于 Kubernetes 发行版也是 100%不可知的，并且不需要在集群中安装任何代理。

停止使用云管理器对集群没有任何影响，并且存在最小的供应商锁定。Cloud Manager 运行时的部分内容和支持库是开源的。其他部分正在考虑/计划在 2021 年开源。

我们预计将演变为类似于 Cloud Foundry 的方法，其中核心组件是开源的，并对社区/合作伙伴贡献开放，而其他一些组件则作为供应商差异化 IP 保留。

目前，完整的系统以“免费增值”模式提供。它可以免费使用，但在免费社区版中，其功能受限于特定的资源限制。

## 简化的 UX/用户界面

在 UX/UI 级别，Cloud Manager 借鉴了 Cloud Foundry 的一些最佳理念，同时仍然可以完全访问所有 Kubernetes 资源。通过将几个相关资源视为同一个应用程序的一部分，部署得到了比普通 Kubernetes 更全面的处理。这包括为每个部署自动创建匹配的服务和 DNS 入口。

DNS 路由以一种简单的方式进行管理，就像 Cloud Foundry 一样:用户可以定义一个或多个域，指定诸如 DNS 主机名后缀和通配符证书之类的信息。在启动/创建时或运行时，可以向应用程序添加一个或多个 DNS 路由。一个选项指定路由应该使用自己的 Kubernetes 入口(默认)还是共享入口。路由还可以覆盖或替换域级证书(例如，如果通配符证书不可用)。与一些高级工具不同，Cloud Manager 没有为应用程序引入新的抽象。相反，它直接使用 Kubernetes 的抽象，无论是(无状态的)部署还是有状态的集合。

## 最小配置和微服务友好

部署设置也以多种方式得到了简化。对于大多数使用案例，只需要最少的配置，不需要复杂的 YAML 清单文件。部署设置也存储在 Cloud Manager 管理数据库中，这允许进行增量交互式配置。

部署可以在集群中实际部署之前进行配置。

这包括添加持久卷装载和环境设置。

部署还支持各种实用程序操作，例如，在空间内或空间之间(可能在不同的集群中)对部署进行“复制和粘贴”，以及生成/导出清单文件和可重用的打包。

与 Kubernetes 的其他工具不同，使用 Kubernetes 的主要命令行工具 **kubectl** 对于大多数用例来说是可有可无的。

像 Cloud Foundry 一样，服务绑定的概念也受到支持，但以更通用的方式，作为对 Kubernetes 本地抽象的补充(例如，配置映射和秘密)。绑定是一组环境变量，根据依赖于其他服务的部署细节(例如 URL 和访问凭证)的值自动设置。

部署可以定义连接器，其他部署可以使用这些连接器来解析绑定。因为对无状态和有状态部署没有不同的处理，所以相同的机制对于连接到后台服务和其他微服务都是有用的。像 Red Hat Openshift 一样，Cloud Manager 可以选择性地了解部署的堆栈，以自动生成配置和绑定。

但是它也允许自定义绑定的定义。

这样做的好处是，它可以更轻松地配置和部署非云原生应用，并消除云原生应用需要外部命名/配置服务的用例数量。

虽然 plain Kubernetes 具有一些简化服务间发现和连接的功能(例如，空间和集群级 DNS 名称)，但是这些机制忽略了 DNS 进入，并且按照设计不能跨集群工作。

## 内置 CI/CD 支持

因为在 Kubernetes 中，所有的应用程序都需要打包成图像(目前， [Docker](https://docs.docker.com/engine/) 、 [containerd](https://containerd.io/docs/) 和 [CRI-O](https://cri-o.io/#what-is-cri-o) 运行时都支持)，图像的创建和分发应该是操作的核心。这意味着 CI/CD(持续集成/交付)不应该被视为 PaaS 中的事后想法。

云管理器作为 CI/CD 的集成支持，构建于 [Tekton](https://tekton.dev/) 之上。可以定义一个或多个映像注册中心(可能是私有的)来获取映像和推送映像。并且应该定义一个或多个 git VCS(版本控制)实现来拉源代码库。

CI/CD 设置是在接近部署信息的地方定义的，这培养了一种快速推送—构建—部署发布周期的文化。构建通常在定义部署的同一个空间和集群中运行。对于非开发部署，CI/CD 设置保持不变。

还支持安全 webhooks，以便在提交时启用自动构建和(可选)部署(仅适用于所有版本或带标签的版本)。Cloud Manager 还帮助设置集群和空间，以支持 CI/CD Tekton 运行时。包括运行时的安装，以及从目录中选择的任务和管道定义。定义 Tekton 资源以运行构建的所有底层细节都由云管理器自动完成。

## 解决方案市场

云管理器也是解决方案市场的内置支持。类似的特性存在于 Kubernetes 的许多其他工具中，但就像在 Cloud Foundry 中一样，它是在核心架构和特性集中烘焙的。

市场解决方案可以通过一个或多个目录来定义，由一个与 Helm 目录兼容的索引文件来定义。解决方案也可以定义为“部署加设置”的独立解决方案，这对于开发团队创建短期/中期可重用的解决方案非常有用，无需创建目录或详细定义，如舵图。

## 团队/企业扩展

云管理器被设计为尽可能轻量级。它作为一个独立的应用程序在单用户模式下运行，具有较低的资源使用量(2Gb 内存)，或者在多用户/企业模式下运行，具有单点登录(SSO)网关，充当身份验证和身份提供者。

SSO 网关支持团队协作所需的各种功能，包括帐户和组管理以及邀请。SSO 网关是集成平台的一部分，基于微服务架构，包括其他可选的支持服务，如用户通知服务，以通知协作用户由其他外部文件存储服务触发的事件。这有利于数据备份快照，以及空间专用频道中的社交聊天/评论。

Cloud Manager 还从 Cloud Foundry 中获得了简化 Kubernetes 安全模型的灵感。映射到 Kubernetes RBAC 权限的一小组高级角色(经理、开发人员和审计人员)为表达大多数安全策略提供了一种更方便的方法。对于高级用例，总是可以回退到直接的 RBAC 权限设置。

## 入门指南

有多种快速开始使用云管理器的方法。它可以使用 Docker 运行，也可以使用 Helm 安装在现有集群中。在单用户模式下安装云管理器作为 Docker 桌面的补充是一种流行的方法。

一些云提供商的 Kubernetes 市场上也有现成的 Cloud Manager。

下面列出的资源提供了详细的“入门”说明。

大多数开发人员首选的交互方式是通过 web 用户界面。命令行工具也可用于实现基于脚本的任务自动化。

## 了解更多信息

[https://www.youtube.com/embed/ZT8xMFwjYd4?feature=oembed](https://www.youtube.com/embed/ZT8xMFwjYd4?feature=oembed)

视频

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>