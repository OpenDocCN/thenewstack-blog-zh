# 如何让 Kubernetes 免于特权升级

> 原文：<https://thenewstack.io/how-to-give-kubernetes-immunity-from-privilege-escalation/>

这是 10 月 24-28 日 KubeCon + CloudNativeCon 系列文章的一部分。

在过去的 20 年里，虚拟化和物理基础架构环境中的安全性已经发展成为一项高度复杂的技术，能够精确控制应用程序工作负载的访问和可用性。Kubernetes(位于该基础设施之上的分布式容器运行时平台)的出现带来了新的挑战，需要创新的方法来确保整个数字产业的同等安全水平。

网络安全的支柱之一是通过各种形式的限制(通过逻辑或物理隔离)实现应用隔离。Kubernetes 能够利用这一实践，以及动态控制应用程序工作负载放置的能力，来实现以前认为不可能的新型安全模式。Kubernetes 中更广泛采用的一种常见模式是多租户架构。

## 传统分割

过去，这是通过隔离物理组件(如交换机、计算和存储设备)来解决的。现在，有了逻辑隔离边界和每个工作负载严格的基于角色的访问控制，就有可能允许 Kubernetes 构造(如名称空间)帮助创建一个考虑到隐私和安全性的共享环境。当通过诸如高级容器网络接口和容器存储接口提供者之类的附加组件进行扩充时，网络传输和静态数据也可以被限制在它们的工作负载应用范围内。

分段体系结构的好处有两个:通过增加工作负载密度提高每个物理单元的利用率，以及同构配置管理。从安全角度来看，后者非常重要，因为如果系统局限于多租户 Kubernetes 集群，基于角色的访问控制策略(RBAC)、权限(ACL)和安全工具可以以一种普遍的方式保持一致。此外，默认限制环境有利于 Kubernetes 本身的安全状况。一个实际的例子是在高度锁定和管制的节点上运行 Kubernetes 控制平面，禁用端口访问和特权操作。

虽然由于 [Kubernetes 的安全态势](https://thenewstack.io/tutorial-create-a-kubernetes-pod-security-policy/)和整体意识的改善，这些模式正变得越来越常见，但不良行为者正越来越多地在系统内寻找薄弱的切入点。薄弱环节越来越成为 Linux 主机操作系统，由于复杂性和缺乏特定领域的知识，许多运营商都忽略了这一点。

## 集装箱逃逸的可怕现实

容器化的应用程序给人一种完全隔离工作流的错觉。然而，现实却大相径庭。从最初的 2019 年 Felix Wilhelm [tweet](https://twitter.com/_fel1x/status/1151487053370187776?lang=en) 概述了滥用`cgroups release_agent`功能如何导致特权 Docker 容器或 Kubernetes pod 的爆发，容器逃逸已经成为针对 DevOps 工具的攻击中最广泛滥用的安全漏洞之一。

集装箱逃逸可能极其危险。一旦攻击者访问主机系统，他们就可以提升权限来访问机器上运行的其他容器或在主机上运行有害代码。根据主机的脆弱程度，参与者还可以访问网络中的其他主机。

坏人可以选择许多途径来成功实施容器逃逸攻击。然而，它们都归结为两个根本原因:配置错误和特权过多。

虽然实施更好的身份验证实践、权限管理、tiger 网络策略和补丁等传统对策可以大大增加攻击者的难度，但要彻底根除威胁是不可能的。总会有“那个应用程序”需要提升特权，并且总会发现新的 CVE(例如，在 Linux 内核中)。

因此，开始将 Kubernetes 和主机操作系统视为一个单一的集成系统，并在堆栈的多个层实施[安全控制](https://thenewstack.io/build-deploy-runtime-the-3-stages-of-kubernetes-security/)非常重要。

## 拯救行动的操作系统限制

这意味着基础操作系统需要有一种方法来阻止 Kubernetes 或任何其他正在运行的应用程序访问文件、网络、进程或任何其他系统资源，而无需请求特定的访问。

这种做法被称为限制，虽然这一概念可以追溯到 1979 年 Unix 的 chroot 系统调用和命令，但现代操作系统将这一概念提升到了新的高度，使访问权限请求对管理员显式，并使用 Linux 内核的安全特性(包括 AppArmor、seccomp 和 namespaces)来阻止应用程序和服务访问更广泛的系统。

受限的主机操作系统环境就是为了应对这种安全缺口而出现的。虽然还处于初期阶段，但它们已经显示出能够在整个体系中提供更高的网络安全弹性。当与物理层、网络层、存储层和虚拟化层的传统安全实践相结合时，它们可以确保在 Kubernetes 中运行应用程序工作负载时有更高的可信度。如果它们逃脱了 Kubernetes 的限制，那么运行容器运行时的主机操作系统就有逻辑边界来阻止来自容器本身的接管、访问升级或后门形式。

*要了解更多关于云原生的话题，请参加 10 月 24 日至 28 日在底特律举行的 KubeCon + CloudNativeCon 北美 2022(和虚拟)上的云原生计算基金会和云原生社区。*
![](img/25bc05722c52e80806074bddd7e413fd.png)

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>