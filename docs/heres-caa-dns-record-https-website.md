# 这就是为什么你应该有一个 HTTPS 网站的 CAA DNS 记录

> 原文：<https://thenewstack.io/heres-caa-dns-record-https-website/>

本周五，所有证书颁发机构都必须遵守域名系统(DNS)记录，该记录允许 HTTPS 网站所有者限制谁可以为他们的域名颁发 SSL 证书。这是一个长期需要的防御欺诈证书的发行，一个安全风险，域名所有者很少保护，直到现在。

问题是:浏览器和操作系统中有数十个可信的证书颁发机构(ca ),理论上，其中任何一个都可以为互联网上的任何网站颁发有效的 SSL 证书。此外，这些证书颁发机构中有许多都有下属的 ca 和经销商，它们由不同的组织运营，也可以向最终用户颁发 SSL 证书。

这意味着互联网公钥基础设施的安全性取决于这些组织保护自己的系统免受黑客攻击，并在向申请证书的人颁发证书之前执行严格的域所有权检查。

不幸的是，历史表明，即使有定期的安全审计和自动控制，证书“错误颁发”的情况(证书被颁发给域所有者以外的人)确实会发生。它们不仅会发生，而且从外部发现这些违背信任的行为也相对困难。

最近一个非常明显的案例导致赛门铁克决定将其 CA 业务出售给 DigiCert，此前[谷歌](https://cloud.google.com/kubernetes-engine)宣布计划[在 2018 年 10 月之前逐步取消对其在 Chrome 中所有证书](https://groups.google.com/a/chromium.org/d/msg/blink-dev/eUAKwjihhBs/El1mH8S6AwAJ)的信任。谷歌的行动是为了回应自 2015 年以来在赛门铁克或其合作伙伴处发现的多起证书错误颁发案件，意义非常重大，因为赛门铁克是世界上最大的 ca 之一。

虽然赛门铁克事件有其内部原因，并且是不当监控或未能执行现有策略的结果，但过去在其他 ca 中也有黑客入侵并获得高知名度域的有效 SSL 证书的案例。2011 年，谷歌域名的欺诈性证书是从荷兰的一个被黑客攻击的认证机构获得的，并被用来对伊朗的大多数互联网用户发起大规模的中间人流量拦截攻击。

这一攻击之所以被发现，是因为 Chrome 拥有谷歌合法 SSL 证书的内部记录，如果在野外观察到该公司服务的任何未经授权的证书，它会向该公司报告。有一种类似的机制叫做 [HTTP 公钥锁定](https://developer.mozilla.org/en-US/docs/Web/HTTP/Public_Key_Pinning) (HPKP)，所有网站所有者都可以使用，但它很难实现，如果配置不正确，[会使网站长时间无法访问](https://thenewstack.io/security-researchers-lose-faith-http-public-key-pinning/)。

## 输入证书颁发机构授权(CAA)

[证书颁发机构授权](https://tools.ietf.org/html/rfc6844) (CAA)是一种基于 DNS 的机制，允许域管理员指定允许哪些特定的证书颁发机构为其域名颁发 SSL 证书。CAA 于 2013 年标准化，但直到现在都没有太大影响，因为 ca 没有被强制遵守它。现在不再是这样了。

CA/浏览器论坛是一个结合了主要浏览器厂商和认证机构的组织，今年早些时候投票决定将 CAA 检查作为证书颁发过程的一部分。CA/浏览器论坛维护“公共信任证书的颁发和管理的基本要求”，这是一组所有 CA 都必须遵守的行业公认的指导原则。

CAA 要求将于 9 月 8 日生效，大多数认证机构已经对其系统进行了更改，以符合要求。DNS 软件和服务提供商增加了对这种记录类型的支持，但域名所有者可能希望检查他们的托管公司是否允许添加它。

CAA DNS 记录支持三个属性:issue、issuewild 和 iodef。“issue”和“issuewild”属性允许指定一个或多个被允许为父域颁发证书或通配符证书的证书颁发机构。列在“issue”属性下的 ca 可以颁发所有类型的证书，而列在“issuewild”下的 ca 只能颁发通配符证书。

“iodef”属性用于报告目的，非常有用。它允许用户指定电子邮件地址或主机名，如果他们收到颁发证书的请求，但域的 CAA 策略没有授权他们，则 CAs 必须将报告发送到该地址或主机名。这为域名所有者提供了一种方式来了解是否有人可能试图欺诈性地获得他们域名的证书。

当然，如果黑客设法从域名所有者授权的 CA 获得证书，将不会有报告。此外，如果黑客侵入 CA，他们可能能够完全绕过 CAA 检查，这取决于所获得的访问权限。因此，CAA 及其 iodef 报告并不是银弹，但总比没有好。

还可以按子域设置 CAA 策略。例如，对于 subdomain.example.com，CA 将首先检查子域的 CAA 策略，然后检查 example.com 的策略。如果 subdomain.example.com 有 CAA 记录，它将优先于 example.com 的记录。

这对于在同一个域名下拥有许多网站和服务的大公司非常有用。这些网站可能由不同的团队甚至外部合作伙伴运行，如营销或公关机构，它们可能有自己首选的 SSL 证书提供商。

CA 服务提供商 [GlobalSign](https://www.globalsign.com/en/) 上个月在[的一篇博客文章](https://www.globalsign.com/en/blog/what-is-certificate-authority-authorization-checking/)中宣称:“在创建 CAA 记录时，一定要小心谨慎，如果你有其他部门获得证书，你需要协调以确保所有正在使用的 CA 都将被添加到你的 CAA 记录中。由于 CAA 检查是强制性的，会导致 CA 无法覆盖的拒绝订单，因此 DNS 管理员不要搞垮该公司非常重要！”

此外，如果您使用的内容交付网络或主机提供商通过不同的 CA 提供自己的证书，这一点必须考虑在内。

许多 ca 将它们颁发的所有证书发布到公共日志中，作为称为证书透明性(CT)的框架的一部分。检查这些 CT 日志是一个好主意——例如通过像 [crt.sh](https://crt.sh/) 这样的服务——以便创建一个在你的域和子域上使用的所有 SSL 证书的清单，并为这些网站建立一个证书提供商的列表。

还建议监控 CT 日志，因为它可以作为欺诈性证书的发布后检测机制，而 CAA 提供发布前防御。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>