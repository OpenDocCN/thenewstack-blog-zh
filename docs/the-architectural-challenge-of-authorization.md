# 授权的架构挑战

> 原文：<https://thenewstack.io/the-architectural-challenge-of-authorization/>

大多数软件开发人员认为认证是一个已经解决的问题。我们可以依靠一套成熟的标准，如 OAuth2、OIDC、SAML 和 JWT，以及各种语言的库，使实现认证变得容易。来自 Auth0、Okta 等厂商的开发人员 API 使这变得更加容易。

授权呢？就像身份验证一样，每个 B2B SaaS 应用程序都需要一个授权系统来执行授予不同用户层的权限。但是与认证相比，授权是一个更难的问题，而且还远未解决。

## 开发者想要它

对授权的交钥匙开发者 API 有明确的需求:在与初创公司从种子阶段到 D 轮的技术领导者的 80 多次对话中，绝大多数人认为授权是“无差别的重担”，这对于正确处理非常重要，但不会给他们的应用程序的用户增加任何独特的价值。他们宁愿依赖交钥匙解决方案，但还没有找到适合他们的解决方案。

> 开发人员希望有一个中央控制平面来管理授权决策中涉及的所有工件。

然而，这些初创公司使用的模式非常相似:它们定义了一组权限，这些权限是它们领域中操作(“动词”)和资源(“名词”)的笛卡尔乘积。它们根据来自用户配置文件的角色(RBAC)、属性(ABAC)和范围/权限来定义访问控制规则。

## 需求斜坡

80%的开发人员要做的事情并不局限于他们的应用领域，但是工程团队发现他们自己在不断增加功能，因为他们的客户要求更细粒度的权限、自定义角色、权限和用户属性之间更复杂的映射、与更多身份提供者的集成以及授权日志的完整审计跟踪。

那么，为什么没有授权的“条纹”——一个作为服务交付的开发者 API，让所有这些痛苦消失？

## 建筑挑战

 [奥姆里·加齐特

Omri 是授权创业公司 Aserto 的联合创始人/首席执行官，这是他的第三次创业。他 30 年职业生涯的大部分时间都在从事开发人员和基础设施技术方面的工作，最近的职位是 Puppet 的 CPO。此前，他是惠普云原生平台的副总裁兼总经理(负责 OpenStack、Cloud Foundry、CloudSystem 产品和服务的业务、产品和工程监督)，也是微软的总经理，负责 Azure、SQL Server、应用服务器和。NET 框架。](https://www.aserto.com/) 

与仅发生在应用程序会话开始时的身份验证不同，架构良好的应用程序将在处理每个应用程序请求的过程中做出一个或多个授权决策。与发送电子邮件、文本消息甚至支付处理的开发人员 API 不同，授权位于每个应用程序请求的关键路径中，这意味着它必须在几毫秒内得到满足，并且必须对调用应用程序 100%可用。这听起来不再像 Stripe:更像是一个库。事实上，今天开发人员唯一依赖的帮助授权的工具就是库。

然而，当开发人员想要一个交钥匙授权服务时，这并不是他们的意思:他们想要一个中央控制平面来管理授权决策中涉及的所有工件:授权策略，它被视为代码，并在 git 存储库中存储和版本化；来自一组身份提供者的用户属性、角色和权限；和授权决策中使用的资源的上下文。所有这些都必须在做出授权决策的边缘可用。同样，从授权服务流出的决策日志应该集中起来，并集中提供。

我们都想拥有我们的蛋糕并吃掉它:由供应商(控制平面)管理和交付的平台服务，但具有库的实时特征(边缘服务)。保持体系结构的这两个部分同步是一个分布式系统问题。这就是为什么授权很难。

## 新的希望

在过去的几年里，我们已经看到大型科技公司，如谷歌、T2、网飞和 T4 的 Airbnb，将这些系统作为内部大规模分布式服务，更广泛地分享他们的模式。我们现在可以使用一组开源构建模块，如[云本地计算基金会](https://cncf.io/?utm_content=inline-mention)的[开放策略代理](https://www.openpolicyagent.org/) (OPA)，而不是必须拿出定制的策略语言和引擎。一套新的解决方案正在出现，可以填补 API 经济中的这个明显的漏洞。

## 正确的架构

在评估这些新的授权服务时，我们认为有几个关键要素必须存在，以满足可伸缩、可用系统的需求。边缘服务:

*   必须在与您的应用程序相同的 subnet/Kubernetes pod 中运行，因此提供 100%的可用性:如果您的 pod 启动了，那么 authorizer sidecar 也启动了
*   做出授权决定时，不需要与外界连接
*   在几毫秒内做出授权决定

控制平面:

*   管理中央存储库中的授权策略，并透明地将策略更改同步到边缘
*   规范来自一组身份提供者和目录的用户属性、角色和权限，并透明地将其同步到边缘
*   聚合来自边缘节点的所有决策日志，为应用程序做出的每个授权决策提供一个可审计的系统视图

## 有这样的 API！

在 [Aserto](http://aserto.com) ，我们正在用那些架构属性构建一个授权服务。还有其他“必备”吗？请在[推特](https://twitter.com/aserto_com)或[媒体](https://aserto.medium.com)上告诉我们！

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>