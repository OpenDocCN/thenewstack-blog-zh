# 开发人员在 300 台无服务器环境中的新角色

> 原文：<https://thenewstack.io/the-developers-new-role-in-300-serverless-environments/>

Stackery 赞助了这篇文章。

 [托比·费

Toby 是 Stackery 的社区开发人员。她的角色和经历结合了软件工程师、作家和技术讲师的工作，用新兴工具构建有趣的项目，并与世界分享她的发现。在加入 Stackery 之前，Toby 是 NWEA、瓦卡萨和新遗迹公司的工程师。](https://www.stackery.io/) 

对于任何现实世界的开发过程来说，“环境”的概念是必不可少的，它是配置、密钥、设置和文件的集合，允许相同的代码体在多个地方运行，从开发人员的笔记本电脑(“本地”环境)一直到为最终用户并行运行代码的几十台机器(“生产”生产环境)。

无服务器是环境管理的新景观，其根本原因是本地环境的消亡。虽然 AWS 的团队努力让您在笔记本电脑上复制 lambdas 和无服务器堆栈的其他组件，但现实是，“在笔记本电脑上编写，推送到 Master，让运营部门担心它的部署情况”的旧流程在无服务器中没有任何意义。通过将多个托管服务构建块缝合在一起，开发人员必然会更多地参与到代码的实际部署中。

我将探索一些可以解决这个问题的可能的环境管理模式，以及如何在整个团队中管理诸如密钥和秘密之类的东西，而不会给自己带来巨大的环境管理难题。如果你是一个独自编写服务的开发人员，并且不与任何人共享工具，那么这篇文章很可能不适合你。你可以安全地将环境中的所有怪癖储存在自己的记忆中。但是，如果您是一个努力管理无服务器环境的小型团队，或者是一个希望雇佣整个团队来进行权限管理的大型组织，请先阅读本指南！

### AWS 中没有“环境”按钮

本文反复提到了多种环境，而这个概念在 AWS 中并不是“东西”。值得注意的是，这与可用性区域无关，可用性区域有时被称为环境。

那么，我们如何实现这些环境呢？

[无服务器应用](https://github.com/awslabs/serverless-application-model) [模型(SAM)](https://github.com/awslabs/serverless-application-model) 和 [AWS CloudFormation](https://aws.amazon.com/cloudformation/) 是这个过程的关键组成部分。使用 SAM 模板，您可以轻松地建立两组相同的无服务器资源堆栈，它们具有不同的环境变量。我将很快再次讨论这些环境变量和秘密。

如果你对让部署和管理 AWS 无服务器资源变得更加容易的工具感兴趣，Stackery 可以做到这一切，它有一个环境按钮，可以让你轻松地移动你的堆栈。

### 2)三个环境？更像是 300。

在所有情况下，您准备使用无服务器体系结构的环境数量都需要增加。至少你需要某种测试环境，一些展示新服务、产品(不能完全忽略盈利能力)和试运行的东西。最后，您需要为开发人员配置一个实际用于开发的环境。

管理多个环境的另一个重要原因是成本管理。在 Stackery，我们经常会以“为什么 X 环境这个月花了 200 美元？”这样的对话结束因为我们有许多单独的环境，所以很容易看出谁创建了产生成本的堆栈。如果我们只有两到三个不同的环境，这可能会成为一个难题。

### 3 a)每个开发人员一个环境

在 Stackery，我们看到了为每个新开发人员创建环境的巨大好处。如果我们记住我们正在失去的是我们当地的环境，这是最有意义的。对于开发人员 Alice 来说，删除所有这些 lambdas 可能不是一个好主意，但是我们希望她能够控制自己的环境来找出答案！

这意味着脱离许多团队早期的尝试:只有几个 AWS 账户，每个账户都有共享的凭证。当然，这也是一件好事。共享凭据不可避免地会留下一个人负责管理，这意味着一个人的“总线因素”。例如，我最近注意到，我的密码管理器有我三年前离开的一个团队的认证细节！每个开发人员都需要一个环境来让他们的代码“工作”并组合其他所需的服务。

自助式受控环境和工具是高绩效团队的最佳实践。Sta [ckery](https://www.stackery.io/) 让每个开发人员管理自己的空间变得极其容易。

### 3 b)每个特征一个环境

一个强有力的想法是，当你追求一个主要特性时，创造新的环境。这为协作提供了一些好处:对环境中其他服务所做的更改可以立即被与您密切合作的开发人员看到。当然，在这种模式下，如果你没有密切沟通，你可能会踩到对方的脚。

### 4)使用 AWS 的内置版本控制

API Gateways 和 AWS Lambdas 都有专门处理版本化概念的特性。 [API 网关有“stages”](https://docs.aws.amazon.com/apigateway/latest/developerguide/stages.html)让你识别你的 API 处于哪个发布阶段， [lambdas 有“aliases”](https://docs.aws.amazon.com/lambda/latest/dg/versioning-aliases.html)用于功能版本化。

使用这些工具有两个主要问题:

*   这个版本一次是你的栈的一个部分，并且不是非常紧密。重复使用的 SAM 模板(见第 1 点)更全面；
*   一旦部署，Lambda 函数是不可变的，这可以搞乱任何硬编码；数据库字符串或参数。埃文·约翰逊不久前在 AWS 写了一篇关于秘密的[文章，最近 Stackery 的 Sam Goldstein 报道了这个话题](https://segment.com/blog/the-right-way-to-manage-secrets/)。

### 5)并非一切都是无服务器的

虽然完全用无服务器工具构建 web 应用程序是可能的，但实际上并不是所有东西都是无服务器组件。无服务器 lambdas 能够从外部 URL 请求外部信息，但这是一个有限的通信渠道，没有 API 网关，它们无法接受请求。

当从 S3 以外的现有数据库或文件存储中获取数据时，您需要提供无服务器应用程序的配置和秘密，以便与外部服务连接。这是一个 Stackery[非常有用的地方，因为它将您的环境信息模块化，并使您可以轻松地将您的功能和无服务器资源(您的“堆栈”)部署到多个环境和 AWS 区域。](https://www.stackery.io/)

### 结论和进一步阅读

Sergio Garcez 在这篇 Hackernoon 文章中很好地解释了 AWS 中的环境策略。

在 Stackery，我们了解无服务器在生产中面临的挑战，因为我们正在努力为团队构建解决方案，以全面、高速地采用无服务器。无服务器提供了巨大的速度优势和易用性，但挑战是真实的。

缺少环境的本地副本似乎是无服务器的一个主要缺点。但是我已经看到许多非常有能力的团队推出破碎的代码，因为“它在机器上工作了”——但是这并不是代码在生产中工作的好指标。测试环境，以其简化的结构和模拟的需求，可以掩盖一些错误，产生其他错误，并按时完成每个部署。

这个问题似乎不是“如果没有应用程序的本地副本，你如何开发？”但是“我们有过本地拷贝吗？”管理多种环境的难题是为多种环境付出的合理代价，所有这些环境都彼此非常相似。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>