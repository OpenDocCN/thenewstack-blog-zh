# 数据库和微服务:技术和方法初级读本

> 原文：<https://thenewstack.io/databases-and-microservices-a-technology-and-methodology-primer/>

[](https://www.cockroachlabs.com/)

 [斯潘塞·金博尔

斯潘塞·金博尔是蟑螂实验室的联合创始人兼首席执行官，他在对分布式系统编程的热爱和帮助公司顺利发展的兴奋之间保持着微妙的平衡。他在互联网全盛时期开始涉足数据库领域，并在谷歌十年的发展历程中一直坐在前排。](https://www.cockroachlabs.com/) [](https://www.cockroachlabs.com/)

尽管一些公司最近因为[放弃它们](https://segment.com/blog/goodbye-microservices/)而获得了很多关注，但微服务仍然是一种流行的——并且可能是强大的——设计架构。

然而，考虑到应用程序的巨大复杂性，“松散耦合的服务”仍然意味着它们可以彼此严格依赖。因为这些关系依赖于它们之间传递的数据，所以清楚地了解每个服务的数据库及其特征非常重要。例如，如果一个服务需要无异常的输入，但是另一个服务从最终的一致性数据库中获取数据，这些不一致性会导致棘手的问题。

虽然在服务之间共享数据的问题没有灵丹妙药，但是了解每个数据库的特征将有助于您更有信心地做出这些决定。

## 在微服务环境中评估数据库

微服务有着不同的需求，也带来了不同的挑战，因此了解数据库如何在这种环境下工作非常重要。以下是你应该考虑的因素:

**可部署性:**使用 Docker 和 Kubernetes 等 DevOps 工具部署和扩展数据库有多简单？

**性能:**控制数据库的性能有多容易？

**访问模式:**数据库支持哪些类型的查询？

**一致性:**数据库是否提供其数据的一致视图，或者是否允许异常？

**可用性:**数据库如何处理机器故障？

## 传统 SQL 数据库

即使到了 21 世纪初，传统的关系数据库仍主导着这个领域。如今，它们已经在很大程度上被更具可扩展性的技术所取代。

**举例** : [MySQL](https://www.mysql.com/) ， [PostgreSQL](https://www.postgresql.org/)

可部署性:这些数据库很容易部署，但是因为它们只能在一台机器上运行，所以你只能通过更新、更大的机器来扩展它们。

**响应时间**:他们的响应时间不容易提高，因为他们必须在一台机器上运行，这对于地理位置较远的用户来说很慢。为了提高吞吐量，您必须获得全新的硬件。

**访问模式**:使用关系数据模型可以为大多数访问模式提供良好的性能，包括跨表的复杂连接。

一致性:传统的 RDBMSs 只能在一台机器上运行，所以它们很容易提供很强的一致性。

**可用性**:这些数据库代表应用程序中的单点故障；如果它关闭，所有依赖它的服务也会关闭。

### 概括起来

传统的 SQL 数据库足以满足小型但非关键的服务，这些服务需要将一致性置于可用性之上。

## NoSQL

NoSQL 数据库专为可扩展应用而构建，这使得它们非常适合许多微服务。然而，考虑到它们有限的访问模式和数据库异常，它们并不总是最佳选择。

**举例** : [MongoDB](https://github.com/mongodb/mongo) ，[卡珊德拉](http://cassandra.apache.org/)

**可部署性**:建立和扩展 NoSQL 集群很容易，并且可以通过许多不同的方式来实现——例如，每个服务一个集群，或者一个大型集群包含由名称空间划分的各个服务。它们也能很好地与大多数基础设施工具配合使用。

访问模式:当 NoSQL 数据库一次只需要访问一个文档时效果最好——例如，一个社交媒体帖子，可能包含其内容和评论。对于复杂的连接，它们不是很好的选择。

**响应时间**:因为您可以轻松扩展 NoSQL，所以您可以确保它离用户很近，并且有足够的硬件来处理您的所有服务请求。但是，如果包含文档的节点关闭或远离，响应时间仍然会很慢。

可用性:NoSQL 把可用性看得比什么都重要，只要求一个节点处于活动状态。尽管任何个别数据可能不可用，但整个服务将保持运行和活动。这可以提供相当难以置信的正常运行时间。

一致性:NoSQL 做了一个非常有意识的权衡:为了可用性放弃一致性。这意味着大多数 NoSQL 数据库提供“最终一致性”，但这多少有些误导，因为这听起来好像值最终会收敛到一致的状态。不幸的是，随着许多节点能够接受写入，情况就不一定是这样了。

### 概括起来

当您需要正常运行时间时，最好选择 NoSQL 数据库，但是这些数据不是关键任务，可以处理潜在的异常。

## 数据库即服务(DBaaS)

在过去的几年中，基础设施公司已经将他们的服务扩展到了数据库。显而易见的好处是，其他人会为您接管基础架构。这也意味着您放弃了一些调整服务以完全按照您的意愿工作的灵活性。

**举例** : [亚马逊 DynamoDB](https://aws.amazon.com/dynamodb/) ，[谷歌云 SQL](https://cloud.google.com/sql/docs/)

**可部署性**:在这个场景中，您花钱请人来处理基础设施，这大大简化了事情。

但是，这样做的一个缺点是，您只能使用供应商提供的服务——可能不是在每个地区——并且会限制您的灵活性。

**访问模式**:这取决于底层的数据库技术。大多数服务映射到 SQL 或 NoSQL 范式，因此上面对访问模式的描述仍然适用。

**响应时间**:这同样依赖于底层技术，但也需要你对服务的地理位置有所了解。例如，如果服务使用主动-被动复制(即，它要求所有写入都到单个主节点)，则远离它的用户的写入将会很慢。

**可用性** : DBaaS 平台在历史上提供了很长的正常运行时间，因为确保服务的可用性是平台的重中之重。

一致性:这同样取决于底层技术。

### 概括起来

当您没有专业知识或时间来运行服务的数据库时，DBaaS 是理想的选择。

## NewSQL

**举例:**[cocroach db](https://www.cockroachlabs.com/)，[谷歌云扳手](https://cloud.google.com/spanner/)

**可部署性** : NewSQL 数据库是按规模构建的，因此易于部署和增加容量。它们还可以与 Kubernetes 等编排工具配合使用。

注意，Spanner 是一个 DBaaS 平台，所以它在这一类别中有点混杂。

**访问模式**:因为使用关系模式，NewSQL 提供了类似于传统 RDBMS 系统的访问模式——对于许多查询类型来说既灵活又强大。

**响应时间**:因为 NewSQL 数据库是为广泛分布而构建的，所以不能保证数据就在服务附近——一个区域中的查询可能需要从另一个区域获取数据。然而，一些 NewSQL 数据库提供了一些特性来帮助缓解这些问题。

**可用性** : NewSQL 数据库是高度可用的，只要大部分数据可用，它就会继续处理请求。这不像 NoSQL 那样健壮，后者只需要最少的节点在线，但这是对一致性的一种有意识的折衷。

**一致性**:这是 NewSQL 数据库的主要优势。它们既广泛又容易部署(类似于 NoSQL)，同时提供了强大的一致性(像传统的 RDBMS)。这种一致性确保您的数据中没有异常，这在微服务环境中很有价值。

### 概括起来

当您有需要扩展的任务关键型服务(如客户的金融交易)时，NewSQL 数据库是很好的选择。

微服务是复杂的环境，有许多移动的、连接的部分。了解了每种数据库的运行方式后，我们希望您能够为自己的微服务做出正确的选择。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>