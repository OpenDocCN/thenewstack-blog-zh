# 确定性数据库和数据共享的未来

> 原文：<https://thenewstack.io/deterministic-databases-and-the-future-of-data-sharing/>

准确共享数据实际上是现代 IT 系统的定义。从打电话买咖啡，到协调全球供应链，保持跨公司、云、地理位置和应用程序的数据一致对消费者和企业体验的每个方面都至关重要。但令人惊讶的是，尽管云技术取得了进步，但准确的数据共享需求在很大程度上仍未得到满足:

*   数据库可以帮助单个公司保持其数据的准确性和一致性，但当两家或更多公司(在不同的云上、在不同的地区、具有法律上和操作上隔离的系统)需要共享数据时，事情就不一样了。
*   API 提供了一种很好的方式来移动位，但是它们不理解数据。他们很乐意携带任何东西，但他们不知道数据是否一致、最新或完整。
*   区块链的早期尝试提出了一种完全不同的分布式账本解决方案，但当第一代区块链的可扩展性和延迟问题广为人知后，该解决方案未能实现。

与此同时，数据库研究社区的一个角落一直在悄悄地研究一种新的数据库方法，称为[确定性数据库](https://cacm.acm.org/magazines/2018/9/230601-an-overview-of-deterministic-database-systems/fulltext)。为了理解这项技术如何成为业务数据共享的游戏规则改变者，让我们先回顾一下变更日志，也称为分类帐。

## 胜利的账本

所有数据库记录数据的更新(保留一份副本)—这是使事务成为可能的算法基础，提供容错，并且在分布式数据库中，允许跨不同公共云区域或多地理内部部署保持数据副本最新。大多数数据库在应用更新的同时创建它们的更改日志。这种方法虽然传统，但引入了一定程度的不确定性:底层细节，如线程调度，可以改变操作被接受和执行的顺序。相同数据库的其他副本，在相同的输入下，可能会得到不同的答案，尽管这个答案仍然满足所有的事务需求。

最近，确定性数据库已经成为传统数据库的替代方案。在一个确定性系统中，变化是预先组织好的，然后**再**应用。这种方法提供了一些[的重要优势](https://www.cs.umd.edu/~abadi/papers/abadi-cacm2018.pdf)。例如，地理上分布的副本可以获得相同的输入，并保证产生相同的结果，从而使数据复制(和重放)更容易实现。

这些技术可用于创建传统的 SQL 或 NoSQL 数据库。像 [FaunaDB](https://fauna.com/) 这样的公司[正是在做这样的事情](https://fauna.com/blog/consistency-without-clocks-faunadb-transaction-protocol)，利用确定性数据库设计的优势来提高传统分布式云数据库的效率、成本结构和性能。

[https://www.youtube.com/embed/U_uCj6Cni60?feature=oembed](https://www.youtube.com/embed/U_uCj6Cni60?feature=oembed)

视频

## 收敛进化:作为确定性数据库的区块链

现在让我们来看看区块链。虽然是并行发明的，但区块链已经汇聚成具有一些惊人的相似特征。

像确定性数据库一样，区块链是分布式系统，它将更新组织到一个共享的、完全有序的变更日志中。他们这样做的机制千差万别:以太坊和比特币的工作证明，许多其他加密货币的股份证明，Hyperledger Fabric 等私有/许可链的“订购者节点”，等等。

然而，如果我们忽略**如何提出**块的细节，而是看这些块如何进入链中，那么与确定性数据库的联系就变得很清楚了。正如确定性数据库中的每个地理分布的副本应用更改日志来创建其数据的本地副本一样，区块链中的每个节点添加新块来创建其共享“世界状态”和本地分类帐的单独副本。

## **区块链只是一种特殊的确定性数据库**

这种趋同进化并不令人惊讶。这两个系统都需要一个有序的日志，允许每一方生成来自多个客户端的数据的本地副本，该副本保证与所有其他副本完全相同。

确定性数据库在一个分布式数据库中完成这个任务，而区块链算法在一个由独立数据库组成的社区中应用这个任务。相似的设计压力(完全有序、预先一致性保证)导致了日志本身级别的相似设计选择，尽管其构造采用了不同的路径。可以肯定的是，仍然存在一些显著的差异——大多数区块链缺乏查询语言和数据模型，这使他们感觉与传统的数据库很不一样——但基本的数据共享模型对确定性数据库研究人员来说会很熟悉。

说到研究，让我们回到数据库研究人员最初提出确定性数据库的原因:性能。[对确定性数据库的研究](https://cs.yale.edu/homes/thomson/publications/calvin-sigmod12.pdf)声称与传统数据库相比有许多优势，包括更高的吞吐量、更简单的容错架构等等。但是，区块链的吞吐量极低，容错能力有限，数据和一致性模型限制以及其他一系列限制使得他们的第一代产品远远不能满足企业基础设施应用的需求。

是否有可能挖掘确定性数据库文献来设计一个区块链，提供确定性数据库的性能、一致性模型和丰富的数据模式支持？

结果答案是肯定的*。*

## 从学术殿堂到你身边的区块链

确定性数据库是由研究人员设计的，他们必须重新创建传统 SQL 和 NoSQL 数据库的所有功能:

*   强一致性模型。
*   支持强类型用户数据模型、云就绪复制。
*   SQL 查询兼容性等等。

所有这些都是第一代区块链所没有的。

对于企业应用程序开发人员来说，仅仅是在区块链中恢复这些功能，就能使区块链的外观和感觉像一个传统的数据库，这将是一个巨大的进步。

像 [Vendia](https://www.vendia.net) 这样的公司的企业区块链就是这么做的。他们利用确定性数据库方法为客户提供熟悉的外观，允许使用基于模式的数据模型定义数据库表，并提供云集成和基于 API 的访问，而不暴露底层区块链的任何实现细节。与只提供无类型“键/值”存储的“普通”区块链不同，这些较新的区块链感觉像是建立一个传统的 SQS 或 NoSQL 数据库，但仍然跨不同的方、地区、云和应用程序运行。

确定性数据库研究提供的另一个重要见解是它们对**分片**的处理，这种能力可以实现比单台机器更高级别的事务处理。大多数区块链仅限于“一个机箱部署”所能实现的处理能力

换句话说，一旦你在一台机器上耗尽了 CPU、内存或网络容量，游戏就结束了。即使在同一个网络中有另外 1000 台机器，整个网络也只是以最慢的机器的速度运行。区块链将这些数据“分片”的尝试(让不同的网络子集在总分类账的子集上工作)导致了一系列复杂问题，例如相关交易在不同的分片上处理，从而导致不一致的结果。

区块链社区尝试的其他方法要求应用程序执行客户端分片，这对于可能不了解其数据如何与后端的其他应用程序更改集成的应用程序来说是一个困难且容易出错的负担。

## 区块链分片的高性能替代方案

如果区块链分片的尝试让人觉得幼稚和有问题，我们是否可以从更成熟的数据库研究社区，尤其是地理复制确定性数据库研究中学到一些有用的东西？

确定性数据库[对地理复制数据的研究](http://www.cs.umd.edu/~abadi/papers/1154-Abadi.pdf)提供了一种替代原始分片方法的高性能方法，在这种方法中，相关事务按其“拥有”节点排序。“Own”在这里可以有不同的含义——在最初的研究论文中，所有者是根据地理空间访问分布模式选择的，以最大限度地减少延迟。这种方法提供了经典的事务性保证——如果系统作为一个整体像传统数据库一样运行，这一点非常重要——同时还能确保所有节点以适当的顺序看到所有更新。

将确定性数据库地理复制方法与区块链的“互不信任”共识算法相结合增加了一些复杂性，但提供了两全其美的优势:**多方分散与高吞吐量和低延迟读写性能相结合**。随着研究人员在确定性数据库方面取得进一步进展，区块链社区可以继续收获这些发现，并将其应用于分散式系统的环境中。

## 确定性数据库的实际应用

将相互不信任的区块链需求与确定性数据库研究相结合，其中系统的所有部分都由一个实体拥有和操作，因此相互之间隐含信任，这不是小事，但它可以导致令人惊讶的和商业上重要的结果。

当今企业面临的许多最具挑战性的问题，从金融交易到供应链工作流程，最终都需要不同的方面来建立关于他们共享的产品和工作流程的**单一事实来源**。创建一个易于使用的企业级多方数据库，使其能够在分散和互不信任的环境中运行，对于实现这些解决方案至关重要。商业解决方案必须同时满足两组要求:

*   传统的数据库特性，如强一致性、数据建模、查询语言等。
*   企业级可扩展性和性能类似于现有的一流云数据库

将确定性数据库技术应用到这些[区块链](https://www.vendia.net/blockchain)应用中，可以实现商业成果，解决各种各样的使用案例，使公司能够灵活地构建业务网络，而无需面对来自合作伙伴的不一致、不完整或过时信息的历史挑战。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>