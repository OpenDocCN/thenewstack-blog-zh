# 在后台软件目录中发现 XSS 漏洞

> 原文：<https://thenewstack.io/xss-vulnerability-discovered-in-backstage-software-catalog/>

[后台，](https://backstage.io/)由 [Spotify、](https://thenewstack.io/how-spotlify-adopted-platform-engineering-culture/)打造的开源内部开发者门户，已被美国航空、富达投资、 [VMware](https://tanzu.vmware.com?utm_content=inline-mention) 等企业采用。然而，最近几个月，它走过了一条坎坷的道路。

11 月，云原生安全公司 Oxeye[在平台工程工具中发现了一个严重的 JavaScript 漏洞](https://thenewstack.io/oxeye-finds-bad-spotify-backstage-javascript-vulnerability/)。

2 月中旬，[在](https://nvd.nist.gov/vuln/detail/CVE-2023-25571)[后台](https://thenewstack.io/spotifys-backstage-a-strategic-guide/)软件目录中发现了一个跨站点脚本(XSS)漏洞，该漏洞可能允许攻击者向应用程序中注入恶意代码。该漏洞是由用户提供的数据的输入验证不充分造成的，特别是在目录的搜索功能中。

尽管新漏洞没有 11 月份发现的漏洞严重，根据 CVSS 基础指标，它仍然具有 6.8 分的中等严重程度，11 月份发现的漏洞在[通用漏洞评分系统(CVSS)](https://thenewstack.io/cvss-struggles-to-remain-viable-in-the-era-of-cloud-native-computing/) 中得分为 10 分。

新漏洞的指标表明，发动攻击不需要太多资源或专业知识。攻击媒介是通过网络，这意味着攻击者可以是远程的，并且不需要物理访问系统。攻击者也不需要高级别的访问权限来利用该漏洞。

攻击者可以利用这一安全缺陷在搜索查询中注入 JavaScript 代码，然后在显示搜索结果时执行该代码。因此，攻击者可以将恶意脚本注入页面，这些脚本将在访问受影响页面的任何人的浏览器中执行。

XSS 通常用于窃取 cookies 并控制用户会话。然而，根据[开放全球网络应用安全项目(OWASP)](https://owasp.org/) HttpOnly 来源，它也可用于暴露敏感信息、获得特权服务和功能的访问权以及传播恶意软件。

受影响的软件包版本有:

*   @ back stage/catalog-model(NPM)< 1 . 1 . 5
*   @ back stage/core-components(NPM)< 0 . 12 . 3
*   @ back stage/plugin-catalog-back end(NPM)< 1 . 7 . 1

要解决此漏洞，使用受影响的软件包版本的 Backstage 用户应该升级到修补版本:

*   @ back stage/目录模型(npm) 1.2.0
*   @ back stage/核心组件(npm) 0.12.4
*   @ back stage/plugin-catalog-后端(npm) 1.7.2

## 受影响软件包的核心功能

根据 CVSS 基准指标，三个受影响的软件包上的漏洞范围已发生变化，这表明它可能会影响超出其预期范围的组件。在这种情况下，它可能会影响系统的保密性，因为攻击者可能会获得敏感信息的访问权限。此漏洞不会影响系统的完整性和可用性。

让我们仔细看看受影响的包的核心功能，以便更好地理解潜在攻击的规模。

### 后台目录模型

目录模型包的[文档提供了定义后台软件目录数据模型的接口和验证器/策略的信息。这些接口和验证器支持目录中软件组件的一致和标准化表示。](https://backstage.io/docs/reference/catalog-model)

文档涵盖了包中定义的各种接口，包括:

*   **组件**:表示目录中的一个软件组件，如服务、API 或库。该接口包括元数据，如名称、描述、所有者和版本，以及与其他组件的关系。
*   **实体:**表示目录中更高级别的实体，例如组织或团队。该接口包括元数据，如名称、描述和所有者，以及与组件和其他实体的关系。
*   **Location:** 表示组件源代码的位置，比如 git 存储库或文件系统目录。

该文档还涵盖了该包提供的各种验证器，这些验证器可用于确保数据符合定义的接口。

通过使用 catalog-model 包提供的接口和验证器，开发人员可以确保他们的软件组件在后台软件目录中得到一致和准确的表示。

对于使用 Backstage 的团队来说，这可以更好地组织、发现和重用软件组件。此外，可以对包进行定制，以包含特定于组织独特需求的元数据和关系。

当与其他后台包(如`@backstage/backend-plugin-api`和`@backstage/catalog-client`)一起使用时，目录模型包提供了访问和管理软件目录数据的能力。这种包的组合使得创建一个集中的软件目录成为可能，整个组织中的开发人员和团队都可以使用这个目录。

### 后台核心组件

core-components 包是一组可重用的 React 组件，用于使用 Backstage 平台构建开发人员门户。这些组件提供了一组 UI 原语，可用于为您的开发人员门户创建一致且内聚的用户界面。

该软件包中包括的一些组件有:

*   **alert display:**alert API 用于向应用程序报告警报，并显示给用户。
*   **CopyTextButton:** 允许用户将文本复制到他们的剪贴板上。
*   **InfoCard:** 以卡片形式显示信息。
*   **进度:**显示进度条。
*   **表格:**以表格形式显示数据。

核心组件包被设计成与其他后台包无缝协作，比如`@backstage/core-app-api`和`@backstage/core-plugin-api`。这些包为构建开发者门户提供了额外的功能，比如应用集成和插件支持。

在使用 Backstage 平台构建开发人员门户时，使用核心组件包可以节省时间和精力，因为它提供了专门为该平台设计的预构建组件。

### 后台目录后端插件

plugin-catalog-backend-module 包是后台平台的一个插件，为软件目录提供后端功能。它旨在与其他后台插件一起使用，如`@backstage/plugin-catalog`、`@backstage/plugin-catalog-node`和`@backstage/catalog-client`，为开发人员提供功能全面的软件目录体验。

该包带有一个内置的数据库支持的目录实现，可以存储和提供目录数据。它还可以充当现有目录解决方案的桥梁，允许开发人员将数据接收到数据库中，或者代理对外部目录服务的调用。

plugin-catalog-backend-module 包被设计为可扩展的，允许开发人员向软件目录添加自定义功能。例如，开发人员可以为组件定义自定义元数据字段，或者添加与管理软件组件的外部工具的集成。

这个包建立在`@backstage/catalog-model`包之上，它提供了一个标准化的数据模型来表示软件组件。这可以在整个组织中实现一致和标准化的组件管理。

像其他后台包一样，插件-目录-后端-模块包是开源的。

## 目录后端插件的扩展模块

目前，有 12 个包依赖于`plugin-catalog-backend-module`。下面，我们重点介绍其中的三种。要获得完整的软件包列表，请在 [NuGet Package Manager](https://www.npmjs.com/) 中搜索`@backstage/plugin-catalog-backend-module`。

### AWS 扩展模块

`plugin-catalog-backend-module-aws`包是用于[亚马逊网络服务(AWS)的目录后端模块。](https://aws.amazon.com/?utm_content=inline-mention)它是 plugin-catalog-backend 插件的扩展模块，提供了一个 AwsOrganizationCloudAccountProcessor，可以用来摄取云账户作为资源类实体。

该模块允许用户轻松地将 AWS 帐户添加到他们的 Backstage 实例中，从而可以与目录中的其他资源一起查看和管理它们。AwsOrganizationCloudAccountProcessor 可用于扫描 AWS 组织中的帐户，并自动为其创建资源实体。

通过使用该模块，用户可以在其后台实例中获得更好的 AWS 帐户可见性和管理功能，从而提高效率和资源利用率。

### GitLab 扩展模块

`plugin-catalog-backend-module-gitlab`包为后台软件目录提供了一个 GitLab 发现模块。GitLab 集成包括一个特殊的实体提供者，允许用户从 GitLab 中发现目录实体。

实体提供者将抓取 GitLab 实例并注册与配置路径匹配的实体。这可能是手动向目录添加内容或使用静态位置的有用替代方法。GitLab 发现模块简化了将 GitLab 存储库集成到后台软件目录的过程。

### OpenAPI 扩展模块

`plugin-catalog-backend-module-openapi`是一个目录后端模块，它提供了对目录后端的扩展，专门用于解析 YAML 文档中的`$refs`。

该模块为用户提供了将 YAML 文档分解为多个文件并引用它们的能力。在处理过程中，使用 UrlReader 将文件捆绑在一起，并存储为一个规范。

该功能对于 OpenAPI 和 AsyncAPI 规范特别有用，在这些规范中，用户经常处理复杂的大文件，而这些文件需要分解成更小、更易管理的文件。

使用`plugin-catalog-backend-module-openapi`，用户可以轻松管理和引用这些文件，而无需手动合并或连接它们。

## 防止 XSS 漏洞的最佳实践

防止 XSS 攻击对于确保 web 应用程序的安全性至关重要。[以下是一些最佳实践](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)，部分源自 OWASP 指南，有助于防止 XSS 漏洞:

*   **输入验证:**验证所有用户输入，并在向用户显示之前过滤或转义所有数据。确保没有不受信任的数据作为代码在浏览器中执行。
*   **编码:**将特殊字符如&、<、>、/和空格编码成相应的 HTML 或 URL 编码。
*   **内容安全策略(CSP):** 使用并实施 CSP 来限制页面上可以加载的内容类型。这可以防止攻击者执行恶意脚本或将恶意代码注入页面。
*   **禁用客户端脚本:**允许用户禁用客户端脚本，这有助于防止恶意脚本在其浏览器中执行。
*   **无效请求处理:**将无效请求重定向到安全页面或显示错误消息。
*   **会话管理:**检测同时登录，包括来自两个不同 IP 地址的登录，并使这些会话无效。适当的会话管理可以防止会话劫持攻击。
*   **库文档:**查看应用程序中使用的任何库的文档，了解哪些元素允许嵌入 HTML。

通过遵循这些最佳实践，开发人员可以帮助防止 XSS 漏洞，并确保其 web 应用程序的安全性。

## 结论

强烈建议用户尽快更新到受影响软件包的最新版本，以防止利用此漏洞并保护他们的系统免受潜在攻击。

为了减少这种漏洞，通常最佳做法是限制对修改目录内容的访问，并要求进行代码审查。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>