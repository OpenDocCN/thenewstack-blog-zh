# 五大机密管理错误以及如何避免它们

> 原文：<https://thenewstack.io/the-top-5-secrets-management-mistakes-and-how-to-avoid-them/>

[](https://www.linkedin.com/in/nicksirris/)

 [尼科罗斯·西里斯

尼科罗斯是 Bridgecrew 的技术含量营销人员。他之前在 NCC Group 和 Forcepoint 工作，创建了关于渗透测试、法规遵从性和风险管理的内容。他是一个电视和电影迷，对斯坦利·库布里克、韦斯·安德森和拉里·戴维的任何东西都有(某种程度上)健康的痴迷。](https://www.linkedin.com/in/nicksirris/) [](https://www.linkedin.com/in/nicksirris/)

你有不为人知的公开曝光的秘密几乎是不可避免的。它们可能在任何地方—在您的应用服务器、容器化应用、基础架构代码(IaC)、业务关键型应用或您的 CI/CD 工具链中。说出一个地方，那里可能藏着一两个秘密。

管理密码、API 密钥、令牌等机密的可用性和完整性。—是一种不容失败的责任。有了证书在手，即使是最新手的坏演员也能造成严重的伤害。在最近的一项研究中，Unit 42 的研究人员定期扫描和分析互联网上不安全的 Kubernetes 集群。在成千上万的容器、映像和部署中，他们发现了[超过 80，000 个暴露的秘密](https://unit42.paloaltonetworks.com/unsecured-kubernetes-instances/)。

以下是我们看到的顶级机密管理错误以及如何避免它们，例如在哪里安全地存储机密，如何找到它们等等。

## 1.硬编码秘密

开发人员总是在寻找节省时间的方法。但是有一个地方可能会反过来伤害你，那就是硬编码或者在代码中嵌入凭证，比如 SSH 和 API 密钥。硬编码的秘密通常是一种临时的解决方案，随着敏捷开发扩展到包括第三方开发人员和 GitHub 等基于云的回购协议上的代码交换，硬编码的秘密尤其危险。

风险有多大？根据 OWASP 的说法，当使用硬编码密码时，几乎可以肯定的是，恶意用户将通过相关帐户获得访问权限。

任何有权访问项目的人都可以查看硬编码的秘密，使它们不再那么秘密。这可能会很快升级。收割工具使得获取访问密钥、提升权限和进行各种破坏成为可能，比如进入不受限制访问的云数据库。从那里，他们可以挑选知识产权，支付数据，个人身份信息(PII)和更多的自助餐。

如果您决定在本地开发中使用硬编码的秘密，请确保在您的*中包含变量文件。gitignore* 文件，这样它们就不会提交到您的存储库中。对于生产，使用秘密商店。您可以在硬件、虚拟设备、软件甚至 SaaS 版本中找到它们。稍后我们将讨论三个最受欢迎的秘密商店。

## 2.使用一维扫描工具

大家都知道“大海捞针”这个比喻。秘密扫描可能有点像这样——试图从 15000 个可能的秘密中识别出 15 个真正的秘密。使用正确的技术可以帮助检测和削减数以千计的可能的秘密到一个精确的，可管理的群体。然而，许多工具只使用下面列出的三种技术中的一种进行不同的扫描，错过了许多秘密或添加了一堆来自误报的不必要的噪声。

### **正则表达式**

使用正则表达式的秘密是扫描器最常识别的秘密。这些是与一种类型的凭证相关的特定模式——想想 AWS 访问密钥、Slack 令牌等等。但是正则表达式通常过于宽泛或定义不准确，无法在扫描中正确显示。例如，您在代码中实际拥有的可能与 Twilio API 键的指定正则表达式不匹配。

### **关键词**

使用关键字的秘密包括很可能是秘密的短语，例如 password、pwd、api*_key。这些相对容易捕捉，但仍然可能出现误报或重复。

### **高熵模式**

使用高熵模式的秘密具有更长的高度随机的字符组合字符串。你可能认为更高的熵值更重要，但并不是所有的秘密都是由高度随机的数据或强密码组成的。因为用户生成的密码通常相当简单，所以仅基于熵的扫描更容易失败。

如何增加真阳性，减少假阳性？有许多专有的和开源的扫描工具可供选择，最有效的方法是扫描高熵模式和关键字的组合。组合检测器——换句话说，搜索具有高熵模式的关键字或正则表达式——可以帮助降低比率。

## 3.在开发生命周期中扫描秘密太晚

传统上，云安全性和合规性检查在运行时进行。但是有了新的 IaC 安全工具，通过持续集成(CI)管道在运行前扫描问题变得越来越普遍。但是更主动的方法——在代码进入版本控制系统(VCS)之前检查其安全性问题——可以在问题变成所有相关团队头疼的问题之前帮助修复问题。

这也适用于硬编码的秘密。

虽然[秘密扫描](https://bridgecrew.io/secrets-scanning)可以在运行时完成，但你也可以更进一步，甚至在代码提交到共享库之前，在代码配置中进行扫描。[像 Checkov](https://bridgecrew.io/blog/checkov-secrets-scanning-find-exposed-credentials-in-iac/) 这样的工具扫描 IaC 模板，寻找遵循各种秘密模式的字符串，并标记它们以供审查。它可以使用上面提到的三种方法追踪已识别的秘密:正则表达式、关键字匹配和基于熵的扫描。

鼓励您的个人开发人员在将代码集成到共享存储库之前，将秘密扫描集成到他们的质量保证工作流中。然后，除此之外，确保在每一步都添加防护栏——在您的 VCS、CI 管道和运行时环境中也是如此。

## 4.在公共场所储存秘密

如果你在谷歌上快速搜索，你会发现一堆关于[哈希公司金库、AWS 参数商店和 AWS 秘密管理器](https://medium.com/hackernoon/aws-secrets-manager-vs-hashicorp-vault-vs-aws-parameter-store-bcbf60b0c0d1)的比较。Secrets Manager 旨在加密机密信息，并通过使用 AWS CLI 提供内置密码生成器，而 Parameter Store 将使用案例扩展到应用程序配置变量，如 URL、数据库主机名、自定义设置、产品密钥等。Vault 通过用户界面、CLI 或 HTTP API 提供其机密存储服务。

你选择哪一个取决于你，但是有一个地方你不希望你的秘密被公开——那就是任何对公众开放的地方，比如你的 VCS 或者登记处。尤其不要放在 CI/CD 配置文件中，比如 GitHub Action YAML 或 CodeBuild buildspec.yml 文件。

请记住，直接添加到这些文件类型之一的任何秘密在 VCS 中是可见的，或者将在构建的任何结果日志中被揭示。确保使用环境变量或秘密管理器，并且仅在使用时注入和混淆秘密。

## 5.没有密钥轮换和撤销的过程

如上所述的秘密管理工具是有用的，因为它们可以自动创建和存储秘密。但是它们涵盖的另一个重要方面是撤销和轮换，这在泄漏或妥协的情况下尤其重要。

最好定期轮换您的密钥。大多数组织每月或每季度轮换一次，但更具体地说，美国国家标准与技术协会(NIST)建议在执行大约 232 次加密之前轮换密钥。为了[估计加密数量](https://www.vaultproject.io/docs/internals/rotation)，取以下指标的总和:

*   *跳栏放倒*遥测仪。
*   *vault.token.creation* 指标，其中 *token_type* 标签为*批次*。
*   *merkle . flush dirty . num _ pages*指标。
*   预写日志记录(WAL)索引。

## 最终提示

通过避免所有这些错误，你就走上了保护秘密安全的正确道路。但是，如果你发现你的秘密暴露在网上的任何地方，那么迅速按照以下步骤进行补救:

1.  首先，深呼吸。
2.  尽快禁用和撤销密钥。
3.  确定密钥访问了哪些服务，并启动相关的信息安全/数据泄漏流程。
4.  查看恶意活动的日志，例如您没有启动的虚拟机。
5.  尽可能清理您的 git 历史或日志历史。
6.  创建一个新的密钥，并将其分发给需要它的各种服务。
7.  监视您的服务是否因为没有更新该服务的密钥而中断。

遵循这些机密管理最佳实践。这是一个相对简单的方法来保持您的凭证无懈可击，保持团队内部的信任，并改善您的安全文化。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>