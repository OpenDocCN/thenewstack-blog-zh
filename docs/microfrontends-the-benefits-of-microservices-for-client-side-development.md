# 微前端:微服务对客户端开发的好处

> 原文：<https://thenewstack.io/microfrontends-the-benefits-of-microservices-for-client-side-development/>

对鹅好，对公鹅好？

首席架构师 [Luca Mezzalira](https://lucamezzalira.com/) 正在[寻求](https://medium.com/@lucamezzalira/micro-frontends-resources-53b1ec7d512a)将微服务的想法带到前端开发中，此前他看到了微服务给他工作的快速增长的体育视频流媒体网站 [DAZN](https://watch.dazn.com/en-US/sports/) (读作“Da-Zone”)带来的好处。

至少有一定比例的后端开发人员和架构师已经接受了[微服务架构](https://thenewstack.io/category/microservices/)在开发和维护大规模应用程序方面的优势:将复杂的“整体”应用程序分解成更小的组件，允许开发团队使用他们选择的工具，按照自己的节奏开发不同的功能。它允许应用程序本身更频繁地更新和增强。它更自然地适应了 [DevOps](/category/DevOps) 节奏的开发工作流:组件可以通过在它们周围画出强有力的边界而彼此独立地增长，允许平台作为一个整体进行扩展，而没有相应的复杂性的对数增长。

但不管出于什么原因，微服务宗教在前端 web 和移动开发人员中并没有看到多少皈依者——这些人努力使用 Vue、React、Angular 或任何其他 JavaScript 框架提供流畅和动态的用户体验，通常使用单页面应用程序(SPA)原则。

可伸缩性仍然是前端社区的一个问题，不仅是不断增长的代码库和依赖性，甚至是如何管理开发团队。然而，Mezzalira 认为，事情不一定是这样的。

当 Mezzalira 在公司快速发展的时候签约 DAZN 时，他在接受 New Stack 采访时回忆道。他需要一种方法来招募新的开发人员(该公司现在有数百名)，同时在越来越多的平台(最近统计有 30 个)上创新和构建新的服务。他喜欢他从微服务阵营中看到的东西，并考虑何时可以将其应用于客户端设计，在客户端设计中，每个访问浏览器只能获得其所需的服务。

今天，DAZN 站点作为一组水疗中心运营，每个水疗中心归不同的开发团队所有。SPA 可以通过浏览器来呈现，或者按照 Mezzalira 的说法，由服务器来呈现。在服务器端，JavaScript 在持续集成阶段被编译，并加载到亚马逊 S3 存储桶中。 [Lambda@Edge](https://aws.amazon.com/lambda/edge/) 为每一页进行微路由。这种方法允许候选测试版本，例如，德国的 Internet Explorer 用户得到一种配置，而其他人得到另一种配置。

“你可以拆开水疗中心的整体结构，”梅扎拉说。“你可以用 Vue.js 编写一部分应用程序，一部分用 React，一部分用 Angular。完全可行。”

## 域和子域

就领域驱动设计而言，Mezzalira 将微前端定义为“业务子域的技术表示”它们通过清晰的契约提供了强大的边界，并避免与其他子域共享逻辑或代码。

领域是一个需要用软件来解决的问题。例如，DAZN 的领域是体育视频流。该域分为多个子域，发现和回放、客户支持、身份验证等等。一个软件团队可以被分配到每个子域，创建一个组织结构，一个最小化跨子域通信的组织结构。关键决策是在当地做出的，而不是在全球范围内。理想情况下，这些组件应该反映在服务本身的开发组织结构中。

当浏览器访问 DAZN 站点时，会下载一个运行时(昵称为“Bootstrap”)，启动应用程序，设置 I/O 以及跨子域的路由和共享配置。Bootstrap 收集有关用户特定配置的信息，并获取适当的组件。

微前端似乎是技术不可知的，并且正在采用几种不同的方法。

一种是使用基本的 HTML **[iFrames 元素](https://www.w3schools.com/html/html_iframe.asp)，**其中每个框架都有自己的子域。Spotify 在其基于网络的音乐流媒体服务中使用了这种方法。事件总线协调不同 iFrames 之间的事件。简而言之，该公司在前端使用 web 技术，而后端逻辑是用 C++编写的。

另一种方法是使用组件。在线预订服务 OpenTable 走的是这条路，使用的是 [OpenComponents](https://opencomponents.github.io/) 栈。这里，注册中心包含了构建应用程序所需的所有组件。“每个团队都可以在注册表中找到他们想要的组件，”他说。

第三种方法涉及**服务器端组合**，其中 web 应用程序的所有元素不是由浏览器组装，而是由服务器组装。时尚电子商务网站 [Zalando](https://zalando.com/) 在[项目 Mosiac](https://www.mosaic9.org/) 的帮助下使用了这种方法，Mosiac 是一个服务、库和组件如何协同工作的规范的框架。一个组件 [Tailor](https://github.com/zalando/tailor) 为呈现的每个页面创建一个微小的运行时层，组装所需的每个 HTML 片段。《裁缝》写于 Go，灵感来自脸书的大烟斗。

“在这种情况下，我们谈论的是运行时在服务器上组装的组件，”他说。

许多微前端 JavaScript 框架也可用于支持微前端的想法，包括 [Single-SPA](https://single-spa.js.org/) ，它通过一个微小的应用运行时将不同的 SPA 联系在一起。Frint 是另一个提供这种方法的包。

正如 ThoughtWorks 顾问 Cam Jackson 在 Martin Fowler 网站上的一篇解释文章中所描述的那样，微前端确实有许多潜在的缺点。

一个是有效载荷大小的问题。杰克逊认为，每个组件都带来了自己的技术，不可避免地会有大量的代码重复，减缓了用户体验，并可能在组件需要更新时造成依赖地狱。一名黑客新闻评论者[在回复帖子时详细阐述了这个观点](https://news.ycombinator.com/item?id=20148308):

优化一个大型的 JavaScript SPA 以使其在移动设备上运行良好已经够难了——我们真的建议给用户设备提供一个包含 N 个不同版本的 React、Angular、Redux 等的 UI 是个好主意吗？全部使用不同的构建工具/管道构建，最终的 UI 拼凑在一起，并让它提供与原生应用程序相当的体验？ *微服务在后端工作，因为它对用户来说是有效隐藏的——他们的设备点击端点并获得响应。在前端，这是一个不同的故事，用户的设备必须下载并执行所有复制的代码。*

与微服务本身一样，另一个问题是固有的复杂性。“微前端将不可避免地导致需要管理更多的东西——更多的存储库、更多的工具、更多的构建/部署管道、更多的服务器、更多的域，等等。，”杰克逊写道。

杰克逊指出，微前端也将带来他们自己的一套要求。需要更多的自动化来配置和管理基础架构。此外，将由首席架构师来确保所有前端项目满足“最低水平的质量、一致性或治理”。

但是微前端也有意想不到的好处，比如……开发人员的快乐。在 Mezzalira 的总部伦敦，前端开发人员倾向于每年左右更换工作，在许多情况下，他们只是为了尝试一些新的东西。微前端可以提供一种不用离开公司就可以试验新技术和新框架的方法。

“微前端为他们提供了他们在组织内部寻找的东西，”他说。“这可能是留住人才的好方法。”

[https://www.youtube.com/embed/BuRB3djraeM?feature=oembed](https://www.youtube.com/embed/BuRB3djraeM?feature=oembed)

视频

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>