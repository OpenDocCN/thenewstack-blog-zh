# 配置不佳的 CI/CD 系统可能是进入您的基础架构的后门

> 原文：<https://thenewstack.io/poorly-configured-ci-cd-systems-can-be-a-backdoor-into-your-infrastructure/>

[CloudBees](https://www.cloudbees.com/) 赞助了这个故事，作为正在进行的“**云原生 DevOps”系列的一部分。**“查看本月的后续版本。

持续集成和交付(CI/CD)过程是现代软件开发的常见组成部分。由于其中大多数涉及容器化或虚拟化的服务，通常托管在云中，因此许多组织无法完全理解与这些被破坏的流程相关的安全风险。

CI/CD 部署由多个部分组成，有时是独立的工具，它们以自动化的方式相互交互，根据需要加速和分配资源，以构建、测试和部署新代码。在大多数设置中，构建服务器与代码存储库有一种隐含的信任关系，并在收到请求时自动触发流程。

有条件地构建代码，通过测试运行，并将结果图像推送到图像存储库。从那里，它被部署服务自动拾取，并被推送到在容器内运行的微服务。

所有这些都是通过一连串的信任关系、依赖关系、配置和凭证实现的，如果没有适当的保护，其中一些可能会被攻击者修改或窃取。至少，被入侵的 CI/CD 服务器可以为黑客提供对免费计算资源的访问，这些资源可以被滥用于加密挖掘、构建分布式拒绝服务(DDoS)僵尸网络或代理恶意流量。但是安全影响远不止于此，特别是对于内部部署、自托管部署。

“如果你接管其中一个构建系统，即使它运行在一个容器中，你也可以接管一个网络，因为这些容器共享 IP 空间，”安全研究员 [Tyler Welton](https://www.linkedin.com/in/tylerwelton/) 在 DEF CON 25 会议上关于 CI/CD 黑客攻击的演讲中说道。即使它们可能位于自己的 IP 网状网络中，它们通常仍有映射到主机的端口

[https://www.youtube.com/embed/mpUDqo7tIk8?feature=oembed](https://www.youtube.com/embed/mpUDqo7tIk8?feature=oembed)

视频

在某些情况下，甚至有可能利用这些服务器和代码库之间的信任关系向 master 提交数据，从而损害代码。至少，他们可以滥用这些服务使用的授权 SSH 密钥。

Welton 在 CI/CD 部署中观察到的另一个常见实践是将其他服务的凭证存储在环境变量中。虽然这比在配置文件中硬编码凭证要好，但在受到损害的情况下，它们仍然会被窃取。

“当你损害了这些服务中的一个，你并没有损害整个系统，但转储一些环境变量，你可能能够转向其他一些系统，”Welton 说。

尽管一些现代 CI/CD 工具允许限制容器内的特权，但是许多系统被配置为以 root 用户身份在容器内运行服务。乍一看，这似乎没什么大不了的，因为任何潜在的攻击者都只能在这些特定的容器内执行操作，而这些操作通常是短暂的。

但是，根访问允许攻击者扫描整个 IP 空间，以便找到主机上运行的其他潜在可利用的服务，如果容器可以访问互联网，它允许攻击者下载和安装他们需要的其他软件包，以发起进一步的攻击。

Welton 开发并发布了一个名为 [CIDER](https://github.com/spaceB0x/cider) (持续集成和部署开发者)的 CI/CD 开发框架，支持各种构建链，如 Travis-CI、Drone 或 Circle-CI。CIDER 使用的主要攻击手段包括通过开放 GitHub 库的 pull 请求，但如果攻击者获得了私有源代码库的访问权限，同样的技术也适用。

还有一个更老的 CI/CD 审计框架叫做[烂苹果](https://github.com/claudijd/rotten_apple)，由 Mozilla 道德黑客 [Jonathan Claudius](https://www.linkedin.com/in/jonathanclaudius/) 创建。这可用于确定根用户是否被用于构建项目，以及攻击者是否可以部署恶意代码来窃取 API 密钥、转向专用网络、使用 GitHub 凭据进行身份验证、创建反向外壳、泄漏数据、访问同一服务器上的其他项目或窃取 SSH 密钥。该框架还有一个攻击模式，可用于渗透测试。

Welton 在 DEF CON 上的 2017 年演讲包含真实世界的 CI 黑客和关于不同配置问题的大量信息。然而，CI/CD 工具带来的风险在安全行业中已经存在多年。

两年前 Nikhil Mittal 在黑帽欧洲的[演讲也是关于 CI 环境中不安全默认配置的重要资源。当时，Mittal 将 CI 工具描述为“攻击者最好的朋友”，并表示他从未遇到过未经授权访问 CI 工具不会导致对整个网络域的管理访问的渗透测试。](https://www.youtube.com/watch?v=0H6jd5yG7_A)

[https://www.youtube.com/embed/0H6jd5yG7_A?feature=oembed](https://www.youtube.com/embed/0H6jd5yG7_A?feature=oembed)

视频

对于组织来说，重要的是要理解默认 CI 配置在设计时没有考虑安全性，并且在容器中运行东西不足以阻止攻击者闯入并通过基础架构的其余部分执行横向移动。

鉴于最近软件供应链攻击的激增，CI/CD 部署的安全性变得更加重要，在这些攻击中，黑客侵入软件开发基础设施，以便在生成的应用程序中插入后门和恶意代码。这使得他们能够利用可信的软件分发渠道来危害大量最终用户。这也使得开发者成为极具吸引力的目标。

持续集成和交付有利于安全性。首先，它使修补和补丁部署速度大大加快。此外，如果配置得当，将应用拆分为微服务有助于减少单点故障并遏制危害。但是，基础设施中不安全的 CI/CD 系统会增加您的攻击面，并为黑客打开入口。

不幸的是，“自动化构建系统，如 CI 系统和 CI 管道，比它们所部署的代码更少被检查安全性，”Welton 说。“它们位于基础设施组件(通过网络渗透测试进行测试)和应用程序代码(通过应用程序笔测试处理)之间。但是，这种准容器化的环境位于自己的 IP 空间中，在自己的容器中，在基础设施之上，但在代码之下，它实际上没有经过测试。”

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>