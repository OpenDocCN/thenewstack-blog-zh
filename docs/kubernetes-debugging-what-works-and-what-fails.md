# Kubernetes 调试:什么有效，什么失败

> 原文：<https://thenewstack.io/kubernetes-debugging-what-works-and-what-fails/>

[KubeCon + CloudNativeCon](https://events19.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/) 赞助了这篇文章，期待 [KubeCon + CloudNativeCon NA](https://events.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2019/) 于 11 月 18-21 日在圣地亚哥举办。

 [或者魏斯

Rookout 的联合创始人兼首席执行官 Weis 五岁开始玩电脑，后来成为一名开发人员、军官和研究员。在以色列情报部队服役后，他在多家网络安全和大数据公司担任首席工程师，并担任国防部的顾问，以及 Netline communication s Technologies 的网络安全解决方案副总裁。或者联合创办 Rookout，解决理解软件和从代码中访问数据点的痛苦。](https://www.linkedin.com/in/orweis/?originalSubdomain=il) 

Kubernetes 是一种高度分布式、面向微服务的技术，允许开发人员大规模运行代码。它彻底改变了云基础设施，并在许多方面简化了工程师的工作，各种研究表明 Kubernetes 在企业中的采用率有所增加。

但即使是铁杆 Kubernetes 爱好者也会承认调试 Kubernetes 豆荚仍然是一件痛苦的事情。

在这样一个高度分布式的系统中，模拟找到问题的根本原因所必需的确切情况是非常困难的。传统的本地调试方法有局限性，直接在云中或生产环境中远程调试也存在问题。

Kubernetes 都是为了让软件更有弹性，弹性软件需要弹性可观测性；然而，我们仍然停留在使用几十年前的调试和日志方法。

我们需要一种新的更好的方法。

## 本地调试的局限性

每个开发者都在本地调试。这是过程和开发生命周期的标准部分。然而，当涉及到 Kubernetes 和微服务架构的相关复杂性时，这种方法变得非常困难。

每个微服务都将服务和使用其他微服务的服务。要在本地环境中重建这个复杂的体系结构，使用所有相同的基础设施和依赖项，将需要大量的工作和设置。处理这些问题的一种方法是使用自动化脚本，它允许开发人员只需运行执行命令就可以在自己的机器上运行微服务。然而，由于开发人员必须控制配置以及正在使用的分支如何与其他分支保持一致，所以脚本经常会中断。

也有开源解决方案，如 [Hotel](https://github.com/typicode/hotel) 或 [Docker Compose](https://docs.docker.com/compose/) ，它们可以帮助减轻这些挫折——但它们也有自己的挑战和缺点。这些缺点包括，作为开源工具，它们需要如何永久维护。这也迫使开发团队投入资源来学习新的工具。这是可以通过更好的方法节省的时间和精力。此外，最终你最关心的系统会存在于产品中，即使你为调试而创建的最好的副本也只是开发者实际需要面对的现实的一个影子。

## 远程调试 Kubernetes 的问题

虽然开发人员可以调试云提供商托管的微服务，但 Kubernetes 有自己的编排机制和优化方法。这些方法让 Kubernetes 变得伟大。但是它们也增加了调试的难度。接近豆荚是一个非常不稳定的操作。如果开发人员想通过 SSH 来尝试在 Kubernetes pod 上运行调试工具，Kubernetes 可能会在获得数据前的一秒钟就杀死它。

有办法解决这些问题。依赖 logger . info(" get Exit Signal:{ }"。format(sig))是这本书里最古老的技巧，但现在它的副作用是重新部署的沉重代价。开发人员还可以选择将流量从集群重定向到他们的本地机器，这肯定有助于重新创建一个问题以进行有效的调试。但是这并不安全，而且本地计算机通常需要处理大量数据。

服务网格解决方案，如 [Istio](https://istio.io/docs/concepts/what-is-istio/) 和 [Linkerd](https://linkerd.io/) ，可以帮助开发者跟踪他们的微服务，而无需更改代码；因为这些工具代理入站和出站流量，所以它们是添加调试和跟踪功能的理想场所。然而，服务网格调试的主要缺点是它缺乏找到问题根源的能力。可以突出比如微服务 A 慢，但不会说为什么。这通常需要开发人员使用其他工具深入代码，并经常恢复到重新部署日志行，以达到底线。

## 按需实时数据点收集

更好的方法包括利用按需插装的弹性能力，并在运行时添加日志/调试快照，无缝地为开发、试运行和生产环境中的快速调试提供统一的解决方案。这使得开发人员能够从 Kubernetes 应用程序中获得他们需要的数据，而不必编写更多的代码，重新启动或重新部署。本质上，这个想法是将断点带回 Kubernetes，设置一个断点并立即获得任何数据点；唯一不同于传统断点的是——无需随时停止应用程序。这些不间断断点的工作方式对于本地、远程甚至生产部署都是一样的。此外，由于该解决方案不局限于单个容器实例，因此它可以大规模工作，还可以解决偶尔出现的问题。

Kubernetes 和容器编排框架带来了新的功能，但也使得从我们的应用程序中获取准确及时的数据变得更加困难。为了应对这一挑战，该行业现在正朝着一个新的方向发展:即时收集数据并即时传输数据的能力，同时允许应用程序连续执行。

支持一些新概念，如动态条件日志记录(相当于条件断点的 Kubernetes)和时态日志记录(根据特定需求限制日志记录时间的能力)。将数据从代码中分离出来，并将其从 CI/CD 管道、复杂的安装和高开销中解放出来，将可观察性带到了一个全新的水平，消除了摩擦和瓶颈，并释放了开发和开发运维资源。类似于结构化日志记录如何支持最初的软件增长，这种下一代响应性日志记录方式可以增加推动现代和即将到来的软件趋势所需的灵活性。

有了 Kubernetess，现代软件的复杂性和规模正在爆炸式增长。我们已经从卑微的起点走了很长的路。简单的单实例服务器的时代早已过去。现在是时候让他们放弃旧的调试方式，同时实现数据与代码的解耦，并促进现代可观察性所需的弹性。

来自 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>