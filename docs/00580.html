<html>
<head>
<title>Lessons in Thrift: How Facebook Keeps its Web Pages Snappy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">节俭的教训:脸书如何保持网页简洁</h1>
<blockquote>原文：<a href="https://thenewstack.io/lessons-in-thrift-how-facebook-keeps-its-web-pages-snappy/#0001-01-01">https://thenewstack.io/lessons-in-thrift-how-facebook-keeps-its-web-pages-snappy/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">脸书在全球拥有超过22亿用户，很可能是这个星球上使用最广泛的软件平台。YouTube或谷歌仍然可能产生更多的流量，尽管这两个网站都不像脸书的网站那样对每个用户都很个性化，这使得这个社交网站成为现代网络性能工程的奇迹。更重要的是，考虑到它大部分都是由开源软件构建的。</p>
<p class="translated">成功的一部分可以归功于公司纽约办公室的小型脸书网络速度团队。“我想我们团队的任务真的很简单:用任何必要的手段让Facebook.com变得更快，”负责管理网速团队的脸书工程经理亚伦·贝尔说，并补充说“任何必要的手段”很重要，“因为，事实证明让Facebook.com变得更快是一个很大的问题。”</p>
<p class="translated">“的确，让它充满挑战的是不断的变化，”贝尔说。“网站永远不会稳定。我们一直在添加新功能。”</p>
<p class="translated">Web Speed团队专注于加速向每个访问者的浏览器交付完全合成的、完全定制的网页。这个团队不处理网络应用，尽管他们确实覆盖了移动浏览器。</p>
<p class="translated">尽管移动应用程序的崛起，网络仍然对这个社交网络巨头至关重要。尽管越来越多的人使用脸书的移动应用程序，该网站仍然是大多数需要处理诸如管理群组或活动等重量级任务的用户的首选平台。大部分广告收入仍然来自网站。</p>
<p class="translated">有趣的是，这个团队位于纽约，而不是硅谷。事实证明，很多浏览器开发都发生在美国东海岸。此外，由于华尔街培育的金融技术社区，纽约是许多工程师的家园，他们认为<em>高性能、低延迟计算</em>。机器学习在纽约也有很大的影响力。</p>
<p class="translated">“所以这里有很多思想和表演工作的交叉授粉，”贝尔说。</p>
<h2 class="translated">行业秘诀</h2>
<p class="translated">提高性能需要对浏览器和服务器软件的工作方式进行大量的调整。</p>
<p class="translated">一个改进是尽可能并行执行计算操作。“基本上，我们玩一些小把戏，以确保我们一次饱和所有东西，”<a href="https://www.linkedin.com/in/1nate/" class="ext-link" rel="external ">团队中的脸书工程师内特·施洛斯</a>。这是该公司开发的一个名为<a href="https://www.facebook.com/notes/facebook-engineering/bigpipe-pipelining-web-pages-for-high-performance/389414033919/" class="ext-link" rel="external "> BigPipe </a>的工具背后的想法，该工具将页面分成小页面，以便它们可以在服务器端和浏览器上通过多个执行阶段进行流水线操作。</p>
<div id="attachment_4792707" class="wp-caption alignright"><img aria-describedby="caption-attachment-4792707" decoding="async" loading="lazy" class="wp-image-4792707 size-medium" src="../Images/5c2aaeff1fa52cad1f3416c1ff0fbb44.png" alt="" data-id="4792707" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2018/05/9471a555-headshot-aaron-300x158.jpg"/><p id="caption-attachment-4792707" class="wp-caption-text translated">亚伦·贝尔</p></div>
<p class="translated">点击脸书页面上的“查看源代码”,会显示很多看起来像嵌入在HTML评论中的JavaScript代码，乍一看，这似乎是一个放置这些代码的奇怪地方。但是注释是放置代码的最有效的位置。Schloss进一步解释道:“将HTML作为注释进行转义比将其转换成JSON或其他格式要便宜得多。”。</p>
<p class="translated">一般来说，web speed time花费大量时间来确定JavaScript代码何时执行。“当它被加载时，我们以非常特定的顺序来做，因为我们想确保我们以最佳的方式利用所有的客户端资源，”Schloss说。</p>
<p class="translated">该公司是A/B测试的大力支持者——在全系统推广之前，先在一些用户身上进行尝试。“总的来说，我们从野外获得的数据更能代表脸书的工作方式，因为在设备和网络等方面有如此多的多样性，我们看到，我们真的真的很难在实验室内正确解决这个问题，”施洛斯说。</p>
<h2 class="translated">面向包装的机器学习</h2>
<p class="translated">该公司还依赖机器学习进行网站优化。脸书可以使用的静态包太多了——充满CSS或JavaScript或图像的小库——不可能一次下载所有的包，甚至不可能创建一个管道来确定哪些包与20亿用户相关。有成千上万的JavaScript文件、CSS文件和图像，而且这个数量总是在不断变化。所有正确的元素必须在几秒钟内下载到浏览器。除此之外，随着新特性的增加，要跟上基础库的日常变化也是不可能的。</p>
<p class="translated">“它在不断变化，所以即使我们找到了一种真正好的捆绑方法，它也会在20分钟内过时。所以我们必须实现自动化，”贝尔说。</p>
<div id="attachment_4792708" class="wp-caption alignleft"><img aria-describedby="caption-attachment-4792708" decoding="async" loading="lazy" class="size-medium wp-image-4792708" src="../Images/72b088a0df6ce5e7f29fa61515a6cc79.png" alt="" data-id="4792708" data-original-src="https://storage.googleapis.com/cdn.thenewstack.io/media/2018/05/ec9ba605-headshot-nathan-300x158.jpg"/><p id="caption-attachment-4792708" class="wp-caption-text translated">内森·施洛斯</p></div>
<p class="translated">该公司开发了一个名为Packager的工具，它使用机器学习来自动决定将哪些文件捆绑到特定最终用户的包中。它在很大程度上依赖于统计分析:用户会立即需要哪些文件？他们最终需要什么？更新了哪些文件？有些文件会不断更新；其他人则不然。</p>
<p class="translated">ML也可以在其他方面有所帮助，比如预测用户下一步可能会点击什么，这样服务器就可以准备下一批要发送的材料。</p>
<p class="translated">每个人的个人资料和历史可以提供线索，让我们知道他们下一步会点击主页的哪个部分。然而，做出这种预测会导致两个可能的陷阱:高估和低估。</p>
<p class="translated">“你可以过度预测你在哪里发送了太多，然后有一堆没有被使用，”贝尔说，并指出这导致资源的低效率——网络，CPU，服务器时间等。“然后是预测不足，即你发送的信息不够多，然后用户点击了一些东西，他们没有获得所需的所有资源，这是迄今为止最糟糕的情况。”</p>
<p class="translated">该团队得出结论，如果该文件至少有很小的机会被使用，那么总的来说，将它发送给用户是值得的。在很大程度上。“这也有一点艺术。有时候文件太大，我们就不发送了，”贝尔说。</p>
<h2 class="translated">开放标准</h2>
<p class="translated">网速团队所做的工作并不都是严格意义上的内部工作。脸书是支持Web标准的忠实信徒，它的工程师可以在许多Web技术的技术委员会中找到。“我们的最终目标是让每个人都能尽可能快地上网。我们真的希望这里的生态系统健康，”施洛斯说。</p>
<p class="translated">例如，脸书对服务工作者(T1)很感兴趣，这是一种客户端代理，可以处理浏览器中的计算问题，比如决定从缓存中提取还是从网络中获取。</p>
<p class="translated">脸书感兴趣的另一个项目是<a href="https://github.com/binast/ecmascript-binary-ast" class="ext-link" rel="external "> JavaScript二进制AST </a>，这是一个为解析JavaScript构建新语法树的标准。“浏览器不需要解析和编译JavaScript。它可以像看语法树一样，这样会更快，”Schloss说，“我也喜欢我们把它作为一个标准，因为这是我们要做很多工作的事情之一，然后它不仅仅是脸书的变革，它是每个网站的变革。”</p>
<p class="attribution translated">专题图片:亚伦·贝尔(左)和内森·施洛斯。图片由脸书提供。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>