# 不要把美国气象站 S3 站的中断看作是一件愚蠢的事情

> 原文：<https://thenewstack.io/dont-write-off-aws-s3-outage-fat-finger-folly/>

[](https://twitter.com/leeatchison)

 [李艾奇逊

**战略建筑高级总监，新遗迹。** Lee 拥有 30 年的经验，致力于设计和构建大规模、基于云、面向服务的 SaaS 应用。他在构建高可用性系统方面有专门的知识。李是新遗迹战略建筑的高级主管。在 New Relic 的最后四年里，他设计并领导了 New Relic 平台和基础设施产品的建设，并帮助 New Relic 设计了一个可靠的基于服务的系统架构，该架构随着他们从一个简单的 SaaS 初创公司发展成为一个高流量的公共企业而扩展。](https://twitter.com/leeatchison) [](https://twitter.com/leeatchison)

众所周知，亚马逊网络服务在周二对其[简单存储服务](https://aws.amazon.com/s3/) (S3)服务进行了重大破坏。鉴于 S3 在互联网上的流行和广泛使用，这是许多公司的一个主要问题。

AWS 公布了导致[服务中断](https://aws.amazon.com/message/41926/)的详细解释。在这份解释中，工程师表示，S3 团队的一名成员犯了一个错误，导致不正确和不适当的大量服务器退出服务，这导致了整个行业都感受到的连锁影响。

任何曾经支持过生产服务的 DevOps 专业人员都会遇到这种问题。我们都输入了错误的命令，导致了我们没有预料到的问题。甚至有一个专门的术语，叫做“胖指法”，指的是当手指在键盘上按错键时可能发生的打字错误。我们都能理解这位 S3 团队成员，我们都能感受到他们的痛苦。我们以前都经历过这种情况，这次似乎没有什么不同。这只是在一个比我们大多数人经历的更大的舞台上。

当然，你可以听到一英里外传来的推文。AWS 怎么能让一个像 S3 这样庞大而关键的系统因为一个简单的失误而瘫痪呢？AWS 怎么可能没有预料到这种问题呢？

你看，AWS *预见到了这个问题，并且像所有好的服务提供商一样，它有适当的流程和程序来处理出现的问题。如果没有适当的基本保护措施，你根本无法提供具有 S3 可靠性和可用性历史的服务。*

让我们退一步，从总体上看胖指法问题。为此，让我们暂时远离 AWS

## 手动更改与工具更改

你看，许多新创建的生产系统，当它们第一次上线时，更多地关注功能性，而不是可支持性。它们被构建来提供特定的能力。当然，必须维护服务，但是维护这些服务通常涉及操作人员的手动任务，例如登录到服务器并重新启动它们，或者终止进程，或者更新配置文件。对于许多生产系统来说，这就是它们的维护方式。个人登录到生产服务器和高特权或“超级用户”并手动执行必要的操作。不幸的是，这是行业中非常常见的过程。

当然，对于维护高可用性服务来说，这是一种糟糕的做法。一旦您允许人们登录生产服务器，那么您就将生产服务器暴露在人们有时会犯的错误面前。意外地输入错误的内容，意外地删除重要的数据文件，或者不恰当地关闭服务器，或者终止重要的进程，这些都是非常简单的。

这就是为什么架构师和系统工程师长期以来一直鼓励使用特定的生产最佳实践。不允许任何人以任何理由登录生产服务器。相反，构建工具来执行人们通常需要在生产服务器上执行的完全相同的功能。这可能包括重新启动服务器、整理日志文件、更改配置设置或重新启动服务。所有这些任务都应该通过工具来完成，这些工具可以自动执行需要在生产服务器上执行的危险任务。

为什么这很重要？因为使用自动化工具给了你*许多*优于手工操作的优势。一些优势包括:

1.  这些工具可以验证提供给它们的输入，并确保输入有意义。如果输入在某些方面不正确，他们可以报告问题并失败，而不是使用不正确的输入并对服务器做一些不好的事情。
2.  您只给个人他们需要的权限。现在，如果简单地在服务器上重启一个进程是解决这个问题的简单的第一步，那么一个工具可以使这项工作变得简单。您可以创建一个工具，让一线支持人员来完成这项任务。您不需要授予每个人对您的服务器的完全访问权限。
3.  从安全角度来看，将个人可以做的事情限制在他们完成工作所需的任务范围内，有助于防止坏人闯入您的系统。如果没有人可以作为超级用户登录到您的生产服务器，那么黑客也不能。
4.  您可以记录操作活动，这使得事后问题分析更容易、更准确，并提供了出于安全目的的操作跟踪。

通过将允许的任务限制为该工具将执行的任务，并验证输入是正确的以及用户具有适当的权限，您可以在很大程度上防止错误的问题导致大型系统崩溃。

## 现实

您可以用自动化和脚本化的工具来代替手工任务的想法在理论上是很棒的，并且在理论上，它可以完全避免诸如导致生产中断的胖手指之类的问题。

然而现实却有点不一样。有许多现实会导致问题:

1.  在需要之前，预测在危机情况下解决问题可能需要的所有工具几乎是不可能的。因此，毫无疑问，您需要一个“后门”,让您最信任的操作人员能够完全访问一切。对于较新的服务来说尤其如此，随着时间的推移和系统变得更加成熟，这种需求会变得越来越少。
2.  工具仍然需要输入，最好的工具验证输入。但是，您应该允许的正确值范围是什么呢？例如，重新启动您的机群中 X %的服务器的工具可能不允许 100%的服务器同时重新启动。但是有多少是可以接受的呢？百分之十？百分之二十？百分之九十？防止问题但解决需求的正确答案是什么？
3.  即使使用了工具和验证，也有可能错过一些必要的验证，并且工具仍然可以很简单地做一些错误的事情，因为它从来没有被编程为拒绝一个意料之外的请求。

这些是影响所有运营团队的现实。那么你能做什么呢？您可以尽最大努力构建最好的工具，尽可能减少错误，并根据需要定期修复和改进它们。换句话说，您可以像对待生产软件一样对待您的工具，并以同样的方式维护它。

## 回到 AWS

而这正是 AWS 所做的。该公司的工程师知道会发生肥指现象。他们知道他们不能给每个人对所有服务器的完全访问权。特别是在 AWS 运作的规模下，这确实是非常危险的。相反，他们做了我上面描述的最佳实践。他们已经构建了工具来执行他们需要执行的所有维护任务。他们已经开发了一些工具来防止人们在维护系统时犯错误，并且他们在这些工具上投入了大量的资金。

> 不允许任何人以任何理由登录生产服务器。相反，构建工具来执行人们通常需要在生产服务器上执行的完全相同的功能。

但是他们在为 S3 服务构建这些工具方面有多成功呢？极其成功。从几乎所有可衡量的标准来看，S3 都是高可用性和高可靠性服务的典范。坦率地说，S3 就是不会崩溃。尽管它在过去几年中经历了显著、显著、显著的增长，但它没有出现重大停机。每个人都指望 S3 在那里…因为 S3 已经证明是非常可靠的。

那这周发生了什么？有人在工具里输入了错误的东西。这种事情经常发生。然而，该工具没有拒绝错误的输入和失败的请求，而是决定实现无效的请求。剩下的就是历史了。

所以，这个问题不是一个糟糕的操作工程师的粗手指问题。这个问题并不是没有遵循构建高可用性服务的最佳实践。这个问题不是意料之外的扩展问题。前几天是什么导致了 AWS 的问题？一个重要工具中的简单软件错误。一些经常发生的事情。

对此应该做些什么？这个错误应该被修复(AWS 说它已经这样做了)。应该审查程序，看看是否可以发现更多的问题(AWS 说它正在这样做)。

更重要的是，业内的每个人都应该从中吸取教训。AWS 在这里使用的最佳实践应该更广泛。如果您仍然有工程师经常登录的生产服务器，请重新评估该流程。如果您的工程师可以随机终止 EC2 实例，请重新评估该流程。如果您可以从命令行或控制台删除随机存储桶或数据表，请重新评估。您的系统将更有弹性、更稳定，这对每个人都有好处。

特征图片:[新老股](http://nos.twnsnd.co/image/156849157318)。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>