# 管道干涸后:在后詹金斯时代繁荣发展

> 原文：<https://thenewstack.io/pipelines-run-dry-thriving-post-jenkins-world/>

[](https://www.oracle.com/corporate/acquisitions/wercker/)

 [Micha“密斯”Hernandez van Leuffen

Micha 是一名黑客企业家，是 Wercker 的创始人兼首席执行官，在那里他负责开发开发人员自动化工具。他在公司博客上说，当他不坐在电脑后面时，他通常会坐在尽可能靠近出口的位置，这样他就可以匆忙下飞机。](https://www.oracle.com/corporate/acquisitions/wercker/) [](https://www.oracle.com/corporate/acquisitions/wercker/)

说软件总是在变，已经是老生常谈了。我们都知道技术发展很快。然而，正如我之前解释的那样，自从 2011 年 Wercker 成立以来，软件世界的某些领域的创新步伐确实非常显著，即使以典型的标准来衡量也是如此。

六七年前，很少有组织在使用 Linux 容器——如果有，他们的平台可能是 LXC，因为 Docker 还不存在。高度分布式的应用程序也不常见。面向服务的架构(SOA)使得分布式服务的想法流行起来，但是没有人做真正的微服务或者将他们的应用程序分解成尽可能多的独立服务。虽然像 Jenkins 和 Bamboo 这样的基本 CI 工具在 2011 年左右已经开始使用，但完整的 CI/CD 交付链的想法仍然是外来的。

虽然在过去的几年中，这些创新创造了新的和不可预见的可能性，正如我也认为的那样，它们还没有发挥出全部潜力。这在很大程度上是文化和工具使用方式限制的结果。例如，虽然 Jenkins 是一款优秀的工具，但其复杂的插件丛林、对微服务的不良支持以及无法提供完整的 CI/CD 使组织难以利用它们所提供的功能。

我已经说了很多困扰现代软件开发和交付世界的问题。但我不仅仅会批评。在这篇文章中，我想通过建议如何克服这些问题，以及组织如何充分利用现有的技术来改变思路。

## 从整体服务转向微服务

在 2011 年，SOA 是一个成熟的概念，但是作为一种技术的微服务才刚刚被提出。微服务的好处众所周知。基于微服务的应用更容易扩展。更新更简单，破坏性更小。监控更加精确，因为管理员可以专注于特定的服务。

在 Wercker，我们在 2015 年开始将我们运行的应用程序迁移到微服务。我想这意味着我们没有站在微服务革命的前沿。我也承认我们的微服务迁移只完成了 30%。

当你将一个单一的应用程序迁移到一个容器化的环境中时，你必须或者[重构或者](http://blog.wercker.com/when-to-refactor-or-rebuild)为微服务重建它。这些过程需要时间。单靠集装箱化是不行的。

好处是，我们在执行迁移方面变得越来越好。我们预计在将下 30%的单片系统迁移到微服务上将花费更少的时间，就像我们迁移前 30%一样。

将 monolith 转变为微服务很难，但是值得努力。随着您的组织获得更多的经验，您将更好地执行这种转换。如果你一开始很挣扎，坚持下去:微服务旅程的第一英里是迄今为止最困难的。

## 从 LXC 到码头工人

虽然我们不是容器的早期采用者，但我们 Wercker 是容器的早期采用者。在 Docker 首次亮相之前，我们使用 [LXC](https://linuxcontainers.org/) 来创建一个平台，在那里你可以运行你选择的应用堆栈。我们认为(并且仍然相信)这真的是很酷的东西。

然而，我们遇到的问题是，LXC 当时相对原始，维护我们需要的框架以支持基于 LXC 的集装箱化开始成为负担。我们开放了我们的平台，并从社区获得了帮助。但这仍然给我们留下了很多东西来维持我们自己。记住，在开源社区对在平台上运行可移植容器感兴趣之前，我们已经做了所有这些。

对我们来说，负担在于我们并不从事构建集装箱化平台的业务。我们正在创建一个构建和发布应用程序的平台，而这个平台恰好是基于容器的。我们不想对平台的底层容器技术负责。

然后，突然之间，Docker 出现了，它正好提供了我们需要的容器技术。Docker 比我们做得更好，因为集装箱化是它的主要关注点。

> 实现全面的 CI/CD 不是一蹴而就的。无论何时你采用新的实践，比如采用微服务，这都是一个需要适应的过程。

Docker 为 Wercker 提供了一个更成熟的基础，让我们不必再负责维护我们的 LXC 框架。许多其他开发人员同时对 Docker 感兴趣，Kubernetes——我们技术迁移之旅中的另一个重要工具——在发布时就考虑到了 Docker 容器，这都很有帮助。

Wercker 现在完全在 Docker 上运行。我们仍然喜欢 LXC，并感谢 LXC 帮助 Docker 成为可能。但是我们发现 Docker 更适合我们的需求。

## 采用 Kubernetes

由于我们从一开始就使用容器，容器编排对我们来说一直很重要。

最初，我们使用 CoreOS 的 [Fleet 为我们的服务提供编排。起初，Fleet 工作得很好，但随着我们越来越多地投资于容器和微服务，我们对 Fleet 能否继续满足我们的需求越来越没有信心。(碰巧的是，Fleet 现在即将退役，到 2018 年将不再提供支持，因此我们认为放弃它无疑是正确的选择。)](https://github.com/coreos/fleet)

因此，在 2015 年，当我们开始微服务迁移时，我们开始寻找新的流程编排解决方案。

首先，我们考虑 Mesos。我们认为基于 Mesos 的数据中心操作系统(DC/OS)是一项令人印象深刻的技术，但我们得出的结论是，Mesosphere 涉及的移动部件比我们需要的多，对我们的目的来说是多余的。

相反，我们选择了 [Kubernetes](/category/kubernetes/) 。它的突出之处在于易于使用，具有单一平台和简单的界面。我们还喜欢 Kubernetes 非常“固执己见”，因为它是为特定的目的而设计的，并与特定的技术结合使用。这让我们更容易整合现有的各种技术。对我们来说，Kubernetes 应该与哪些技术配对，以及我们应该采取哪种方法来使用它是显而易见的。而且对微服务的支持非常好。

今天，Wercker 的整个内部和面向公众的书库都在 Kubernetes 上运行。

## 拥抱 CI/CD

CI 平台的棘手之处在于，它们本身不支持持续交付(CD)。为了实现完整的 CI/CD，您需要完全自动化，完全消除人类在构建和发布软件时执行手动任务的需求。完整的 CI/CD 还意味着构建、测试和部署软件的完全可重复和可预测的模式。

为我们的内部发展完成 CI/CD 是我们在 Wercker 的主要目标之一。我们在这个方向上已经取得了很大的进步，主要是通过使用像容器这样的工具。它们提供了重要的优势，例如测试和生产环境之间的对等性，这使得 CI 和 CD 更容易实现。

当然，我们在 CI/CD 方面仍然面临一些挑战，最大的挑战是不同微服务测试的编排。对于单块应用程序，在 CI/CD 管道中测试它很简单，因为只有一个服务。但是使用微服务，您可以测试多个相互依赖的服务。您可以启动单独的容器，但是当您发现一个微服务有问题，需要您回滚其他微服务时，事情就变得复杂了。

我们尚未找到应对这一挑战的完美解决方案。但在 Wercker，我们已经找到了解决方法:例如，回滚软件部署的能力。如果我们的测试揭示了特定微服务的问题，我们需要时间来解决，我们可以快速将应用回滚到早期版本。通过回滚，即使在测试更新时出现问题，生产应用程序也能保持稳定。

所以实现全面的 CI/CD 不是一朝一夕就能做到的。无论何时你采用新的实践，比如采用微服务，这都是一个需要适应的过程。但是，我们已经确定了应对我们面临的挑战的策略，以继续完成 CI/CD 之旅。

## 结论

我希望我能告诉你，Wercker 已经解决了人类已知的所有软件问题，而且我们已经学会了完美地利用当今可用的技术。当然，这是一个谎言。

然而，我能说的是，这些年来我们已经学会了做出调整，以使我们能够面对不断变化的挑战。采用 Docker 和 Kubernetes 等工具，并努力为我们的内部开发工作流构建完整的 CI/CD 管道，帮助我们将现代软件现实转化为资产而不是负债。我们不再陷入孤立运行 Jenkins 或试图维护我们自己的容器项目的痛苦世界，而不是充分利用开源社区内的协作。

Wercker 是新堆栈的赞助商。

专题图片:[一张 1927 年弗里茨·兰经典科幻巨作《大都会》的电影海报，由 Boris Bilinsky](http://folksonomy.co/?permalink=3340) 拍摄，由 Simon Perkins 分享，以 Creative Commons 2.0 发布。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>