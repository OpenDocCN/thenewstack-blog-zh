# 为什么运作良好的 CI/CD 渠道会造就快乐的 DevOps 团队

> 原文：<https://thenewstack.io/why-a-well-oiled-ci-cd-pipeline-makes-for-a-happy-devops-team/>

[旗语](https://semaphoreci.com/)赞助本帖，由[旗语 CI/CD](https://semaphoreci.com/) 平台为您带来。

 [沃伊泰克·奇乔

沃伊泰克正在 Semaphore 把营销和客户关系联系起来。在职业上，他喜欢与现代技术的创造者和动摇者密切合作。在业余时间，他写并表演口语诗。](https://semaphoreci.com/) 

[JJ·阿斯加尔作为 IBM 的开发者代言人](https://www.linkedin.com/in/jjasghar/)一直致力于帮助组织向云原生生态系统和 [IBM Cloud 的 Kubernetes 服务](https://www.ibm.com/cloud/container-service)过渡。此前，Asghar 是 [Chef Software](https://www.chef.io/) [的 OpenStack go-to-guy。](https://www.chef.io/)

在本次采访中，Asghar 从他丰富的实践和高级经验中描述了组织在采用云原生平台时面临的考验和磨难。他还讨论了在 Kubernetes 中使用 Istio 的服务网格的意义，以及运行良好的 CI/CD 管道为企业带来的巨大好处。

**我想知道您能否从您的经验中谈谈企业采用云原生和无服务器平台的最大推动因素是什么？**

归结起来就是是否有很多应用程序仍然在运行 Java。世界上还有 Java 应用在运行。Tomcat 和 Jbox 非常成功，因为你可以把一个 WAR 文件转储到 Tomcat 中。随着时间的推移，新一代人不想使用 Java。他们希望使用 Ruby/Python/Node/Go 和 Kubernetes，因为企业现在正成为任何东西的统一控制平面或应用层。你可以在里面运行 Java，你可以在里面运行 Python 应用程序，这和 Java 人过去用 Tomcat 做的技术是一样的，但是现在完全跨每一种语言。它非常强大，因为现在您不必花费这么多时间来运行您的应用程序，您只需让 Kubernetes 全面运行一切。

**好像企业都注意到 Java 有点过时了吧？**

不一定。新版本的 Java 实际上有了惊人的进步。有一个版本的 Java 已经被编译并运行在 Knative 上，速度快得离谱，而且很容易使用。我相信在大约一个月后的 [DevNexus](https://devnexus.com/) 大会上，将会有一股展示它的巨大推动力。Java 没有死；它是企业的主力。

**我在 [Semaphore](https://semaphoreci.com/) 工作，在那里我们经常强调“为快乐而优化”的口号，我们从客户那里听到灵活的 CI/CD 渠道如何改善整个团队的生活，并且是一个实际的推动者。** **您能描述一下为什么一个运行良好的 CI/CD 系统对实施和维护企业级软件如此重要吗？**

这也是一个非常非常重要的问题，我以前在不同的公司工作时多次听到这个问题。好的 CI/CD 管道的好处在于它是一张舒适的毯子。如果您正在转向原生云、基于容器或仅使用配置管理，CI/CI 就是您的舒适毯。你可以信任的东西总是会做正确的事情，它不是人类，而是机器人在做工作。

不幸的是，要获得真正成功的 CI/CD 管道，您不能简单地放弃它，您可能从 Semaphore 中了解到这一点。你需要一点一点地去做；你需要学会信任软件来完成工作，你需要从非常简单的开始。

我教别人 CI/CD 的最好的故事之一就是 Python。有很多 Python 开发人员，pep8y 实现是非常标准的。好吧，对于任何 Python 项目，你应该为你的 CI/CD 管道做的第一件事就是让 pep8 在它被合并到 master 之前运行它——只是为了确保你正在做你所期望的。然后添加单元测试和集成测试。你不断前进，然后有了它，你就能拥有完整的管道，在你知道之前，每次你看到一个新的公关你都会看到一个绿色的小支票，你有信心它可以进入师父，而不是炸毁世界。

**但是企业一般是怎么做 CI/CD 的呢？**

总的来说还是一样的对话，只是慢了很多。对于企业来说，有很多人在 CI/CD 管道的不同级别接触单个代码库或多个代码库，并且有很多不同的产品在做这种工作。但它的美妙之处在于，你可以找到适合你的公司投资组合的东西，并且你能够塑造它来适应你的工作流程；或者你买一个自以为是的，然后说，“嘿，这是我想要的方式。我知道这种固执己见的工作流程之所以成功是因为 X、Y 和 Z”或者“我需要一个完全灵活的工作流程，在这里我可以做任何我想做的事情。”

**在最近的一次采访中您回忆起在 Chef 担任 DevOps 工程师如何让您有更多时间与家人在一起，并且不再担心在与家人庆祝寒假期间必须跑到数据中心重启服务器和启动基础设施。你甚至承认“厨师改变了你的生活”** **你认为今天应该注意什么？运行影响人们生活并阻止他们在晚上获得八小时不间断睡眠的云原生应用程序仍然是一个大问题(无论是对系统管理员还是在云上运行业务的人来说)？**

我关于《大厨》的故事以及它如何改变了我的生活非常简单。我在一家做一些应用工作的商店工作，我经常在凌晨三点醒来做产品发布。最终，我能够使用配置管理来完成这项工作(感谢 Chef)。我实际上意外地创建了一个 CI 管道，通过它我引入了所谓的[测试厨房](https://kitchen.ci/)来为我做这项工作。我真的去找我的老板说，“我不想在周六的凌晨 3 点醒来。”我经历了整个过程。我向他展示了测试厨房 CI 流程，并向他们展示了所有检查结果。我没有拆任何机器，做了一个滚动重启，说:“我对这个东西太有信心了。如果我停止生产，我就辞职。我是一个可敬的人——我会修好它，把它修好，然后我会写辞职信。”老板说:“我接受这个打赌。”我敲了敲键盘，然后把它推出来，它运行得非常好。他看着我说，“我不相信这真的有用。”现在我能够做到了，这改变了我的生活。现在，我可以随时推出产品，因为我有 CI 渠道，所以我不会停止生产。六个月后，我开始为主厨工作。

考虑到这一点，还有什么工具可以真正改变人们的生活吗？

总的来说，使用容器技术来获得灵活性和速度，使用 CI/CD 来确保您“就像那样”有信心的想法是极其重要的。有信心说 CI/CD 已经通过检查，一切都是绿色的——这将改变你的生活；尤其是如果你来自虚拟机世界，并且不使用云原生的东西。当您开始遍历和构建管道来完成工作时，CI/CD 是非常宝贵的。

**今年早些时候，您在[2019](https://cfgmgmtcamp.eu/)配置管理营上谈到了 [Istio 服务网](https://istio.io/)。在接受了 Kubernetes 的复杂性之后，这个项目通常是人们试图接近的下一个项目。当谈到“我应该何时考虑在我的 K8s 集群上使用 Istio？”时，您有什么建议 Istio 可以帮助解决哪些最常见的问题？**

Kubernetes 只是一个调度程序。嗯，这非常复杂，但如果你把它归结为每天都在做的事情，那就不复杂了。您告诉 Kubernetes，“我需要这个容器运行，”然后您创建了这个清单，其中包含了一系列变量。这就是它真正的作用。围绕 Kubernetes 有一个完整的生态系统需要创建。

Istio 特别关注网络——这就是它的本质。对我来说，我告诉人们为什么我应该在乎这个故事的那一刻，基本上就是我看到 Istio 和特使边车的那一刻。您可以编写智能路由来读取 HTTP 头并更改容器的方向。您不仅仅是开发一个普通的三层应用程序，而是拥有 Web 前端、应用服务器和数据库。显然，您的数据库不在 Kubernetes 上，但这是一个不同的话题，也是一个争论激烈的话题。您有了 Web 前端和应用服务器，假设您想要发布一个新的 iPhone 应用程序，您可以使用 Istio 查看来自用户代理的 iPhone http-header，并将其专门发送到角落里的一个容器的测试版，然后实际访问您的生产数据。这就是你如何以一种安全的方式拥有真实的生产数据。你实际上可以在上面有任何任意的标题，所以如果你有一个 QA 团队或一个设计团队，你可以告诉他们，“嘿，当你碰到我的生产数据时使用这个散列，你会碰到我们明天要发布的东西的一小部分。”

Kubernetes 做了所有的工作来确保所有的东西都在那里，回到 CI/CD 的故事——你实际上可以把头放进去，让 CI/CD 专门推送到特定的名称空间，让 Istio 路由到它，然后你可以有一个安全的方法来确保公众不使用它，或者只有特定的一组人使用它。

**所以是关于复杂的交通管理？**

那只是一部分。那一刻我第一次明白了。有一个完整的世界。您可以确保特定的容器只通过安全通道相互交流。有免费的遥测技术，所以只要你安装 Istio，你就可以立即获得一堆不同的插件，在那里你可以向你的老板展示你的微服务之间实际发生的事情，甚至还有一个 [Vistio](https://github.com/nmnellis/vistio) 图，你可以实际看到几乎实时发生的所有不同的连接。

**复杂性从未停止。**

我是说，这就是它的美妙之处，对吧？你看到了你面前的复杂性。随着时间的推移，当你获得越来越多的微服务时，事情会变得非常非常复杂。实际上，您可以在屏幕上看到每秒钟通过不同微服务的请求，并了解实际发生了什么。

**在你的文章[“建立和领导一个开源社区”](https://jjasghar.github.io/blog/2018/03/23/leading-an-opensource-community/)中，你强调了围绕一个项目建立一个活跃的社区是多么困难，尤其是当它必须“让企业的霸主们高兴”的时候你还提到“80%的开源项目”从来没有达到这样一个程度，即他们能够说他们有机地开发了对社区和支持该项目的公司都有价值的东西。那么，Kubernetes 的爆炸是如何成为这个规则的例外的呢？**

我先从 OpenStack 说起。这是一个非常棒的开源项目，它的理念是，“我们将建立一个自由开放的云。”我认为它已经存在了六七年，现在每个人都有自己的声音。太棒了。它完全民主化了，任何人都可以参与其中。它开着。太棒了。

随着时间的推移，人类就是人类——犯错，事情发生，性格改变，公司进来制造问题。我真诚地相信 Kubernetes 如此成功的一个原因是:他们吸取了许多关于 OpenStack 如何运行的经验教训，然后利用这些经验教训，为云原生故事创建了另一个基础。这也是因为它主要由 CNCF 的几家公司支持，这些公司实际上可以对事情说“是”或“不是”。因此，有一个真正的信任圈来确保不是所有的随机事件发生。

我真诚地相信 Kubernetes 现在如此成功的主要原因之一是因为有一种“监督水平”,允许不太疯狂的事情突然出现，但一个实际的项目却非常成功。

**例如，在 [FOSDEM](https://fosdem.org/) ，我听到人们说，“几年前都是关于 OpenStack，现在都是关于 Kubernetes。”**

这些是完全相同的人。如果你真的去逛逛，你会看到从 OpenStack 社区搬到 Kubernetes 的那些人。见鬼，我甚至是他们中的一员。

管理 Kubernetes 的云本地计算基金会是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>