# 数据堆栈之旅:Heroku 和 Mattermost 架构堆栈的经验教训

> 原文：<https://thenewstack.io/the-data-stack-journey-lessons-from-architecting-stacks-at-heroku-and-mattermost/>

[](https://www.linkedin.com/in/adoven/)

 [亚历克斯·多芬穆赫勒

亚历克斯是大时代数据公司的联合创始人。此前，他在 Mattermost 和 Heroku 从事数据工程工作。Alex 喜欢构建数据系统，并利用尖端数据技术推动业务发展。](https://www.linkedin.com/in/adoven/) [](https://www.linkedin.com/in/adoven/)

我们当前的世界被定义为信息超载。从你的手表跟踪你的健康状况，到你的洗衣机通知你衣服洗好了，到你的手机跟踪一切，我们的个人生活不断产生数据流。

对商家来说没什么不同。当然，许多企业收集上述类型的产品数据，但这只是一种数据。跟踪销售线索、营销旅程和客户体验现在已经成为标准，这只是商业数据的几种形式。您的企业产生的数据量是巨大的——如果利用得当，它也会非常有价值。

事实上，我们认为，能够大规模利用这些数据的公司，能够更好地了解他们的业务，并更快地迭代。这种独特的竞争优势有助于他们最终赢得市场。

重要的是，您在实现从数据中创造价值所需的工具和流程方面的努力不是一成不变的。随着企业规模和复杂性的增长，您需要不断迭代以适应客户和市场的需求。这改变了你从数据中创造价值的方式。

我们将这一过程称为“数据堆栈之旅”这篇文章旨在指导您做出良好的基础决策，这些决策将为您带来短期利益，但会减少或消除随着您的业务和数据增长而出现的常见增长难题。

我们将介绍公司阶段、客户数据堆栈的核心组件，然后根据 Alex 在 Heroku 和 Mattermost 等公司构建数据堆栈的经验，深入探讨他对在哪个阶段使用哪些组件的建议。

## 数据堆栈之旅

 [埃里克·多兹

Eric 在 RudderStack 领导客户成功并支持增长团队。他长期帮助公司构建客户数据堆栈，并使用他们的数据来发展。](https://www.linkedin.com/in/ericdodds/) 

当您的企业第一次提供数据库来存储数据时，您就已经迈出了数据堆栈之旅的第一步。了解您所处的阶段有助于您为自己的业务选择正确的数据工具。该工具包将使您能够利用您的数据发挥最大影响。

最终，数据堆栈之旅是随着您的业务和数据的增长和变化，您的数据、数据工具和流程的演变。通过在旅程的适当阶段选择正确的工具和技术，您将能够最大化从数据中提取的价值，同时还能控制在工具和资源上的支出。也许最重要的是，您可以尽早做出明智的决策，随着您的发展而获得回报，帮助您避免迁移/集成工作以及为扩大规模而重新架构的需要。

## 公司阶段

让我们先来看看企业成长过程中通常会经历的阶段，从小型初创企业到国际企业。

随着公司的发展，他们的数据和数据技术需求也在发展。成长的每个阶段都会带来新的挑战，我们将针对每个阶段提出有针对性的建议。

**第一步:**你有少量的客户与你保持着高度接触的关系。创始人身兼数职，大多数后台流程都是手工完成的。

**Seed:** 你的产品获得了关注，你不再能够亲自给每个客户发信息。你的业务已经开始产生收入，你正在快速迭代产品。种子和 A 轮阶段 VC 公司一般都在这。大部分传统部门，如销售、营销等。，由小团队(1-3 人)组成。

**增长:**你已经发现产品适合市场，并正在积极扩大市场份额。你有成千上万(甚至更多)的客户(数量也取决于商业模式)。年收入现在已达数百万。您的组织开始感受到成长的烦恼，需要扩展和成熟。这是大多数 B 轮和 C 轮公司的处境。

成熟:你的企业被认为是其市场中的大玩家，被认为是你所在细分市场中事实上的选择之一。产品迭代更倾向于深思熟虑和计算。优化任何业务指标，哪怕只是几个百分点，都可能带来数百万美元的成本节约或收入。

**你的祖母听说过它们**:你的企业处理的是真正的“大数据”我们这里说的是 FAANG 级别，数据大小以 Pb 为单位。您正在构建一些自己的内部工具来处理数据规模，因为没有现成的解决方案可以满足您的所有数据需求。

## 数据堆栈组件

现在，我们已经建立了公司在数据堆栈之旅中的高级阶段，让我们来看看数据堆栈的核心组件。客户数据堆栈[是一个全面、复杂的系统](https://rudderstack.com/blog/the-complete-customer-data-stack)，所以在这篇文章中，我们删减了每个公司都需要的堆栈基础核心组件的列表。

**数据仓库**:堆栈的“中心”，在这里，您的所有数据都是统一的且可访问的(对于团队、工具、应用程序等)。)

**数据转换:**处理和转换，以确保您的数据可用于下游功能

**数据可视化:**将数据转化为人类可用的界面，用于各种目的，主要是分析

**事件流:**来自您的网站和应用的用户行为数据

**ETL/ELT(表格):来自云应用的**表格数据

**反向 ETL:** 将数据从你的仓库发送到应用程序和其他目的地

**数据治理:**在整个堆栈中保持数据整洁&合规

## 按阶段划分的数据堆栈组件

这就是橡胶与公司相遇的地方——决定在哪个阶段使用哪个组件。(此分析来自 Alex 在 Heroku 和 Mattermost 等公司的各个阶段构建和重新构建数据堆栈的经验。)

### 数据仓库

**第一步**和**种子**:你最有可能只是查询你的生产数据库，尽管我会推荐使用读取副本/跟随器。我会说你**可以**对你的生产数据库运行 dbt，但我会非常小心，可能会干脆跳过 dbt，直到你可以得到一个只用于分析的数据库。

在一段时间内，您应该能够使用 Postgres 数据库作为您的数据仓库。

**增长**和更大:一旦你达到一定规模，你很可能会寻找一个合适的数据仓库。

目前排名前三的是谷歌的 BigQuery、亚马逊红移和雪花。我个人把雪花和 BigQuery 分别定为 1a 和 1b。

*   **BigQuery** 能够非常快速地将数据传输到您的仓库中(例如，只需几秒钟就可以获得某些可查询的数据源)。
*   我发现**雪花**是最容易使用的，有一个更传统的数据库权限系统。此外，通过控制“虚拟仓库”的大小来控制计算能力的大小，可以轻松地在一个合适的运行时运行大型任务。它还有一些有趣的特性，比如 Snowpipe，用于将数据拉入仓库。

对于 BigQuery 和 Snowflake，您需要关注成本，因为您通常要为消耗的计算资源付费。

**红移**很棒，但是运行起来更像传统的数据库系统。红移的好处是，无论你用它做多少，你都只需支付一个固定的金额。但是，您必须在数据库管理任务上花费更多的时间，例如优化列编码、排序键和分布键。此外，您的计算能力并没有脱离您的存储。因此，如果您只是需要更多的存储，您必须向您的集群添加更多的节点，即使您不一定想购买更多的计算能力。

### 数据转换

独一无二的 [dbt](https://www.getdbt.com/) 这是我向任何规模的公司推荐的一个工具。作为 ELT 过程的一部分，它提供了一个转换数据的框架。使用 dbt，您可以定义原始数据源并在类似 SQL 的模板中构建模型，然后构建引用其他模型的模型。因为您现在已经定义了模型的层次结构，所以 dbt 现在可以根据您已经构建的模型图来适当地构建您的模型。

然后，Dbt 将自动生成一个 docs 站点，允许您可视化模型和原始数据源的谱系图。这确实有助于新的分析师和数据工程师的入职，为他们提供了一种简单的方法来探索数据是如何建模的及其谱系。

[Dbt Cloud](https://www.getdbt.com/signup/) 是 50 美元/月/开发者用户，无限“仅查看”用户。也可以通过 Airflow 这样的工具自己运行 dbt。在大多数情况下，我会从 dbt 云开始，因为自己运行 Airflow 的运营负担可能会超过它的价值，特别是如果您只是使用它来运行 dbt。

### 数据可视化

对于**第一步**和**种子**，我推荐[元数据库](https://www.metabase.com/)。这提供了不会倾家荡产的数据可视化。为了将来的可伸缩性和可维护性，我建议利用 dbt 来构建模型，这些模型可以用简单的 SQL 查询回答大多数问题。通过将大部分复杂性放在 dbt 模型中，可以确保用户不会因为错误地编写 SQL 而陷入麻烦。如果您选择迁移到不同的可视化平台，这也允许您有更多的可移植性。

如果你使用他们的云服务，元数据库的价格可以低至每月 100 美元。

对于**成长**和更大的，我会推荐 [Looker](https://looker.com/) 。我不推荐它用于较小公司阶段的唯一原因是，它的成本比 Metabase 等替代方案高得多。使用 Looker，您可以在 [LookML](https://docs.looker.com/data-modeling/learning-lookml/what-is-lookml) 中定义您的数据模型，然后 Looker 使用它为最终用户提供一个拖放界面，使他们能够构建自己的可视化，而无需编写 SQL。这使您的分析团队能够扩展，而不必陷入回答终端用户的一次性问题，也不必构建用户需要的每个图表或图形。

### 事件流

这里实际上只有两种选择——分段和方向舵堆栈。在第一步和种子阶段，它们都是负担得起的，但在成长、成熟和企业阶段，[ruder stack](https://rudderstack.com/?utm_content=inline-mention)的伸缩性要好得多。

**细分市场**:细分市场是一个成熟的产品，非常倾向于营销和收入运营用户。虽然 Segment 会将您的数据同步到您的数据仓库，但许多功能被限制为只能使用 Segment 本身中的数据。这意味着很难释放数据的真正力量。此外，由于基于 MTU 的定价，您可能会被迫尝试确定实施新的遥测技术是否值得。

RudderStack : RudderStack 不存储任何数据(它们使您能够在自己的仓库上构建 CDP)，并且它们的事件流功能与 Segment 一样好，甚至更好。此外，它们提供了云提取(ELT)和仓库操作(reverse-ETL)，这意味着您不必将事件流与其他管道分开管理。最后，因为它们是开源的，所以没有供应商限制。

### 数据治理

这与我们上面讨论的转换组件密切相关，所以我们不需要深入讨论太多的细节。最终，您需要从一开始就将数据治理放入堆栈中，dbt/Looker 是完成这项工作的工具。

**第一步**和**种子**:通过 dbt，您可以隐藏将原始数据转换为可用模型的复杂性，还可以确保内部用户只查看经过审核的 dbt 模型中的数据。

**增长**和更大:通过结合 dbt 和 Looker，您可以保持良好的数据治理。Looker 为您提供了一个平台，让您可以统一业务指标的定义，这样每个人都可以在同一张乐谱上演奏。

### ETL/ELT(表格)

将表格数据从云工具中获取到数据仓库的 ETL/ELT 解决方案正变得商品化，该功能现在在数据堆栈中无处不在。有各种选择和一些后起之秀需要留意。

**Pipelinewise:** 运行 Singer.io taps 和 targets 的开源框架。自己运行相对容易，可以让你开始使用 ETL。推荐用于**第一步**和**种子**(但是你可以把它作为一个额外的工具，因为它很容易使用)。

**Stitchdata:** 一款 SaaS 产品，也运行 Singer.io taps 和 targets。UX 相对简单，尽管有一些粗糙的边缘，除非你购买他们的企业计划，否则你不能使用 cron 风格的调度。定价完全基于同步的行数，通常不会很贵。

**FiveTran:** 这是这一领域的高端产品，采用抛光 UX，但成本也较高。他们还有一个基于“每月活跃行数”的定价计划，这使得计算起来有点困难。建议成长型或大型公司使用。

**RudderStack 云提取:**使用云提取，您可以将数据从数据源提取到您的仓库中。因为它与 RudderStack 产品的其余部分集成在一起，所以无需登录大量不同的工具，管理起来也更容易。

Airbyte: 这是这个领域的新成员，并且是开源的。他们希望摆脱 Singer.io 格式，并且希望更好地与 dbt 集成。留意这一个。

### 反向 ETL

从数据仓库中丰富业务系统中的数据变得越来越重要。关键是确保每个业务系统都填充了准确的数据。这也允许您公司中的不同团队使用他们熟悉的技术，而不必在一堆不同的系统之间跳跃。例如，用产品使用数据丰富客户关系管理中的销售线索信息，可以帮助销售代表更好地与客户互动，并带来更多的转化。

反向 ETL 还有助于自动化业务流程，并使其更加高效。这个领域有很多竞争对手，谁是首选解决方案尚未尘埃落定。

在撰写本文时，Census 是这个领域中比较成熟的产品之一。不要低估一个好的 UX 对推动组织内的采用有多大的帮助。默认的定价模式是每个连接器不收取额外的每卷费用。如果您的组织将大量数据同步到一个目的地，这可能是您的解决方案。

T2:这个产品发展很快。一个有趣的特性是他们的 [Git sync for dbt](https://docs.hightouch.io/hightouch-with-dbt/git-sync-for-dbt) ，它给你“按代码配置”,这将有助于可伸缩性和可维护性。他们的定价基于同步到任意数量目的地的**唯一**记录的数量。如果您希望将相对较少的记录同步到许多不同的目的地，这可能是您的解决方案。

**多体:**该产品是该领域的新成员，他们有一些有趣的变化。一个是，它们不写入从中提取数据的数据源，这意味着您可以将它连接到一个只读副本，而不会有任何问题。此外，他们可以将包括 Google Sheets 在内的各种来源的数据结合在一起，并将结合的数据推送到各种来源。如果您正处于数据堆栈之旅的早期阶段，这绝对值得一看。

**RudderStack 仓库操作:**使用 RudderStack 的仓库优先架构，可以很好地将数据发送到其他数据源。这个特性仍在开发中，但看起来很有前途，如果您有相对简单的反向 ETL 需求，它会让您不再需要“另一个工具”。

## 只有你可以防止一个凌乱的堆栈

现在是数据工程师设计客户数据堆栈的大好时机。可用的工具允许您以仓库为中心从数据层开始构建，最终为您提供灵活性和可伸缩性。也许最好的消息是，有像 dbt 和 RudderStack 这样的工具，它们将从您成为企业公司的第一步开始与您一起扩展，极大地简化您在堆栈上的工作，并使您能够专注于您的产品。

然而，归根结底，工具只是管道:最好的公司让数据本身成为组织中的一等公民，并在数据建模、转换和治理方面投入时间，以确保无论使用何种工具，数据在增长的每个阶段都保持干净和可用。

Pixabay 的特色图片。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>