# 历史数据和流:朋友，而不是敌人

> 原文：<https://thenewstack.io/historical-data-and-streaming-friends-not-foes/>

在过去的十年中，实时事件流已经成为软件工程师最重要的工具之一。在 Stack Overflow 的 2022 年开发者调查中，事实上的事件流平台 Apache Kafka 被列为薪酬最高的技术技能和最受欢迎的框架之一。

虽然开始时不为人知，但现在有无数公司大规模使用它的故事，如[游戏](https://www.kai-waehner.de/blog/2020/07/16/apache-kafka-gaming-games-industry-bookmaker-betting-gambling-video-streaming/)和[拼车](https://www.uber.com/blog/kafka-async-queuing-with-consumer-proxy/)，延迟必须保持令人难以置信的低。因为这些例子被谈论得最多，所以许多人认为[事件流](https://thenewstack.io/the-rise-of-the-event-streaming-database/)——也称为数据流——只适合具有苛刻实时要求的用例，而不适合旧的历史数据。然而，这种想法是短视的，并且突出了错过的建筑机会。

不管你的业务需要多快处理数据，如果它是适合这项工作的正确工具，流媒体可以让你的软件更容易理解，更强大，更不容易出现错误。当您考虑将[添加到您的架构中时，需要考虑以下三个关键因素。](https://thenewstack.io/what-is-data-streaming/)

## 因素 1:了解数据的时间/价值曲线

你的数据有多大价值？那是一个棘手的问题。这取决于数据点发生的时间。绝大多数数据都有时间/价值曲线。一般来说，数据越老，价值就越低。

现在，人们通常不会将旧数据与流媒体相提并论。为什么？直到最近，大多数流媒体平台的存储容量都相对较小。这对于他们最初在裸机数据中心的家来说是有意义的，但由于几乎所有东西都转移到了云，这已经成为一种不健全的模式。云对对象存储的访问提供了近乎无限的存储容量。

许多流媒体平台直接与这些商店集成，并实现相同的存储容量改进。这一点很重要，因为当涉及到流式传输时，它将强制保留决策排除在外。您不再需要决定数据可以在流中保留多长时间——只要有意义，您就可以简单地保留它。

历史流最令人兴奋的用例之一是回测在线机器学习模型。团队经常发现，当他们将一个经过训练的模型部署到产品中时，他们需要以某种方式改变它。但是他们怎么能确定他们的新模型运行良好呢？最好的结果是对所有历史流量进行测试，因为流传输是无损的，这正是你所得到的。

如果您的数据的时间/价值关系有意义，流式传输是从曲线两端获取价值的一个很好的方式。

## 因素 2:决定数据流的方向

在软件工程的早期，许多东西都是用轮询来编写的——定期检查是否发生了什么。例如，您可能会定期轮询数据库表，以查看是否添加或更改了某一行。出于很多原因，这是一个灾难的处方，因为自从你上次检查以来，许多事情可能会改变，而你不会知道所有的改变是什么。

流的强大之处在于，它迫使你考虑无损的、单向的数据流，而不是可变的、双向的进程调用。这为您理解系统如何通信提供了一个简单的模型，不管数据是实时的还是历史的。代替轮询，您可以监听来自系统的更新，并保证您将看到按发生顺序发生的每一个变化。为了解决上面的例子，[变更数据捕获](https://www.oreilly.com/library/view/streaming-change-data/9781492032526/ch01.html)已经成为监听数据库变更的事实上的解决方案。

当您考虑流对您的问题是否有用时，请将延迟放在一边，并问自己:我的系统是否受益于这种推模型？无损更新重要吗？

## 因素 3:选择到期策略

不受限制的历史流是很好的，但总有一天会删除您的数据，这可能是由于 GDPR 合规性或您业务的变化。如何协调流的关键原语(不可变的数据日志)和删除(可变的操作)？

有两种常见的方法来解决这个问题。第一种是实施到期策略，使数据系统能够在某个时间段后清除数据，如生存时间(TTL)。另一种方式是[压缩](https://www.pcmag.com/encyclopedia/term/data-compaction)，记录的历史修订在一定时间后被清除。

第二种稍微复杂一点，使用了[加密](https://thenewstack.io/protect-and-index-sensitive-data-with-polymorphic-encryption/)。只有当您拥有解密密钥时，加密的有效负载才有用。一般来说，删除有效载荷的加密密钥被认为是一个错误，但如果你想防止任何人再次看到这些数据，就不是这样了！在某些系统中，有意删除加密密钥，然后删除实际的数据集，是使数据离线的简单解决方案。

很难预测软件的未来，但一个不变的事实是，总会有新技术出现。当您考虑您的用例的流时，重要的是考虑这些关键问题:推模型有帮助吗？有序访问旧数据有用吗？有没有简单的删除旧数据的方法？如果这些问题的答案是肯定的，那么你投资流媒体技术是出于正确的原因，当你这样做的时候，很难出错。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>