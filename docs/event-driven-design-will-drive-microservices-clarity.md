# 采用事件驱动设计的高效微服务架构

> 原文：<https://thenewstack.io/event-driven-design-will-drive-microservices-clarity/>

毫无疑问，在 IT 界，[微服务](/category/microservices/)是性感的。但是仅仅因为你发现一些很酷很吸引人的东西并不意味着它对你有好处。这并不意味着你知道如何正确使用它![](img/632aa57fc8812c59993f8ff03c30c6f2.png)。

事实上，微服务尤其不容易。是的，微服务允许不同的团队成员以不同的速度处理代码的不同部分。但是根据红帽的首席中间件架构师 [Christian Posta](https://github.com/christian-posta?tab=repositories) 的说法，这种奇妙的自治经常发现人们更加孤立，在把它扔给测试和文档团队之前不知道对方在做什么。

为了获得真正的微服务独立性，Posta 说我们需要摆脱依赖，比如假设微服务意味着每个服务控制自己的数据库。

这个想法是合理的:不要跨服务共享一个数据库，因为这样你会遇到冲突，比如竞争读/写模式、数据模型冲突、协调挑战等 Posta 在最近的一篇博客中写道。Posta 是 Red Hat 的集成消息和云平台产品的产品专家，在北美旅行，与开发人员一起研究云原生意味着什么。

如果您有完全隔离的角色，那么您需要隔离的数据，除非使用单个数据库也有好处。使用单个数据库，您可以更全面地了解所有信息是如何汇集在一起的，并且能够通过一个视图管理所有信息。单个数据库还支持 ACID 交易——比如从一个备用账户提款和向另一个账户转账被视为一个交易。

Posta 希望我们解决如何利用单一数据库的这些便利，并将它们应用到微服务中。如果每个服务都有自己的数据库，我们如何在保持独立性的同时协调所有服务的变更和安全性呢？根据 Posta 的说法，当你采用[事件驱动设计](http://www.thecloudcast.net/2017/05/the-serverlesscast-6-events-vs-functions.html)时，答案就来了。

“通过在一个设定的域和上下文中建模数据，微服务可以摆脱这些依赖性[，同时仍然保持整个系统的数据一致性](https://www.redhat.com/en/about/videos/hardest-part-microservices-your-data)，”Posta 在最近的 Red Hat Enterprise Summit 的一次演讲中指出:

[https://www.youtube.com/embed/MrV0DqTqpFU?feature=oembed](https://www.youtube.com/embed/MrV0DqTqpFU?feature=oembed)

视频

## 问题是:微服务仍然缺失

在他的工作中，波斯塔看到各种各样的公司——从亚马逊到高盛——自称为科技公司。他说这很棒，但当保险或风险管理等传统企业习惯于将所有 it 工作外包出去，现在又想从投资的另一端将所有 IT 工作内部化时，却没有考虑它如何成为一个差异化因素。

“这些公司中的一些——从支持这些事情的低层到高层管理人员——非常兴奋地去做谷歌、网飞或亚马逊所做的事情，他们最终投入大量资金去做他们认为这些公司所做的事情，以解决他们认为这些公司存在的问题，但他们没有从中获得差异化优势，”他说。

这些公司投资于当前的热门领域，如可操作的高联网和容器，当然还有微服务。

“最终，他们将如此多的资源投入到某种平台中，他们不得不支持、维护、修复漏洞和安全，做一些对他们的底线或提供商业价值来说并不重要的事情。”

在过去的几十年里，这些公司依赖于像 IBM 和 Oracle 这样的大型战略合作伙伴作为他们的劳动力和使用他们的软件。这使他们能够更全面地了解他们的软件，但是，现在他们被束缚住了，这些公司无法实现增加这种自动化和自治所需的灵活性水平。

“现在他们只是试图将一切内部化——也许使用开源软件——但却在一些没有优势的东西上投入大量资金，”波斯塔说。

问题增加了，因为这些开源工具中的每一个都有不同的社区和不同的发布周期。

最终，这些公司缺乏竞争优势，无法充分利用他们投资的技术。

## 解决方案:事件驱动设计

波斯塔告诉新堆栈，自从[马丁·福勒](https://martinfowler.com/)写下[他的微服务观察](https://martinfowler.com/articles/microservices.html#CharacteristicsOfAMicroserviceArchitecture)以来，我们一直在努力按照描述的方式构建事物，提出微服务的硬性规则，“如果你不做这五件事，那么你就不是在做微服务。”

但有一点是一致的:“每个微服务都有自己的数据，它们通过 API 进行通信，重点是去耦和所有我们知道我们需要的东西。”

Posta 说这是有意义的，并迫使许多人想要“建立东西，这样每个微服务都有自己的数据库。”

然而，他认为，如果不完全理解数据库今天做什么，它们带来的能力以及什么依赖于它们——如事务、并发性、隔离、持久性、物化视图、索引——“我们就没有完全理解关系数据库决策的原则，[而且]我们很快就会陷入通过 API 调用重新实现数据库的麻烦，并且实现得更差。”

这就是为什么 Post 开发了这四个问题，我们必须在开始任何微服务架构转型之前问自己:

领域是什么？你现在的现实是怎样的？

交易界限在哪里？

微服务应该如何跨边界通信？

如果我们把数据库翻个底朝天会怎么样？

“至少承认，是的，我们将建立一个看起来像数据库的东西，是的，这很难做好，第三，使用事件驱动的架构比使用 API 驱动的架构更适合这个问题，”他说。

那么事件驱动架构和异步 API 驱动架构有什么不同呢？事件驱动架构”让您提前处理数据不是最新的这一事实。你必须解决时间的概念，数据意味着什么，什么时候是当前的，什么时候不是当前的，”波斯特说。

“在旧的数据库中，一切都是最新的，但是，一旦你开始向网络打电话，你正在处理的数据，从本质上来说，是陈旧的，”他说。

事件驱动的架构将这一事实作为架构的核心部分，理解当您处理事件时，它们是发生在过去的事情，而不是假设它们是当前状态，就像银行帐户状态可以快速改变一样。

这种事件驱动的架构是 LinkedIn、网飞和亚马逊的基础。

“企业架构师、首席架构师、开发人员，他们将是实现弹性的先锋，引入技术、架构和管理工具，”Posta 说。“微服务或任何云原生架构最重要的部分是能够观察系统并了解正在发生的事情。”

Posta 承认这不是一个新问题，但也许是一个更大的问题，现代工具和架构可以吸引更多的注意力，如果没有意识到这一点，可能会使问题复杂化。可观察性领域的工具变得越来越有必要创建度量标准，记录和跟踪这些微服务如何交互，哪里速度慢，哪里出现问题。这些工具转向动态的云原生环境和事件驱动的架构，其中服务可能一直在变化。

波斯塔指出“另一个问题是如何更深入地理解:对我们的业务有什么影响？客户交易慢，对我们的核心客户意味着什么？”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>