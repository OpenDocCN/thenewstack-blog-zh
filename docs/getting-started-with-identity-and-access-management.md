# 身份和访问管理入门

> 原文：<https://thenewstack.io/getting-started-with-identity-and-access-management/>

如果您的业务正在扩大，您可能会发现您交付的软件应用程序和 API 比原来多得多——所有这些都很可能使用敏感和个人数据。当然，这些数据必须是安全的。那么，你从哪里开始，如何确保你这样做是正确的呢？

[https://www.youtube.com/embed/Qr2PZkpBpwo](https://www.youtube.com/embed/Qr2PZkpBpwo)

视频

## 要考虑的安全挑战

 [朱迪思·卡勒

Judith 是一名产品营销工程师，对安全性和身份非常感兴趣。在加入 curity 团队之前，她最初是一名开发人员，后来成为了一名安全工程师和顾问。](https://www.linkedin.com/in/judith-k-3269a6a9/) 

用有限的资源交付一个好的安全实现来解决所有开放 Web 应用安全项目的[10 大 API 安全风险](https://curity.io/resources/learn/owasp-to-ten/)是一个挑战。需要考虑许多要求，以下是一些最重要的要求:

*   避免数据泄露和防止网络攻击
*   满足监管要求
*   以简单和可扩展的方式集成安全功能

像这样的架构需求需要一个架构解决方案，它只需设计一次，就可以在整个组织中重复。您必须确保随着您的实现的增长，解决方案是可伸缩的，以便相同的模式可以在许多团队中使用和理解。

## 安全标准很重要

通过使用由行业专家设计和审查的安全标准，您可以建立高安全基准。现代应用安全标准基于 [OAuth 2.0](https://curity.io/resources/oauth/) 系列技术，这些技术提供了良好的功能，包括与其他系统的出色连接以及与大多数堆栈集成的能力。OAuth 提供了一种机制来控制哪一方可以访问哪些信息。

另一个必要的标准是 [OpenID Connect](https://curity.io/resources/openid-connect/) ，一个位于 OAuth 之上的身份层。它允许根据授权服务器执行的身份验证来验证最终用户的身份。它还允许客户端请求和接收有关经过身份验证的会话和最终用户的信息。

## 创建安全架构

作为基线，建议使用基于令牌的安全架构。在基于令牌的系统中，您的应用程序(OAuth 术语中的“客户端”)与身份服务器集成，并通过反向代理安全地与 API 通信，该代理充当访问令牌的看门人。

建议依靠安全专家来实现您的系统，对于困难的安全工作，应该考虑两种类型的组件:

*   身份服务器提供 OAuth 标准的实现，处理包括身份验证和令牌发放在内的安全细节。
*   [认证安全库](https://openid.net/developers/certified)触发认证并验证收到的令牌。

你不必购买昂贵的产品。相反，你可以从免费或开源的实现开始，比如 Curity Identity Server 的[社区版](https://curity.io/product/community/)。

一个现代的、成熟的安全架构由几个不同的元素组成，它们共同为您的应用程序带来好处。让我们更深入地了解一下它们对身份和访问管理解决方案的贡献。

### 客户

应用程序使用安全库与身份服务器集成，以进行用户身份验证并获取访问令牌。这个过程以不同的方式发生，每个“流”都有自己的安全优势，这取决于用例。

用户成功通过身份验证后，身份服务器会颁发令牌。令牌定义了客户端可以访问的数据，以及客户端或下游 API 可以代表用户对这些数据执行哪些操作。根据要求，用户可能需要明确同意这种“委托”,作为身份验证过程的一部分。

### 访问令牌

可以把访问令牌看作 API 的入口票。访问令牌携带足够的数据，以便 API 可以执行足够的授权。访问令牌有两种类型:*轻量级不透明引用令牌*和*按值结构化令牌。*

在安全架构中，internet 客户端接收短期引用访问令牌。引用令牌指向存储在身份服务器中的安全状态。API 接收已经包含安全状态的数字签名 JSON Web 令牌(jwt)形式的按值令牌。反向代理介于两者之间。

### 反向代理

反向代理，如 NGINX 入口或云 API 网关，是防止身份服务器直接暴露给互联网的看门人。这是一个很好的实践，因为这些组件连接到敏感的数据源。反向代理隐藏了内部结构，还可以运行插件来执行安全任务，这有助于保持 API 代码以业务为中心。

一个这样的安全特征是授权。由于每个请求都要通过反向代理，因此它可以确保只有授权的请求才能通过。作为实施的一部分，它可以执行一些基本的令牌验证。此外，反向代理可以将传入的引用令牌交换为 JSON Web 令牌，并将其转发给 API。这种方法被称为[幻象令牌模式](https://curity.io/resources/learn/phantom-token-pattern/)。

在幻影令牌方法中，反向代理利用身份服务器的自省能力来检索访问令牌的按值表示。反向代理通常缓存具有相同访问令牌的未来请求的结果。

通常，反向代理已经存在于今天的 API 基础设施中。因此，上述架构不需要任何新的系统，而是重用现有的解决方案。

### API 令牌验证

自省之后，反向代理将传入的请求转发给带有 JWT 访问令牌的 API，该令牌由身份服务器进行了数字签名。API 必须在使用有效负载中的数据之前验证令牌。这应该根据 [JWT 最佳实践](https://curity.io/resources/learn/jwt-best-practices/)来完成。

如果按照上述建议和最佳实践，令牌被认为是有效的，那么 API 可以信任在 JWT 接收的数据。它可以将“作用域”和“声明”处理成内存中的主体对象，这是授权的核心。

### API 授权

访问令牌的内容是身份服务器和 API 之间的契约的结果。API 使用范围和声明进行授权，因此，身份服务器必须确保令牌包含 API 正确授权所需的所有数据。

范围是一种高级特权，声明提供了业务授权所需的更细粒度的数据。结合起来，它们帮助 API 确定是否允许客户端和用户执行请求。研究下面的例子:

`Scope: orders_read -> Claim: account-nr :`给出 API 指令来查找给定`account-nr`的订单。API 要求 account-nr 能够查找任何订单。身份服务器确保每当请求范围 orders_read 时，令牌都包含`account-nr`。

API 可以相信客户端有权请求令牌中的范围，因为来自身份服务器的 JWT 已经过加密验证。然后，API 可以简单地检查所需范围的存在。API 还可以确保声明属于令牌所代表的用户，并相应地处理请求。

一些行业要求 API 满足更复杂的规则。因此，确保身份服务器足够灵活，能够发布满足这些需求所需的范围和声明。

### 微服务授权

使用类似上面的设计模式只需要 API 中的简单代码，并且可以很好地扩展到微服务架构，其中每个 API 充当一个独立的服务。通过仔细设计访问令牌，可以实现服务的高级别包容。

API 可以将访问令牌转发给下游服务。有时，为下游服务生成一个具有更新或减少权限的新令牌会很有帮助。

### 身份服务器

身份服务器是安全架构的核心。它处理各种流的 OAuth 2.0 和 OpenID 连接消息。作为流程的一部分，身份服务器负责认证客户端和用户。因此，服务器存储密码和证书等机密，并与不同的数据源集成。数据源用于获取属性或存储令牌数据。毕竟，身份服务器是向客户端发布机密令牌并存储 API 的相关范围和声明的组件。

终端用户在身份验证期间与身份服务器进行交互，这可能会使用多种因素，并且还需要提供现代友好的用户体验。这种体验包括在适用的情况下获取用户的同意。可以依靠身份服务器来审计安全事件和授予权限。通过审核范围和声明，identity server 提供了一个安全的记录，记录了一段时间以来谁访问了哪些数据，符合法规遵从性要求。

在任何软件公司，都会开发多种 API 和客户端，通常具有不同的安全需求。因此，选择能够提供丰富的定制和集成选项的产品。这包括对各种数据源和身份验证方法的支持，还包括屏幕品牌和丰富的令牌发布行为。记住需求是可以改变的。因此，身份服务器必须灵活，能够支持未来的用例。

安全架构的成败取决于身份服务器。因此，它必须支持高可用性和零停机升级，以避免任何停机。

## 基于令牌的体系结构的关键组件

要开始使用安全的身份和访问管理体系结构，请实施基于令牌的体系结构，包括以下关键组件:

*   负责身份验证和令牌发放的身份服务器
*   保护 API 和身份服务器的反向代理
*   依赖可数字验证的授权声明的 API
*   为 API 和客户端实现低级安全性的认证库

使用像社区版 Curity Identity Server 这样的工具，您可以轻松地以零成本或低成本创建安全的端到端解决方案，使您的团队能够将更多时间花在核心业务功能上。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>