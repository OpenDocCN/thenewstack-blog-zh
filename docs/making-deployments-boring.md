# 让部署变得无聊

> 原文：<https://thenewstack.io/making-deployments-boring/>

时代变了。不久以前，大多数组织使用瀑布方法开发软件，并在固态介质上发布软件，如光盘。对于敏捷、快节奏的发布周期没有真正的业务需求，并且公司对变化的需求反应缓慢。

 [吉姆·道格拉斯

Jim 是 Armory，Inc .的首席执行官，他是一名转型 B2B 软件高管，拥有丰富的全球经验，从初创公司到中型公司。他之前是 CodeGear 和 ReShape Inc .的 Wind River 总裁兼首席执行官，并在 Cadence 担任过各种行政领导职务。](https://www.linkedin.com/in/jidouglas) 

对于许多软件公司来说，大发布仍然是常态。围绕主要版本发布的宣传仍然是重新推出或更新品牌的一个很好的营销工具。而且这些版本仍然包含用户必须忍受的错误，直到明年的主要新版本——如果他们不把他们的业务转移到别处的话。

然而，许多软件开发团队已经采用了连续交付(CD)或渐进交付(PD)方法，立即将他们的代码交付到产品中。新功能和修复会作为频繁的更新自动到达用户的设备。用户今天抱怨的 bug 甚至可能在下周被修复，不久之后就被遗忘。

采用 CD 和 PD 的公司的部署更加乏味。当这些软件制造商快速修复错误并频繁添加新功能时，客户会很高兴，发布的软件也不会有戏剧性。

## 自动化的重要性

保持你的软件在一个可发布的状态对 CD 来说是必要的。[自动化的 CD 管道](https://www.armory.io/blog/armorys-new-solution-for-kubernetes-deployments/)让您有信心增加您的功能交付节奏，并获得快速反馈循环和高代码质量的好处。问题往往很早就浮出水面，T2 的研究将 CD 与提高生产率联系起来。

如果没有自动化 CD，部署会有风险。不一致的流程和手动步骤成为痛苦之源。通常，同一个团队的两个开发人员有不同的方法来部署相同的软件。开发人员根据个人编写的脚本执行许多手动部署。当他们转到其他工作时，脚本知识和维护脚本的能力也随之消失。剩下的开发人员继续部署这些脚本，对它们知之甚少或一无所知——这是灾难的一个原因。

相比之下，标准化和自动化生产可确保您最大限度地提高产品的正常运行时间，并运送您想要的产品。回滚也最好是自动化的，因此，您的部署团队只需按一下按钮，就可以返回到稳定版本，而不是在出现问题后的凌晨打补丁。此选项让您的团队有信心以更高的频率进行部署。

毕竟，这里的整体思想是自动化是可靠性的同义词。因此，我们的目标是实现更多的自动化，并最大限度地减少部署中具有挑战性的手动方面。

让我们来看看如何打破你的铁板一块，实现一些 CD 的最佳实践。把你的软件交付从一个有风险、有压力的事件变成一个无聊的日常事件。

## 打破巨石

让部署变得乏味的一个方法是避免将单一的应用程序迁移到云中。相反，计划将其拆分为微服务。这项任务值得投入时间，而且非常简单，尤其是因为您不需要一次完成它。

首先通过将整个应用程序放入 Docker 容器来完成任务。然后，逐渐将碎片分割成独立的微服务，每个服务在自己的容器中运行。这种碎片化本身不会使部署更好，但它有助于确保应用程序由易于开发、测试、控制和部署的较小部分组成。

你的软件工程师会感谢你，因为他们不太担心对代码库进行修改，以免破坏其他地方的东西。独立的微服务是一种乐趣。

微服务还有许多其他好处。您的部署规模更小，更易于管理。征服这个庞然大物也使团队能够在适合他们的时间部署。没有更多的等待整个独石是生产就绪。甚至这种成就感也会产生鼓舞人心的效果。

除了整体架构之外，一些公司还开发整体部署脚本。在选择部署工具时，确保它具有有助于避免这个问题的特性是很重要的。一些部署工具，比如 [Spinnaker](https://www.armory.io/what-is-spinnaker/) ，允许由其他命令性管道组成命令性管道。这鼓励了重用和模块化，有助于避免单一流程的开发。

另一个新兴的模式是[声明性部署定义](https://www.youtube.com/watch?v=uowJIYDyUQY)，其中您声明了一组您的代码必须遵循的需求，但是没有提供一个逐步的过程。这些需求列表往往更简单，能够随着时间的推移而发展，同时避免脆弱的整体。

## 使用 Kubernetes 部署微服务

一旦你把你的应用放到 Docker 容器中的微服务中，你就需要一种方法来管理它们。Kubernetes 是编排、扩展和管理此类流程的首选工具之一。它监控容器的健康状况，并对节点故障和其他事件做出反应。

帮助部署顺利进行的一个技巧是用 YAML 或 JSON 文件配置 Kubernetes。不要忘记将这些配置文件保存在源代码控制中，以便在需要时进行恢复。配置文件也有助于检测配置漂移，其中一个团队出于可能只有他们自己知道的原因进行调整，并将它们存储在一张纸上。

最大限度地利用现有技术来制定标准，可以使这一过程顺利进行。使用许多技术可能会令人望而生畏，但是通过将它们与第三方服务结合在一起，您可以利用各种包的能力无缝地构建 CD 管道。您可以构建防护栏来确保您的团队实施最佳实践、弹性、安全性和合规性。

对部署进行检查也是保持消费者信心的关键。没有人想损害品牌声誉，但任何部署都有可能推出不合格的产品。因此，在投入生产之前，组织有任务清单和最终安全措施。在生产部署中，您应该考虑使产品自动遵守公司政策和法规。

例如，一些公司可能有“责任划分”政策:编写代码的人不能是部署代码的人。您可以依靠监控、审计跟踪和警报来捕捉违反策略的情况，但是这些手动步骤容易出现问题。自动化系统可以实现这些检查，并在出现问题时暂停部署，您可以轻松地将这种策略实施添加到您的管道中。

当自动化 CD 时，您不再需要等待高级开发人员度假回来进行部署。公司文化从孤立工作的不同团队转变为跨团队授权，使每个人——从开发人员到运营人员等——都感觉自己是流程的重要组成部分。此外，您的工程师不必担心在下班后被传呼，因为有人在部署前发现了错误。

## 如果出了问题怎么办？

当您准备好部署时，如果您推出的代码出现问题，高级部署策略可以帮助您限制暴露风险(通常称为限制爆炸半径)。

canary 等技术将部署限制在特定的目标用户数量，分析结果，然后在更大的范围内进行，这样可以避免灾难性的失败。

另一种策略是蓝绿色(网飞称之为红黑色)。使用这种方法，您可以维护两个尽可能相似的生产环境。您在其中一台服务器上对一个新版本进行最后阶段的测试，一旦它稳定下来，您就切断所有的流量。如果您注意到任何问题，您可以自动将流量推回到其他服务器(立即回滚)。使用这种方法，您可以避免代价高昂的停机。

随着部署时间的延长，不再有固定的发布日期会带来压力，也不再有频繁变更的交付内容。作为一名开发人员，知道自己已经修复了一个 bug 是令人沮丧的，但是要花两个星期才能把它弄出来。虽然 bug 和边缘情况仍然会在持续的部署中出现，但是您的团队可以快速地对它们做出响应。

## 后续步骤

持续部署提供了许多好处，包括对您的底线。据[麦肯锡&公司称，](https://www.mckinsey.com/industries/technology-media-and-telecommunications/our-insights/developer-velocity-how-software-excellence-fuels-business-performance)创造了高开发速度的公司大大超过了那些没有创造高开发速度的公司，包括:

*   收入增长快 4 到 5 倍
*   股东总回报增加 60%
*   运营利润提高 20%
*   创新得分高出 55%
*   更高的客户满意度、品牌认知和人才管理

自信、快速、稳定、跨越目标地向用户交付您的产品。当你这样做时，你就获得了[企业级部署](https://www.armory.io/what-are-enterprise-scale-deployments/)的竞争优势。最终，这会让您的部署平淡无奇，甚至令人厌烦，这是理所应当的。创新的速度是我们都需要的。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>