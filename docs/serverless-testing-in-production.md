# 生产中的无服务器测试

> 原文：<https://thenewstack.io/serverless-testing-in-production/>

无服务器生态系统仍处于成熟阶段，这意味着在这种基础架构风格中，没有一系列工具可用于应用程序部署的特定方面。此外，无服务器作为一种事件驱动的架构的性质(云提供商或其他人负责自动扩展和管理计算所需的资源)意味着，在许多情况下，很难有效地测试生产环境中会发生什么。

与平台无关的 DevOps 监控工具 [Honeycomb.io](https://honeycomb.io) 的联合创始人兼首席执行官 Charity Majors 表示，这种无法在开发中进行测试的情况并不是无服务器独有的。考虑到大规模构建和部署分布式应用程序的本质，不可能对每一种可能性都进行测试。虽然她同意“我不测试，但当我测试时，我在生产中测试”可能值得一看，但她确实相信“在生产中测试”的概念。

“当我说‘生产中的测试’时，我并不是说不先做最佳实践，”Majors 解释道。“我的意思是，有一些未知的未知，应该通过构建具有弹性的系统来进行测试。某些种类的错误只有在大规模应用时才能被注意到。也许我们需要更少的暂存环境和更多的防护栏。这不是一个‘如果’我们推出 bug 的问题，而是何时、能够检查它们，以及建造机器人来检查它们需要成为稳定系统的一部分。”

虽然这适用于所有大规模的应用程序，但无服务器也带来了其特定的环境。无服务器是建立在不可变的基础设施上的，该基础设施在一个事件期间旋转，因此通常甚至不可能两次创建相同的工作流，使得在生产之前的试运行和测试变得不可能。

梅杰斯指出了五种新兴技术，可以用来管理生产中的无服务器测试。

**功能标志:**“功能标志可以让你确定发布日期，这样你就可以把你的代码发布到产品中去，”梅杰斯说。这个想法是，对于新功能或升级，通过使用功能标志，开发人员可以规定谁应该使用新功能，而它对其余大部分客户群是不可见的。梅杰斯说:“功能标志上写着‘在我同意之前，不要派任何人去读这段代码’。这允许开发人员在更广泛的推广之前，先在自己身上测试一切。像[launch darky](https://launchdarkly.com/)这样的新创公司现在出现了，它们将功能标志作为一项服务提供。“我们在蜂巢使用它们，它们很棒，”梅杰斯说。关于 Launch Darkly 的真正酷的事情是它的界面非常有用，并且易于使用，你可以让非技术人员如营销人员使用它。"

这使得企业中的任何人都有可能测试他们自己的更改:例如，更新企业网站的 CEO 或向开发人员门户添加 API 产品登录页面的营销团队成员可以使用功能标志和类似 LaunchDarkly 这样的工具来测试他们所做的更改，然后将它们应用于大多数客户群。

梅杰斯说，通常情况下，功能标志是一个内部团队在进行中可能会破解的东西，但这限制了它们在内部的可用性，因为它通常是在没有用户界面的情况下构建的，使得它可以在构建它们的工程团队之外访问。

金丝雀:金丝雀经常和特色旗一起使用。当 Majors 在脸书时，工程团队通常首先在巴西部署新功能和更新，然后手动检查控制基地和巴西部署组之间的错误率。“这些都是分阶段推出的，”梅杰斯说。金丝雀允许在大范围推广之前测试生产中是否有任何问题。梅杰斯希望会有一家像 LaunchDarkly 这样的初创公司，决定专注于管理金丝雀阶段的推出。梅杰斯说:“有些公司正在把它作为他们服务网络的一部分，像 bubbly 和 Turbine，甚至 Nginx，都在做一些这样的事情。”“这是关于强化您的部署，毕竟，您不知道它最终会如何运行。”

**分阶段推出，自动推广到更大的群体:**这是一种带有分阶段组件的鸭式布局，而不是部署到特定的地理区域。“你把金丝雀的产量定在总产量的 10%。然后你进行自动化，这样你的系统就可以将这 10%与系统的其他部分进行比较。当没有错误或问题时，它会将部署提升到 25%。如果在任何一点上出现问题，该系统将要么恢复到部署前状态，要么像分阶段部署一样，进行滚动恢复，”梅杰斯说。Majors 表示，这对于大规模应用程序尤其有用，因为通常会出现一些问题，而这些问题在生产中的较低部署级别可能并不存在。“可能只有在达到 80%时才会出现问题，例如，因为这需要打开更多的连接，或者使用更多的 RAM。梅杰斯说:“总的来说，这是一个让服务器崩溃的转折点。

丰富的仪器:“我强烈希望我们将今天视为我们发布代码的糟糕的旧日时光，如果我们没有收到分页，那么一切都很好，”梅杰斯警告说。在 Honeycomb，她致力于构建丰富的工具，以便开发人员可以询问发布的代码是否如预期的那样运行。“我们应该捕捉足够的细节，这样我们就能看到。作为一个行业，我们仍在提出仪器仪表的通用原则。这是一门艺术，也是一门科学。”由于全球应用程序的性质、无服务器的规模及其通常庞大的多功能工作流，整个体系结构系统不再适合一个监督系统的架构师，需要一套更丰富的工具来帮助管理生产。

**可观察性优先开发:**所有这些都形成了一个新的范例，专业人士希望将应用程序开发行业带离当前的测试驱动开发原则。有了丰富的仪器，就有可能实时监控系统并了解它们在执行什么操作。在可观察性优先的开发范例中，工程团队可能会从工作流、应用程序或功能展示中映射出期望的结果。但是，在为该特性或工作流编码之前，团队将创建他们的工具套件，首先，可能会询问解决方案是否值得构建，然后将能够监控开发和部署，以确保与初始目标保持一致。“这就像戴了一个头灯。与构建一个特性并监控它(这是一种非常盲目的方法)不同，在可观察性优先的开发中，您首先构建工具。这让开发者更有信心，”梅杰斯说。

人物形象:[一个不简单的模因生成器](https://imgflip.com/memegenerator/One-Does-Not-Simply)。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>