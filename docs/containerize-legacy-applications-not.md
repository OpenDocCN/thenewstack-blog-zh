# 何时将遗留应用程序容器化，何时不容器化

> 原文：<https://thenewstack.io/containerize-legacy-applications-not/>

[](http://www.boxboat.com)

[Will Kinard](http://www.boxboat.com)

[Will 在 BoxBoat Technologies 领导技术战略和项目，担任工程团队领导和集装箱化宣传员。他热衷于创建工具和工作流来帮助开发人员更高效地工作。](http://www.boxboat.com)

[](http://www.boxboat.com)[](http://www.boxboat.com)

在与新客户的早期会谈中，我经常坐在桌子对面，想起大约 10 年前开始的 Blendtec 营销活动，Blendtec 搅拌机的创造者通过他的 YouTube 频道[发现他的搅拌机系列](https://www.youtube.com/watch?v=lBUJcD6Ws6s)中会混合哪些物品。开场白总是“它会融合吗？”然后，他继续表明，今天的选择对象，事实上，将融入 Blendtec。结果通常是烟雾弥漫，糊里糊涂，但它确实，事实上，融合！

在 boxsboat 的许多新项目中，我们会看到遗留应用程序，并被问及一个类似的简单问题，“它能被容器化吗？”除了少数例外，我的回答总是“是的”然后，我们的目标是展示一条可行的路径来迁移这些应用程序，并提供容器化带来的不可思议的好处，而不会出现热乎乎的混乱局面。

为什么“所有的”应用程序最终会变成“遗留的”并且难以维护？大多数开发人员都知道，在平衡业务需求和必要的上市速度的同时，很难保持进度、范围扩展和代码组织。

微服务架构有助于解决这些问题，但是您当前的开发工作(包括长期以来代码完整的开发工作)如何呢？“遗留”应用程序，或者那些发现自己在技术上已经过时并需要替换的应用程序，或者那些根本不符合分布式体系结构最新潮流的应用程序，可以在这个“新堆栈”环境中找到一席之地。一个战略性的前进道路和理解容器化遗留应用程序的含义对推动您的组织前进有很大的帮助。

## 关于 Docker 和微服务的一句话

误解出现在所有的新兴技术中，尤其是那些处于不断改进状态的技术。市场随着炒作的基调而起伏，Docker 的承诺也不例外。所以，不，Docker 没有让你的应用程序自动伸缩(你需要为此编码)，它不能“在任何地方”运行(二进制文件仍然需要在它们编译的架构上运行)，端到端的开发工作流仍然在不断成熟。对于世界上其他了解 Docker 不仅仅是一个轻量级虚拟机的人来说，许多人仍然在努力理解他们的遗留应用程序被容器化是什么样子，或者这样做是否有益。

微服务是一种架构模式，其中复杂的应用程序由小型、独立的进程组成，这些进程使用与语言无关的 API 相互通信。换句话说，不是您刚刚完成的历时 3 周的整体式应用程序，它跨越了从 UI 到多个服务层的范围，并且数据库模式发生了变化，所有的都融合在一起！微服务架构正处于炒作周期上升的趋势，但原因显而易见(看看亚马逊的做法就知道了)；在规模上，他们只是有意义。与部署、团队代码所有权、可维护性和可伸缩性相关的好处超过了管理多项到多项单独服务的缺点。事实上，Docker/containing 保持这种体系结构正常的能力是它的主要优点之一。

不幸的是，我们都没有重新开始新应用的奢侈。没关系，因为采用容器化和/或最终采用微服务模型来支持我们的传统应用程序可以带来巨大的好处。

## 每个人都拥有一个遗留应用程序

任何东西都可以用集装箱装运。然而，仅仅因为它可以是，并不意味着它应该是。

在一天结束时，在容器中运行的应用程序仍然是由主机管理的 Linux 进程。现在有相当健壮的机制来处理容器化应用程序的有状态应用程序的联网、监控和持久存储。以下是容器技术处理得相当好的一些领域:

### 建立工作关系网

随着 Docker 中覆盖网络的引入，私有的多主机网络由守护进程自己创建，允许容器和/或服务之间的轻松通信，同时提供安全粒度。流行的编排框架，如 [Kubernetes](/category/kubernetes/) 和 Mesos/Marathon，表现了一种成熟的容器网络形式。传统应用程序可以利用这一点，而无需改变其当前的网络堆栈。对于应用程序来说，网络是一个网络，而管理工具提供了其运行时范围之外的细节。

### 监视

对于任何经验丰富的运营商来说，应用健康和性能监控都非常重要，有助于延长正常运行时间，并为性能调整的发展提供反馈。作为一等公民，监控代理知道哪些容器是重要的，因为它们可以在物理(和虚拟)主机之间移动。几个主流的解决方案都主张容器监控，Sysdig 被认为是提供了一个健壮的监控解决方案，关注于容器及其服务。再一次，从遗留应用程序的角度来看，监控与以往没有什么不同。

### 持久存储

这一条似乎最容易让人犯错。可以在物理主机之间移动的容器化应用程序如何维护任何类型的状态/存储？Docker 和附带的编排解决方案提供了强大的第三方插件支持，以处理和消除此类任务的复杂性。举几个例子来说， [GlusterFS](https://www.gluster.org/) 、 [Flocker](https://github.com/ClusterHQ/flocker) 或 [AWS S3](https://aws.amazon.com/s3/) 支持分布式卷需求，每种都有其实施的好处。容器化数据库？没错。保留 web 会话状态？那也可以处理。

## 增值

如上所述，容器化的应用程序本身不需要知道外部是如何处理事情的；但这才是重点，不是吗？容器化本质上将应用程序文件系统和运行时从其宿主中分离出来，带来了我们所熟知和喜爱的好处。使用正确的方法，遗留应用程序，或者几乎任何应用程序都可以被容器化，并带来以下直接好处:

1.**平台支持**:您的应用程序现在可以在任何运行 Docker 的 Linux 平台和流行的云平台(AWS、Azure、GCE)上得到支持
2。**安装、升级和回滚过程都是内置的**:容易出错的定制升级例程不再是必需的，因为 Docker 可以无缝地为您处理这些。
3。**“提升和转移”**:重新设计应用程序可能既费钱又费时，但是将一个遗留应用程序迁移到云中，再加上容器化的可移植性，对于那些根本不值得再接触的应用程序来说，可能是一个主要的成本优势。
4。**用于开发和测试的即时环境复制**:为集成开发或测试场景快速重新创建遗留应用副本的能力正在改变游戏规则。

## (今天)底部掉出来的地方

在很大程度上，我让这个话题听起来像是前方只有蓝天。当使用正确的方法处理许多到大多数遗留应用程序时，可能会出现这种情况。但是，需要注意的是，在有些环境中，集装箱化不是一条可行的发展道路，或者结果根本不值得努力:

1.**微软视窗应用和服务**。容器化是从添加到 Linux 内核的原语中诞生的一项技术。微软一直在快速追赶，但 Windows 原生容器化目前仅在 Windows Server 2016 的预览版中可用。期待这一领域的快速变化。
2。**客户端 GUI 应用**。
3。对特殊硬件架构有强烈依赖性的应用:想想大型机。

## 我的观点是什么

在 OSCON 2016 大会上，戴尔高级 Linux 软件工程师 [Jose De La Rosa](https://www.linkedin.com/in/josedelarosa) 展示了传统应用程序容器化。他解释说，虽然没有明确遵循最佳实践，但是如果能够解决现有的问题，将遗留应用程序容器化是非常值得的。在他的例子中，安装、升级和回滚现在很容易，他的应用程序现在可以在任何支持 Docker 的 Linux 平台上运行。它不是最小的映像，以内核模块的形式拥有主机依赖性，还需要特权访问，但关键是它有好处。对于一般的业务用例，这是一个胜利。也许在未来的发展中，将会采取措施来创建一个更加容器友好的解决方案。

微服务是花里胡哨的，但有时候我们只是需要解决眼前的问题，继续前进。大多数遗留应用程序可以以其当前的形式快速地容器化，与以前的实现相比，创建了几个优点而没有缺点。在 BoxBoat 的许多项目中，我们经常发现这种情况。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>