# 新的开源安全堆栈

> 原文：<https://thenewstack.io/the-new-open-source-security-stack/>

[](https://www.linkedin.com/in/degio/)

 [洛里斯·德吉奥安尼

洛里斯·德吉奥安尼是云原生可见性和安全公司 Sysdig 的首席技术官和创始人。他还是流行的开源故障排除工具 Sysdig 和开源容器安全工具 Falco 的创造者。在创立 Sysdig 之前，洛里斯参与创建了 Wireshark，这是一款开源网络分析器，目前拥有 2000 多万用户。洛里斯拥有都灵理工大学的计算机工程博士学位，现居加州戴维斯。](https://www.linkedin.com/in/degio/) [](https://www.linkedin.com/in/degio/)

认识到没有完美的安全这种东西，从业者喜欢分层来增加阻止坏人的机会，即所谓的深度防御策略。

容器环境带来了一些新的挑战，因此需要一些额外的安全层。

幸运的是，在开源世界中有许多创新可以利用，包括 Linux 内核中的许多进步，这些进步使我们能够更紧密地控制在这个核心级别上允许的活动。这是一件好事，因为容器以一些独特的方式改变了安全游戏。

首先，开发人员在决定将什么打包到容器中时有很大的自由——语言选择、运行时间、他们将使用什么数据存储等等。这可能会让运营人员有些不知所措，因为他们不一定知道他们刚刚投入生产的容器中有什么。

此外，还有容器的短暂特性。随着环境规模的扩大和缩小，它们来来去去。但是如果其中一个受到威胁呢？即使容器在使用后不久就被销毁了，但是如果这种危害使得攻击者能够在容器被销毁之前扩展到环境的其他部分呢？

这里回顾了一些可用的开源工具——用于容器安全堆栈的基础设施、构建和运行时层——以帮助您保护您的环境免受此类威胁。

显然，这只是一个示例，意在吊起你的胃口，因为还有很多开源容器安全选项。同样显而易见的是，我希望这些工具不能替代基本的防火墙和其他传统的安全工具。它们是您可以添加到纵深防御策略中的附加层。

## 基础设施

在基础设施方面，可以从策略和网络过滤入手。

*** Pod 安全策略:**为了方便起见，许多开发人员简单地跳过了 Kubernetes 中许多基本的基于策略的安全控制，这是一个遗憾，因为即使打开一些最基本的检查也会极大地改善您的容器安全状况。有开源项目，如 [K](https://sysdig.com/blog/enable-kubernetes-pod-security-policy/) [ubernetes Pod 安全策略顾问](https://sysdig.com/blog/enable-kubernetes-pod-security-policy/)，它将从 Kubernetes 资源中扫描现有的安全上下文，如部署、daemonsets 和副本集，然后自动为整个集群生成推荐的 Pod 安全策略。

正如我们可以限制容器可以消耗的主机资源，比如内存和 CPU，我们可以使用 Pod 安全策略来非常精确地了解容器可以访问哪些 Linux 内核资源。这通常是通过 Kubernetes 使用一个叫做 pod 安全策略的对象来完成的。您定义策略，然后当您定义 pod 时，您指示 pod 订阅这些策略。

政策可能非常复杂(这可能是它们经常被忽略的原因？)，使您能够指定诸如容器是否可以提升特权、它可以访问内核的哪些部分以及文件的所有权是否可以更改之类的事情。

您还可以限制容器可以挂载的卷(因此它们只能使用这些特定的对象)，限制它可以使用的组，指定文件系统是否是只读的，以及规定容器是以 root 用户还是非 root 用户身份运行。如果不做其他事情，限制 root 访问将极大地提高容器环境的安全性。

但是，请记住，即使您花时间详细说明了安全策略，pod 仍然必须订阅策略才能使控件生效。但是工具箱中还有其他选项来帮助确保您想要的控件实际上已经启用，我们将在后面讨论。

***纤毛进行网络过滤。**你可能要考虑的第二个基础设施开源安全工具是 [Cilium](https://cilium.io/) ，它具有网络过滤功能。Cilium 被描述为“为 Docker 和 Kubernetes 等 Linux 容器框架带来了 API 感知的网络安全过滤。”

基本上，Cilium 是一个内核插件(通过 BPF)，允许您在第 3 层、第 4 层甚至第 7 层过滤网络流量。您可以创建过滤器规则，并使用端点选择器指定规则的应用位置。

规则可以指定什么可以进出容器。例如，该规则可能允许来自任何组织“帝国”的入站流量，但仅限于端口 80。因此，帝国可以访问端口 80，但没有帝国作为定义组织属性的星球大战叛军将被阻止。

你可以得到更多的颗粒。假设 Empire 被允许访问端口 80，但是你只允许 Empire 向一个特定的 URL 发送数据。如果他们试图在任何其他网址上做 Git，他们将被拒绝。

如果您有一个处理敏感数据的服务，并且您只希望某些 URL 端点能够访问某些主机或容器，那么这很有用。你可以使用 Cilium 说，“我只想接受来自我的银行前端的请求，而这个前端应该只对这 10 个 URL 发出这 10 个请求。”这有效地建立了一个门，防止任何人访问任何其他东西。

## 建设

在构建容器时，我们要考虑许多安全选项，包括图像扫描、准入控制器和另一层策略。

***图像扫描锚点。**扫描集装箱图像是一个关键步骤，因为受损的图像可能会在短时间内导致一船受损的集装箱。

你会想知道你的容器图像的出处，并且需要考虑诸如签名、可信注册和准入控制之类的事情。但是当涉及到映像本身时，您需要能够将完全构建的映像作为不可变的工件进行扫描，确保它符合安全最佳实践，并检查所有的合规性框。

[Anchore](https://anchore.com/) 被描述为“一个开放的容器合规性平台，用于发现、分析和认证内部或云中的容器映像。”

Anchore 作为一个带有 API 的服务运行，并且有一个广泛的、可定制的、基于策略的扫描方法。您将 Anchore 作为构建引擎的一部分。例如，如果您使用 Jenkins，您将使用 Jenkins 构建您的应用程序，然后构建容器映像并通过 Anchore analyzer 运行它。

好的一面是，您可以使用 Anchore 策略来定义如果发现了什么应该发生什么。例如，如果发现低安全漏洞，您可以让 Anchore 发出警告，要求具有中等漏洞的图像进行另一次审查，并彻底拒绝任何具有严重漏洞的图像。

***Kubernetes 录取控制员。**准入控制器也可以支持所谓的变异网络钩子。因此，如果您正在进行本机部署，并向 Anchore 或公证人抛出一个 webhook，询问该映像是否可以安全使用，控制器可以将该映像标记为有问题，而是推荐一个安全可靠的更新版本。

*** Kubesec.io 进行部署检查。**图像扫描只是一个时间点的合规性检查。您还需要担心您运送到 Kubernetes 的部署。而且，如前所述，您还需要确保容器 pods 实际上符合您所要求的安全策略。

这就是像 [Kubesec.io](https://kubesec.io/) 这样的工具派上用场的地方。Kubesec.io 允许您检查您的 Kubernetes 部署，以查看您是否正在运行不可取的东西(测试，然后向您返回可能出错的信息)，并检查以确保您有适当的安全策略(或者您是否正在定义糟糕的策略)。

可以将 Kubesec.io 看作是一种强制机制，您可以在构建阶段将其指定为测试。您让 Kubernetes 部署 YAML 定义如何部署您的容器——包括所有的配置要求，如应用程序的名称、应用程序的标签、要使用的图像、实例的数量等。—但在它全部上线之前，会向 Kubesec.io 发出一个调用，看看是否一切都符合标准。

## 运行时间

容器映像是不可变的，但是一旦你启动了容器，如果你不是在一个只读文件系统上运行，人们可以进入并进行修改。这就是为什么有一个运行时工具来检测异常行为也很重要。

*** Falco 进行异常行为检测。**考虑一下 [Falco](https://sysdig.com/opensource/falco/) ，这是一个基于规则的检测引擎，用于云原生架构内的运行时安全性(以及一个 CNCF 沙盒项目)。据说 Falco 提供了“容器和应用程序行为的可见性”

容器倾向于运行独立的进程，所以你对容器应该做什么有预期。您不希望进程产生、随机打开端口或创建随机出站 internet 连接。Falco 会观察这些行为，并在出现可疑情况时发出警报。

虽然有一些工具可以让您进行主机入侵检测，但是它们不能从诸如 Kubernetes 之类的 orchestrators 或 Docker 运行时引擎中获取数据，所以当涉及到容器时，它们基本上是无知的。

有了 Falco，您可以创建安全行动手册，这样，当 Falco 检测到可疑行为时，您就有一个针对警报采取行动的计划，无论是涉及杀死 pod、污染 Kubernetes 节点以便无法安排新的工作负载，还是简单地通过您选择的渠道(Slack 等)通知某人。).

*** Sysdig Inspect for Forensics:**Sysdig Inspect 是一个基于电子的 GUI，用于系统调用分析。开源项目使用捕获规则来提供系统级的可观察性。

取证归结为一个数据挑战。对于企业来说，能够访问所有容器上的数据(包括那些已经被杀死的容器)以及上下文以便他们能够快速确定问题并进行补救是非常重要的。Sysdig Inspect 提供了简化的取证功能，允许轻松深入查看进程活动、文件系统活动、网络活动以及更多详细的事后分析。

Inspect 的用户界面旨在直观地导航包含 Linux 系统的粒度系统、网络和应用活动的数据密集型 sysdig 捕获。它附带了旨在支持性能和安全性调查的特性，并具有深度容器自省功能。

## 做点什么！

这里重要的一点是，容器改变了安全计算，您需要重新审视您的深度防御策略，并确定可以用来保护这些快速变化的环境的新工具。

好消息是:有许多开源工具可以用来保护这个环境。

坏消息是:容器世界中的资源隔离没有虚拟机世界中的那么强。如果一个容器受损，攻击者可能会发现将权限提升到主机操作系统并从那里进入任何和所有其他本地容器相对容易。

您需要一种多层次的方法来实现容器安全性，并且您需要强制使用您使用这些或其他开源工具构建的策略。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>