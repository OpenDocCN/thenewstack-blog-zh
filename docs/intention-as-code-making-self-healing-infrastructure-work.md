# 意图-代码:让自我修复基础设施发挥作用

> 原文：<https://thenewstack.io/intention-as-code-making-self-healing-infrastructure-work/>

[](https://www.linkedin.com/in/deepakgiridharagopal/)

 [迪帕克

迪帕克是木偶公司的 CTO。](https://www.linkedin.com/in/deepakgiridharagopal/) [](https://www.linkedin.com/in/deepakgiridharagopal/)

随着我们的建造方式越来越复杂，我们建造的速度也越来越快。基础设施是可编程的、动态的，可以快速调整以满足我们的需求。在此基础上，我们构建了精细的应用程序，这些应用程序是分布式的、容器化的，并被分解为微服务。我们的应用程序和基础架构的变化率大幅增加。

基本的自动化让我们在不崩溃的情况下维持这种复杂程度。我们现在处于一个管道如此先进的时代，以至于我们的应用程序的状态和规模可以在眨眼之间改变，比 Git 提交的速度还快。如果我们希望事情处于控制之下，我们的工具必须适应并变得更加面向事件和响应性，这就是自我修复基础设施不可避免的原因。这是跟上步伐的唯一方法，当然也是我们这样做的最大希望。

## **可靠性不容置疑**

每家公司，包括那些因其运营能力而自吹自擂的大公司，都会遇到可靠性问题。停机伤害:他们伤害收入，他们伤害用户体验，他们伤害你的声誉，他们可以伤害你的团队。不可靠的系统往好了说是竞争劣势，往坏了说是灾难性的。公司越来越多地期待自动化来帮助他们更好地管理未来的停机。

自我修复系统就像它们听起来的那样:自动系统可以检测和修复错误，而不需要太多的人工干预。自我修复基础设施是这一理念在运营团队管理的所有事物中的应用。它包含多种方法，包括底层基础设施代码工具、策略执行引擎、容器编排器等等。

> 我们需要从基础设施即代码提升一个抽象层次，并开始考虑捕获意图即代码。

就像运营领域的大多数事情一样，一些公司比其他公司走得更远。随着我们的应用程序和基础设施变得越来越复杂，现在比以往任何时候都更难自动化所有的移动部分。

分解这个问题的一个方法是考虑您的自动化外围应用。

每个应用程序、每个团队的基础架构、每个产业都有一个自动化外围应用，其中包括所有开发、运营和安全工作流中涉及的一组组件。这个表面积代表了将所有事物联系在一起并保持事物运行的所有过程。理论上，它代表了所有你可以自动化的东西。

对于许多团队来说，操作系统(OS)是他们自动化外围应用的重要部分。运营团队自动化工作流，这些工作流涉及跨整个基础架构的直接操作系统级交互:操作文件内容、安装软件包、配置用户帐户、设置防火墙规则等。在这个世界里，配置管理工具很棒；他们可以轻松应对操作系统的复杂性，并安全可靠地进行大规模部署。

但是，众所周知，技术在不断变化。基础设施不断发展。应用程序架构不断发展。平台不断发展。随着微服务、基础设施即服务和云原生工具越来越受欢迎，相对于团队通过 API 进行交互的组件和服务，操作系统在整个自动化表面区域中所占的比例越来越小。

这些 API 在比操作系统更高的层次上运行，这意味着它们为我们提供了一些真正伟大的抽象，用于控制我们的基础设施和运行在其上的应用程序的各个方面。这使得解决自我修复基础设施成为可能，而这种解决方式在我们大多数人看来是不可行的。然而，很少有人这么做。坦率地问自己，您的所有生产应用程序、基础架构和服务的自我修复能力到底有多强。

我们有能力进行自我修复；我们必须这么做。

## **数字胶带**

我们一遍又一遍地从我们的用户那里听说，即使是他们最简单明了的操作任务看起来也很棘手，并且涉及到跨各种不同服务的大量操作的排序。手动执行这些任务会带来出错的空间，即使程序被正确地记录下来。在响应服务中断事件、回滚失败的部署和保护云资源之间，斗争是真实的。

对许多人来说，解决这些问题需要将现有的脚本、定制的内部工具和第三方服务拼凑在一起。我称之为“数字管道胶带”这不好看，不可持续，也不是永久的解决办法，但这是许多人能做的最好的事情。

我想到了持续集成/持续交付(CI/CD)之前的时代，在那个时代，大量定制的脚本以一种脆弱且不可持续的方式将随机的东西捆绑在一起。我们已经通过持续交付改进了很多，但是持续可操作性对我们大多数人来说仍然是难以捉摸的。

那么，如何才能让大众更容易实现自我修复基础设施呢？

## **意向代号**

我认为，我们需要从基础设施即代码的抽象层次上升，并开始考虑捕获意图即代码:“当事情发生时，这里是必须发生的响应。”

这是自我修复系统的“核心循环”,也是现场操作的基本部分。我们捕获一组指示需要注意的问题、错误或情况的触发因素，并捕获我们需要采取哪些措施来补救问题。哪些操作可以并行运行？它必须等到前面的步骤完成。什么时候，如果有的话，我们需要人在回路中的批准？行动不一定仅限于基础设施；它们可能涉及归档票据、ping Slack 上的同事、点击 API 来操纵云资源等等。如果这有助于解决问题，那么为什么不将这部分过程自动化呢？

[以运营为中心的工作流引擎](https://relay.sh/)让用户以代码的形式表达这些触发器和动作，以一种简化的符号表示，广大运营受众可以理解并定制以满足他们的需求。将触发器和操作结合到可重复的工作流中，可以实现真正的响应自动化，以他们需要的速度覆盖运营人员经常面临的所有场景。

大多数公司都了解完全自动化 CI/CD 渠道的价值。手动步骤会阻碍装配线，并带来不必要的风险。然而软件在交付时并没有“完成”;部署的时刻仅仅是应用程序剩余生命周期的开始，这个生命周期是运营团队必须不断监督和管理的。

在管理应用程序的整个生命周期时，CD 涵盖了开始，自我修复基础架构涵盖了结束。我们两个都需要。不管你用什么工具来做这件事，重要的是我们一起努力，让我们的系统变得更可靠，我们可以花更少的时间在半夜被呼叫去修理东西，花更多的时间放松。我想我们都应该放松一下。

*9 月 29 日至 30 日，与我一起参加 [Puppetize Digital 2021](https://events.puppet.com/event/puppetize-digital-21/) 在线活动，安顿下来，放松身心，了解更多。*

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>