# PostgreSQL 9.5 旨在将企业从数据仓库中解放出来

> 原文：<https://thenewstack.io/postgresql-9-5-geared-liberate-enterprises-data-warehouse/>

IT 系统架构师长期以来已经习惯了这样一种观念，即数据分析不应该直接在事务数据库上进行，以免使系统过载并降低性能。正是这种思想催生了数据仓库，历史数据可以被传送到数据仓库并进行深入分析。

现在，PostgreSQL 开源数据库管理系统在即将推出的大型核心计数服务器的帮助下，希望收回分析工作量，为用户节省资金和设置辅助数据仓库系统的管理麻烦，并让他们能够查询实时数据。

新版本使系统更接近于“使用 PostgreSQL 作为一个纯粹的分析平台”。PostgreSQL 核心团队的主要维护者之一、提供 PostgreSQL 商业发行版的 EnterpriseDB 的高级数据库架构师 Bruce Momjian 说，从历史上看，PostgreSQL 是一个 OLTP 或在线事务处理数据库。

“人们厌倦了将他们所有的 OLTP 都转储到分析数据库中。这些数据是旧的、陈旧的，并且有很多开销。Momjian 说:“有一大堆事情是你在数据副本上做不到的，而在实时数据上却可以做到。“我们已经看到了很多对实时数据分析的请求，这一(版本)让我们更接近这一目标。”

[PostgreSQL 9.5](http://www.postgresql.org/docs/current/static/release-9-5.html) ，现在可以从[下载](http://www.postgresql.org/download/)，它提供了许多新的特性来为数据仓库风格的工作做准备，以及一些性能改进来处理多种工作负载。

在 EnterpriseDB 进行的基准测试中，PostgreSQL 9.5 比 PostgreSQL 9.4 提高了 96%，同时在 496 GB RAM 上运行的 24 核系统上提供 64 个并发连接。

[EnterpriseDB](http://www.enterprisedb.com/) 的产品和服务副总裁马克·林斯特说:“我们在性能和可伸缩性方面做了很多工作。“支持分析的重要功能有所增加，但这些功能表明我们可以利用摩尔定律为我们提供的更大优势。”

仅在几年前，最大的 PostgreSQL 实现运行在 8 核或 16 核服务器上，拥有大约 5TB 的数据。林斯特说，现在用户希望在 32 核甚至 64 核的机器上运行数据库系统，并保存几十兆兆字节的数据。

EnterpriseDB 充当 PostgreSQL 的赞助商，并贡献代码以使其更适合大规模使用。例如，该公司贡献了支持共享缓冲区并发和锁定管理的特性，为同时支持更多用户铺平了道路。

“随着内核数量的增加，管理并发性、锁定和共享缓冲区变得非常关键，”Linster 说。“您有几十个用户同时访问相同的信息，因此您希望确保锁定机制尽可能高效。如果我从共享缓冲区读取数据，而你也想读取同样的数据，我们希望尽可能减少你的等待周期。”

## 新的分析功能

数据库系统提供了许多数据仓库中常见的新分析特性，包括分组集、立方体和汇总。它们都提供了可以通过一系列标准 SQL 操作符(如 UNION ALL)执行的功能，尽管它们使执行这项工作变得更加容易，加快了复杂查询的执行时间，并提供了制作更细微命令的方法。考虑需要汇总不同部门、地点和工作角色的员工人数等信息。

Momjian 说:“这种(方法)的效率是只检查一次数据。"过一段时间后，告诉人们使用 UNION 会变得很尴尬."

另一个应该有助于分析的新特性是一种叫做 BRIN(块范围索引)的新索引类型。BRIN 可以生成非常小的索引来描述一系列信息，例如最小值和最大值，这使得查询在查找特定范围内的数据时可以跳过大量的行。有了 BRIN，100GB 的数据可以在 100KB 左右的范围内汇总。

“布林创造了一个过滤指数，”Momjian 说。“你在一个数万亿字节的表中寻找一件紫色衬衫，我基本上可以缩减该表，知道紫色衬衫将在该表的百分之一以内。”

## UPSERT 做得对

用户最感兴趣的特性之一是引入了 UPSERT 命令，它将 INSERT 和 UPDATE 命令合并到一个调用中，这样，如果数据已经存在，它可以自动将 INSERT 转换为 UPDATE。PostgreSQL 没有特定的 UPSERT 命令，而是提供了一个可以与 INSERT 一起使用的特殊子句，可以实现相同的结果。

这是一个其他数据库系统已经有一段时间的特性，Momjian 承认他对 PostGreSQL 直到现在才拥有这个特性感到有点尴尬。

Momjian 说，事实证明，UPSERT(在某些系统上也称为 MERGE)在其他数据库系统上的许多实现“处理得非常糟糕”。实现这个特性是一项困难的任务，尤其是处理数据库被多方同时更新的用例。在许多其他系统中，两个人同时对相同的数据进行 UPSERT 只会导致一个用户或两个用户收到错误消息，这不是处理这种情况的最佳方式。

PostgreSQL 团队不想只是拼凑一些会导致技术债务的东西，这些债务以后会由开发人员或用户来解决。他们对结果感到满意。

“我们的实现的好处是它从不产生意外错误。你可以让多个人来做这件事，而且对性能的影响很小，”Momjian 说。因为它可以同时处理多个表，所以它甚至可以用于将一个表合并到另一个表中。

专题图片:[西蒙·玻利瓦尔](http://www.biography.com/people/simon-bolivar-241196)，[纽约街头艺术](http://joabj.com/Photos/2015/1501-SA-Bushwick-SimonBolivar-DasicFernandez.html)达西克·费尔南德斯。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>