# 为什么云本机的成功依赖于高速 CI/CD

> 原文：<https://thenewstack.io/why-cloud-native-success-depends-on-high-velocity-ci-cd/>

[旗语](https://semaphoreci.com/)赞助本帖。

 [马尔科·阿纳斯塔索夫

Marko 是一名软件开发人员，也是 Semaphore 的联合创始人，Semaphore 是一个 CI/CD 平台，为一些世界上最好的工程团队提供支持。他写了支持持续改进的实践和工具。](https://semaphoreci.com/) 

每个技术领导者的目标都是以高速度向客户交付无缺陷的产品。今天的云原生技术可以让工程团队以前所未有的速度进行大规模迭代。但是不改变软件交付方式的团队将很难从云原生提供的敏捷性和部署速度中获益。

托管 CI/CD 解决方案可以很好地解决“集成”部分，例如编译代码，并具有不同程度的性能和可用性。例如，Semaphore 的平台基于裸机硬件，以提供最佳性能。这使得并行测试场景中的生产率有很大的不同。

但在云原生方法中，并行管理许多微服务比集成更具挑战性。我们需要一种快速、标准化的方式向生产交付新服务。我们需要确保运营工作的复杂性不会激增，因为我们不再部署和运行单个应用程序，而是部署和运行数十甚至数百项服务。

第一步是接受云的可编程性——您将基础设施描述为代码，并在版本控制系统中管理它。一旦您像对待应用程序代码一样对待所有基础设施，您就可以应用连续交付来解决运营复杂性的挑战。但是要做到这一点，您的 CI/CD 工具也需要是可编程的。

传统的托管 CI/CD 服务提供针对整体式 Web 应用程序部署而优化的部署功能，但灵活性有限。当团队转向容器和云原生计算时，他们倾向于依赖 CI 供应商作为“主力”——但通常会投入工程时间来操作他们自己的 Jenkins 实例，有时会与 Spinnaker 结合用于 CD。由于缺乏完善的 CI/CD 产品，这是一个被迫的举动。然后，团队面临着维护和扩展内部基础设施的耗时任务，同时还面临着糟糕的用户体验和稳定性问题。这是大量没有给公司最终客户带来价值的工作。

在 Semaphore，我们认同这样一个理念:尽管问题可能很复杂，但解决方案必须简单。自 2012 年成立以来，我们以两个原则指导产品开发:速度和简单。大约一年前，我们问自己:今天，这些原则会转化为什么样的 CI/CD 产品？

![](img/094058775cc11e4d8869dffbb07547e8.png)

我们找到的答案让我们创造了一个全新的 CI/CD 产品——[Semaphore 2.0](https://semaphoreci.com/blog/2018/11/06/semaphore-2-0-launched.html)，于本周发布。新的信号量基于许多原则和模式，旨在提高云原生环境的开发人员生产率:

### 1.速度总是很重要。

没有人希望他们的构建运行得更慢。如果开发人员需要等待超过 10 分钟的 CI 结果，他们就会失去注意力，工作效率也会降低。CI/CD 产品应该提供测量和加速构建时间的工具。

以企业医疗保健公司 Par8o 的工程团队为例。他们使用类似于 GitHub flow 的开发工作流，一旦故事在 QA 环境中得到验证，就合并到 master。

问题是这种情况很少发生，因为在开发笔记本电脑上运行所有测试需要两个多小时。因此，在一个工作日内，整个工程团队每天不能合并超过三次。

一旦他们开始使用 Semaphore 的名为 [Boosters](https://semaphoreci.com/landers/boosters-rails) 的自动测试并行化特性，平均构建时间下降到仅仅 13 分钟，提高了团队士气和生产力。这些挑战在未来将继续存在。

### 2.每个开发人员都应该能够在几分钟内定义并运行一个定制的 CD 管道。

大多数用 Docker 开发应用的团队都需要使用多级管道。例如，在 CI 阶段，我们通常需要构建一次容器映像，“扇出”到多个并行作业进行测试，然后“扇入”收集测试覆盖结果。

一些团队在不同阶段使用不同的策略。例如，丰田等公司的团队有针对不同环境运行的测试，如 QA、试运行和生产。代码基础是相同的，但是结合了不同的配置或参数。这些测试不需要同时运行，而是根据系统的记录手动按需运行。在构建中改变一个步骤应该无缝地反映在所有环境中。

另一个常见的用例是根据另一个构建的成功来“控制”部署。例如，我们可能有多个应用程序都使用一个库。在这种情况下，如果该库的测试失败，我们不希望部署这些应用程序。

### 3.基础设施正从固定资源转向短暂资源。

当 CI/CD 资源有限时，开发人员通常会在一周的繁忙时间受阻。这与云原生的“按需付费”模式形成对比，在这种模式下，我们使用的资源会自动扩展以支持团队的实际需求。

### 4.CI/CD 反馈循环不仅仅是拉动式请求状态。

选择的工具应该是可编程的，并作为开发人员自然工作流程的便捷扩展。

引导一个新的项目，包括一个有效的 CI/CD 管道，理想情况下需要几分钟。一如既往，自动化有助于加快速度，同时消除与人为错误相关的风险。

通过用代码描述我们的 CI/CD 管道，正如我们已经为我们的云基础设施所做的那样，我们还提高了可见性，实现了快速入职和快速知识转移。如果 CI/CD 工具的所有功能都通过命令行界面公开，开发人员就可以像使用代码库一样轻松地进行交互和构建。

### 5.需要测量 CD 吞吐量。

CI/CD 工具应该让用户选择他们自己的度量标准并定义他们自己的仪表板，而不是为每个项目指定相同的关键数字。一些项目在构建时间上有问题。对其他人来说，最重要的是知道我们多久向用户部署一次。

然而，大多数指标不再与每个存储库相关。当一个应用由许多微服务组成时，重要的是聚合指标。因此，CI/CD 仪表板可以包括跨一系列服务的最新工作摘要、关于部署到生产或平均构建持续时间的见解。

云原生计算曾经只为网飞或 Spotify 等最大、最先进的工程组织保留。Docker、Kubernetes 以及相关工具和服务的兴起使得这种模式成为主流。同样，大规模地进行连续交付正从需要专业的内部团队转变为交钥匙服务。在 Semaphore，我们很高兴成为这一旅程的一部分，并继续致力于使 CI/CD 对每个人来说都很容易。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>