# Apache Cassandra:可扩展微服务应用的持久数据存储

> 原文：<https://thenewstack.io/apache-cassandra-persistent-data-storage-for-scalable-microservices-applications/>

[](https://www.linkedin.com/in/patrick-callaghan-b415513/?originalSubdomain=ie)

[Patrick Callaghan](https://www.linkedin.com/in/patrick-callaghan-b415513/?originalSubdomain=ie)

[Patrick Callaghan 最近被任命为 DataStax 的支持副总裁，此前他曾在该公司担任企业架构师和战略业务顾问长达六年。Patrick 与在混合云和多云环境中实施和支持任务关键型应用程序的公司合作。在加入 DataStax 之前，Patrick 曾在银行和金融部门从事实时应用程序的设计和开发工作。](https://www.linkedin.com/in/patrick-callaghan-b415513/?originalSubdomain=ie)

[](https://www.linkedin.com/in/patrick-callaghan-b415513/?originalSubdomain=ie)[](https://www.linkedin.com/in/patrick-callaghan-b415513/?originalSubdomain=ie)

软件工程师和架构师正在远离构建在一个单一、庞大的代码基础上的单一应用程序。这种方法变得越来越难以管理和扩展，因为公司需要在全球范围内运营，全天候开展业务，并且在一个需要更高敏捷性和更快响应客户需求的世界中工作。

微服务架构的新方法的出现填补了这一空白。企业软件团队从他们围绕领域驱动设计的经验中学习，并接受持续集成和持续交付(CI/CD)的能力，以更有效地将软件投入生产。使用微服务，团队可以更快地响应变化，而不必返工整个应用程序。他们支持在服务的生命周期中使用小团队，并展示了如何构建健壮的系统，该系统可以扩展以应对当今的应用需求。

## 规划向微服务的迁移

微服务方法建立在所有实践和技术的基础上，这些实践和技术是为了创建由小型独立进程组成的复杂应用程序，这些进程使用与语言无关的轻量级应用程序编程接口(API)如 REST 来相互通信。这些服务通过将这些服务分布在多个服务器或机器映像上来扩展，然后在需要扩展时复制这些机器。

这些服务是小的构建块，高度解耦并专注于完成一个小任务，促进了构建系统的模块化方法。这些服务都是独立部署和管理的。像容器这样的技术正在成为创建这种服务的默认选择。

如果您有一个现有的 monolith 应用程序，迁移到微服务需要将任务划分为不同的离散服务。随着时间的推移，所有或大多数功能都将在微服务架构中实现。您可以根据业务逻辑、前端和数据访问来分割整体。由于 monolith 是根据应用程序的模块划分的，它将逐渐缩小，当需要新功能时，我们可以创建微服务，而不是为 monolith 创建更多代码。

独立运行服务会带来一些显著的好处:

*   **多语言方法:**只要服务的端点 API 返回期望的输出，您可以选择任何语言或技术来开发它。
*   **部署的乐趣:**微服务的独立性使它们更容易部署。与 monolith 应用程序不同，更新或扩展组件不需要关闭整个应用程序。
*   **级联更少:**类似地，任何一个服务的失败都不会导致整个应用程序的级联失败。如果您没有遵循一个好的设计方法(例如，[网飞方法](https://medium.com/netflix-techblog/fault-tolerance-in-a-high-volume-distributed-system-91ab4faae74a))，部分失败可能会成为一个问题，但是服务独立性确实使调试过程更加集中。
*   **回收:**一旦你踏上了微服务之路，服务代码也可以提供在其他项目中可以很容易重用的功能。

## 微服务应用面临的挑战

除了一些显著的优势，微服务架构也带来了一些挑战。然而，许多问题都可以通过正确的方法来解决。

从一开始，为服务选择正确的功能就非常重要。为 monolith 的每个功能创建一个微服务会带来不必要的复杂性。微服务的目标是分解应用程序，以实现敏捷的应用程序开发和部署。微服务的主要思想家 Sam Newman 提出了一个有用的经验法则，当代码库太大而无法由一个小团队管理时，考虑将其分解是明智的。

类似地，如果您没有正确地实现，服务间的通信也会很昂贵。您需要从消息传递和 RPC 等选项中选择开销最小的方法来满足需求。例如，通知客户他们的出租车或包裹即将到达只需要一对一的单向请求，而不是一对多的通知，后者要求在指定的时间范围内得到答复。

> 当您需要状态时，将状态信息存储在一种类型的数据存储中比存储在内部更容易。

另一个挑战是复杂性。部署微服务应用程序通常需要一个可以跨多个环境运行的分布式环境，从数据中心的不同服务器到像云这样的完全分布式环境。然后，这些分布式环境将需要使用容器编排工具(如 Kubernetes)进行管理。思考如何自动化像 Kubernetes 创建的新容器这样的过程可以消除一个严重的扩展问题。

除此之外，您还必须考虑如何测试和管理应用程序。微服务的端到端测试可能具有挑战性，因为涉及到大量的服务和平台，以及它们之间的相互依赖性。最终，意识到挑战，当您的应用程序复杂且不断发展时，微服务将继续对您的企业有意义。

## 微服务和数据

除了应用程序流程，查看它将创建的数据也很重要。每个微服务可以是无状态的，也可以是有状态的。实际上，这意味着无状态微服务不会在服务中跨调用维护任何状态。该服务将接收一个请求，对其进行处理，并发回一个响应，而不会为将来的调用保存任何状态信息。

有状态的微服务将以某种形式持续存在，以使其能够发挥作用。使用微服务的系统通常混合了无状态和有状态组件，例如，更改文件的服务可能不需要长期保留该文件的副本，而客户服务应用程序背后的组件将创建必须存储的数据。

当您需要状态时，将状态信息存储在一种类型的数据存储中比存储在内部更容易。可用于保持状态的数据存储类型将取决于您的需求以及随着时间的推移您期望创建的数据量。这里的选项包括传统的关系数据库管理系统(RDBMS)、NoSQL 数据库或某种类型的云存储。在外部保持状态为状态信息提供了可用性、可靠性、可伸缩性和一致性。

对于创建大量必须组织的数据的应用程序，数据库通常是比对象存储或云存储更好的选择。对于涉及交易或客户服务的应用程序，大规模性能也很重要。看看像 Apache Cassandra 这样的 NoSQL 数据库会有所帮助。

因为 Apache Cassandra 可以通过添加更多节点来线性扩展，所以它已经成为微服务应用程序的一个流行的持久数据存储选择。例如，在 Monzo，微服务和 Cassandra 的结合使 challenger bank 的客户群每年翻两番，没有任何问题。Monzo 表示，在高峰时期，该银行现有的 1500 个微服务每秒可以处理 30 万次读取，所有这些微服务都连接到他们的 Apache Cassandra 集群。

任何微服务应用都涉及如此多的移动部件，因此任何支持应用的数据库实现都必须能够轻松扩展并连接到所有组件。使用一个容器编排工具(比如 Kubernetes)来管理应用程序和数据库实例可以有所帮助，并且通过使用 Kubernetes 操作符来管理在需要时添加数据库节点的过程，可以避免一些纵向扩展数据库的管理难题。

同样，数据一致性和弹性问题也值得关注。对于分布式计算环境，可以重放丢失的消息并重新创建事务。这在分布式数据库中并不简单，因此也需要考虑如何处理数据一致性。Cassandra 基于 Paxos 原则和最终一致性来处理这一问题，这确保了数据的所有副本在每个节点上都是一致的。对于需要 ACID 事务的应用程序，可能需要一个单独的数据库实例，但是绝大多数应用程序可以使用最终一致性运行，这需要几毫秒的时间。

## 微服务的未来

微服务满足了当今 IT 的需求。它们可以驻留在全球多个数据中心环境中，也可以跨混合云部署实施，以提供对数据的扩展和即时访问。这可以满足连续可用性和无延迟等应用程序要求。关注微服务应用也意味着关注应用将创建的数据。

使用分布式 NoSQL 数据库提供了相同类型的应用程序设计方法——广泛传播、可伸缩并且能够跨多个环境运行。通过同时考虑应用程序和数据库设计，您可以在未来充分利用您的微服务。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>