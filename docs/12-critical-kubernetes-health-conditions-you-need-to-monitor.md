# 您需要监控的 12 种 Kubernetes 关键健康状况

> 原文：<https://thenewstack.io/12-critical-kubernetes-health-conditions-you-need-to-monitor/>

[](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/)

 [查理·菲斯克

查理是 Circonus 的 ux 设计主管，他在前端为客户创造快速、易用的体验，同时与后端工程师合作，使 Circonus 安全无故障。自从他在世纪之交开始研究多媒体光盘以来，他已经从事前端开发工作二十多年了。查理与妻子和儿子住在肯塔基州。](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/) [](https://www.linkedin.com/in/charlie-fiskeaux-4293a54/)

Kubernetes 每天可以生成数百万个新指标。监控集群健康状况最具挑战性的一个方面是过滤这些指标中哪些是值得收集和关注的。

应对这一挑战的最佳方式是首先了解每个 Kubernetes 运营商应该关注哪些高价值信号。这是我们的一个客户，美国职业棒球大联盟采取的方法。通过关注他们关心的[核心、可操作的问题](https://thenewstack.io/lessons-from-major-league-baseball-on-deploying-and-monitoring-kubernetes/)，他们过滤掉了他们生成的大约 90%的 Kubernetes 数据。

在本文中，我将定义 Kubernetes 的 12 个关键健康状况，您应该对其进行监控并创建警报。您的组织的列表可能略有不同，但是在制定您的组织的 Kubernetes 监控策略时，这 12 个列表是一个很好的起点。

## **崩溃循环**

崩溃循环是指一个 pod 启动、崩溃，然后不断尝试重启但无法重启(它一直在循环中崩溃和重启)。这显然很糟糕，因为当这种情况发生时，您的应用程序无法运行。这可能是由 pod 中的应用程序崩溃引起的，也可能是由 pod 或部署过程中的错误配置引起的，这使得调试崩溃循环变得相当棘手。当崩溃循环发生时，您需要立即知道—以便您可以弄清楚发生了什么，以及您是否需要采取紧急措施来保持您的应用程序可用。

## **CPU 利用率**

CPU 利用率就是您的节点使用了多少 CPU 周期。这对于监控很重要，原因有二:首先，您不想耗尽应用程序的处理资源。如果您的应用程序受到 CPU 的限制，您需要增加 CPU 分配或向集群添加更多节点。第二，你不希望你的 CPU 闲置在那里。如果您的 CPU 使用率一直很低，那么您可能过度分配了资源，并且可能在浪费金钱。

## **盘压**

根据您在 Kubernetes 配置中设置的阈值，磁盘压力是一种指示节点使用太多磁盘空间或使用太快磁盘空间的情况。监视这一点很重要，因为如果您的应用程序确实需要更多的空间，这可能意味着您需要添加更多的磁盘空间。或者，这可能意味着应用程序行为不当，以一种意想不到的方式过早地填满了磁盘。不管怎样，这是一种需要你注意的情况。

## **记忆压力**

内存压力是另一种资源状况，表明您的节点内存不足。类似于 CPU 资源分配，您不希望耗尽内存，但是您也不希望过度分配内存资源和浪费金钱。您特别需要注意这种情况，因为这可能意味着您的某个应用程序中存在内存泄漏。

## **PID 压力**

PID 压力是一种罕见的情况，在这种情况下，一个 pod 或容器产生了太多的进程，使可用进程 ID 的节点处于饥饿状态。每个节点都有有限数量的进程 id 在运行的进程中分发；如果它用完了 IDs，就不能启动其他进程。Kubernetes 允许您为 pod 设置 PID 阈值，以限制它们执行失控过程-产卵的能力，PID 压力条件意味着一个或多个 pod 正在用完它们分配的 PID，需要进行检查。

## **网络不可用**

您的所有节点都需要网络连接，此状态表明某个节点的网络连接有问题。要么是设置不正确(由于路由耗尽或配置错误)，要么是硬件的网络连接存在物理问题。

## **工作失败**

作业被设计为在有限的时间内运行 pod，并在它们完成预期功能后将其拆除。如果由于节点崩溃或重新启动，或者由于资源耗尽，作业没有成功完成，您需要知道作业失败了。这就是为什么您需要监控作业失败——它们通常并不意味着您的应用程序不可访问，但是如果不加以解决，它可能会导致以后出现问题。

## **持续的卷故障**

永久卷是在群集上指定的存储资源，可作为永久存储供任何请求它的 pod 使用。在它们的生命周期中，它们被绑定到一个 pod，然后在该 pod 不再需要它们时被回收。如果回收由于任何原因失败，您需要知道您的持久存储有问题。

## **Pod 待定延迟**

在 pod 的生命周期中，如果它等待在节点上进行调度，则其状态为“待定”。如果它停留在“待定”状态，通常意味着没有足够的资源来安排和部署 pod。您将需要更新您的 CPU 和内存分配，删除 pod，或者向您的集群添加更多节点。

## **部署故障**

部署用于管理无状态应用程序——其中的单元是可互换的，不需要能够访问任何特定的单个单元，而只是特定类型的单元。您需要密切关注您的部署，以确保它们正确完成。最好的方法是确保观察到的部署数量与期望的部署数量相匹配。如果不匹配，则一个或多个部署失败。

## **声明集未准备好**

StatefulSets 用于管理有状态的应用程序，其中的 pod 有特定的角色，需要访问其他特定的 pod；而不是像部署那样只需要特定类型的 pod。不过，监控也是一样的——您需要确保观察到的状态集的数量与期望的状态集的数量相匹配。如果存在不匹配，则一个或多个 StatefulSets 已经失败。

## **DaemonSets 未准备好**

守护进程用于管理需要在集群中所有节点上运行的服务或应用程序。如果您想要在每个节点上运行日志收集守护程序或监控服务，那么您将需要使用守护程序集。监视与部署相同:您需要确保观察到的 daemonset 数量与所需的 daemonset 数量相匹配。如果不匹配，则一个或多个 DaemonSets 失败。

像 Kubernetes 的大多数方面一样，监控 Kubernetes 的健康状况可能是一个复杂而具有挑战性的过程。很容易不知所措。通过了解您最需要关注的高价值健康状况，您至少可以开始实施一种策略，使您能够过滤掉集群产生的大量数据噪音，并更加自信地认为您正在解决对确保良好体验最重要的问题。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>