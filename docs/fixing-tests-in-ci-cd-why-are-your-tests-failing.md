# 修复 CI/CD 中的测试:为什么您的测试会失败？

> 原文：<https://thenewstack.io/fixing-tests-in-ci-cd-why-are-your-tests-failing/>

伊斯梅尔·埃吉尔梅斯

伊斯梅尔是桑德拉公司的业务发展经理。他对销售、营销和增长战略充满热情。

自动化测试是当今软件开发世界的最佳实践。每个开发人员都知道他们应该对他们的代码进行多重测试。即便如此，大多数关于如何运行测试的信息都是基于个人观点。

您是否应该先编写集成测试，然后针对特定的 bug 编写单元测试，以控制回归？你需要 100%的保险吗？如果不是，多大的覆盖率是可以接受的？

问题不断，测试应用程序的方法也很多。即使你得到了你需要的答案，你也可能不知道下一步该怎么做。例如，[当测试失败时，你会怎么做，](https://blog.thundra.io/how-to-fix-your-failing-end-to-end-tests)最快的解决方法是什么？

一般来说，当测试显示你的代码有问题时，这是很好的。意思是不会直接影响一个用户，但是会有影响。一个失败的测试会减慢你的交付过程，因为你需要停止一切并修复它。你的用户必须等待新的功能，如果他们必须等待太长时间，他们可能会倾向于看看你的竞争对手提供了什么。

在本文中，我们将讨论如何修复那些只在您的 CI 服务器上失败的测试，即使它们在您的本地计算机上工作。我们还将介绍为什么认真对待失败的测试很重要，以及如何减少修复失败的工作量。

## 为什么我们忽略失败的测试

这是一场与测试的无休止的斗争:当你失败时，它们会告诉你，这是有帮助的，但也可能表明其他问题。它们还会在您必须编写的实际应用程序代码之上创建额外的编码工作。因此，失败的小的、看似不重要的测试将被忽略。通常这种情况会持续下去，直到出现大量失败的测试，没有人知道如何控制这些失败的测试。如果你的待办事项太多，以至于人们都避而远之，那么它将成为没人愿意做的任务的墓地。

虽然这些障碍很小，但会导致忽视测试。此外，如果测试失败，开发人员可能会有比修复测试更紧迫的事情要考虑，因为新功能需要在周末之前交付。

但是，不要认为这是后期处理的问题。令人沮丧的大量失败测试通常来自于从项目一开始就被忽略的测试。测试错误越难重现，开发人员调试和修复它的积极性就越低。如果您没有计划过程来减轻早期调试的痛苦，这些问题会随着时间的推移而增长。

## 为什么我们要认真对待失败的测试？

有多种理由认真对待失败的测试。首先，失败的测试会阻碍新版本的交付，因为 [CI/CD 管道](https://thenewstack.io/3-ways-to-use-automation-in-ci-cd-pipelines/)只会在每个测试成功时部署。或者，可以将管道配置为允许更大的灵活性，并部署带有失败测试的版本。这两种情况都不理想。要么您的交付停止，要么您开始交付质量低于标准的软件，您的客户肯定会注意到这一点。

因为随着时间的推移，解决测试问题不会变得更容易，所以应该尽早采取第一个纠正措施。技术债务不会自行修复。最终，如果不认真对待，[失败的测试会折磨你的开发团队](https://blog.thundra.io/ignoring-flaky-tests-for-expediency-is-harming-your-team)，并导致 CI/CD 进度的冻结。

测试是为了在开发过程中帮助你。如果你的测试没有价值，不值得修复，你就不应该写它们。没有自动测试来检查其功能的系统是糟糕的。一个充满无用的失败测试的系统更糟糕；他们使用资源，而你并没有从他们的结果中获得任何东西。

## 修复失败测试的最佳方法

在最坏的情况下，修复失败的测试需要开发人员签出他们代码的旧版本，并在另一台机器上复制持续集成环境。根据 [CI/CD 自动化](https://thenewstack.io/3-ways-to-use-automation-in-ci-cd-pipelines/)的水平，可能会有额外的步骤来发现 bug。在传统环境中，开发人员可能必须手动安装系统的多个部分。

这是开发人员在 CI 中看到提交失败时的想法。所有都是不调试的可能借口，每一个都可以通过一点规划来规避。以下是一些策略:

### 最大限度减少前期工作

管理人员和开发人员应该尽量减少开始调试所需的前期工作。重要的是立即通知提交失败的创建者，并告诉他们您所知道的关于该问题的一切，而不是仅仅传达他们的 CI 运行失败的消息。

如果您在应用程序中使用基础设施即代码，请利用这一点。IaC 可以加速开发环境的建立，并允许开发人员使用类似于 CI 环境的系统立即进行调试。这节省了研究和创造完美匹配环境的时间。

### 在测试发生的地方调试测试

更好的是，使开发人员能够在 CI 环境中的部署位置调试系统。这消除了许多令人厌烦的前期工作，并使您不必等待开发系统的部署。

您还可以检测您的 CI 和测试代码，以便您确切地知道在那个远程服务器上发生了什么。测试花了多长时间？执行了什么代码？它达到任何资源限制了吗？测试场景中涉及了哪些服务？这些度量和跟踪可能足以让沮丧的开发人员顿悟，而不需要复制任何东西。

### 使用正确的工具

桑德拉的最新产品 [Foresight](https://www.runforesight.com/) 是让您的 CI 渠道更加引人注目的完美工具。Foresight 利用我们多年来为云应用构建监控解决方案所积累的可观察性知识，将其应用于 CI/CD 渠道。现在，您甚至可以在将系统部署到生产环境之前，获得诸如指标、跟踪和日志等信息。

借助 Foresight 新的记录和回放功能，您可以一步一步地完成测试。这允许您重放实际发生的事情，就像在本地机器或云中的专用开发环境中复制系统一样。

这个特性有两个巨大的好处:

1.  它消除了开发人员开始调试之前需要做的所有工作。
2.  它运行在最初执行测试的同一硬件上，因此您不必担心您的副本与 CI 环境不匹配。

## 结论

当出现问题时，开发人员倾向于在他们的本地机器上重新运行测试，因为这是他们可以控制的地方。然而，在云基础设施和托管服务时代，这种复制并不总是可能的。虽然运行自动化测试是一个很好的实践，但是当它们在 CI/CD 管道之外执行时，它们的错误会很快变得令人困惑。

这就是为什么我们需要将运行测试和本地调试的控制权转移到云中，进而转移到远程 CI/CD 管道。

许多测试监控解决方案告诉开发人员一个错误，但是他们没有给他们可操作的洞察力来帮助他们修复它。通常，他们得到的最好的是一些不完整的日志，甚至没有最重要的信息。这导致开发人员害怕修正测试，最终，软件质量或交付速度都会受到影响。

桑德拉预见的创建是为了保持交付过程的顺利，包括修复损坏的构建这一不方便的任务。探索桑德拉的开源项目，看看修复失败的测试有多简单。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>