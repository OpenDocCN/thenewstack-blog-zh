# Rust vs. Go:为什么它们在一起更好

> 原文：<https://thenewstack.io/rust-vs-go-why-theyre-better-together/>

[](https://github.com/spf13)

 [史蒂夫法兰克王国

在过去的 25 年里，史蒂夫法兰克王国打造了一些最具创新性和最成功的技术和公司，这些技术和公司已经成为云计算的基础，受到了全世界企业和开发者的欢迎。他目前是谷歌 Go 编程语言的产品和战略主管。他是 Hugo、Cobra、Viper、spf13-vim 和许多其他开源项目的创造者，拥有领导世界上最大的五个开源项目的独特荣誉。](https://github.com/spf13) [](https://github.com/spf13)

虽然其他人可能认为 [Rust](https://www.rust-lang.org/) 和 [Go](https://go.dev/) 是有竞争力的编程语言，但 Rust 和 Go 团队都不这么认为。恰恰相反，我们的团队非常尊重其他人正在做的事情，并将这些语言视为对整个行业软件开发现代化的共同愿景的补充。

在本文中，我们将讨论 Rust 和 Go 的优缺点以及它们如何相互补充和支持，以及我们对每种语言何时最合适的建议。

公司发现采用两种语言及其互补价值的价值。为了从我们的观点转移到实际的用户体验，我们采访了三家这样的公司， [Dropbox](https://www.dropbox.com/) 、 [Fastly](https://www.fastly.com/) 和 [Cloudflare](https://www.cloudflare.com/) ，了解他们一起使用 Go 和 Rust 的体验。这篇文章中会引用他们的话来提供进一步的观点。

## 语言比较

## 类似

 [乔纳森·特纳

Jonathan Turner 在开源领域工作了 20 多年，从小项目到大项目，包括帮助微软过渡到开源。他是创建 TypeScript 的团队的一员，并帮助它成长为项目经理和设计团队的领导者。作为 Rust 社区成员和 Mozilla Rust 团队的一员，他也从事 Rust 方面的工作，包括共同设计 Rust 的错误信息和 IDE 支持。](https://www.jonathanturner.org/) 

Go 和 Rust 有很多共同点。两者都是现代软件语言，都是出于为影响软件开发的问题提供安全且可伸缩的解决方案的需要而诞生的。这两种语言都是针对创作者在行业中使用现有语言时遇到的缺点而创建的，特别是开发人员的生产率、可伸缩性、安全性和并发性方面的缺点。

今天的大多数流行语言都是 30 多年前设计的。当这些语言被设计出来时，与今天相比有五个关键的不同:

1.  摩尔定律被认为是永远正确的。
2.  大多数软件项目是由小团队编写的，通常是个人一起工作。
3.  大多数软件都有相对较少的依赖项，大部分是专有的。
4.  安全是次要问题…或者根本不是问题。
5.  软件通常是为单一平台编写的。

相比之下，Rust 和 Go 都是为当今世界编写的，并且通常采用类似的方法来设计一种满足当今开发需求的语言。

### 1.性能和并发性

Go 和 Rust 都是专注于生成高效代码的编译语言。它们还提供了对当今机器的多处理器的轻松访问，使它们成为编写高效并行代码的理想语言。

*“通过使用 Go，MercadoLibre 可以将用于这项服务的服务器数量减少到原来的八分之一(从 32 台服务器减少到 4 台)，而且每台服务器的运行功耗更低(原来有 4 个 CPU 内核，现在减少到 2 个 CPU 内核)。通过 Go，该公司减少了 88%的服务器，并将剩余服务器的 CPU 减少了一半，从而节省了大量成本。”*—“[自由市场与 Go 一起成长](https://go.dev/solutions/mercadolibre/)”

*“在我们运行 Go 代码的严格管理的环境中，我们已经看到 CPU 减少了大约 10 %(与 C++)并且代码更干净和可维护。”* — [巴拉·纳塔拉詹，贝宝](https://go.dev/solutions/paypal/)

*“在 AWS，我们也喜欢 Rust，因为它帮助 AWS 编写高性能、安全的基础设施级网络和其他系统软件。亚马逊的第一款由 Rust 构建的著名产品鞭炮于 2018 年公开推出，提供开源虚拟化技术，为 AWS Lambda 和其他无服务器产品提供支持。但我们也使用 Rust 来提供服务，如亚马逊简单存储服务(亚马逊 S3)、亚马逊弹性计算云(亚马逊 EC2)、亚马逊 CloudFront、亚马逊 Route 53 等等。最近我们推出了 Bottlerocket，这是一个基于 Linux 的容器操作系统，用 Rust 编写。”— [马特·阿萨伊，亚马逊网络服务](https://aws.amazon.com/blogs/opensource/why-aws-loves-rust-and-how-wed-like-to-help/)*

我们“看到我们的速度惊人地提高了 1200-1500%！我们在 Scala 的发布模式下实现了 300-450 毫秒的解析规则，而在 Rust 中实现了 25-30 毫秒的解析规则！”— [乔希·汉纳福德，IBM](https://developer.ibm.com/technologies/web-development/articles/why-webassembly-and-rust-together-improve-nodejs-performance/)

### 2.团队可扩展—可审查

今天的软件开发是由不断成长和扩展的团队构建的，他们通常使用源代码控制以分布式的方式进行协作。Go 和 Rust 都是为团队如何工作而设计的，通过消除不必要的关注，如格式、安全性和复杂的组织，改进了代码审查。这两种语言都需要相对较少的上下文来理解代码在做什么，允许评审者更快地处理其他人编写的代码，评审团队成员的代码和团队之外的开源开发者贡献的代码。

*“构建 Go Rust 代码，在我早期的职业生涯中，我来自 Java 和 Ruby 背景，感觉像是卸下了我肩上的重担。当我在谷歌的时候，遇到用 Go 编写的服务是一种解脱，因为我知道它很容易构建和运行。铁锈也是如此，尽管我只在小得多的范围内研究过。我希望无限可配置构建系统的时代已经一去不复返，所有语言都自带专门构建的构建工具，开箱即用。”— [山姆·罗斯，CV 合伙人](https://bitfieldconsulting.com/golang/rust-vs-go)*

*“当我在 Go 中编写服务时，我倾向于松一口气，因为与动态语言相比，它有一个非常简单、易于推理的静态类型系统，并发性是一等公民，Go 的标准库不仅令人难以置信地完善和强大，而且还切题。以一个标准的 Go 安装为例，加入一个 grpc 库和一个数据库连接器，你只需要很少的东西就可以在服务器端构建任何东西，每个工程师都能够阅读代码并理解这些库。当在 Rust 中编写模块时，Dropbox 工程师在 Async-await 于 2019 年稳定之前就感受到了 Rust 在服务器端的成长之痛，但从那时起，crates 开始使用它，我们获得了异步模式与无所畏惧的并发性的优势。”—丹尼尔·雷特·霍恩，Dropbox*

### 3.开源感知

如今，普通软件项目所使用的依赖关系的数量是惊人的。几十年的软件重用目标已经在现代开发中实现，今天的软件是使用数百个项目构建的。为了做到这一点，开发人员使用了软件仓库，这已经越来越成为软件开发的主要部分，应用范围越来越广。开发者包含的每个包都有自己的依赖项。当今编程环境的语言需要毫不费力地处理这种复杂性。

Go 和 Rust 都有包管理系统，允许开发人员列出他们想要构建的包的简单列表，语言工具自动为他们获取和维护这些包，这样开发人员就可以更多地关注自己的代码，而不是管理其他人。

### 4.安全

Go 和 Rust 很好地解决了当今应用程序的安全问题，它们确保用这些语言构建的代码在运行时不会使用户暴露于各种经典的安全漏洞，如缓冲区溢出、释放后使用等。通过消除这些顾虑，开发人员可以专注于手头的问题，并构建默认情况下更安全的应用程序。

“[Rust]编译器真的会帮你解决你遇到的错误。这让您可以专注于您的业务目标，而不是寻找漏洞或破译神秘的信息。”— [乔希·汉纳福德，IBM](https://developer.ibm.com/technologies/web-development/articles/why-webassembly-and-rust-together-improve-nodejs-performance/)

*“简而言之，Rust 的灵活性、安全性和安全性超过了必须遵循严格的生存期、借用和其他编译器规则甚至缺少垃圾收集器的任何不便。这些功能是云软件项目非常需要的补充，将有助于避免其中常见的许多错误。”——[老泰勒·托马斯，微软](https://msrc-blog.microsoft.com/2020/04/29/the-safety-boat-kubernetes-and-rust/)。*

*“Go 是强静态类型的，没有隐式转换，但是语法开销仍然出奇的小。这是通过赋值中的简单类型推断和非类型化的数字常量来实现的。这使得 Go 比 Java(具有隐式转换)具有更强的类型安全性，但代码读起来更像 Python(具有非类型化变量)。”— [斯蒂芬·尼尔森，计算机科学教授](https://yourbasic.org/golang/advantages-over-java-python/)。*

当我们在 Dropbox 上构建 Brotli 压缩库来存储块数据时，我们将自己限制在 Rust 的安全子集，并且进一步限制在核心库(no-stdlib)中，分配器被指定为一个泛型。以这种方式使用 Rust 的子集使得在客户端从 Rust 调用 Rust-Brotli 库以及在服务器端从 Python 和 Go 使用 C FFI 变得非常容易。这种编译模式也为[提供了实质性的安全保障](https://dropbox.tech/infrastructure/lossless-compression-with-brotli)。经过一些调整后，Rust Brotli 实现尽管是 100%安全的、经过数组边界检查的代码，但仍然比 c 语言中相应的本机 Brotli 代码要快。”

### 5.真正便携

编写一个运行在许多不同操作系统和架构上的软件在 Go 和 Rust 中都是微不足道的。“一次编写，随处编译。”此外，Go 和 Rust 本身都支持交叉编译，消除了与旧编译语言相关的“构建农场”的需要。

*“Golang 拥有出色的生产优化品质，例如内存占用量小，这支持其成为大型项目构建模块的能力，以及开箱即可轻松交叉编译到其他架构。由于 Go 代码被编译成一个单一的静态二进制文件，它允许容易的容器化，并且，通过扩展，使得将 Go 部署到任何高度可用的环境(如 Kubernetes)中变得几乎微不足道。”— [Dewet Diener，曲线](https://jaxenter.com/golang-curve-163187.html)。*

*“当您考虑基于云的基础设施时，通常会使用 Docker 容器之类的东西来部署工作负载。使用在 Go 中构建的静态二进制文件，您可以拥有 10、11、12 兆字节的 Docker 文件，而不是引入整个 Node.js 生态系统、Python 或 Java，在那里您可以获得这些数百兆字节大小的 Docker 文件。所以，运输这种微小的二进制文件是惊人的。”— [微软](https://cloudblogs.microsoft.com/opensource/2018/02/21/go-lang-brian-ketelsen-explains-fast-growth/)的布莱恩·科特森。*

*“有了 Rust，我们将拥有一个高性能、可移植的平台，可以在 Mac、iOS、Linux、Android 和 Windows 上轻松运行。”— [Matt Ronge，Astropad](https://blog.astropad.com/why-rust/) 。*

## 差异

在设计中，总有必须做出的取舍。虽然 Go 和 Rust 差不多在同一时间出现，有着相似的目标，但当他们面临决策时，他们选择了不同的权衡，以关键的方式将这两种语言分开。

### 1.表演

Go 开箱即用，性能卓越。从设计上来说，没有旋钮或杠杆可以用来提高 Go 的性能。Rust 旨在使您能够从代码中挤出最后一滴性能；在这方面，你今天真的找不到比 Rust 更快的语言了。然而，Rust 性能的提高是以额外的复杂性为代价的。

值得注意的是，在编写 Rust 版本时，我们只将非常基本的思想投入到优化中。即使只有基本的优化，Rust 也能够超越超级手动调整的 Go 版本。这是一个巨大的证明，与我们不得不深入研究 Go 相比，用 Rust 编写高效的程序是多么容易。”杰西·豪沃斯，不和。

*“Dropbox 工程师通常会看到，通过将 Python 代码逐行移植到 Go 中，性能和延迟提高了 5 倍，与 Python 相比，内存使用率通常会大幅下降，因为没有 GIL，并且进程数可能会减少。然而，当我们受到内存限制时，例如在桌面客户端软件或某些服务器进程中，我们会转向 Rust，因为 Rust 中的手动内存管理比 Go GC 有效得多。”—丹尼尔·赖特霍恩，收纳箱*

### 2.适应性/交互性

Go 快速迭代的优势允许开发人员快速尝试想法，并专注于解决手头任务的工作代码。通常，这就足够了，开发人员可以腾出时间去做其他工作。另一方面，Rust 与 Go 相比编译时间更长，导致迭代时间更慢。在更快的周转时间允许开发人员适应不断变化的需求的场景中，这种方法会更好地工作，而 Rust 在可以有更多时间来进行更精炼和更高性能的实现的场景中会更好。

Go 类型系统的天才之处在于调用者可以定义接口，允许库返回可扩展的结构，但需要狭窄的接口。Rust type 系统的天才之处在于将 match 语法与 Result < >结合起来，在这里你可以静态地确定每一个可能发生的事情都得到了处理，并且永远不必发明空值来满足未使用的返回参数。”—丹尼尔·雷特·霍恩，Dropbox

*“(I)如果你的用例离客户越近，就越容易受到需求变化的影响，那么 Go 就更好，因为持续重构的成本要低得多。而是你能以多快的速度表达新的需求并尝试它们。”——彼得·波尔贡，法斯特丽*

### 3.可学性

简单来说，真的没有比围棋更平易近人的语言了。有很多团队能够采用 Go 并在几周内将 Go 服务/应用程序投入生产的故事。此外，Go 在语言中是相对独特的，因为在其 10 多年的生命周期中，它的语言设计和实践非常一致。所以投入学习围棋的时间在很长一段时间内保持其价值。相比之下，由于其复杂性，Rust 被认为是一种难学的语言。通常需要几个月的时间来熟悉 Rust，但是这种额外的复杂性带来了精确的控制和更高的性能。

*“当时，没有一个团队成员知道围棋，但不到一个月，每个人都在写围棋”——[Jaime Garcia，Capital One](https://medium.com/capital-one-tech/a-serverless-and-go-journey-credit-offers-api-74ef1f9fde7f)*

*“让 Go 不同于其他编程语言的是认知负荷。您可以用更少的代码做更多的事情，这使得推理和理解您最终编写的代码变得更加容易。大多数 Go 代码最终看起来都非常相似，因此，即使你正在使用一个全新的代码库，你也可以很快上手并运行起来。”—美国运通忠诚度平台工程总监 Glen Balliet】美国运通使用 Go 支付&奖励*

*“然而，与其他编程语言不同，Go 是为了最大化用户效率而创建的。因此，具有 Java 或 PHP 背景的开发人员和工程师可以在几周内获得使用 Go 的技能和培训——根据我们的经验，他们中的许多人最终更喜欢它。”— [Dewet Diener，曲线](https://jaxenter.com/golang-curve-163187.html)*

### 4.精确控制

Rust 最大的优势之一可能是开发人员可以控制如何管理内存、如何使用机器的可用资源、如何优化代码以及如何制定问题解决方案。与 Go 相比，这不是没有很大的复杂性成本，Go 不是为这种精确的工艺设计的，而是为更快的探索时间和更快的周转时间设计的。

*“随着我们对 Rust 的了解越来越多，它在另外两个方面显示出了优势:作为一种具有强大内存安全性的语言，它是在边缘进行处理的一个很好的选择；作为一种拥有巨大热情的语言，它成为了一种受欢迎的全新组件。”—约翰·格雷厄姆-卡明，云闪*

## 总结/关键要点

Go 的简单性、性能和开发人员的生产力使它成为创建面向用户的应用程序和服务的理想语言。快速迭代允许团队快速调整以满足用户不断变化的需求，让团队能够将精力集中在灵活性上。

Rust 更精细的控制允许更高的精度，这使 Rust 成为低级别操作的理想语言，这些操作不太可能发生变化，并且将受益于比 Go 稍有改善的性能，特别是如果部署在非常大的规模上。

铁锈的强度在最接近金属的地方最为有利。Go 的优势在离用户越近的地方就越有优势。这并不是说双方都不能在对方的空间工作，但是这样做会增加摩擦。随着您的需求从灵活性转移到效率，在 Rust 中重写库变得更加重要。

虽然 Go 和 Rust 的设计有很大的不同，但它们的设计发挥了一系列兼容的优势，当一起使用时，可以提供很大的灵活性和性能。

## 推荐

对于大多数公司和用户来说，Go 是正确的默认选项。它的性能很强，Go 很容易被采用，而且 Go 的高度模块化特性使它特别适合需求不断变化或发展的情况。

随着产品的成熟和需求的稳定，可能会有机会从性能的边际增长中获得巨大的成功。在这些情况下，使用 Rust 来最大化性能可能非常值得最初的投资。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>