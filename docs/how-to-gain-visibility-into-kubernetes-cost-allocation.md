# 如何了解 Kubernetes 的成本分配

> 原文：<https://thenewstack.io/how-to-gain-visibility-into-kubernetes-cost-allocation/>

为了追求更快的创新，组织开始转向 Kubernetes。开源令人兴奋的可能性促使公司构建内部 Kubernetes 环境，以充分利用容器化和微服务架构。然而，他们越来越发现自己迷失在 Kubernetes 的运营细节中。

将开源工具缝合在一起对于释放 Kubernetes 的优势(如更大的灵活性和可伸缩性)是必不可少的，但这仍然非常具有挑战性，并且有许多工具可以考虑。以成本可见性为例。如果没有正确的工具来了解您的 Kubernetes 集群，您将没有适当的基础来围绕更高级的 K8s 问题进行更多深入的对话和挑战。此外，缺乏可观察性通常会直接导致过度的云支出和令人吃惊的账单。

在本文中，我们将回顾一些公司在构建 Kubernetes 环境时经常遇到的关键成本超支问题。我们将讨论为什么 Kubernetes 是危险的，成本控制的最佳实践，以及为什么你需要在他们控制你之前控制 Kubernetes 的成本。

## 库伯内特能见度为零的危险

许多团队对他们的 Kubernetes 集群没有统一的可见性。他们的集群在风暴中“依靠仪器”飞行，这让飞行员在控制成本方面处于更弱势的地位。整个车队的可见性提供了一种做出明智决策的方法。信息有限，成本管理就会失败。如果不能进行基线比较，成本超支的风险会变得更大。

## 什么导致了黑暗的库伯内特斯

这些危险是如何发生的？我们已经确定了阻碍 Kubernetes 在当今组织中可见性的三个因素:

1.  **临时管理:**作为一项新的实验，一些公司开始时没有为他们的探索设定明确的界限。Kubernetes 的世界是巨大的、令人兴奋的和强大的，因此一些组织开始将 Kubernetes 视为一个参数不确定的项目。最终，无限制的 Kubernetes 变成了无限制的消费。不幸的是，任何未定义的实验都可能导致成本超支。
2.  **糟糕的流程:**通常，罪魁祸首是管理成本超支的糟糕流程(或者没有流程)。一个糟糕的成本管理过程可能比设置零成本限制要好，尽管它可能缺乏适当管理资源使用所必需的相关性。
3.  **差距和孤岛:**技能差距和信息孤岛切断了公司围绕成本管理和有效资源分配进行富有成效的对话的机会。今天，人才的限制使得构建和保持 Kubernetes 环境变得困难。

一旦云计划遭到破坏，很难弥补，但是有一些分配资源的最佳实践可以帮助组织保持正轨。

## Kubernetes 成本分配的最佳实践

防止 Kubernetes 成本超支的最佳方法之一是将最佳实践作为您的设置和维护的核心。

### 店主是谁？

在一些组织中，具体成本或资源的所有权不明确。所有权澄清了责任，并将被动使用恢复为主动管理。对于每一个过程和每一个成本，“谁是所有者？”需要一个明确的答案。

### 使用不同的模型—考虑共享集群或专用集群的替代方案

没有流程的自助服务剥夺了工程团队制定资源决策的框架。最后，没有一个过程会鼓励没有深思熟虑的限制的使用。如前所述，您需要一个您的团队应该熟悉的成本分配流程。

共享集群模式和专用集群有其自身的蔓延和超支趋势。在大多数情况下，组织应该评估来自应用程序团队的请求，并仅在必要时提供专用集群。默认情况下，大多数团队应该使用共享集群。

也就是说，如果不分摊共同成本，你就会失去透明度和问责制。应该适当地分配共享的群集资源，以便用户和应用程序拥有他们需要的访问权限。否则，一些应用程序可能会因为没有资源而挨饿，而另一些则会超支。

如果你继续使用共享模式，你仍然可以平均分配费用，按比例使用或每月按相同比例使用。您甚至可以对不同的成本应用不同的模型—例如，将支持费用分成一种方式，而将资源费用分成另一种方式。

专用集群的一个优点是它们相互隔离。这使得为不同的团队提供他们自己的主节点和资源成为可能。尽管您可以通过专用集群获得可见性，但与共享模式相比，您也可能会看到相同资源使用的成本大幅增加。

### 赔偿要求

成本责任是按存储容量使用计费的最大优势。按存储容量使用计费模型只是将 IT 资源视为供应商，并对他们使用的资源向部门或项目预算收费。让每个成本中心对他们自己的成本超支负责，你将在系统中建立额外的责任。

经济学理论告诉我们，道德风险——也称为“搭便车”倾向——是商业和组织中始终存在的风险。每当有一个有限的共享资源，如 Kubernetes 支出，就有成本超支的风险。这种模式在降低成本方面有着成功的记录，值得您的组织考虑。

### 接受 FinOps 最佳实践和原则

实践 FinOps 是非常宝贵的，因为它使团队能够做出正确的权衡，避免不必要的降低质量、产品交付或其他指标。通过向包括应用程序团队在内的所有利益相关方提供实时可见性，组织能够更有效地规划和采取行动，管理员也能更好地做出响应。通过 FinOps 实践获得的可操作数据允许跨职能团队更全面地管理云支出。

## 结论:通过 FinOps 的前进道路

由于不遵循最佳实践会导致成本超支，因此组织必须尽早克服可见性问题。FinOps 原则为合理的 Kubernetes 成本分配提供了一条途径，并使资源管理符合业务目标。

有效的成本分配还需要有精确的数据。没有使用数据，您无法做出使用决策，也无法调整实践和流程。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>