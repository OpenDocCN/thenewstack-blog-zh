# TypeScript 扩展到提供函数式编程、Node.js 集成

> 原文：<https://thenewstack.io/typescript-2-new-version-javascript-scales/>

在从内部到公共开源、开放设计项目的四年时间里，静态类型检查、传输和在 [TypeScript](http://www.typescriptlang.org/) 中使用工具的结合已经成为某种幕后成功，尤其是在大型项目上。你可能会认为微软的项目像 [Visual Studio Code](https://code.visualstudio.com) (以及 Office Online apps)是用打字稿编写的，但是 [Angular 2](https://thenewstack.io/google-preps-angular-2-final-release/) 也是如此。Slack 目前正在将其基于[电子](https://thenewstack.io/electron-brings-cross-platform-javascript-apps-to-the-desktop/)的桌面应用程序迁移到 TypeScript。

最近发布的 TypeScript 版本扩大了该语言的范围，该语言最初是作为 JavaScript 的超集设计的，也提供静态类型。这个版本增加了新的类型，更多来自函数式编程的概念——比如标记联合，以及几个方便的特性来提高开发人员的工作效率。

TypeScript 2.0 中的许多基础部分也是下一版本 TypeScript 2.1 中即将出现的功能的构建块(周三发布的预览版)，例如使用代码流分析来更好地为变量和数组分配隐式类型。随着 **async/await** 成为下一个 ECMAScript 标准的一部分，TypeScript 2.1 将能够为更广泛的浏览器传输异步代码。

新的堆栈询问了 C#的首席架构师、现在也是 TypeScript 的核心开发人员[安德斯·海尔斯伯格](https://github.com/ahejlsberg)，TypeScript 2.0 中什么是重要的，以及为什么微软首先要给 JavaScript 带来新的特性。

## 让 JavaScript 规模化

Hejlsberg 说，早在 2011 年，微软就已经看到 JavaScript 将成为一种重要的语言，而且不仅仅是针对网络。

“其中一个原因是，它确实是唯一可以跨平台运行的东西。甚至 Java 也不再是真正的跨平台；它不能在一堆移动设备上运行。由于移动革命，这个世界变得越来越多样化，这变得越来越重要。人们开始编写非常大的 JavaScript 应用程序，他们很难用动态编程语言编写一个大型应用程序，几乎没有工具可以验证你正在做的工作，”Hejlsberg 说。“检验代码是否有效的唯一方法是运行它，你最好在所有可能的状态下运行它，否则你永远不知道。但是我们从几十年的经验中知道，如果你添加一个静态类型系统和更好的工具，你可以在航天飞机飞行之前验证你的代码，而不是在它飞行的时候！”

该团队考虑尝试推广一个名为 [Script#](https://github.com/nikhilk/scriptsharp) 的内部工具，用于将 C#交叉编译为 javaScript，同样，谷歌正在推动 [GWT](http://www.gwtproject.org/overview.html) 作为一种使用 Java 工具和交叉编译为 JavaScript 的方式。

“但我们也意识到，你不能通过告诉他们用不同的语言编写并交叉编译成我们告诉你认为是网络 IL 的东西来吸引社区，”Hejlsberg 指出。“我们意识到，我们必须与 JavaScript 社区合作，找出 JavaScript 的不足，并找到创造性的方法来解决这个问题。”

最突出的一点是，JavaScript 没有其他语言提供的用于构建大型应用程序的方法。“没有模块，没有类，没有接口。特别是，没有静态类型系统，因此你不能做静态验证；你也不能做像智能感知这样的事情，去定义并找到所有的引用或安全重构。如果我们可以将它添加到 JavaScript 中，并且以不损害核心价值主张的方式做到这一点，即跨平台和随处运行，会怎么样？”

自 1.0 版以来，静态类型一直存在于 TypeScript 中；1.5 版本到来的模块和装饰器；中间版本带来了对 [ES2015](https://www.codeschool.com/courses/es2015-the-shape-of-javascript-to-come) 和更多 JavaScript 模式和库的支持。关注工具并使 TypeScript 易于嵌入到各种编辑器中也是关键。“开发人员的生产力不仅仅来自类型检查，还来自编辑和创作体验；获得出色的智能感知、出色的重构、出色的代码导航。过去需要一整天的事情，通过重构只需要一秒钟，这是无价的。”

## 建立在节点上

他热衷于 TypeScript 2 通过使用[节点包管理器](https://www.npmjs.com/)更容易地获得您需要的类型声明的方式，利用了 TypeScript 使用 Node 的方式——正如他指出的，这是在浏览器之外获得 JavaScript 的标准方式。

“打字稿在很大程度上是 T2 转运员的瑞士。我们与任何特定的开发栈都没有密切关系；它与“角度”和“反应”一起工作。它与 [Vue](https://vuejs.org/) 和 [Dojo](https://dojotoolkit.org/) 和 [Aurelia](http://aurelia.io/) 和 [Ember](http://emberjs.com/) 一起工作，你可以说出来……但是要使用 TypeScript，你必须从某个地方获取类型信息。如果它是一个用 TypeScript 编写的模块，那很容易，但是如果它是用 JavaScript 编写的，并且有人已经编写了一个声明文件，那么你必须得到那个文件；当你安装它时，它可能不与其他框架一起提供。”

这个[明确类型化的](http://definitelytyped.org/)站点有超过 2，000 个类型声明文件，TypeScript 社区创建了像 TSD 和 Typing 这样的工具来从这些和其他的 repos 中提取类型定义，但是 Hejlsberg 承认这变得相当“混乱”

“我们意识到我们需要专注于使这成为更好的体验，所以对于 TypeScript，我们会自动抓取明确类型化的内容，并自动将您放在那里的任何内容打包到节点模块中，并将它们放在私有名称空间中， **@types** 。如果您说' **npm install jQuery** '，您会得到类型—它只是一个节点模块。这些节点模块可以依赖于其他节点模块，所以我们使用节点依赖管理器。您现在只需安装类型。”

他注意到像 Angular ship 这样的框架包含了类型脚本类型，所以你可以自动获得它们；“但如果你不这样做，这只是另一个 npm 安装了，这使得配置容易得多。”

类似地， [glob](http://www.tcl.tk/man/tcl8.5/TclCmd/glob.htm) 支持是一个受欢迎的请求，因此您可以在配置文件的文件路径中使用通配符来包含或排除特定的文件，这在项目变大并需要从不同位置提取源代码时非常有用。他解释说，TypeScript 不能简单地使用标准节点模块 globbing 支持库。

“按照我们编写 TypeScript 的方式，它有很少的依赖性。节点项目经常发生的情况是，你依赖于这个或那个，在你知道之前，你已经吸取了数百个节点模块。我们希望 TypeScript 是可嵌入的。如果你想在浏览器中运行 TypeScript，你不能依赖 node，所以我们不得不自己写。”

## JavaScript 的函数式编程

其他新特性更加基础，让 TypeScript 采用一些[编程思想](https://maryrosecook.com/blog/post/a-practical-introduction-to-functional-programming)，由于 Swift 和 F#等函数式语言的成功，开发人员开始熟悉这些编程思想。

当您忘记考虑从 API 返回的空值或未定义的值时，为 JavaScript 提供两种将值标记为空(null 和 undefined)的方法，它们自己的类型可以避免大量的编程错误。

他将推理非空类型的能力称为这种能力的前兆之一:“这是十亿美元的错误，或者说二十亿，因为 JavaScript 既有空的也有未定义的；这正是我们渴望解决的问题，我们现在已经用一个很好的向后兼容的故事解决了这个问题，让您可以逐步实现这一目标。”

这反过来依赖于控制流分析。“控制流分析是关于编译器对代码中发生的事情的推理。当你写一个 if 语句……

或

…那么你知道 x 在那里不为空，如果你返回那里，那么你知道 x 在你所在的块的剩余部分不为空。但是需要编译器进行代码流分析来解决这个问题。事实证明，没有代码流分析，不可空性是没有意义的。"

一旦你拥有了这两者，你就可以对其他模式使用控制流分析。“JavaScript 中很常见的一点是编写消息风格的处理应用程序。许多微服务收到的请求可能是以下 17 个请求中的一个，它们都有一个标头，所有标头都有一个请求属性，该属性是一个字符串以及除此之外的一些可变数据。"

您可以使用类，每个请求有一个类和一个调度程序；他称之为面向对象的方法。但这不是唯一的选择，证明 TypeScript 不只是“JavaScript 的 C#”。

他指出:“有了 TypeScript 和 ECMAScript 2015，你可以编写比以前更多的 OOP 风格的代码，但这也是编写函数风格代码的一个非常好的地方。”(TypeScript 本身完全是用函数式代码编写的，根本没有类)。

处理这些请求的功能性方法更多的是使用对象类型声明来描述各种请求形状，每个对象类型声明都有一个判别属性。例如，您可能有一个“kind”属性，它在一个声明中具有文字类型“get”，在另一个声明中具有文字类型“update”，在第三个声明中具有文字类型“delete”然后，通过为每种可能性声明一个联合类型，您可以说请求可以是这些对象中的任何一个。所以现在你已经描述了，在一个封闭的世界里，所有可能的事情，你已经描述了判别式。"

## 形式化

“我们只是将常用的模式形式化，但这允许你让编译器验证你处理了所有可能的请求，并且你没有访问这个请求的属性，而这些属性实际上属于不同类型的请求，”他说。

熟悉函数式语言的开发人员应该对此耳熟能详。“这是函数式编程的 ADT 的 JavaScript 形式化——抽象数据类型——在这里，你声明一个记录可以具有的所有不同形状，并对它们进行模式匹配。”但有趣的是，TypeScript 团队不必更改 JavaScript 来支持这一点。“这是通过声明联合类型来完成的，这些联合类型是带有歧视的接口的联合，并使用 switch 语句来进行模式匹配，但这并没有在 JavaScript 中添加任何新的语言结构！”

正如 Hejlsberg 在他的职业生涯(现在包括在微软的 20 年)中所做的几乎所有事情一样，这不是为了函数式编程而函数式编程；这些模式基本上与开发人员的生产力有关。“我们正在做的事情…当你坐在一个愚蠢的编辑器中键入 JavaScript 时，你的脑海中已经有了这个画面，但你的工具却没有。即使你已经有了自己的想法，还是有很多细节可能会出错。如果你能教会工具用你思考代码的方式来思考你的代码，那么这个工具会更有帮助。这就是我们正在做的，将人们编写 JavaScript 时使用的这些常见范例和习惯用法正式化。”

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>