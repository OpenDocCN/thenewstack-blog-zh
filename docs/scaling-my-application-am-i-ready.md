# 扩展应用程序的开发者指南

> 原文：<https://thenewstack.io/scaling-my-application-am-i-ready/>

[](https://www.linkedin.com/in/powellronald/)

 [罗恩·鲍威尔

罗恩拥有空间物理学背景，曾作为卡西尼小组成员分析土星磁层中的等离子体。他现在在加州旧金山的 CircleCI 公司工作，作为一名开发人员，倡导开发内容，使开发人员能够更快地构建、测试和部署他们的项目。此前，他是美国三星电子的开发人员，专门从事 360 度视频制作和虚拟现实硬件、可穿戴设备和物联网应用的开发。](https://www.linkedin.com/in/powellronald/) [](https://www.linkedin.com/in/powellronald/)

大多数应用程序都是从中小型用户群开始的。即使有了迁移项目，您也不会立即向整个现有用户群开放您的新应用程序。相反，你可以先在一些内部用户中进行测试，然后向早期采用者开放。

尽管如此，如果您的应用程序成功了，在某个时候您将面临扩展它的需求。

需要扩展是一个很好的问题。这意味着你的应用程序很受欢迎，需要发展。应用程序有许多需要扩展的地方。例如，它可能需要根据所提供的功能进行扩展，或者需要根据处理或存储进行扩展。在本文中，我们将重点关注每日活跃用户或单位时间内的请求数。

提高扩展效率是最难解决的问题之一。虽然没有灵丹妙药可以提高每个应用程序的效率，但有一些策略和技术可以应用于许多场景。当你开始决定扩展你的应用时，我们将讨论一些需要考虑的问题。

## 要扩展什么以及扩展到什么程度？

在高层次上，当我们需要增强应用程序处理更多用户和请求的能力时，我们应该考虑两种类型的伸缩(相对于添加特性或功能)。

首先，**我们可以通过提供更强大的硬件来扩展应用程序处理请求的能力**。这种方法的优点是它不需要改变应用程序代码——你只需要在一个更强大的服务器上运行它。但在某种程度上，不可能增加更多的处理能力、更大的附加存储、更快的网络或额外的内存。

第二，**你可以通过增加额外的机器**来扩展。这种方法让您可以利用多台商用服务器来完成这项工作。然而，为了充分利用网络性能和工作分配，您可能需要优化您的应用程序代码——并可能重新设计应用程序(尽管这样做会使进一步的扩展更容易)。

如果你从一个单一的应用开始，那么扩展硬件可能是你的第一选择。在这里，您只需要为更快的机器提供更多的处理器和额外的内存，让代码运行得更快。

然而，只要您能找到更强大的硬件，这只会使应用程序的单个实例运行得更快。如果您想要进行全局扩展，即能够以最低的延迟要求为全球受众提供应用程序服务，您需要对您的工作节点采取地理分布方法。这意味着在世界各地的数据中心增加更多的机器，在那里它们可以提供低延迟的响应。

这就是使用微服务方法变得有价值的地方:您可以将您的应用程序分割成多个专用服务，然后将这些服务分类并部署到 Kubernetes 集群中。

## 首先自动化

虽然在某些时候扩展是必要的，但首先看看如何优化当前的应用程序是一个好的做法。在您进行扩展之前，有几个开发和部署实践是有帮助的——当您进行到这一步时，它们也使扩展变得更容易。

**首先，为了验证你的应用程序的有效性，你应该有适当的测试覆盖率。**确保你有有效的单元测试和回归测试覆盖范围，也可以防止由于随后扩展所需的代码库的任何变化而产生的问题。

理想情况下，所有的测试工作都应该是完全自动化的，并且应该在每个构建中运行。[持续集成管道](https://circleci.com/blog/what-is-a-ci-cd-pipeline/)是其中的关键部分。[持续集成(CI)](https://circleci.com/continuous-integration/) 确保代码变更在您的主分支中被自动测试和合并。连续交付会自动将更改部署到试运行或生产基础架构，但前提是它已经通过了连续集成测试和检查点。

在部署阶段，您仍然可以运行回归测试，例如，在压力测试中验证性能。这为任何增强提供了基础。

您还可以自动配置资源。如果你采用代码化的基础设施(IaC)方法，使用像 T2 哈希公司(HashiCorp)的 T4 Terraform 或亚马逊网络服务(Amazon Web Services)这样的工具来自动供应和配置服务器，你甚至可以测试和验证用来创建你的基础设施的配置代码。迁移也可以至少是半自动的，从而带来高度的灵活性。

## 扩展数据存储

在任何应用程序中，最难扩展的是数据库。核心问题由[上限定理](https://en.wikipedia.org/wiki/CAP_theorem)解释:

*   **一致性** —每次读取都会收到最近的写入或错误。
*   **可用性** —每个请求都会收到一个(无错误)响应，但不能保证它包含最近的写入。
*   **分区容差** —尽管网络在节点间丢弃(或延迟)了任意数量的消息，系统仍会继续运行。

对于一个数据库系统，以上三点只能选择两点。例如，如果您重视一致性和可用性，就要放弃分区容错。因此，您的数据库系统将产生单个节点实例(可能带有回退/只读镜像)。

一些现有的数据库系统解决了这个问题。例如，许多 NoSQL 系统(比如 MongoDB)都包含分区。另一方面，经典的关系数据库系统(如 MySQL)在有足够资源的情况下仍然可以扩展。但它仍有其局限性。您可以使用表分区和分片来扩展它的功能，这可能很难使用，并且需要重新构建表模式。

**第一步是计算您的数据库系统需要为预期负载处理多少流量(或存储容量)**。知道这个数字是至关重要的。在耗尽硬件能力之前，您应该考虑软件优化。通常情况下，数据库查询以及写操作都可以得到优化。这不仅可以节省所需硬件的费用，还可以让您的应用程序处理更多的用户。

引入高效的缓存层也是事半功倍的好方法。当迁移到更分布式的架构时，比如微服务，不管怎样，您最终都会得到一些缓存实例。许多开发团队通过快速、易用的内存数据存储(如 Redis)将缓存引入到他们的系统中。虽然完整页面或 API 请求可能是合适的目标，但是一些昂贵的数据库查询可以很容易地被缓存。

## 扩展文件存储

与一般的数据存储类似，您最终需要考虑分布式文件存储。从定义上来说，将文件存储在附加甚至集成的磁盘上是一个瓶颈。虽然使用网络连接存储(NAS)甚至存储区域网络(SAN)可能对本地系统有所帮助，但您也可以利用云服务来完成这一常见任务。

像 AWS 和 Azure 这样的云提供商有专门的服务来上传和下载文件。这些服务不仅提供了地理分布、缓存、碎片、检查等选项，还允许设置访问文件(读写)的策略。

使用云提供商的一个好处是潜在的 IO 使用。传输文件——尤其是数百 MB 甚至数 GB 的大文件——会对您的网络容量产生巨大影响。利用云提供商的网络可以节省处理应用请求的带宽。请注意，云出口成本可能会很快变得昂贵，因此尝试提前计算您的预期带宽使用量，以避免任何意外。

所有这些都假设您有很多文件、大文件，或者两者都有。如果您只有几个较小的文件，那么使用您自己的分布式和高效的数据库系统来存储和检索它们就足够了。

## 交通优化

即使数据和文件存储是完全分布式的，并且很容易扩展，您的应用程序也可能性能不佳。原因是单一的入口点形成了一个天然的瓶颈。有多种技术可以缓解这一问题。

**DNS 轮换消除了只有一个 IP 接收所有发往我们域名的请求的情况。**然而，即使你有多个入口点，但是在它们后面仍然有应用程序的单个实例。

**另一种技术是使用负载均衡器在多个运行实例之间分配流量。**这是使用云提供商的另一个优势。他们有隐式使用负载平衡器的服务，同时也提供显式负载平衡器。例如，在 AWS 上，您可以利用 Amazon 弹性负载平衡器来分发传入流量。

一般来说，您可以使用软件定义的网络和资源编排器的功能。Kubernetes 的内置负载平衡器就是一个例子。或者，考虑像 HAProxy 这样用于负载平衡的专用软件。

## 连续缩放

扩展您的应用程序可能会令人生畏。从单个应用程序组件的角度来考虑，您可以**设计一个计划来确保这些组件的适当伸缩——以及最终整个应用程序的伸缩。**

不要试图为*任何事情*做准备，试着想想具体的情景，并决定如果这种情景发生你将如何应对。一定要包括有利的场景——比如业务翻倍，增加对扩展到新区域的支持，或者推出新产品和新功能——而不仅仅是你想避免的问题。

**一个好的 CI 工具是必不可少的，它可以帮助你在扩展时保持灵活性，从而避免最初过度设计的诱惑。**它让您保持资源的精简、集中和有针对性，并让您快速自信地扩展。

CI 的采用也改变了开发团队文化。当谈到开发团队的成功时，找到正确的 [DevOps 度量标准来衡量](https://circleci.com/blog/engineering-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogScaling)是至关重要的。了解[在](https://circleci.com/blog/how-to-measure-devops-success-4-key-metrics/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogScaling) [2020 年软件交付状态:工程团队的数据支持基准](https://circleci.com/resources/2020-state-of-software-delivery/?utm_medium=content&utm_source=thenewstack&utm_campaign=content-thenewstack-content-2022q1---blogScaling)中，如何用四个关键基准来衡量开发运维的成功。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>