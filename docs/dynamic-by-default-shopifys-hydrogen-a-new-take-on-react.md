# 动态默认:Shopify 的氢，一个新的反应

> 原文：<https://thenewstack.io/dynamic-by-default-shopifys-hydrogen-a-new-take-on-react/>

Shopify】发布了一个新的基于 React 的网络开发框架，叫做[氢](https://hydrogen.shopify.dev/)。它是开源的，现在可以作为开发者预览版获得。Hydrogen 类似于 [Next.js](https://nextjs.org/) ，可能是最流行的 React 框架，只是它是专门为电子商务开发人员的需求而构建的。另一方面，Hydrogen 是在“商业需要动态”的前提下开发的，这意味着重点是快速的服务器端渲染。这与客户端渲染的默认 React 方法相反。

我与 Shopify 的首席工程师伊利亚·格里戈利克进行了交谈，以了解该公司为什么为其电子商务客户建立了一个定制的 React 框架，以及它如何融入现有的 JavaScript 框架生态系统。

## 氢气与 Next.js 和 Jamstack 相比如何

 [理查德·麦克马努斯

Richard 是 New Stack 的高级编辑，每周撰写一篇关于 web 和应用程序开发趋势的专栏文章。此前，他在 2003 年创立了读写网，并将其打造为全球最具影响力的科技新闻和分析网站之一。在 Twitter @ricmac 上关注他。](https://twitter.com/ricmac) 

在一篇介绍性文章中，格里戈利克将 Hydrogen 描述为“一个基于 React 的框架，针对商业进行了优化，并专门由 Shopify APIs 和基础设施提供支持。”所以我开始问他为什么现有的 React 框架——比如 next . js——不能满足他们的需求？

为了回答这个问题，他详细解释了 React 框架是如何分支的。他首先谈到了“传统反应”，即“一切都在客户端进行，一切都在客户端完成，这样做会损失很多性能，因为你没有利用服务器端的渲染。”然后，他将这种方法与最近的 Jamstack 方法进行了比较，在 jam stack 方法中，预先构建文件并通过边缘网络交付文件是很常见的。但这对 Shopify 来说也不合适，因为“作为一名[Jamstack]开发人员，你进入了非常复杂的前端开发世界，所有这些 JavaScript 开始增加，变得非常棘手，非常难以管理。”他引用了在电子商务中很常见的 A/B 测试，作为在 Jamstack 中可能变得过于复杂的开发人员任务的一个例子。

“所以，我们看到了差距，”格里戈利克继续说道，“当我们调查现有的工具时，很难——不是不可能，但真的很难——让服务器端渲染和动态商务很好地协同工作。”

因此，Hydrogen 比传统的客户端 React 更接近 Jamstack 方法——除了它旨在使前端开发不那么复杂。正如格里戈利克所说，Shopify 的框架帮助开发者“解锁快速的服务器端渲染，同时仍然以一致的方式拥有 A/B 测试的可选性——以及所有这些事情。”

## 为什么是 React 而不是 Web 组件？

因此，如果 Shopify 开发人员需要更少的复杂性，为什么不选择一个基于 web 组件的框架呢？正如独立开发者 Jared White 在 Twitter 上评论[的那样，web 组件将“允许 Hydrogen 与任何 JS 视图库一起使用”——而不仅仅是 React。](https://twitter.com/jaredcwhite/status/1457773898192195593)

格里戈利克回答说，React 只是 Shopify 最务实的选择。

“我们与我们的商家进行了交谈，他们响亮而清晰地告诉我们，他们中的大多数都在使用 React，并且可以轻松访问 React 工具的开发者生态系统。所以这是一个明显而正确的起点。我们与 React 核心团队一起工作，从性能和功能的角度来看，找出即将出现的东西，以及它如何才能最好地应用于商业。因此，我们能够利用他们即将推出的一些技术，如 React 服务器组件，并与他们合作进行验证，并在 Shopify 上实际证明。”

## React 服务器组件的角色

React 服务器组件(RSC)是 React 团队在去年[年底](https://reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html)推出的一个实验性特性。Next.js 也利用了 RSC，这是这两个框架的另一个相似之处。Next.js 背后的公司 Vercel 在今年早些时候写道，React 服务器组件“允许开发人员构建跨服务器和客户端的应用程序，将客户端应用程序的丰富交互性与传统服务器渲染的改进性能相结合。”

我问格里戈利克，RSC 在《氢》中的使用和在 Next.js 中的使用有什么不同？

“我们是他们正在建造的东西的忠实粉丝，”他在谈到 Vercel 和 Next.js 时说，“在许多方面，架构是相似的。但是他们正从另一个方向接近它。Vercel 是关于:构建它，将其推到边缘，[然后]添加动态功能层。我们认为，鉴于商业的需要，我们实际上需要从相反的方面着手。也就是说，假设默认情况下一切都是动态的，然后将正确的 API 和功能公开为静态的。”

尽管“默认动态”是 Hydrogen 的立场，但这并不意味着在框架中没有呈现静态文件的位置。事实上，格里戈利克在他的介绍性文章中写道，“这不是一场关于动态与静态的辩论。两者你都需要。”他指出“一些，或者甚至一些店面的大部分”可以“从边缘缓存和服务”(传统的 Jamstack 模型)。

格里戈利克说，事实证明，动态优先的方法是 Shopify 客户的首选。然而，他认为关键是让供应商能够根据需要灵活地分散 React 的传统客户端功能。开发者还可以调整其他选项，例如选择特定的时间范围来缓存某个页面。

“不是把所有的事情都推给客户端，或者要求你在服务器上做所有的事情，”格里戈利克说，“我们是说，看，你有 React 的全部能力。如果你想在客户身上做 React 擅长的事情，请便。但与此同时，您还拥有能够编写运行在服务器上的 React 代码(JavaScript 代码)的所有优势。”

## 回应社区反应

最后，由于 React 革命的大部分是由客户端渲染和服务器端渲染的最小化驱动的，我想知道 React 社区对 Shopify 逆转这一趋势的反应如何？

为了回答这个问题，格里戈利克提到了 React 服务器组件，Shopify 已经为此工作了五个月(其中三个月与 React 团队密切合作)。

“我们在 Shopify 的一个优势是，我们正在重新开始。我们没有一个现有的应用生态系统，无法迁移到 React 服务器组件的新世界。”

格里戈利克说，因为选择使用氢的 Shopify 客户将使用 JavaScript 重新建立他们的店面，Shopify“愿意在技术选择上做出一些更有见解和前瞻性的赌注”。因此，它选择围绕 React 服务器组件构建，并创建一个“默认动态”框架。

## 服务器端又回来了…是吗？

在通过 React 进行客户端渲染风靡多年之后，看看 Hydrogen 是否会导致 web 开发人员大量回归服务器端方法将是一件有趣的事情。

记住，React 团队仍然把 React 服务器组件看作是一个半成品。Next.js 当然在尝试这种方法，但 Shopify 在这一方法上走得更远。这种新的、现代的服务器端呈现形式是否能适用于更广泛的网站，而不仅仅是电子商务，还有待观察。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>