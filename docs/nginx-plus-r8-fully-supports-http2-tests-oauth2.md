# NGINX Plus R8 完全支持 HTTP/2，现场测试 OAuth2

> 原文：<https://thenewstack.io/nginx-plus-r8-fully-supports-http2-tests-oauth2/>

将一个网站的内容分割成多个任意的域来提高性能[仍然被认为是 Web 服务器的合法做法](http://chimera.labs.oreilly.com/books/1230000000545/ch11.html#HTTP11_MULTIPLE_CONNECTIONS)。它仍然是绕过 HTTP 1.1 的每台主机最多六个连接的限制的最好方法，对于 Internet Explorer 7 这样的旧浏览器，这种限制甚至更苛刻，只有两个连接。

HTTP 1.1 不是为支持我们今天实际使用的 Web 而设计的，更不用说它作为微服务世界的传输协议的不足了。去年 9 月，NGINX 推出了其商业网络服务网关 NGINX Plus 的第 7 版。随之而来的是对 HTTP/2 的首次支持，这是 IETF 于去年 2 月批准的现代传输协议，使得服务器和浏览器之间的信道复用受到每台主机 6 个甚至 8 个同时连接的限制。

周二，NGINX 宣布发布第 8 版。根据 NGINX 产品负责人 Owen Garrett 的说法，NGINX Plus Release 8 和它四个月前的版本之间的差异不仅相当大，而且实际上比 Release 7 更适合 HTTP/2。

## 黄金时间玩家准备得越充分

“去年 9 月，我们小心翼翼地向用户解释，他们不应该把它作为生产解决方案，”加勒特告诉我们。“我们发布它是作为该技术的预览版，允许用户开始从 SPDY 迁移到 HTTP/2 的任务。”SPDY 是由谷歌首次提出的下一代 HTTP 协议[。SPDY 的一些组件确实在最终的 HTTP/2 草案中被采用，](http://readwrite.com/2012/03/29/microsoft-sees-googles-hand-fo)[谷歌在 2015 年 1 月开始为其 Chrome 浏览器的版本 40 推出 HTTP/2 支持。但即使在那时，SPDY 也很慢地走向了夕阳。](https://googlechromereleases.blogspot.com/2015/01/stable-update.html)

“我们出于几个原因分享了这些警告，”加勒特继续说道。“一个是我们自己的代码可能不成熟——支持 HTTP/2 所必需的产品核心有大量重大变化。但更重要的是，当时大部分网络用户还没有转向支持 HTTP/2 的网络浏览器或平台。SPDY 仍然占主导地位。”

由于与用户进行了相当多的磋商，NGINX 现在感到更有信心，NGINX Plus 第 8 版中的 HTTP/2 实现已经准备好部署在组织的生产阶段。Garrett 指出，内容交付网络 CloudFlare 是一个主要互联网服务的例子，现在在生产中使用 R8 代码。

“所以就生产准备而言，绝对是，它现在就在那里，”他说。

尽管网络浏览器制造商开始让他们的用户远离谷歌的 SPDY 协议已经整整一年了，但 Garrett 说，他的公司自己的数据显示，直到现在 HTTP/2 和 SPDY 的使用水平才相遇。他认为，现在 Web 服务可以安全地开始拆除域分片的做法，并停止创建虚假域来绕过过去时代的协议限制。

微服务架构现在可以将网络从超文本的传送器变成数字服务的促进者。但是仅仅打开多路复用的闸门和每台主机更多的连接还不足以实现这一点。

## 再次认证服务，而不是人

因此，现在 NGINX 发现自己拥有了它认为成熟的、产品化的 HTTP/2 支持版本，它也必须采用不会成为微服务瓶颈的认证系统。出于这个原因，该公司正在引入它所谓的对 [OAuth2](http://oauth.net/2/) 支持的“初始版本”,它增加了认证来自同一来源的大量网络服务的新工作流程。

Garrett 指出:“很少有不验证 API 事务的情况。“但是开发人员面临的挑战是很难正确进行身份验证。OAuth 正在成为一个非常好的认证标准。它将用户信息与应用程序分开，因此允许您针对一个实体进行身份验证。”

最初的 OAuth 允许主要的登录提供商，如脸书或谷歌，来保证用户的真实性。但是，这又是一种[涉及用户](http://www.informit.com/guides/content.aspx?g=windowsserver&amp;seqNum=155)的情况。

“想象一下一个微服务环境，其中有几十个或几百个单独的服务，它们都需要知道用户是谁。NGINX 负责人解释说:“每个实例单独执行认证是不可行的。“这给开发人员带来了很大的负担，也给服务器带来了很大的负担，并且使安全环境变得更加广泛和复杂。”

他说，NGINX 的计划是通过 Release 8 解决这个问题，就像 Release 7 解决 HTTP/2 问题一样。新服务器将保留微服务的安全凭证，然后只将经过身份验证的流量转发给它们。因此，微服务可以信任离他们更近的来源，而不是利用谷歌或脸书，或者更像社交网络的东西。

“通常，您的应用程序使用 SSL 和 PKI 等标准技术部署在可信环境中。因此，一个微服务实例可以信任 NGINX 作为一个流量来源，”他评论道，“它可以从我们发送给该服务的请求中提取认证数据。这在实践中意味着，开发人员可以更容易地确定谁是访问其 API 的一方，这样他就可以在上面放置自己的访问控制器、日志或任何[安全服务]，这样他就不必担心身份验证是针对脸书、谷歌、最终用户还是远程客户端进行的。”

## 坚持是有回报的

除了更成熟的 HTTP/2 和 OAuth2 更大的开始之外，NGINX Plus Release 8 还增加了持久配置，Garrett 承认这并不是他公司路线图上的一项功能。他说，在这个 API 的早期版本中，可以追溯到 2014 年，用户可以对 NGINX 的配置进行快速和临时的更改——例如，指示服务器何时停机维护或停止维护。但是每当 NGINX 被重新加载时，那些临时的配置更改就会被丢弃。

但是在微服务环境中，应用程序会在很短的时间内改变它们的整个上下文。客户不仅开始要求他们的配置更改是永久性的，而且要求 NGINX 以某种方式与他们的应用程序配置数据库相集成——因此在那里所做的更改可以立即反映在服务器上。

Owen Garrett 解释说:“因此，在这个版本中，我们采用了 API，并使其具有持久性。“我们将发布解决方案，展示如何通过两个公共服务数据库使用 API，这将允许用户在微服务环境中部署服务，并以非常非常简单、轻量级、可靠的方式向 NGINX Plus 注册这些服务。”

卡尔斯滕·乌烈芝在知识共享 2.5 下授权，在伦敦科学博物馆展示了查尔斯·巴贝奇的差异引擎的复制品

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>