# 为什么 GitLab 转向持续交付不能等待 Kubernetes

> 原文：<https://thenewstack.io/why-gitlabs-move-to-continuous-delivery-couldnt-wait-for-kubernetes/>

[](https://twitter.com/pritianka)

 [普里扬卡·夏尔马

普里扬卡是 GitLab 的技术传道部主任，并在云计算原生计算基金会(CNCF)的董事会任职。她在 DevOps 和可观察性方面有很深的专业知识。Priyanka 是一名前企业家，热衷于通过开源社区开发开发人员产品，她在 HeavyBit industries 为初创公司提供咨询，heavy bit industries 是开发人员产品的加速器。她拥有斯坦福大学的政治学学士学位，业余时间喜欢阅读和与她的狗奥利玩耍。](https://twitter.com/pritianka) [](https://twitter.com/pritianka)

当今生态系统的叙事是关于[持续集成/持续交付](https://thenewstack.io/category/ci-cd/) (CI/CD)。为了追求难以捉摸的 DevOps 文化和最短的周期时间，公司面临着迅速采用最时髦技术的压力。这是 GitLab 反其道而行之的故事，也是为什么。

在 GitLab，我们在每月的第 22 天发布新闻稿，以帮助我们的大型自我管理产品保持一致性。我们正在向 Kubernetes 迁移，随着功能开发速度的提高，我们需要比过去更加频繁地进行部署。但是，我们没有使用 Kubernetes 完全实现现代化，然后启动 CD，而是选择通过使用我们现有的遗留工具和大量 smarts 将我们现有的 CI/CD 系统推向极限。这是我们如何成功的故事，包括人类和字节大小，通过使用最具成本效益的 [枯燥的解决方案](https://about.gitlab.com/handbook/values/#boring-solutions) 来启动 CD。

## **为什么是 CD？**

“周期时间的压缩可能是决定科技领域赢家和输家的最被低估的力量，”入选万维网名人堂的硅谷最杰出的企业家之一马克·安德森说。

工程团队以功能的形式交付客户价值。为了保持竞争力，企业需要尽可能快速有效地交付软件。通过将 DevOps 生命周期左移，工程团队可以压缩周期时间，加快创新步伐。

在 GitLab，我们不仅仅交付最小可行产品(MVP)甚至最小可行特性(MVF)，而是始终专注于创建[【MVC】](https://about.gitlab.com/handbook/values/#minimum-viable-change-mvc)。我们通过专注于我们能为客户提供的价值，无论多么微不足道，来保持低水平的羞耻和高效率。例如，因为我们的工程师的任务是始终创造迭代创新，我们经常传递闪亮的新技术，以考虑更成熟稳定的解决方案，这些解决方案可以为我们的客户提供真正的商业价值。通过发布 MVC，工程团队可以获得许多好处:

1.  获得反馈，更快地学习。
2.  任何一个变化带来的风险都要小得多。
3.  取消小变动的能力要容易得多。
4.  学习提高更快。

例如，GitLab 交付团队的工程经理 Marin Jankovski 认识到我们需要将 GitLab 转移到 CD 上。但是交付团队没有等待实现新的工具，而是选择强调我们可用的资源，并让我们的工程师习惯于用 CD 思维工作。

### **将我们的系统转移到 CD 如何产生立竿见影的效果**

通过快速扩展到 CD，我们从每周部署变为每天部署，并能够在两小时内将代码发送到 canary。对于习惯于每周部署的人来说，能够在两个小时内从提交到金丝雀已经完全改变了他们的世界。

在 CD 之前，任何被合并的变更都可能需要一天到几天的时间才能投入生产。基本上，至少需要一天的时间才能将任何更改纳入试运行环境。通过使用我们当前的传统 CD 工具系统，我们从 2019 年 5 月的 4 次部署增加到 2019 年 7 月的 24 次部署，加快了我们的交付时间，而不必等到 Kubernetes 完全实施后才能看到结果。

我们已经达到了系统的极限，但是我们已经从 CD 中获益。在我们继续使用 Kubernetes 更新 CD 系统组件的同时，我们的工程团队仍在协同工作，开始迁移、扩展和管理向 CD 的转移。

### **我们如何在不使用 Kubernetes 的情况下转移到 CD 上**

GitLab 运行在 GitLab 上，在虚拟机(VM)上使用 [Ansible 脚本用于 CD](https://about.gitlab.com/2019/07/01/using-ansible-and-gitlab-as-infrastructure-for-code/) 。同样，如上所述，我们还没有实施 Kubernetes 来满足我们所有的 CD 需求。相反，我们正在采取不寻常的步骤，将我们的遗留工具的能力推到边缘。方法如下:

1.  我们在所有环境中都使用虚拟机，并且都有综合包。
2.  Kubernetes 给我们的脚本用于协调所有的虚拟机。
3.  Kubernetes 需要工作的所有细节都在 Ansible playbooks 中。
4.  出于法规遵从性要求，我们仍然手动部署到生产环境中。

诚然，我们已经在使用一些 Kubernetes 用于审查应用程序(供开发人员查看他们代码更改的影响，类似于本地主机，除了不是本地的)和 [功能标志](https://about.gitlab.com/2019/08/06/feature-flags-continuous-delivery/) 作为我们走向 CD 的一部分。

我们在当前 CD 系统上使用的 Kubernetes 的组件允许工程师实时审查他们代码的任何更改，而不必等待部署。管道自动创建应用程序的审查实例，并使用 Kubernetes 部署应用程序。现在，开发人员可以审查代码变更并进行质量评估，而不必等到代码部署完成。

### **在我们的工程团队中建立文化变革**

将我们的传统 CD 系统推向极限的最大好处是随之而来的文化变革。到了全面实施 Kubernetes for CD 的时候，我们的工程团队将已经经历了实施 CD 的成长过程。

以下是一些结果:

1.  **QA 为王。现在，质量是所有工程师的第一要务。我们的评论应用程序可以帮助开发者准确地看到他们推送的内容。虽然没有生产数据，但是任何开发人员，甚至是前端工程师，都可以马上看出哪里出了问题。审批者也有更多的责任。既然识别问题变得更加容易，批准者就应该标记它们。**
2.  **不再进行热修补。嗯，几乎没有。我们唯一一次热修补(登录虚拟机并使用 diff 更改生产代码)是在某个东西是 p1 *和* S1 的情况下。对于某些用户来说，p1 的优先级为 1，s1 的严重性为 1，因为它会影响大部分用户或非常重要的客户。**
3.  **所有开发人员现在都在随叫随到。**迁移到 CD 后，我们在三周内实现了我们三年来一直在谈论的目标。由于 QA 规则的严格性，开发人员要对他们的代码负责并携带寻呼机。

任何管理工程团队或组织的人都会认识到，这些是巨大的文化转变，而且它们肯定不容易实现。但是，我们从传统 CD 系统开始并最大限度地发挥其能力的方法奏效了，我们的工程团队也转向了 CD 思维模式。接下来，我们计划通过完全采用 Kubernetes 来投资我们的预算时间。

请跟随 GitLab 分享我们在实施 Kubernetes 方面的扩展过程、挑战和成功。我们确信将会有更多激动人心的发展。

*如需更多案例研究讨论和 CI/CD 最佳实践，请参加 9 月 17 日的[git lab Commit Brooklyn](https://about.gitlab.com/events/commit/)。GitLab 的首次用户活动将通过战略和技术讨论、经验教训、开发生命周期的幕后观察等展示 DevOps 的强大功能。*

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>