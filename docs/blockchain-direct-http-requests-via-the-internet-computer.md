# 区块链通过互联网计算机直接 HTTP 请求

> 原文：<https://thenewstack.io/blockchain-direct-http-requests-via-the-internet-computer/>

尽管 Web3 对一切都发生在区块链的未来充满乐观，但我们离现实还有很长的路要走。绝大多数有用的数据是在传统的数据中心或云计算基础设施中生成的，并使用熟悉的工具进行交互，这些工具主要利用 HTTP 或 HTTPS。

运行在任何第 1 层区块链上的分散式应用程序，如以太坊或 Solana，使用所谓的 oracle 与基于 HTTP 的服务接口。这些 oracles 充当可信中间件，允许创建混合智能联系，其中链上代码可以与链外基础设施和数据交互。Chainlink Network ，一个流行的分布式 oracle 网络，提供了一个简短的讲解视频。

[https://www.youtube.com/embed/6e7DmuYmXKw?feature=oembed](https://www.youtube.com/embed/6e7DmuYmXKw?feature=oembed)

视频

## 神谕的麻烦在于

虽然 oracles 是将 dApps(分散式应用程序)与链外数据和基础设施连接起来的主要手段，但它也有一些缺点。这些请求是间接的，这意味着您不是直接对您想要查询的数据源进行 API 调用——oracle 会为您完成这项工作，然后您的 dApp 需要信任 Oracle 返回的响应。这种方法还伴随着使用 oracle 作为第三方中介的相关费用。

[DFINITY Foundation](https://dfinity.org/) ，互联网计算机的最大贡献者之一，第一层区块链，正在提出一种替代方法，dApps 可以使用集成到区块链中的 API 直接发出 HTTP 请求。

在与新堆栈的访谈中，DFINITY 基金会的技术项目经理 Dieter Sommer 解释了以这种方式依赖 oracles 的挑战。“每个想做任何合理事情的人都需要某种形式的与 Web 2 的集成，所有其他区块链人都为此使用神谕，”他说。“oracle 是外部服务，所以如果你依靠 oracle 连接到 Web 2，Oracle 会做所有的 HTTP 工作。这也意味着你引入了许多新的信任假设；例如，在使用 Chainlink oracle 的标准模型中，您调用一个 oracle 提供商，该提供商需要得到您的信任，这是一个非常弱的模型。”

## 直接进行 HTTP 调用的 API

DFINITY Foundation 使用一些略有不同的术语来解释互联网计算机区块链基础设施是如何工作的。在互联网计算机协议的基础上，互联网计算机托管称为罐的智能合约，这些罐是 WebAssembly 字节码和运行该代码的内存页面的组合。部署一个罐意味着相应的代码和状态被复制到它所部署的子网上的所有节点。

这种复制的概念是今天大多数区块链使用 oracles 发出 HTTP 请求的原因之一。在当前互联网计算机的设计中，每个复制品将对外部服务进行相同的 HTTP 调用。但是返回给每个副本的 HTTP 响应可能是不同的，因为时间戳或 id 可能会有变化。当所有副本都得到稍微不同的响应时，就不可能达成共识，这实际上破坏了子网。

在即将发布的互联网计算机 Chromium 中，有一种新的方法来解决这个问题，并使用 API 进行 HTTP 调用，为区块链提供直接集成。这消除了使用 oracle 所需的信任假设，理论上简化了访问链外数据的过程。

通过管理罐提供的异步 API，每个节点都将发出相同的 HTTP 请求。当每个节点收到一个响应时，它们对响应进行签名，并将其传播给其他节点。一旦共识图层聚合了足够多的签名，它将在区块链中包含响应。当块被终结时，响应被传递回执行层，执行层又继续发起 HTTP 请求的计算。

## 导航不一致的响应

当所有节点几乎同时收到相同的响应时，这种方法可以完美地工作。即使在恶意节点报告错误信息的情况下，只要有足够多的节点返回相同的响应，这也应该是可行的。

正如 Sommer 所说，“子网中的所有节点都发出请求，只有当共识成功时，也就是说至少有三分之二的副本同意结果，才会将结果回复给容器。这允许外部的安全呼叫，而不依赖任何外部第三方。我们的共识协议足够灵活，允许这种扩展。”

一个更复杂的场景是，请求在语义上是相同的，但是潜在地具有对计算结果无关紧要的微小差异。为了避免无法达成一致，您可以使用一个函数围绕这些不一致进行编码，该函数通过只显示计算所需的响应部分来转换响应。举一个例子，比如需要返回一个文本字符串，其中文本被打包在一个带有时间戳的响应中。如果文本字符串在所有情况下都是相同的，那么时间戳的不同并不重要，您可以使用函数来丢弃它们。

对于初始版本，只支持 GET 请求。较长期的计划也是支持员额请求。在观看详细介绍这一新功能的 DFINITY 基金会视频时，[d finity 的软件工程师 Ivan Malison](https://www.linkedin.com/in/ivanmalison/) 解释说 POST 请求更加复杂。他展示了一个信用卡支付的例子。你不希望尝试对同一张卡进行多次充值，或者对你的 POST 请求得到不同的响应，比如一次是成功消息，下一次是拒绝。该视频提供了 Stripe 对安全 API 重试的幂等性，作为将来如何正确实现这一点的示例。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>