<html>
<head>
<title>Off-The-Shelf Hacker: Automated Yard Watering Project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现成的黑客:自动化庭院浇水项目</h1>
<blockquote>原文：<a href="https://thenewstack.io/off-the-shelf-hacker-automated-yard-watering-project/#0001-01-01">https://thenewstack.io/off-the-shelf-hacker-automated-yard-watering-project/#0001-01-01</a></blockquote><div><div id="tns-post-body-content">


<p class="translated">我的最新项目<a href="/off-the-shelf-hacker-a-methodology-for-automated-yard-watering/" target="_blank">自动庭院浇水系统</a>的<a href="https://www.banggood.com/5V-8-Channel-Relay-Module-Board-For-Arduino-PIC-AVR-DSP-ARM-p-74110.html?rmmds=buy&amp;cur_warehouse=CN" target="_blank" rel="noopener noreferrer external " class="ext-link">八通道继电器板</a>最近已经放在我的工作台上。我还没有一个<a href="https://www.sparkfun.com/products/14277" target="_blank" rel="noopener noreferrer external " class="ext-link"> Raspberry Pi Zero W模块</a>，所以与此同时，我认为看看一个支持Wi-Fi的Arduino克隆(称为<a href="https://www.banggood.com/3Pcs-NodeMcu-Lua-WIFI-Internet-Things-Development-Board-Based-ESP8266-CP2102-Wireless-Module-p-1121409.html?rmmds=search&amp;cur_warehouse=CN" target="_blank" rel="noopener noreferrer external " class="ext-link"> NodeMCU </a>)能完成什么可能会很有趣。</p>
<p class="translated">我花了大约15美元从Banggood买了三个这样的设备。它们是小小的ESP8266板，将通用输入/输出(GPIO)输出到试验板友好的引脚，同时添加了稳压器和USB通信电路。一个无线(基于ESP8266-01)<a href="https://www.banggood.com/5V-ESP8266-Dual-WiFi-Relay-Module-Internet-Of-Things-Smart-Home-Mobile-APP-Remote-Switch-p-1270421.html?rmmds=search&amp;cur_warehouse=CN" target="_blank" rel="noopener noreferrer external " class="ext-link">双中继模块</a>可用于即插即用，价格约为8美元。</p>
<p class="translated">总结这个项目，我想用一个微控制器，一个继电器板和几个24伏的洒水电磁阀来控制我的院子里的洒水器。我们在最近的一个故事中讨论了这个过程。</p>
<p class="translated">今天，我们将看看如何将继电器板连接到微控制器，并使用一个程序来测试基本的继电器操作。下一篇文章将集成控制软件来驱动螺线管。当我得到一个Raspberry Pi Zero W时，我们将把它替换为NodeMCU模块，并尝试一下该配置。能够使用多种解决方案，稍加调整，是现成黑客需要开发的一项重要技能。</p>
<h2 class="translated">建立联系</h2>
<p class="translated">理想情况下，我们应该有一个间距为0.1 mm的10引脚连接器，用于将继电器板连接到微控制器。没有一个方便的，所以我把通常过时的硬盘驱动器电缆连接器减少到10个引脚，并将电线焊接到位。只需将连接器夹在老虎钳中，并用小锯或Dremel研磨盘切割塑料连接器。这是连接器的特写。</p>
<div id="attachment_6129273" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-6129273" decoding="async" loading="lazy" class="size-full wp-image-6129273" src="../Images/99c66ae826d60a73bcec1baac6f6bd7b.png" alt="" data-original-src="https://cdn.thenewstack.io/media/2018/11/df90e7db-relay-board-connector.png"/><p id="caption-attachment-6129273" class="wp-caption-text translated">继电器板上使用的被黑客攻击的硬盘电缆连接器</p></div>
<p class="translated">我发现最好是在试图连接之前，将焊料“接触”到引脚和导线的末端。老派黑客称这一过程为“<a href="https://www.mediacollege.com/misc/solder/tinning.html" class="ext-link" rel="external ">镀锡</a>”焊料中的助焊剂清洁引脚表面，并使焊料适当流动。然后将线的末端靠在引脚上，用最小的热量进行焊接。尽可能快地焊接针脚，否则针脚会熔化连接器中的塑料，并可能一起短路。</p>
<p class="translated">为了进行初步测试，我将所有的电线都削减到大约两英寸长，并使用一个小试验板来连接NodeMCU板。一旦我确定继电器板工作正常，我就从试验板上取下电线，将它们焊接到NodeMCU模块引脚的顶部。这个操作有点棘手，因为引脚之间的空间非常小。</p>
<div id="attachment_6129274" class="wp-caption aligncenter"><img aria-describedby="caption-attachment-6129274" decoding="async" loading="lazy" class="size-full wp-image-6129274" src="../Images/b156a975790a49fd67093da4e888c49d.png" alt="" data-original-src="https://cdn.thenewstack.io/media/2018/11/c132c052-nodemcu-pins.png"/><p id="caption-attachment-6129274" class="wp-caption-text translated">焊接到NodeMCU模块的导线</p></div>
<p class="translated">当处理试验板和原型项目时，我更喜欢使用22号实心线。将绞合线推入试验板时，它总是会分离。直的、实心的电线末端非常容易进入，并最大限度地减少短路或开路的可能性。</p>
<p class="translated">在网上找到八通道继电器板的好文档有点粗略。我不确定该板是在3.3伏还是5.0伏逻辑下工作。常规Arduino模块使用5.0伏逻辑，而Raspberry Pi和ESP8266板(NodeMCU)都使用3.3伏逻辑。事实证明这无关紧要。我只是把它挂起来试了一下。看看继电器板的通用<a href="http://wiki.sunfounder.cc/index.php?title=8_Channel_5V_Relay_Module" target="_blank" rel="noopener noreferrer external " class="ext-link">内部原理图</a>。</p>
<p class="translated">我将中继板上的接地引脚连接到NodeMCU板上的GND引脚。同样，继电器板上的VCC引脚连接到NodeMCU上的一个3.3伏引脚。13个数字GPIO引脚中的8个连接到继电器板以供使用和测试，因此您可以将剩余的引脚用于其他目的。还有一个标为A0的模拟输入引脚，我们目前没有使用。</p>

<p class="translated">谷歌有大量的<a href="https://www.google.com/search?q=nodemcu+pinout&amp;ie=utf-8&amp;oe=utf-8&amp;client=firefox-b-1-ab" target="_blank" rel="noopener noreferrer external " class="ext-link"> NodeMCU引脚排列图片</a>供你参考和娱乐。</p>
<p class="translated">确保继电器板右下侧的配置跳线(连接器面向前中心，继电器在后面)位于VCC和JDVcc引脚之间。忽略相邻的Gnd引脚。这个设置应该也适用于Raspberry Pi。对于NodeMCU和中继板来说，这是再简单不过的布局了。在编程阶段，将USB电缆连接到Linux笔记本电脑。</p>
<h2 class="translated">上传测试固件</h2>
<p class="translated">NodeMCU使用<a href="https://en.wikipedia.org/wiki/Lua_(programming_language)" target="_blank" rel="noopener noreferrer external " class="ext-link"> Lua编程语言</a>，并且已经加载到固件中。IBM有一个关于NodeMCU 的<a href="https://developer.ibm.com/tutorials/iot-nodemcu-open-why-use/" target="_blank" rel="noopener noreferrer external " class="ext-link">小介绍，如果你对他们的开发工具包和使用Lua感兴趣，你可以看看。我对这门语言没有任何经验，所以我选择为这个项目的这一部分编写常规的旧Arduino代码。也许，我们会在以后的文章中研究Lua，因为我还有另外两个NodeMCU模块可以试验。它看起来很容易使用。</a></p>
<p class="translated">Arduino IDE的当前版本支持NodeMCU模块。我在华硕Linux笔记本上下载安装了<a href="https://www.arduino.cc/en/Main/Software" target="_blank" rel="noopener noreferrer external " class="ext-link">1 . 8 . 7版</a>。确保选择“ESPduino (ESP-13模块)”作为板卡类型，否则固件上传将会失败。</p>
<p class="translated">接下来，我编写了ESP8266闪烁程序的示例代码，基本上使继电器板上的八个继电器闪烁。这是代码。<br/></p>
<div id="crayon-64204e077dc4c100850781" class="crayon-syntax crayon-theme-github-gist crayon-font-liberation-mono crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-always">
<p class="crayon-plain-wrap"/>
<div class="crayon-main">
<pre><span class="crayon-c">/*</span>
<span class="crayon-c">  NodeMCU - relay board test program</span>
<span class="crayon-c">  Sequentially turns each relay on and off for 2 seconds, loops forever</span>
<span class="crayon-c">*/</span>
<span class="crayon-h">  </span>
 
<span class="crayon-c">// the setup function runs once when you press reset or power the board</span>
<span class="crayon-e">void </span><span class="crayon-e">setup</span>()<span class="crayon-h"> </span>{
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">16</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">5</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">4</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">2</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">14</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">12</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
<span class="crayon-h">  </span><span class="crayon-e">pinMode</span>(<span class="crayon-cn">13</span>,<span class="crayon-h"> </span><span class="crayon-i">OUTPUT</span>);
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">16</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">5</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">4</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">2</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">14</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">12</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">13</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);
}
 
<span class="crayon-c">// the loop function runs over and over again forever</span>
<span class="crayon-e">void </span><span class="crayon-e">loop</span>()<span class="crayon-h"> </span>{
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">16</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">   </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">16</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">  </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">5</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">    </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">5</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">   </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">4</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">    </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">4</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">   </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">    </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">0</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">   </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">2</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">    </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
<span class="crayon-h">  </span>
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">2</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">   </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">14</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">   </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">14</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">  </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">12</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">   </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">12</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">  </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">13</span>,<span class="crayon-h"> </span><span class="crayon-i">LOW</span>);<span class="crayon-h">   </span><span class="crayon-c">// LOW lights optoisolator LED to ground - turns on relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
 
<span class="crayon-h">  </span><span class="crayon-e">digitalWrite</span>(<span class="crayon-cn">13</span>,<span class="crayon-h"> </span><span class="crayon-i">HIGH</span>);<span class="crayon-h">  </span><span class="crayon-c">// HIGH kills optoisolator LED - turns OFF relay</span>
<span class="crayon-h">  </span><span class="crayon-e">delay</span>(<span class="crayon-cn">2000</span>);<span class="crayon-h">             </span><span class="crayon-c">// wait for a 2 seconds</span>
}
</pre>
</div>
</div>

<p class="translated"><br/>我们首先用pinMode语句初始化引脚，然后开始引脚高电平状态。将引脚切换到低电平会打开继电器，因此默认情况下，引脚为高电平(+3.3伏)，意味着关闭。此时我们不需要任何特殊的库，因为我们只是打开和关闭GPIO管脚。稍后在集成wifi和MQTT功能时，我们将需要一些。</p>
<p class="translated">只要电路板接通电源，digitalWrite语句就会通过引脚步进，使继电器打开两秒钟，然后关闭两秒钟。</p>
<p class="translated">将固件上传到NodeMCU后，您应该会看到每个LED相继亮起，并听到继电器启动时发出的咔嗒声。</p>
<h2 class="translated">包裹</h2>
<p class="translated">我们已经看到了将NodeMCU连接到一个八通道中继板。布线简单明了。测试很容易，用一个强力眨眼程序。每个继电器中的开关触点可以处理10安培的240伏交流电或10安培的30伏DC，使设置适合各种电源开/关工作。我会用它来切换24伏的洒水螺线管在大约半安培。继电器的开关端与逻辑端完全隔离。</p>
<p class="translated">在接下来的文章中寻找升级设置以连接到我的本地网络并通过MQTT接收命令的内容。稍后，我们将换上一个树莓派Zero W，以获得更多的黑客乐趣。</p>


<div class="tns-logo-slug">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 68 31" version="1.1">
<title>Group</title>
<desc>Created with Sketch.</desc>
<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
<g id="Group">
<path d="M24.002,29.619 L29.77,29.619 L29.77,15.808 C29.77,15.038 29.622,11.265 29.59,10.414 L29.77,10.414 C31.424,14.019 31.473,14.147 32.168,15.322 L39.65,29.618 L44.845,29.618 L44.845,0 L39.075,0 L39.075,11.064 C39.075,12.197 39.075,12.44 39.182,14.472 L39.325,17.468 L39.151,17.468 C39.034,17.267 38.596,16.173 38.467,15.929 C38.164,15.323 37.725,14.512 37.373,13.905 L30.031,0 L24,0 L24,29.619 L24.002,29.619 Z" id="Path-Copy" fill="#FF3287"/>
<path d="M56.948,0 C50.745,0 47.606,3.43 47.606,8.296 C47.606,14.114 51.036,15.404 55.518,17.132 C60.438,18.853 61.782,19.332 61.782,21.539 C61.782,24.225 58.969,24.867 57.401,24.867 C54.579,24.867 52.493,23.342 51.536,20.858 L47,24.185 C49.43,28.937 52.145,30.185 57.713,30.185 C59.364,30.185 62.059,29.74 63.727,28.694 C67.779,26.156 67.779,22.22 67.779,20.898 C67.779,18.129 66.531,16.207 66.178,15.726 C65.049,14.121 63.032,12.918 61.25,12.278 L57.084,10.914 C55.073,10.267 52.928,10.105 52.928,8.019 C52.928,7.707 53.008,5.528 56.288,5.319 L61.465,5.319 L61.465,0 C61.465,0 57.342,0 56.948,0 Z" id="Path-Copy-2" fill="#00AFF4"/>
<polygon id="Path" fill="#00AFF4" points="5.32907052e-15 1.77635684e-15 5.32907052e-15 5.319 7.572 5.319 7.572 29.564 14.132 29.564 14.132 5.319 21.544 5.319 21.544 1.77635684e-15"/>
</g>
</g>
</svg> </div>

</div>
</div>    
</body>
</html>