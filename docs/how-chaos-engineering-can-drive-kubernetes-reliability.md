# 混沌工程如何提高 Kubernetes 的可靠性

> 原文：<https://thenewstack.io/how-chaos-engineering-can-drive-kubernetes-reliability/>

毫无疑问，停机是贵公司成功的最大风险之一。没有一个系统是万无一失的，所以在系统摧毁你的公司之前摧毁它会好得多(最好是在投入生产之前很久)。)

这是[系统弹性工程(SRE)](https://thenewstack.io/site-reliability-engineering-cloud-native-operations/) 的全部目标，也是促使网飞开始投资[混沌工程](http://principlesofchaos.org/)的原因，目的是——主要是使用自动化系统——在分布式系统上造成大范围的混乱、无序和破坏。从那以后，人们开始从事大规模释放受控混乱以推动业务和软件稳定的事业。

[chaos IQ](https://medium.com/chaosiq/improve-your-cloud-native-devops-flow-with-chaos-engineering-dc32836c2d9a)的工程师兼首席技术官 Sylvain Hellegouarch 解释说，混沌工程有一个很好的定义:

“询问有关您的系统在特定条件下的行为的问题，并让您能够安全地进行现场测试，以便您可以与您的团队一起查看是否存在真正的弱点，并了解正确的应对措施。”

到目前为止，新的 Stack 已经与 Loki-like chaos 的先驱们讨论了混沌工程的好处以及衡量其对商业方面的好处的方法。今天我们将讨论混沌工程最流行的用例——支持您的 Kubernetes 部署。

## 混沌工程如何推动 Kubernetes 的可靠性

Kubernetes 是 Docker 的市场领先的管弦乐队，在 Kubernetes 和云原生世界中，现在正在开发各种 Kubernetes 原生工具，以服务于其看似无限的受欢迎程度。一个主要领域是混沌工程，它正获得如此多的关注，以至于亚马逊网络服务研讨会的最新章节之一是关于将混沌工程应用于 Kubernetes。

然而，顾名思义，Kubernetes 的混沌工程有点无处不在。随着[云本地计算基金会](https://www.cncf.io/) (CNCF) [混沌工程工作组](https://github.com/chaoseng/wg-chaoseng)的启动，对该领域的自然编目的需求日益增长，部分是为了帮助绘制工具领域的地图。

“没有多少工具能够相互集成。我们需要一个社区来团结他们，”CNCF 的 Chris Aniszczyk 告诉 New Stack。“混沌社区仍处于萌芽状态。Kubernetes 现在是运行在所有云(公共和私有)上的分布式系统内核，而您需要 Kubernetes 之外的外部参与者。”

这个自举小组还希望提高工具之间的意识，这样他们就有希望一起工作，改进集成，实现更有用的混乱工作流。

Aniszczyk 表示，“像 Kubernetes 这样的云原生技术使组织能够在现代的动态环境中构建和运行可扩展的应用程序。这些技术使得松散耦合的系统具有弹性、可管理性和可观察性。它们允许工程师以最少的劳动频繁地、可预测地做出高影响力的改变。

“混沌工程是一门在分布式系统上进行实验的学科，目的是建立对系统承受生产中动荡条件能力的信心。在 CNCF，我们认为适当的混沌工程实践是构建真正的云原生系统的关键，并支持通过调查工作组和项目来推进这一学科。”

Aniszczyk 继续说，这是关于启用一系列实际上会造成故障的常见测试和场景，以便工程师可以了解如果出现问题会发生什么。

[我们已经报道了](https://thenewstack.io/gremlins-tammy-butow-on-the-business-side-of-chaos-engineering/)Gremlin 的失败服务如何被用于破坏商业目的，但现在让我们深入到另一个混乱优先工具[石蕊](https://openebs.io/litmus)，这是针对稳定存储的主题。

## 混乱中存储和保护 Kubernetes

当 Evan Powell 和 Uma muk Kara 创建 Maya data 时，他们的目的是为 Kubernetes 创造端到端的数据灵活性，因为“稳定的应用程序和数据库的爆发带来了真正的问题。”

MayaData 工具集包括容器原生、开源的 OpenEBS，用于提供、存储和保护 Kubernetes 周围的数据，数据是堆栈的基础层。该公司还创造了 MayaOnline 作为观察和跨面板控件。

“你存储和保护了数据，但我真的想看看应用程序上发生了什么，”Mukkara 说。“每个应用程序都是裸机，现在在数十个甚至数百个容器上，”这就更需要数据是可观察的。

“我们的用户可以连接这些 Kubernetes 集群，看看他们做得怎么样，”他继续说道。“企业在多个云中部署应用程序，因此我们希望提供一个控制面板，让他们可以在一个地方查看所有内容。”

例如，在亚马逊网络服务、微软和谷歌之间，一家公司的总存储使用量是多少？

然后，MayaOnline 基于云的数据运营平台展示了您的有状态应用程序以及预测分析的表现，以帮助运营团队更好地了解和控制他们的数据。

但是，如果其中一个存储源出现故障，该怎么办呢？MayaData 团队构建了一个内部工具，他们后来意识到该工具具有公共用例。今年 5 月，他们公开推出了一个名为 Litmus 的开源框架，这是一个测试工具，旨在验证和强化容器，重点是:

*   功能
*   可量测性
*   表演
*   可靠性—包括负面、失败路径和混乱

Litmus 面向各种受众:

*   使用混沌 API 的数据库开发人员。
*   开发人员在部署前后测试混乱情况。
*   希望看到结果的首席信息官和软件副总裁。
*   存储提供商。
*   像 Mongo 和 Cassandra 这样的数据库供应商。

Mukkara 说，它“引入了混乱，测量了观察和结果，并将它们很好地融入到应用程序的行为中”，在生产过程中甚至有时在后来验证和强化应用程序。

他接着将 MayaData 工具集描述为“为在 Kubernetes 上运行有状态应用程序的用户提供的完整解决方案。”

这个系统如何更好地处理运行在 Kubernetes 上的有状态应用程序？Mukkara 举了该公司一个电子商务大客户的例子。

“我们的一个用户有一个巨大的 IT 系统正在被转移到 Kubernetes，主要问题是:‘我如何将我的数据库转移到一个使用容器的更易于管理的 CI/CD[持续集成/持续部署]平台上？’他们的系统中有 400 多名开发人员，他们真正需要的是一种快速获取数据库快照并根据数据测试更改的方法。"

只有当代码变更被标记为高质量时，它们才能被推入生产。

Mukkara 继续说道:“例如，他们可以编写一个有 12 个节点的 Kubernetes 集群，因为他们集成了 Litmus，所以他们可以关闭一个节点，查看应用程序是否继续运行，或者在应用程序在 CI/CD 管道上运行时引入更多混乱，例如关闭网络。

这些容器工具的应用解决了用户将其整体应用程序迁移到基于 Kubernetes 和微服务的系统堆栈中的问题。

“他们能够确保测试中的数据是真实的，他们能够用真实数据测试代码更改，并通过他们的 CI/CD 管道运行，”Litmus 和 MayaOnline 说道。

OpenEBS 自动化了这一过程，使 DevOps 人员能够根据更好的数据、节省时间的需求和 DevOps 工作人员来建议某一配置。

Mukkara 说，有了这些 MayaData 工具，“几个人应该能够管理一个系统，而不是 10 到 15 个人管理这些大系统。”

此外，使用 OpenEBS，用户能够减少获取数据快照的时间以及测试时间。它可以立即开始，而不是几天，这使得开发人员几乎可以立即启动自己的测试管道。

MayaData 工具集中的一切都是关于构建存储、数据保护以及围绕存储操作和 API 的可见性。Mukkara 说，这一切都要追溯到对更多混沌工程工具的渴望。

“每个人都在尝试采用一项新技术，他们想做到万无一失，”他说。

这一切都是为了重新关注发布稳定的应用程序，你可以肯定会保持这种状态。

云计算原生计算基金会和 T2 谷歌是新堆栈的赞助商。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>