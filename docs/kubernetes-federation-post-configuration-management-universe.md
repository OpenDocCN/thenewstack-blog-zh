# 后配置管理世界中的 Kubernetes 联盟

> 原文：<https://thenewstack.io/kubernetes-federation-post-configuration-management-universe/>

当集装箱化还年轻的时候，它的早期原则之一是不可变基础设施的理想 *[，](https://thenewstack.io/devops-landscape-2015-the-race-to-the-management-layer/)* 为集装箱建造足够灵活的支撑结构，以满足集装箱在其生命周期内的需求，生命周期可能很短，但在整个生命周期内保持固定资产的能力。

这表明 It 最关键的功能之一(配置管理)可能会完全过时，而这是当今企业非常依赖的一项技能。当太空中的主要厂商[开始讨论进化适应](https://thenewstack.io/in-container-world-chef-faces-shifting-landscape-for-configuration-management/)时，太空中的实践者团结起来[形成一种全球支持团体](https://thenewstack.io/configuration-management-community-matters/)以在进化漩涡中保持希望。

在柏林举行的 KubeCon Europe 2017 周四上午的会议上，[kel sey Hightower](https://github.com/kelseyhightower)——现在作为一名开发人员和[谷歌云平台](https://cloud.google.com/)的首席开发人员为[云本地计算基金会](https://www.cncf.io/)做出贡献——唤起了与会者对容器化最初目标的记忆，提醒开发人员，理想状态曾经专注于分布式系统，而不是配置实体。

## 聚会

Hightower 的主题是 *[集群联合](https://coreos.com/blog/kubernetes-cluster-federation.html)*——将多个集群汇集在一起。这是去年推出的 CNCF[Kubernetes](/category/kubernetes/)容器编排引擎的一个功能，它不仅能够跨集群均匀分布工作负载容器(或容器集合)，还能够跨云提供商和本地云平台管理这些容器。

“这是让每个人都感到困惑的特征之一，”海塔尔说。“每隔一段时间，就会出现一项新技术，每个人都会超级兴奋。当联邦宣布成立时，我们称之为“übernetes”所有人都失去了理智。他们说，‘啊！我们将拥有真正的混合云！'

“有多少人还在使用‘混合云’这个术语？””他继续说道这毫无意义。没有混合云这种东西。你的集群要么在两个地方，要么在一个地方。仅此而已；对此没有混合云。"

Hightower 继续将集群联合描述为比*节点联合*更高的一层，这实质上是 Kubernetes 一直在做的，也是它每天都在做的。他说，对于一个四节点集群，任何开发人员或运营商自然都希望确保访问安全，希望了解正在运行的内容、服务发现，最后当然也是最不重要的是资源管理。

“在我们进入 Kubernetes 和分布式系统的世界之前，现实世界中的大多数人都是这样做的:配置管理，”他告诉与会者。“我们拿走了所有这些机器，并试图以某种方式使它们正常化。”他说，要定义一个集群的操作，基本上意味着构建每个节点的配置，然后将配置相同的节点汇集在一起。

“所以你评估我们从配置管理系统中得到的，我认为我们没有达到要求，”他继续说道。

通过 API 实现的节点联合使得 Kubernetes 可以像处理一台机器一样处理多个节点。“如果你认为像 Kubernetes 这样的工具上的节点联合应该存在，”Hightower 说，“那么我认为当你有多个集群时，同样的情况也适用。集群联合——如果保持简单，实际上可能会解决问题。

“那么我能解决什么问题呢？我们引入第二个集群。这就像是，“我不需要节点联合！”因此，您可以编写 bash 脚本，在所有 API 服务器上执行 for 循环。你将在哪里存储所有的状态？您可以创建一个电子表格，并决定哪些对象属于哪个集群。随着时间的推移，您将为 Kubernetes 集群发明一些类似配置管理的东西。这是必然的。您只需对多台机器、多个集群重复您所做的事情。

“我说，我们跳过这一部分。会很痛苦。你知道配置管理的结果是什么吗？ [DevOps](/category/devops/) 。无效工具的好疗法。我不想知道如果人们去了多个集群，DevOps 会是什么样子。”

## 雷神之锤

工具行业的供应商[将 DevOps 描绘成一种不可避免的发展](https://thenewstack.io/modern-business-devops-die/)或组织的社会进化，这种进化必须发生，否则它们就会在进化更快的竞争对手手中灭亡。但是海托华捡起了一个被忽视的挑战，并把它扔了回去，迫使我们回忆起几周前，甚至几个月前，当我们开始这段旅程时，我们在哪里。如果简化是目标，那么对于社区来说，仅仅为了保持对旧技能的希望而聚集在复杂性周围可能是毫无意义的。

Hightower 提出了一个场景，对于多个集群共存的情况，另一个 API 服务器被分配代表整个集群的角色。这样的共存需要标准化，否则每个集群最终都会说自己的语言，我们最终会建立障碍而不是桥梁。他警告不要将 API 植入服务器，他说这是 Kubernetes 以前犯过的一个错误。这使得开发人员每次都必须重新编译代码。

![](img/51176e829e5515a40c2b0295b7802743.png)

“我们应该避免联邦犯这种错误，”他说。“让我们将联合视为多个集群的特殊客户端。如果我们做到了这一点，我们就可以保持简单。”

需要使用多个集群的应用程序的一个例子是一个 web 应用程序，它需要组件在两个云可用性区域中运行——可能每个区域都靠近它自己的特定用户。另一种可能涉及单个集群，其提供商的 SLA 限制了应用程序可以扩展的最大节点数量，迫使其在其他地方的集群上寻找空间。

“你将不得不在某个时候运行多个集群，”Hightower 预测道。我们建议每个可用性区域运行一个群集，而不是尝试跨多个可用性区域扩展您的节点池

他确实警告说，将多个集群加入一个联盟的概念可能会让开发人员面临“一场伟大的史诗般的事后分析”——这是某些记者撰写的头条新闻。这可能是一个简单的概念，但肯定不是没有风险的。

然而，它可能会很快陷入神秘之中。当容器在设计上似乎总是无状态的时候，抛弃配置管理是很容易的。现在，容器化的应用程序处理持久卷和状态条件，特别是那些使用 etcd 作为其状态存储的应用程序(Kelsey Hightower 有个人经验的项目)。当系统需要跨集群联合*有状态*应用时会发生什么？

他继续通过演示集群联合的运行来解决自己的问题，这涉及到创建一个全局 NGINX 负载平衡器——本质上是一个节点联合模型。

但是即使是演示也不是对这个问题的完整回答。将会有上下文的问题，并实时解决差异。然而他的观点是，配置管理方法——为此任务应用脚本和监控工具——会将组织引向错误的方向。在这个更大的范围内，这样一个方向的含义可能比单个集群中的节点更可怕。

“需要讨论一下，”海塔尔说。“这场讨论中缺少的是更多有联邦实践经验的人。有一个存储库可以帮助您开始使用联邦，但是在我们做出疯狂的决定之前，我们需要更多的反馈。因为这对他们不利。”

[云本地计算基金会](https://www.cncf.io/)是新堆栈的赞助商。

专题图片:凯尔西·海托华在 KubeCon 演讲，由德国 DevOps 公司 [Bee42](https://bee42.com) 的高级顾问[迪特·路透](https://twitter.com/Quintus23M)拍摄。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>