# 如何旁若无人地部署

> 原文：<https://thenewstack.io/how-to-deploy-like-nobodys-watching/>

[](https://launchdarkly.com/)

 [亚当·齐曼

亚当拥有超过 20 年的工作经验，从事过从软件工程到技术销售的各种工作。他曾在 VMware、EMC 和 GitHub 等企业和消费类公司工作过。Adam 热衷于包容性领导和用技术解决问题。另一个目标是成为一个多元化和公平的公司的一部分。不仅仅是一个接受多元化的组织，而是一个积极追求更加多元化和包容的团队，作为建设更好的产品和服务的必要条件。亚当也是一些创业公司和非营利组织的顾问。他对生活的看法是由物理学和视觉艺术的背景、作为丈夫和父亲的持续冒险以及童年的火变戏法生涯形成的。](https://launchdarkly.com/) [](https://launchdarkly.com/)

[launch darky](https://launchdarkly.com/)赞助了这篇帖子。

DevOps 一直希望在服务或应用程序的开发和生产中的代码操作之间建立更紧密的联系。正因为如此，我们已经看到围绕软件开发出现了新的工具和方法。这引起了产品经理(pm)的极大兴趣，比如我自己，他们总是在寻找新的方法来帮助我们的团队更加成功。

但不幸的是，如果你做了足够多的产品发布，你肯定经历过一个“简单”的功能更新变成了一场彻底的灾难，需要你花一整夜(甚至几天)来修复。像其他任何一位首相一样，我已经处理了太多的失误。多年来，我一直在寻找方法来更好地准备和支持我的团队，以及限制错误对我的用户的影响。

一个被证明有价值的关键概念是承认代码的部署不一定与新特性的发布相同——可以有一个有意的分离。如果做得好，这允许工程师更快地开发代码，并极大地降低通常与这种增加的发布速度相关的业务风险。

今天，当我的团队开始开发一个新特性时，我们允许开发人员[立即](https://launchdarkly.com/blog/continuous-incrementalprogressive-delivery-pick-three/)开始部署到一个阶段环境，甚至在代码完成之前。一旦代码完成，我们将开始部署到生产中，开始我们的测试。(是的，我们在生产中进行了测试，因为我们还没有找到在隔离环境中复制互联网的好方法。)一旦特性稳定并按设计运行，我就可以拥有特性的发布，而不需要开发团队的参与。这允许开发人员继续进行下一个项目，而我在一个对业务有意义的时间表上发布特性。最好的部分是，即使事情不像计划的那样发展，我也有能力通过开关的翻转来终止发布。

这种“黑暗”或“金丝雀”发射的想法也使得测试非技术问题成为可能。如果早期用户不参与我们更新的功能，或者如果更少的新用户转换到新的工作流，那么我们可以简单地关闭该功能，而不必进行任何代码更改，甚至不必重新部署并继续我们的下一个出色的想法。

## 跟上微服务的步伐

在打包软件的世界里，有一个强有力的理由来创建一个单一的整体应用程序。这支持了长的开发周期和紧密耦合的时间表。随着发布周期变得越来越短，有必要将这些整体分成更小的服务，更容易独立更新。这种独立更新的能力旨在允许团队更快地移动。

即使在单片应用程序的世界里，工程师也会使用特性标志来隐藏或控制对特性和功能的访问。特性标志本质上是一个 if-then 语句，无需重新部署应用程序即可更改。功能标志的最早版本存储在-config 文件中(有时带有隐藏变量),被视为“高级”配置选项。

当我在 VMware 时，我们使用这些来明确地为特定客户启用功能。这可能是一个不被普遍支持的驱动程序，或者是一个不是每个人都能使用的集成。支持组织将启用特性标志，客户将拥有他们需要的特性。这允许灵活地发布某些功能，而不必支持每个客户和每个环境。

当微服务出现时，挑战发生了变化。开发团队开始将大型整体应用程序分解成组件服务。微服务使得独立更新这些较小的组件变得更加容易。但是这种独立的服务交付也揭示了在服务分离后经常存在的紧密耦合。因此，成功的团队将特征标志作为保持部署速度的一种方式，同时避免由于跨服务的兼容性问题而导致的失败。

通过特性标志，团队可以部署和发布新版本的服务，并禁用某些标志，直到所需的更新出现在相关或链接的服务中。这种方法加强了开发商和运营商之间[更紧密关系的价值](https://www.youtube.com/watch?v=LdOe18KhtT4)。开发人员实施控制，运营人员控制应用程序或服务部署后的行为。

突然间,“发射”的想法有了更大的灵活性。运营团队使用功能标志和目标规则来明确选择要向新功能或行为公开的用户和群组，从而“暗启动”功能。当我在 GitHub 的时候，我们使用功能标志来进行新功能和更新功能的黑暗发布。我们将更新推送到我们的生产服务器上，然后选择群组或特定用户，他们将在所有人之前提前获得新功能。

## 发射不是二元的，它是一个光谱

黑暗发布、金丝雀发布、对更渐进的发布进程的渴望以及对用户暴露的控制，正在推动对健壮的特性管理的更大需求。

企业还面临着越来越多的需要交付个性化应用体验的用例。例如，现在的孩子总是想要最新最好的，而我的父母则诅咒他们的手机，如果一个按钮的形状或颜色发生变化。

使用控制点构建您的代码允许业务所有者有更大的灵活性，以适合他们用户的速度发布新功能——即使他们的用户需要以不同的速度前进。方便的是，相同的控制点可以用于生产测试，为早期采用者和稳定性坚持者创造更好的体验。

一直有“新特性还是稳定性”的问题—但为什么不两者都要呢？在您的开发生命周期中实现特性管理，可以让开发人员和操作人员在没有最终用户风险的情况下，在生产中进行测试和验证。更渐进的启动阶段允许项目经理或企业所有者对客户如何体验应用程序或服务有更多的控制。它给了 PMs 一种减轻工程师压力的方法，并且以用户满意的速度拥有特性的发布，并且只提供用户需要的特性。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>