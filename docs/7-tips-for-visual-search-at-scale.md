# 大规模视觉搜索的 7 个技巧

> 原文：<https://thenewstack.io/7-tips-for-visual-search-at-scale/>

哈迪·基亚普尔

哈迪·基亚普尔是易贝计算机视觉团队的研究科学家。他的兴趣包括识别服装和时尚风格、大规模视觉搜索和细粒度对象识别。他于 2015 年在北卡罗来纳大学教堂山分校获得了计算机科学博士学位。

视觉搜索变得越来越重要。最近的一份报告显示，在谷歌、易贝、亚马逊和其他主要网站上，27%的搜索是为了图片。另一项研究表明，75%的网上购物者在购物前会定期或总是搜索视觉内容。视觉搜索在零售应用中的突出地位使其成为成功的关键因素——但前提是它有效。

[在易贝](https://www.ebayinc.com/stories/blogs/tech/tips-for-visual-search-at-scale/)，我们在任何给定的时间都有超过 10 亿的实时列表，这相当于一个巨大的数字仓库，有数百万个通道或“叶子类别”,如有声读物、烹饪书、小说&书籍的“树类别”。基于给定图像预测树叶类别是我们基于神经网络的分类器的一项重要任务，随着时间的推移，我们已经发展了相当多的专业知识。

 [王

乔松·王于 2016 年加入，目前是计算机视觉领域的研究科学家。他在 2013 年至 2015 年参加了 DARPA 机器人挑战赛，并在 2014 年获得了 SPIE 最佳学生论文奖。他的研究兴趣包括计算机视觉、机器学习和机器人学。](https://www.ebayinc.com) 

我们首先根据神经网络中的 [softmax](https://en.wikipedia.org/wiki/Softmax_function) 层预测的概率，选择几个最有潜力的叶子类别。接下来，我们需要知道如何比较两个图像(查询和货架上的一个商品)。我们用一个紧凑的签名来表示每个图像，该签名是由同一个神经网络使用弱监督来提取的。该签名具有一系列数字的形式，表示为一个[向量](https://en.wikipedia.org/wiki/Feature_(machine_learning))。我们通过用 [sigmoid](https://en.wikipedia.org/wiki/Sigmoid_function) 层训练网络来提取二进制向量(由 1 和 0 组成),以预测顶部叶子类别。最好在所有步骤中使用尽可能多的监督。

根据我们的经验，这里有一些更详细的提示:

1.  **了解数据，使用分层抽样。**

理解你的神经网络需要分类的数据是很重要的。通常会有各种复杂因素，包括图像质量、物体本身的属性和背景。

 [罗宾逊·皮拉穆图

Robinson Piramuthu 于 2011 年加入易贝，目前是计算机视觉的首席科学家。他在计算机视觉领域拥有超过 20 年的经验，包括大规模视觉搜索、粗粒度和细粒度视觉识别、对象检测、时尚计算机视觉、2D 图像的 3D 线索、图形-背景分割和视觉深度学习等。](https://www.ebayinc.com) 

训练集的大小由四个因素决定:

*   要预测的标签数量
*   每个标签中数据的多样性
*   内存和计算限制
*   培训的时间预算

在易贝，我们对叶子类别、卖家、条件、品牌等进行分层抽样，最终剔除重复的部分。目标是充分捕捉数据的丰富性和多样性。****

2.  **使用数据扩充，包括旋转。**

当训练数据不能捕获真实用例中可能发生的所有变化时，数据扩充是训练神经网络的关键步骤。平滑，对比度和亮度，裁剪和翻转的合成数据增强都有帮助，但迄今为止最重要的是旋转，这往往被忽视。

3.  **在尽可能多的监督下提取语义签名。**

在提取语义签名时，使用尽可能多的监督非常重要。这有助于训练分类器聚焦于信息内容而忽略其他非信息区域。当标签不可用于实际任务(测量图像对之间的相似性)时，最好利用低获取成本的大量不同数据进行强有力的监督(例如叶类别预测)。

4.  **分析签名的熵。**

这一步在许多大型信息检索系统的系统设计中被忽略了。评估签名的熵以在其容量内有效地打包信息是至关重要的。例如，使用 8 位来表示二进制签名能够表示多达 2 个 ^(8 个)独特的概念。在最佳情况下，每一位的值为 1，频率为 50%。考虑到系统中的冗余，允许一定的松弛是有好处的。

5.  **当标签粗糙时，保持较高的类内方差**

我们使用粗糙的叶子类别标签来训练神经网络。典型的分类系统旨在最小的类内方差和大的类间方差。理想情况是方差为 0。在这种情况下，一个类中的所有样本都折叠成一个点。然而，这对于细粒度搜索来说并不理想，因为当每个聚类中的点都收缩为单个点时，细粒度匹配是不可能的。

例如，来自运动鞋的所有样本可以被折叠成单个点。但是，有许多独特的产品属于“运动鞋”这一类别，使用签名相似性是不可能找到它们的。由于这个原因，当标签是粗糙的并且需要细粒度的搜索时，类间方差和类内方差都应该很高。这可以通过查看签名的熵来测量(提示 4)。

6.  **使用速度和精度的消除过程**

消除过程是提高速度和精度的一个非常强大的工具。使用强分类器来预测前几个潜在分区(叶类别)是减少搜索空间和提高精度的非常有效的方式。礼服签名不会与鞋子签名混淆)。

7.  **在高可信度情况下使用累积 Top-K 分区**

当对顶部分区的预测的置信度很高时，没有必要搜索其他分区。当信心不太强时，最好包括其他竞争分区。我们建议使用累积 top-k 以获得更高的精度，而绝对 top-k 仅用于即使成本较高也需要精确匹配的情况。

通过 Pixabay 的特征图像。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>