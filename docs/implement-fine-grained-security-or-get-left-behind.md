# 实施细粒度的安全性，否则就会落后

> 原文：<https://thenewstack.io/implement-fine-grained-security-or-get-left-behind/>

过去十年中，安全领域最大的转变是从基于边界的方法转变为 [零信任](https://en.wikipedia.org/wiki/Zero_trust_security_model) 。多云和远程工作加速了这一趋势。但人们没有谈到的是，零信任如何需要类似的从粗粒度安全到细粒度安全的转变。

## 粗粒度的安全性是老一套

粗粒度安全处理网络、用户和应用。如果您在公司网络上，您可以通过网络访问该网络上的所有内容。如果您被鉴定为用户，您就可以登录访问一组特定的应用程序。如果您可以登录到某个应用程序，则根据您所属的角色或组，您可以进行基于角色的访问。

安全日志和可观察性同样是粗粒度的。传统的防火墙、身份提供商和应用程序会告诉您谁在何时登录，但除此之外通常不会捕获任何特定于应用程序的数据。

## 下一步是细粒度的安全性

零信任心态需要向细粒度安全转变。下面是一个 [细粒度](https://www.aserto.com/blog/fine-grained-authorization-whats-all-the-buzz-about) 、零信任的应用安全方法的几个要素。

### 默认为“拒绝”的基于策略的访问

为了让组织能够处理访问控制，授权逻辑需要从应用程序 中提取出来 [，并在授权策略中进行描述。这些策略应默认拒绝访问，并且仅当用户、工作负载或设备通过授权标准时才允许访问。](https://www.aserto.com/blog/why-separate-policy-from-your-code)

将授权策略从应用程序代码中分离出来，允许安全团队拥有该策略的生命周期，并以安全和可预测的方式发展它。将策略视为代码并将其存储在源代码存储库中，为策略发展提供了完整的审计跟踪。将策略代码构建到不可变的签名映像中，允许安全团队部署可信版本并回滚到先前已知的良好映像，从而为授权策略启用一个 [安全软件供应链](https://www.aserto.com/blog/securing-software-supply-chain-policy-as-code) 。

### 实施最小特权原则

 [奥姆里·加齐特

Omri 是 Aserto 的联合创始人兼首席执行官，aser to 是一家授权创业公司，也是他的第三次创业。他 30 年职业生涯的大部分时间都在从事开发人员和基础设施技术方面的工作，最近的职位是 Puppet 的 CPO。此前，他是惠普云原生平台的副总裁兼总经理(负责 OpenStack、Cloud Foundry、CloudSystem 产品和服务的业务、产品和工程监督)，也是微软的总经理，负责 Azure、SQL Server、应用服务器和。NET 框架。](https://www.aserto.com/) 

定义粗粒度角色的应用程序使得应用程序管理员很难给予用户足够的访问权限，但不能超过严格必要的权限。迁移到细粒度的访问控制模型涉及以下一种或多种技术:

**定义细粒度的权限作为访问控制的基础**

应用程序应该在每次访问受保护的资源之前进行权限检查。但是，应用程序应该检查用户是否拥有离散权限，而不是检查用户是否属于某个角色。这样，角色和权限之间的映射可以在应用程序之外完成。这使得可以轻松地向现有角色分配新权限，根据客户要求创建新角色，甚至允许客户定义自定义角色来聚合一组应用程序权限。

**理清“角色”和“群体”**

角色是权限的集合，组是一组用户。然而，大多数应用程序将这两者混为一谈。现代授权系统允许创建聚合用户的组，然后允许管理员将这些组分配给角色。通过这种方式，应用程序管理员可以控制他们如何对用户进行分组，并有一个单一的位置来管理角色(以及过渡权限)到这些用户组的映射。

**对应用资源的细粒度访问控制**

应用程序有一个资源层次结构，也称为域模型。对于多租户 SaaS 应用程序，“租户”位于这个资源层次结构的顶端。对于这些应用程序，最简单的授权策略确保与特定租户有关系的用户(例如，查看者、管理员)只能访问该租户范围内的资源。

大多数应用程序进一步将其租户范围的资源组织成一个层次结构:团队、项目、列表、文件夹甚至单个项目。最终，客户希望对层次结构中的每一层进行细粒度的访问控制。这种类型的访问控制越来越被称为“基于关系的访问控制”或 ReBAC。

ReBAC 采用 RBAC 的角色概念(也称为“关系”)作为一种机制来聚合一组权限，但提供了在资源层次结构的任何级别上创建主体(用户/组)和对象之间的关系的能力，这导致了比传统的 RBAC 更细粒度的访问。

**利用除了(或代替)群组成员资格的属性**

现代应用程序通常希望基于动态用户属性做出访问决策，比如用户属于哪个部门，或者他们是否是经理。当用户移动到不同的部门时，应用程序仍会正确评估权限，而无需管理员手动取消调配并将用户调配到新的组中。这种模式是“基于属性的访问控制”或 ABAC 的一个实例。

**组织感知访问决策**

管理关系是每个组织结构所固有的。许多应用程序希望经理能够对他们的报告执行操作，这需要理解描述管理关系的非常具体的用户属性类型。

例如，可以构建一个访问控制策略来遍历组织图并确定用户是否在该主管的组织中，而不是创建一个包含该主管的所有部门的组并明确地管理它。

**基于环境的属性**

一些应用程序需要根据用户从哪里登录、应用程序在哪个区域运行或者操作被调用的日期/时间而有不同的行为。这通常是由于服务级别或法规遵从性要求的地区差异(如 GDPR)。访问控制策略应该能够将基于环境的属性与其他细粒度的访问控制技术结合起来。

### 细粒度的安全日志和事件

安全行业的很大一部分专注于捕获和处理产品类别中的安全事件，如安全信息和事件管理(SIEM)以及安全协调、自动化和响应(SOAR)。

在这里，过去粗粒度的安全思维模式也让位于细粒度的安全方法。我们需要的不仅仅是记录登录，而是应用程序在用户会话过程中进行的每次访问检查的决策日志。这有助于更有效地找到并修复过度配置或错误配置的权限。

## 到达那里

这种转变必须从应用程序开始。开发人员需要一种简单的方法来将细粒度的安全性集成到他们的应用程序中。这需要将所有授权逻辑从应用程序中分离出来，并将授权调用委托给一个基于外部化策略做出授权决策的服务。

这种细粒度的安全服务需要对用户、资源和环境属性进行推理。它还需要收集应用程序生成的所有决策日志，并将其转发给中央系统。

### 建造它

对于拥有适当级别的资源和专业知识的组织来说，有一些开源构建块有助于创建定制的细粒度安全服务:

*   [开放策略代理](https://www.openpolicyagent.org/) 是一个通用决策引擎，可用于基于用户和资源属性做出 ABAC 式的授权决策。
*   Google [Zanzibar](https://research.google/pubs/pub48190/) 论文已经产生了多个开源项目，用于存储和评估用户对 ReBAC 对象图的权限。
*   Beats 日志运送器和伐木工协议使得运送和聚集决策日志成为可能。

也就是说，基于这些组件构建解决方案并不简单，其中大多数都不包括端到端的解决方案，该解决方案涵盖了基于属性的访问控制(ABAC)、基于关系的访问控制(ReBAC)、基于组织的访问控制以及提供有保证的排序和交付的日志聚合。换句话说，即使有开源项目的帮助，仍然有很多东西需要构建。

### 部署它

授权必须发生在应用程序附近，因为它是每个应用程序请求的关键路径。但是细粒度的安全性要求实时访问用户属性和资源关系。在应用程序请求的关键路径上获取这些属性而不招致昂贵的网络调用是一个 [分布式系统问题](https://www.aserto.com/blog/the-architectural-challenge-of-authorization) 并且是构建定制解决方案时最难解决的挑战。

对于授权策略来说也是如此:将访问控制代码从应用程序中提取出来并放入授权策略中的全部意义在于，您希望集中管理该策略，但要让它就在应用程序旁边。构建一个从源代码提交到策略分发的自动化策略代码工作流也绝非易事。

### 管理它

授权必须在本地完成，但管理必须集中完成才能成功运营。所有这些本地授权者都需要由控制平面管理，控制平面是用户数据、关系/资源数据、策略和决策日志的中央控制点。这样，安全和运营团队就有一个地方来管理他们所负责的应用和微服务集合中的所有工件。

同样，为细粒度安全性创建控制平面需要相当大的努力。像谷歌、网飞、Airbnb 和 Intuit 这样的公司已经这样做了，但他们有专门的团队来运营这些服务。

### 细粒度的安全平台

对于不想投入时间和精力自己构建的组织来说，还有其他选择。在细粒度的安全平台中，您应该寻找什么？

*   基于 OPA 的 ABAC 式保单授权。
*   用于细粒度用户、组和资源层次关系的 ReBAC 目录。
*   目录中管理关系的建模。
*   身份和目录数据记录系统的内置集成。
*   细粒度的决策日志捕获和聚合。
*   用于本地授权和集中管理的分布式体系结构。 

## 阿塞托

[Aserto](https://www.aserto.com) 是面向开发者的细粒度安全平台。它提供了一个完整的端到端解决方案，使开发人员能够轻松地将其集成到应用程序中，并使安全和运营团队能够进行大规模管理。今天创建一个 [免费账号](https://www.aserto.com/%23sign-up) ！

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>