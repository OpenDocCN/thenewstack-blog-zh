# 为什么您的下一个数据库将是无服务器 API

> 原文：<https://thenewstack.io/why-your-next-database-will-be-a-serverless-api/>

[](https://twitter.com/databrecht)

 [布莱希特·德姆斯

布莱希特·德姆斯是动物界的高级开发商倡导者。他是一名程序员，作为一名全栈开发人员和研究员，在初创企业和 IT 咨询领域都有广泛的工作经验。他的使命是揭示新兴的强大技术，使开发者更容易构建吸引用户的应用和服务。](https://twitter.com/databrecht) [](https://twitter.com/databrecht)

无服务器计算的早期给许多开发人员和工程师留下了不好的印象。最初，开发人员看到了功能即服务(FaaS)的巨大机会。他们可以以微服务风格编写代码，不再需要考虑扩展或服务器配置。此外，还有一个额外优势的承诺，有时被视为无服务器的核心组件:“随用随付”

然而，许多第一次体验无服务器并没有达到宣传的效果。一些公司在选择定制应用程序方面取得了成功，而其他应用程序似乎不适合无服务器。那些不适合的人会遇到提供商强加的限制，这些限制是为了估计和处理快速变化的功能需求而设置的。当项目接近完成时，战争故事开始从工程团队中出现，他们开始时抱有很高的希望，但由于这些限制而以沮丧告终。报告的问题包括冷启动、有效载荷限制、运行时间限制和内存限制。

然而，随着这些问题的解决，随着时间的推移，无服务器已经证明它将继续存在，并有望成为 2020 年的主要趋势之一。许多工程师现在理解了先前的限制，并且可以更仔细地分析一个项目是否适合无服务器。然而，由于无服务器仍在发展，可以构建无服务器风格的应用程序的范围正在迅速扩大。许多限制已经得到解决，新的供应商正在崛起，他们专注于不同的领域。AWS 等传统提供商已经减少了冷启动，Cloudflare、EdgeEngine 和 [fly.io](http://fly.io/) 等新提供商正在兴起，它们提供“边缘”无服务器，这带来了另一个优势:功能在全球范围内的自动分布，这导致了比以前想象的更低的延迟。

然而，FaaS 只是无服务器的众多面孔之一；推动采用的核心理念(现收现付和零操作)正在被纳入许多其他领域。过去，我们按月支付服务费用或购买许可证并在我们自己的服务器上安装可部署的，现在我们可以看到各种各样的服务提供按需购买模式，如身份验证、分析、内容管理、实时通知、支付服务或数据库。本质上，它们提供高度特定的计算即服务。

## 数据库的作用？

从以上采用这些核心原则的服务类别列表来看，无服务器数据库可能影响最大。主要是因为它们在应用程序堆栈中扮演的角色要求它们总是可访问的，并且尽可能实时。此外，当成名的时刻到来时，创业应用程序再也不能不伸缩了；要么成功，要么失败。具有可靠故障转移策略的分布式数据库完全符合这一要求，但是分布式的特点常常使它们的部署和维护变得复杂。无服务器数据库已经经历了这种挣扎，因此提供了将操作从你手中拿走的服务。本质上，无服务器数据库是不需要供应或服务器管理的数据库，并提供一个随用随付的 API。

> 开发人员社区正在等待数据库发展到可以与无服务器堆栈完美协调的程度。

分布式数据库向无服务器的发展很可能是无服务器应用的催化剂。更确切地说，这种发展将消除采用无服务器的最后障碍，因为如果数据库仍然是瓶颈，完全基于功能构建的应用程序将不会提供所需的按需付费或可伸缩性。

事实上，许多与 FaaS 有关的问题都可以追溯到数据库。传统的数据库不提供现代的安全 API，这迫使您保护数据库免受外部访问。这通常是通过将数据库放在虚拟私有云(VPC)中来实现的，您可以将数据库隐藏在后端。然而，当兰姆达斯在 VPC 中运行时，冷启动[可能会受到](https://mikhail.io/serverless/coldstarts/aws/)的严重影响[。](https://medium.com/@benjamin.tanone/the-goods-and-bads-of-serverless-e7f3395a8f14)

另一个原因是数据库在交互之前通常需要一个连接。建立连接通常需要时间，并且[连接数是有限的](https://medium.com/swlh/databases-that-play-nice-with-your-serverless-backend-13eb7dc1e1c)。因为无服务器功能应该是完全无状态的，所以连接不能无限期地保持开放。另一种方法是，每个函数建立一个连接，检索数据并再次杀死它，这将增加 API 调用的时间。当许多功能并发运行时，我们很容易超过可以同时打开的最大数据库连接数。

这个问题的一个相对简单的解决方案是在您的数据库之上放置一个 API 来为您处理连接池，但是它会增加复杂性、延迟，并且根据方法的不同，可能会再次引入单点故障。

## 有什么变化？

### 数据库！

数据库有许多复杂的优化和数据一致性问题需要解决。因此，它们比无服务器堆栈中的其他元素发展得更慢。像本文[无服务器数据库愿望清单](https://serverless.com/blog/serverless-database-wish-list/)这样的文章表明，开发人员社区正在等待数据库发展到可以与无服务器堆栈完美协调的程度。和谐工作的数据库不会遇到前面提到的连接问题，因为它是无连接的，默认情况下是安全的。数据库不再打开与数据库的连接，而是成为一个接收安全令牌和传递数据的 API。理想情况下，这样的数据库提供了与堆栈中的其他数据库相同的优势，如按需付费和自动扩展。随着将无服务器推向边缘的提供商的出现，地理上分散的数据库将保护这些提供商的低延迟优势。如今，提供部分(或全部)这些特性的数据库已经存在。例子包括 [FaunaDB](https://fauna.com/) 、Azure Cosmos、Firestore 和 DynamoDB。

### 斯塔克斯。

像 [JAMstack](https://thenewstack.io/the-sweetness-of-jamstack-javascript-apis-and-markup/) 这样的新方法正在出现，其想法是尽可能地消除后端(正如我们所知)。这种堆栈试图通过在 cdn 上部署静态生成的页面(在部署期间编译)并使用从无服务器 API 接收数据的动态元素(客户端)来扩充它们，从而实现尽可能低的延迟。这种方法正在迅速成为一种流行的方法，因为它不需要服务器配置，托管成本更低，并且具有 CDNs 和无服务器的自动扩展和按需付费的优势。

越来越多的 SaaS 公司已经看到了这种发展，并通过提供服务 API 来填补市场空白，这些 API 可以处理这种堆栈中繁琐的部分(如授权)，或难以实现的部分(如长时间运行的计算)。JAMstack 开发者如今可以选择 [Auth0](https://auth0.com/) 进行身份验证，选择 [Cloudinary](https://cloudinary.com/) 进行媒体存储和操作，选择 [Algolio](https://www.algolia.com/) 进行搜索，选择 [FaunaDB](https://fauna.com/) 这样的数据库来存储和查询动态数据。这些服务加速了 JAMstack 社区的发展；每当社区出现新的需求时，新的乐高积木就会以新的服务 API 的形式出现，可以毫不费力地插入到他们现有的 JAMstack 中。

## 结论

自从第一次发布无服务器以来，许多事情都发生了变化。我们有了更多的经验，限制正在被解除，生态系统正在迅速发展。很长一段时间，数据库没有被预见到用于无服务器的堆栈中，因此由于它们的安全模型和持久连接，仍然是一个瓶颈。随着新的无服务器友好数据库解除这些限制，我们现在正接近一个转折点。此外，边缘无服务器和 JAMstack 爱好者通过采用全局复制交付(CDN)和分布式计算框架(边缘无服务器)进一步降低了延迟。几年前，这对于 OLTP 应用程序来说意义不大，因为不存在好的解决方案来以分布式方式存储一致的数据，而不会产生巨大的运营开销。今天，全球复制的数据库，如 Amazon Aurora、FaunaDB、Spanner 和 CockroachDB，都作为服务提供，其中一些(FaunaDB、Spanner)甚至在全球范围内提供 ACID 保证。

无服务器友好的数据库提供了无服务器难题的最后一块，全局复制的数据库是创建无服务器并在边缘交付、计算和存储数据的堆栈的最后边界。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>