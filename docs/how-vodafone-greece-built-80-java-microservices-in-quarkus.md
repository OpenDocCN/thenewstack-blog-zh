# 沃达丰希腊如何在 Quarkus 建立 80 个 Java 微服务

> 原文：<https://thenewstack.io/how-vodafone-greece-built-80-java-microservices-in-quarkus/>

[](https://www.linkedin.com/in/alhandy/)

 [亚历克斯·汉迪

亚历克斯是红帽公司的技术营销经理。在他之前的生活中，他报道了第一台 iMac 的发布，然后开始了 20 多年的科技记者生涯。](https://www.linkedin.com/in/alhandy/) [](https://www.linkedin.com/in/alhandy/)

如果你在过去十年开始编程，你的第一门编程语言可能不是 Java——新开发人员将 Java 作为第一门语言的可能性每年都在下降。虽然 Java 仍然是世界上第三大流行的语言，但它作为计算机科学教育和新兵训练营的第一语言的日子已经一去不复返了。

今天的程序员是在移动设备、JavaScript 和基于云的部署中成长起来的。但是，如果您是在这些环境中长大的，但是后来又被扔回到 Java 世界中，那该怎么办呢？你将如何回到反应式的、事件驱动的编程环境和高度可伸缩的容器？

## 扔进 Java

当克里斯特斯·索蒂里欧来到沃达丰希腊公司，成为该公司后端部门的负责人，管理一个开发团队时，他已经有了十多年的编程经验。他已经使用过 C++和 Objective C，然后在获得硕士学位时学习了 Java。但他最近一直在从事 JavaScript 和 iOS 的专业开发；沃达丰是一家 Java 商店。这很难让人感觉不到一点挫折，因为 Java 并不是最现代、最动态的开发环境。

索蒂里欧非常欣赏 iPhone 的硬件限制，以及 JavaScript 的即时反馈和反应能力。Java 应用程序在 RAM 和 CPU 时间的使用上可能会稍逊一筹，当您对应用程序进行更改时，该应用程序必须进行编译才能看到更改，这与 JavaScript 不同。

## 沃达丰希腊分公司的转型

2018 年索蒂里欧加入沃达丰希腊公司时，他的团队只有 2 个人。今天已经接近 40 了。有这么多的人加入团队，以及将公司的微服务集群扩展到 10 个服务之外的动力，Sotiriou 有他的工作要做。

如今，该团队在其集群上托管了 140 项微服务，展示了他们的成就。以下是 Sotiriou 和他的团队是如何实现这一飞跃的。

### 寻找合适的工具

Sotiriou 意识到他需要工具和技术来搬运重物。Sotiriou 选择的一个工具是 [Vert.x](https://vertx.io/) ，这是一个 Eclipse 项目，支持在 JVM 上使用反应式应用程序。Vert.x 还有助于减少它所使用的 Java 应用程序的开销，因为它提供了更高效的执行，允许更大的集群密度。

### 改造开发反馈

Sotiriou 还想找到一种方法，使开发过程在更快的循环中向开发人员提供更多的反馈。他使用 JavaScript 的经验让他意识到能够快速看到代码的变化，向开发人员展示他们所做的改变是否有效。此外，Node.js 的事件驱动编程模型支持对环境中发生的事情做出快速的编程响应。

“从我以前的经验中，我看到了拥有一个反应式环境意味着什么，拥有多线程意味着什么，以及它如何影响应用程序。它教会了我如何使用线。iOS 如何使用线程会影响你如何编程，以及你对此的看法。我在 Node.js 的经历告诉我，为什么 Node 改变了我们今天所看到的行业。“使用 Node.js，您可以创建一个反应式应用程序，一个事件循环就能完成所有工作。这发挥了作用。在此之前，我们对线程如何运行有非常不同的看法。

“有了这样的经历，并在两种环境下工作过，当我必须决定如何使用一项技术时，我选择投入更多的时间来研究事情在幕后是如何工作的，微服务与我以前的经历有一些共同点。到目前为止，我所做的一切都是围绕在内存和 CPU 都很少的受限环境中工作而构建的。”

### 改善启动时间

所有这些 Java 应用程序都存在另一个问题——启动时间。沃达丰希腊公司在 T2 亚马逊网络服务中心的 Kubernetes 上运行。由于该系统建立在容器上，每当通过 SMS 向客户发送新的营销活动时，该系统都必须承受巨大的流量高峰，因为用户伸出手来利用营销努力。

Sotiriou 说，不幸的是，每次出现流量高峰时，系统都会暂停，因为它会启动新的容器化 Java 应用程序来满足需求。这些容器的启动时间令人望而却步，并可能导致营销工作的浪费(因为用户无法及时购买新产品)。

不过，为了缩短启动时间，Sotiriou 知道有必要进行更多的优化。Sotiriou 说，他在移动平台方面的经验教会了他如何优化应用程序，以更小的内存和 CPU 占用量运行。但是对于 Java 来说，大部分工作已经由团队完成了。Java Spring Boot 应用程序已经在 JVM 和应用程序级别进行了尽可能有效的优化。

### 优化 Java 应用程序:评估 Quarkus

索蒂里欧想要更多。2019 年春天，他和他的团队开始评估 Kubernetes 原生 Java 堆栈 Quarkus。 [Quarkus](https://quarkus.io/) 基于 Vert.x，虽然当时它刚刚接近完成，但 Sotiriou 表示，即使作为 2019 年的一个不完整产品，团队也可以非常清楚地看到优势。

在最初的测试表明 Quarkus 将减少应用启动时间，减少 CPU 和内存使用，并使整个开发过程运行更快之后，Sotiriou 和他的团队决定将他们最重要的库和微服务移植到这个新的堆栈。然后，他们将使用它来构建所有新的微服务。旧的、不太重要的服务将不再被开发，并根据需要移植到 Quarkus。

他们从内部库开始，将它们转移到 Quarkus，这样其他依赖它们的应用程序就更容易移植。最终，Red Hat 的应用程序迁移工具包将为 Spring Boot 到 Quarkus 的迁移添加具体指导，进一步简化沃达丰希腊公司的迁移。他们还决定不使用 Quarkus Spring 扩展，这使得移植 SpringBoot 应用程序更加容易——soti riou 希望这些新应用程序是纯 Quarkus。

## 索蒂里欧的团队今天如何使用夸库

如今，Sotiriou 的团队已经向 Quarkus 移植了 10 多项业务关键型 SpringBoot 微服务。这些应用程序启动速度更快，运行所需的资源更少，从而降低了群集的总体 AWS 费用。总体而言，集群也更加健康，因为它在处理由公司的直接营销活动驱动的突发流量高峰时不再遇到困难。总的来说，该团队还消除了大约 30%的 Java 代码，因为 Quarkus 能够帮助删除不必要和未使用的代码。

该公司现在有 80 个 Quarkus 微服务在生产中运行，另外 50-60 个 Spring 微服务仍处于维护模式，等待商业动机进行更新。沃达丰希腊公司的成功不仅仅是因为 Sotiriou 的技术选择，他还提到了公司为鼓励合作而进行的组织转型。

“这里面也有非常人性化的一面。这是一个风险，我们知道这是一个风险。团队需要很多信任，如此大的信任渗透到围绕基础设施组织一个小团队，这个基础设施后来成为共享库或公共库。当我们决定进行迁移时，最重要的是不要中断业务连续性。第二件最重要的事情是，如果我们想要长期高效，我们就必须投资于开发和研究。如果我们不遵循一项准则，投入部分时间来扩展我们的服务器基础设施，我们就无法做到这一点，”Sotiriou 说。

这对于一个在不到三年的时间里从 2 人发展到 40 人的团队来说尤为重要。选择合适的人，建立信任和快速、动态发展的文化也是成功的一个重要部分。

*如果你对沃达丰希腊的移民之旅感到好奇，可以看看 Quarkus 的炉边谈话:*

[https://www.youtube.com/embed/RYGvDtMM95I?feature=oembed](https://www.youtube.com/embed/RYGvDtMM95I?feature=oembed)

视频

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>