# 日志和监控:为什么你需要两者

> 原文：<https://thenewstack.io/logging-and-monitoring-why-you-need-both/>

[](https://raygun.com/)

 [Jean 突尼斯

Jean 是 Raygun.com 的一名作家，也是一名应用和网络性能工程顾问，自 1999 年以来一直在该领域工作。](https://raygun.com/) [](https://raygun.com/)

记录和监控是花生酱和果冻。这两者搭配得很好，就像面包和黄油或者你能想到的其他著名组合。类似地，日志记录和监控工作得最好，因为它们可以很好地相互补充。

另外，[日志记录](https://raygun.com/blog/breadcrumb-logging-in-raygun4net/)生成应用程序中发生的一组详细事件。[错误监控](https://raygun.com/platform/crash-reporting)告诉你你的应用是否在工作。例如，日志可以帮助找到应用程序问题的原因，但其庞大的数量会限制完成任务的速度。但是将日志记录与监控集成在一起可以帮助更快地筛选这些数据，从而解决由运行缓慢的应用程序引起的客户体验问题。

总之，监控您的应用程序并记录其数据有助于让您的客户满意。随着应用程序运行的系统变得越来越复杂，单独做其中任何一个都是不够的。在这篇文章中，我将谈谈为什么只写日志是不够的一些原因。我还将分享一些集成日志和监控的方法，以便您可以更快地解决影响客户体验的问题。

## 伐木业的伟大

多年来，日志一直是应用程序和基础架构性能故障排除的重要组成部分。它们有助于了解我们的应用程序如何在各种基础架构组件上运行。

日志数据包含诸如内存不足异常或硬盘错误等信息。这是非常有用的信息，可以帮助我们确定问题背后的“原因”,无论是用户引起我们的注意，还是我们发现的问题。

因此，从您的应用程序记录数据是很棒的！但是我们需要更多。

## 日志是不够的

使用日志数据，您可以获得许多关于应用程序的关键信息，但这不足以帮助您快速解决问题。仅仅依靠日志数据有许多缺点。

### 单文件记录器

一个缺点是，传统上日志数据被写入一个或多个文件，有时是在一个滚动缓冲区中，这些文件存储在运行应用程序的服务器的硬盘上。这可能很快导致磁盘空间问题，具体取决于记录的数据量。

大多数[日志框架](https://raygun.com/blog/c-sharp-logging-best-practices/#logging-frameworks)都有一组类似于下面的日志级别:致命、错误、警告、信息或调试。如果您只记录错误，这通常是默认的，并且只记录特定类型的信息，您可能不会遇到任何问题。

但是一旦您将日志记录级别提高到调试级别(开发时可能会用到),您可能会开始担心磁盘空间问题。如果是一个应用程序，这可能不是问题。但是，如果运行多个应用程序，系统资源可能会受到影响。

### 太多了，无法搜索

另一个缺点是极端日志记录的可能性。当您记录大量关于应用程序的数据时，日志数据通常对故障排除最有用。您记录的相关数据越多，出现问题时您的情况就越好。

这样做的一个问题是，日志文件可能会变得非常大，以至于打开和处理它们都成问题。当有问题需要解决时，这使得搜索和找到相关数据变得困难。

我仍然会做噩梦，打开由数万行或数十万行日志数据组成的大型日志文件，我需要搜索这些文件来排除故障，结果发现是一个 [Java 虚拟机(JVM)内存问题](https://raygun.com/blog/java-exceptions-terminology/)。

搜索所有这些数据，无论是存储在单个文件、多个文件还是时序数据库中；可能很费时间。当存在最终用户体验问题时，时间就是关键。

### 无(相关)关系

第三个缺点是缺乏跨系统数据的相关性。当你的应用被安装在[众多微服务](https://raygun.com/blog/monitoring-microservices/)上，并且每个服务都在记录数据时，你需要能够识别并[跟踪整个微服务架构中的最终用户问题](https://raygun.com/blog/unique-user-tracking-for-exceptions-and-crashes/)。

必须查看来自多个系统的多个日志文件或查询多个服务的时间戳，才能找到用户速度缓慢的原因，这可能需要一段时间。时间就是您的组织正在损失的金钱。

## 集成了错误监控和日志记录

尽管有日志记录工具可以用来存储和分析日志数据，但是这些缺点仍然存在。有像 Splunk 和 Loggly 这样的商业工具，还有像 ELK ( [Elasticsearch](https://raygun.com/blog/effective-data-elasticsearch/) 、Logstash 和 Kibana) stack 这样的开源选项。这些工具将允许您聚合、存储、搜索和可视化您的日志数据。但是你仍然有一些相同的问题。

你仍然需要搜索你的日志。随着应用程序复杂性的增加，日志数据也可能增加，所以这种搜索仍然需要时间。商业工具也带来了成本上的缺陷，因为存储每千兆字节的数据需要一些费用。在这种情况下，记录数据的成本会急剧增加。

因此，我建议利用错误监控和[崩溃报告工具](https://raygun.com/platform/crash-reporting)来补充您的日志记录，而不是仅仅将您的日志数据发送到日志工具，或者更糟，发送到日志文件。

这里有五种方法可以做到这一点，并将日志记录与错误监控相结合:

### 1.Log-o-Error 监控工具

为了有机会更快地进行故障诊断，您的 DevOps 团队应该将日志数据发送到错误监控工具，而不是只发送到磁盘或日志工具。投入生产的代码应该发送到您的监控工具，以便在您的 [CI/CD 流程](https://raygun.com/blog/continuous-deployment/)中了解您的应用程序的性能；

### 2.验证应用程序语言支持

能够将数据直接记录到您的错误监控工具中是非常好的。但是，您也需要该工具在安装后立即提供价值。为此，您的错误监控工具需要支持应用程序的[编程语言](https://raygun.com/documentation/language-guides/overview/)的工具。如果你的申请是用。NET，您需要一个崩溃报告解决方案来检测您的。NET 应用程序，以便它可以尽快开始提供错误报告；

### 3.使日志记录具有描述性和上下文性

当开发人员为您的应用程序编写日志消息时，这些数据应该是描述性的，并提供有助于故障排除的上下文。您希望确保日志数据包含诸如时间戳、会话 id、唯一用户 id 和资源使用信息等信息。在日志中包含所有这些数据将有助于更快地进行故障排除。这些信息还有助于您了解在错误发生之前，整个基础架构中发生了什么。错误监控工具将能够关联这些数据，并将其与特定的用户或会话联系起来。

### 4.使日志数据结构化

记录的一个常见的[最佳实践是确保数据是结构化的。在进行故障排除时，非结构化日志数据使得存储、索引和搜索日志事件变得更加困难。拥有结构化格式的数据不仅需要指明应用程序中发生了什么不好的事情，还需要指明发生了什么，例如，发生在哪个客户 ID 上。当这些数据发送到您的监控工具时，您现在可以看到该客户受到了该问题的影响，以及其他哪些问题可能正在影响该客户。](https://raygun.com/blog/c-sharp-logging-best-practices/)

### 5.使用 API 或插件

您希望尽可能减少维护日志记录和监视集成所需的更改。利用 API、 [webhooks](https://raygun.com/blog/webhooks-finally/) 或者你的错误监控工具的插件将有助于完成这个任务。[API](https://raygun.com/blog/api-design-guidelines/)倾向于保持相对稳定，以提供对许多系统集成的支持，因此推荐使用它们来发送或接收日志数据。此外，这可以通过电子邮件或 [ChatOps 系统](https://raygun.com/blog/chatops-software-teams-manage-issues/)向您提供关于日志中发现的问题的警报和通知。

## 让我们开始吧

日志数据包含关于应用程序和基础设施(包括数据库)的一些关键信息。将这些数据存储在日志工具中对于收集、汇总和查看这些数据非常有益。但是有一些缺点和不足可以通过用错误监控来补充您的日志来克服。

最终目标是让您的最终用户满意，并拥有好的[客户案例](https://raygun.com/customer-stories/olo)。要做到这一点，您需要以集成的方式同时使用日志记录和监控来实现您的目标。使用正确的日志记录工具或方法以及错误监控工具，您的开发人员和运营团队将能够更快地规划和解决应用程序问题。

这就是拥有辅助工具的好处:事情完成得更快。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>