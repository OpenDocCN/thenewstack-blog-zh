# 监控 Amazon Web Services 上无服务器的基本指标

> 原文：<https://thenewstack.io/essential-metrics-to-monitor-serverless-on-amazon-web-services/>

[桑德拉](https://www.thundra.io/)赞助了这篇文章。

 [埃姆拉·萨姆丹

艾姆拉是桑德拉公司的产品副总裁。他热衷于无服务器、可观测性和混沌工程。](https://www.linkedin.com/in/emrahsamdan/) 

对无服务器应用程序进行故障排除意味着将许多不同的资源结合在一起。Lambda 函数按需运行，硬件只在请求期间存在，日志可以跨多个资源分布。因此，当使无服务器应用程序更易维护时，第一道防线是掌握重要的指标，以及它们的含义。当生产中出现问题时，度量的汇总分析通常是您收到的主要信号，知道跟踪哪些度量是成功的一半。在本文中，我们将探索对您的应用程序的健康至关重要的无服务器指标。

## 哪些指标是必不可少的？

让我们开始讨论，为我们的讨论设定一些界限。在这个探索中，我们将关注三个通用的度量类别:操作、负载相关和其他。这些指标将分别代表应用程序执行过程的一部分。要构建应用程序生产性能的一致视图，您需要将它们都考虑在内。

### 运营指标

最容易理解的指标是操作指标，它通过比较调用的结果来跟踪无服务器功能的操作性能。这允许您建立警报阈值，建立关键指标来帮助您确保应用程序继续运行而不出现问题。在 AWS Lambda 中，我们主要关注两个操作指标:聚合错误计数和聚合执行计数。

聚合错误计数是 Lambda 函数在一段时间内遇到的错误数量的简单计数。虽然这可以让我们大致了解我们的函数在生产中有多成功，但它需要另一个数据，即聚合执行计数，才能让我们了解完整的情况。聚合执行计数顾名思义:一个函数在给定的时间跨度内执行的次数。通过比较总的执行计数和总的错误计数，您可以对无服务器应用程序的组件功能的可靠性有一个大致的了解。

### 与负载相关的指标

与负载相关的指标表示运行代码的硬件上的相对负载。在传统的软件应用程序中，这将包括 CPU 使用率、RAM 使用率或网络带宽使用率等指标。无服务器应用程序不像传统应用程序那样保持硬件统计数据的保真度，但为了清晰起见，我们仍然可以查看一些与负载相关的指标。

与负载相关的指标以执行的持续时间为中心。执行的持续时间可以通过许多不同的方法来衡量。第一个是执行的平均持续时间。这是每个应用程序函数的平均执行时间，以毫秒为单位。它是使用来自 AWS Lambda 生态系统的上下文对象中提供的统计数据计算的。这告诉我们，平均而言，我们的无服务器函数在被调用时将运行多长时间，并且它可以帮助我们衡量资源使用情况，因为它与 Lambda 函数必须遵守的总体函数超时相关。

但是，当试图理解函数的总体性能时，这个执行时间度量可能不准确。由于函数持续时间变化很大，所以从统计角度来看执行时间很重要。这意味着我们希望根据函数执行时间的分布来查看指标。我们使用概率阈值，如 p90 和 p99，来实现这一点。这些指标从统计的角度处理函数的执行时间，p90 给出了 90%的函数调用(平均而言)将完成的时间，p99 在此基础上扩展到包括 99%的函数调用。这些方法将告诉您离各种临界值有多近，比如 Lambda 函数的超时值。例如，如果您的无服务器应用程序的 p99 时间非常接近 Lambda 函数的超时值，您将更有可能在执行无服务器函数时看到超时异常，从而为您提供从何处开始调查的关键信息。

下一个指标是函数节流的数量。当 AWS Lambda 函数开始过于频繁地执行，或者有太多的并发性时，它们被调用的速率就会受到抑制。这个度量只是统计 Lambda 函数执行时看到的节流数量。这个数字越大，任何单个调用由于过度并发、系统负载或任何其他潜在因素而被抑制的风险就越高。

最终与负载相关的指标是基础设施需求的度量，如功能的供应并发性和资本驱动的指标，如执行成本。这些指标由您的无服务器应用程序在 AWS Lambda 基础设施上的负载直接驱动。供应的并发控制您可以一次执行多少个功能，超过供应的并发阈值的执行将受到 AWS 的限制。这会缩短您的职能部门的响应时间，对客户体验产生负面影响。在财务方面，执行成本(在每个功能执行的上下文对象中提供)等资本驱动的指标有助于您控制基础设施支出。随着应用程序开始扩展，这一点非常重要，因为 Lambda 函数执行请求的突然增长将直接导致每月 AWS 账单的增加。

### 业务指标

我们要看的最后一组指标特定于每个应用程序和驱动它的业务。这些业务指标是使用开发人员添加到您的应用程序中的自定义指标构建的，并且可以包括开发人员能够设计的任何指标。这些指标使用构建在应用程序功能集之上的自定义信息，提供了对应用程序性能的有意义的测量，因为它与关键的面向用户的功能相关。

关键是根据可以主动报告、测量和监控的方面，确定对您的应用程序的健康最关键的指标。例如，如果您正在编写一个无服务器的支付处理器，您可能希望跟踪应用程序中每天记录的交易数量，这样您就可以感受到应用程序中的流量峰值。这些指标将与您的应用程序的业务目标相关联，当与自动化基础架构指标结合使用时，它们可以帮助您识别应用程序中的问题区域、架构中的压力点或业务验证失败——根据您的需要，对您的业务至关重要的指标没有限制。

## 本机工具入门

一旦您为无服务器应用程序确定了一套适用的指标，就该构建您的工具链了。我们将从 AWS 原生工具开始分析，这些工具可用于监控无服务器应用程序中的 Lambda 函数。该列表从 [CloudWatch](https://aws.amazon.com/cloudwatch/) 开始，它提供了许多关键指标，可以在每个服务级别和跨多个 AWS 资源的跨服务级别查看。CloudWatch 为您的无服务器应用[定义了许多非常有价值的指标，开箱即用](https://aws.amazon.com/blogs/compute/building-well-architected-serverless-applications-understanding-application-health-part-1/)。

CloudWatch 允许您访问函数的硬统计数据，包括调用计数、错误计数、平均持续时间和平均节流。CloudWatch 还为您提供了构建自定义指标的能力，只需简单的 API 调用就可以用对您的应用程序很重要的指标填充 CloudWatch。CloudWatch Insights 让您走得更远，它使用结构化日志数据分析来基于您的应用程序日志自动生成指标，而无需任何额外的代码。您可以查看单个 AWS 区域或多个区域的统计数据。CloudWatch 提供了许多关键的操作和负载指标，这些指标将推动您的应用程序保持健康。

## 本机工具的缺点

虽然原生工具让我们一目了然，但有一些漏洞会降低它们生成的指标的效用。从本质上来说，CloudWatch 等原生工具的范围是有限的。它们不允许您构建应用程序的内聚和全面的视图——一切都在功能级别进行，或者以聚合的方式进行，这使得进一步的分析具有挑战性。如果您希望监控行为，那么 CloudWatch 指标可能会非常有限，因为函数的呈现与调用它们的控制流无关。这导致了一个复杂的用户界面，您需要在导航之前完全理解它，并且它给出了对您的应用程序真正重要的指标的不完整视图。

## 使用定制的业务指标超越本地工具

本机工具为您提供了许多关于当前执行的信息。有了现成的操作和负载指标，您就可以构建应用程序当前执行特征的总体情况。然而，纳入这个集合之外的指标对于业务成功通常是至关重要的。设想一个服务于多个国家的支付处理器。在提供服务器容量时，您需要单独跟踪每个国家发生的交易。该信息特定于应用程序的业务目的，因此不能根据 AWS 平台可用的指标来定义。

一旦您定义了对您的业务至关重要的指标，您仍然需要找到一种方法将它们输入到您的监控仪表板中。在纯本机方法中，您的度量将限于 AWS 中可用的工具，这些工具更多地涉及 Lambda 执行的一般特征，而不是任何特定的定制度量。桑德拉让您可以将所有资源整合到智能仪表板中，帮助您获得您关心的生产运行指标，并提供监控和警报。

## 与桑德拉一起构建一幅完整的图画

集成第三方工具有助于解决原生 AWS 监控工具的许多棘手问题。桑德拉作为对您的应用程序至关重要的指标的在线仪表板，将您的无服务器应用程序生成的指标合并到 CloudWatch 中，并在它们的基础上构建附加功能。可搜索的用户界面使得这些指标更容易访问，但是这种展示仅仅触及了表面。

一个关键的桑德拉功能是智能仪表板中人工智能驱动的[异常检测功能](https://blog.thundra.io/introducing-smart-dashboard-with-ai-driven-anomaly-detection)。通过桑德拉平台生成的自动化警报和洞察，您无需定制配置即可深入了解应用的重要指标。桑德拉让您能够定义您需要的业务指标，将您的职能部门报告的所有指标合并到一个简单易用的仪表板中。

## 让您的应用更上一层楼

监控对于检测无服务器应用程序何时出错至关重要。虽然获得与运营和负载相关的指标相当简单，但是在收集和发布特定于业务的指标时，本地工具会留下很多问题。由于缺乏可发现性、可搜索性或分组粒度，通过 CloudWatch 提供的许多指标也可能会遗漏。借助桑德拉，您可以在 AWS 中对操作和负载指标的强大支持的基础上，使用智能仪表板添加监控和警报，这有助于您及时了解应用中的重要指标。使用桑德拉，您可以将所有需要的信息集中在一个易于使用的界面中，从而推动您的应用程序更上一层楼。

亚马逊网络服务是新堆栈的赞助商。

通过 Pixabay 的特征图像。

目前，新堆栈不允许直接在该网站上发表评论。我们邀请所有希望讨论故事的读者通过[推特](https://twitter.com/thenewstack)或[脸书](https://www.facebook.com/thenewstack/)访问我们。我们也欢迎您通过电子邮件发送新闻提示和反馈: [feedback@thenewstack.io](mailto:feedback@thenewstack.io) 。

<svg xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 68 31" version="1.1"><title>Group</title> <desc>Created with Sketch.</desc></svg>