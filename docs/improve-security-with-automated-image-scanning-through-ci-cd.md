# 通过 CI/CD 的自动图像扫描提高安全性

> 原文：<https://thenewstack.io/improve-security-with-automated-image-scanning-through-ci-cd/>

当涉及到保护部署在 Kubernetes 上的应用程序时，通过 CI/CD 管道实现自动化是关键。使用与 Jenkins 或您喜欢的 CI/CD 工具挂钩的云原生安全工具，企业安全团队可以为构建容器映像的开发人员设置策略。管道通过在构建过程中自动扫描每个映像的漏洞来实施这些策略。开发人员只部署安全团队有信心的图像，因为它们已经过扫描。

自动图像扫描有助于安全实践“左移”,从一开始就建立安全性。在本播客中，了解分布式架构如何改变企业的安全方法，自动化如何大规模提高安全性，以及 Aqua 的工具(免费和商业企业版)如何在整个应用程序生命周期中帮助提高安全性。

**亚历克斯·威廉姆斯:**大家好，我是亚历克斯·威廉姆斯，这里是哥本哈根的 KubeCon + CloudNativeCon，我是 New Stack 的创始人兼主编。我现在和利兹·赖斯在一起，她是今年 CNCF 的联合主席，祝贺她。你在舞台上的表现非常出色，我认为，你带来了一些很大的关注。当你站在舞台上谈论这个项目时，我真的觉得自己是个焦点，所以谢谢你。

**莉丝赖斯:**非常感谢！

## Aqua 安全微型扫描仪

我最近写了很多关于它的文章，主要是因为我一直在做一个叫做 MicroScanner 的产品，这是一个免费的工具，开发者可以在他们使用我们的 Aqua 包漏洞的地方使用。这与我们在商业产品中使用的漏洞情报是一样的。但是个人开发者可以在他们的项目中免费使用。

我们的企业客户通常会将扫描构建到他们的 CI/CD 渠道中。该产品类似于挂钩到您的 Jenkins 或您最喜欢的 CI/CD 工具。另一方面，MicroScanner 更像是一个独立的东西，实际上它是 Dockerfile 中的一行。因此，对于个人来说，这是一种简单的方法——对于企业来说，这可能不是正确的方法，但是对于个人开发人员来说，检查他们自己的映像及其软件包是否充满漏洞，这可能是一种有用的工具。

亚历克斯·威廉姆斯:好的。因此，当我们在 Kubernetes 中考虑 CI/CD 时，它是非常不同的，对吗？这是很多-这是一个完全不同的方法，Kubernetes 是一个与人们习惯的架构大不相同的架构。微服务每时每刻都在不断地相互交叉。你对此有什么看法？当您想到一个实际上像蜂巢一样的基础架构时，您如何从 CI/CD 的角度来考虑这个问题？

在 Kubernetes 的世界里，你突然在某个地方运行这些容器，这些软件。你甚至不一定知道在哪里。你有数以千计的实例，如果你来自传统的安全背景，乍一看，这听起来真的很可怕。现实是自动化是你的朋友，对吗？

## Kubernetes 上的自动化

自动化是在 Kubernetes 部署该软件，决定在哪里运行该软件。自动化是您的 CI/CD 管道的一部分，可以帮助您保护它，并确保您只部署您有信心的映像，因为它们已经过扫描。他们通过了你的形象政策。你可能有规则，规定你准备接受什么样的脆弱性水平，或者是谁建立了这种形象。也许还要检查一下这些图像的突出程度。有各种各样的事情可以自动化，所以当 Kubernetes 开始运行一个容器时——运行一个里面有容器的 pod，这个容器映像是——你对它有信心。

亚历克斯·威廉姆斯:对。所以这是你真正想要获得的信心和信任？

**莉丝赖斯:**是的。自动化是关键，因为这些事情的规模很大，当您一天可能要运送数百或数千个部署时，您不可能手动检查所有这些不同的映像。这种规模超出了手动能力，但自动化 CI/CD 是关键。将这些安全部件连接到流程中。

**莉丝赖斯:**洁身自好。因此，我们在 Aqua Security 的许多客户都有关于基础映像的政策，允许他们的开发人员从基础映像开始。也许他们对每一种可能使用的不同语言都有不同的基本意象。你知道，可能有基于 Python 的映像、基于节点的映像和基于 Java 的映像。但是安全团队会查看这些基础映像中包含的内容，他们会有一定的信心，并确保您随后构建的每个映像都是基于那些已批准的映像之一构建的。这能给他们一些信心。

亚历克斯·威廉姆斯:那么，由此产生的一些新的漏洞是什么呢？您现在正在尝试解决的漏洞有哪些，这些漏洞的范围越来越大，并且会以不同的形式出现？

**莉丝赖斯:**嗯，有漏洞，新的漏洞，每天都有发现。其中一些可能是最近才被引入到软件中的。有些可能已经存在了很多年了。我很确定 Heartbleed 是多年前的代码。所以你永远不知道漏洞会从哪里来。每次出现漏洞，都有一个围绕供应商的过程，编写软件的人有一个补丁，将补丁应用到软件包的发行版中。

这实际上有点复杂，因为所有不同的 Linux 发行版都有自己的包管理过程，它们可能会处理——其中一些会进行新的更新，一些会支持补丁。所以你真的希望你的漏洞扫描器不仅要知道基本的漏洞，还要知道哪些发行版在每个包的哪些不同级别上有这些漏洞。这就是不同的图像扫描仪的区别。Aqua 拥有来自许多不同来源的大量情报，加上一个研究团队，投入了大量工作来确保我们的漏洞报告不会-最重要的是误报。如果没有所有这些来源，您可能会得到误报。

**Liz Rice:** 从 NVD(国家漏洞数据库)获得信息的来源确实各不相同，但除此之外，还要应用关于发行版的知识，应用来自上游供应商的知识。有时，像数据库软件这样的供应商可能有他们自己的安全披露，特定语言的披露。另外，实际的人工干预。我们有这个 Aqua 的研究团队有这个完整的工具，在有疑问的地方——漏洞是否真的存在于软件包中。他们会去检查的。因此，我们进行了大量的研究，研究哪些软件包、哪些发行版包含哪些漏洞。

**亚历克斯·威廉姆斯:**哦，我的天哪，你一定从中学到了很多东西。

莉斯·赖斯:是的。我是说，这里面有很多细节。真的让人印象深刻。

亚历克斯·威廉姆斯:那你是如何组织这些数据的？

Liz Rice: 他们有内部工具来管理这些。

亚历克斯·威廉姆斯:对。那么 Aqua 关注的其他组件是什么呢？你从扫描仪的角度来看。我们还讨论了运行时视角。

莉兹·赖斯:有些东西对我来说太迷人了。我可以说上几个小时。归结起来就是知道一个特定的软件应该做什么。我们知道正常的行为是什么样子，然后我们可以发现什么时候不正常的事情发生，什么时候不正常的事情发生。比如，访问一个不应该访问的文件，或者以一个不应该运行的用户 ID 运行。

特别是当我们谈论微服务时，考虑特定服务应该被允许做什么是非常合理的。应该允许它与什么网络流量通话？你的微服务-也许你有一个产品搜索微服务。例如，它无权将用户数据与数据库联系起来。并且能够限制容器化代码所做的事情，因此它不能与用户数据库对话，并且它不能，我不知道，开始 being 不同的网络组件，它可能能够-你知道，它不能开始探索自己的本地网络。你越能约束——我们讨论过收缩包装容器在运行时的行为，这样我们就能标记——或者警告或者阻止，正常行为之外的东西。非常强大。

亚历克斯·威廉姆斯:有意思。

**Liz Rice:** 实际上，如果我们正在谈论 CI/CD，如果您正在部署新版本，您可能需要重新了解该行为是什么，因为新版本可能会在功能上有所变化。这意味着它的行为会略有不同。也许它需要访问一个不同的文件。所以能够保持那些运行时概要文件是最新的也很重要。

**Alex Williams:** 那么你如何保持运行时概要文件是最新的呢？

莉兹·赖斯:自动重新分析他们。

亚历克斯·威廉姆斯:只是重新描述他们。那么，轮廓是如何定义的呢？比如你在这方面有什么想法？

亚历克斯·威廉姆斯:是的，因为这样他们就可以进入任何领域，对吗？是啊。是啊。你如何防止它们进入，我猜，问题是你如何防止它们进入所有的容器？仅仅因为这个原因，你不会希望宋承宪在那里。

莉斯·赖斯:是的。没有人会说一切都是安全的，因为风险正在到来-这完全是一个风险问题，每天都有新的攻击来源。我明天将谈论一些人们可能没有意识到的特权升级问题。人们有一半时间没有意识到他们是以 root 身份运行的。所以这就是我要说的。

**亚历克斯威廉姆斯:**是因为他们某种程度上不具备可解释性吗？

莉兹·赖斯:有可能。是的。有可能。我认为有工具让你知道什么时候你是-我的意思是，实际上这是你可以从 Aqua 安全控制台看到的另一件事，是容器不应该作为 root 运行，但却是。这是我们可以强调并提供建议的另一件事。也许你想运行这个容器不是作为根。

亚历克斯·威廉姆斯:只是一个想法。

莉兹·赖斯:是的。我想，您可以将这种审计日志与更广泛的日志管理或 seam 管理系统挂钩。

亚历克斯·威廉姆斯:是的。我想这留下了许多关于监控整个环境中的组件的问题。

**莉兹·赖斯:**整个可观测性世界有很多方面，我们昨天简单介绍了 CNCF 的所有不同项目，其中几个与可观测性、追踪、记录有关。这是一个很大的领域。

**Alex Williams:** 那么，您对哪些与安全相关的项目感兴趣呢？

丽兹·赖斯:有几个新项目刚刚加入了 CNCF。其中之一是开放策略代理，它是一个通用的策略引擎。因此，我认为我们将关注这一点——我们显然正在定义与图像和运行时间相关的策略。所以现在还为时尚早-

亚历克斯·威廉姆斯:你也许可以提供这样一个形象，你可以-？

莉兹·赖斯:是的，对那个项目来说，现在还为时过早。但是很明显，我们将会看到一些重叠。另一个我很想看到的是漂亮的，这就是安全的身份。我们显然看到更多的服务网格和容器之间更安全的连接，这是一件非常好的事情。这些容器相互识别自己的方式也可以很好地集成到 Aqua 工具中，这样就有了共同的身份。

**Alex Williams:** 我注意到关于这些通信层的讨论越来越多，我们开始看到这些讨论的出现。所以如果你不能交流。但是，举例来说，我会考虑容器本身之间的安全上下文，对吗？还有它们在运行时的行为。

莉斯·赖斯:是的。因此，网络微分段是我们在 Aqua 平台中已经有一段时间的另一个组件，这是容器应该只与某些其他容器进行对话的想法。确实与我们在服务网格中看到的一些工具有关，这些工具可以控制哪些服务可以相互通信。我们是在容器级别上做的，所以这里的粒度稍微大一点。我认为查看这些东西的配置将会非常有趣，配置服务网格不是你只需要花五分钟就能完成的事情。

莉兹·赖斯:是的，的确有些事情我需要深入了解，就像布兰登今天早上说的那样。

## 关于安全性的对话

亚历克斯·威廉姆斯:是的。我想回到 Kubernetes 中的持续集成/持续交付是现在正在讨论的安全问题。你知道，开发人员和安全团队之间的这种奇怪关系已经存在很长时间了，对吗？你总是在这样的会议上听到，“拿出清单。”你拿不到那张支票，那就意味着忘了它吧。在您与开发人员的对话中，有哪些关于安全性的内容让您印象深刻？

**Alex Williams:** 但是开发者是什么，我的意思是在这样的活动中，当你和开发者交谈时，他们会问你什么样的问题？你知道扫描和 CI/CD 以及安全的作用吗？

**莉兹·赖斯:**实际上，关于扫描出现的最大问题是关于误报的整个问题。我认为有些人已经被只获取单一信息来源的扫描工具所困扰。他们扫描，他们发现他们有很多假阳性，然后他们有点像，“嗯，这没有给我任何有用的东西。做这个图像扫描有什么意义？”

亚历克斯·威廉姆斯:“假警报。虚惊一场。”你知道他们说什么。

**莉丝赖斯:**完全正确。是啊。所以我认为我们想用 MicroScanner 做的事情之一是给人们一个不太容易出错的工具——你知道，我不是说永远不会有假阳性，但它应该比我们看到的一些更简单的处理 NVD 的工具要少得多。

**Alex Williams:** 那么你为这款扫描仪构建的技术架构是什么？

**Liz Rice:** 所以这又回到了综合所有这些不同来源的情报？

亚历克斯·威廉姆斯:对。哪个-

**Liz Rice:** 所以微扫描器就像一个小的可执行程序，你可以把它构建到你的容器映像中。它呼唤我们的，我们称之为“网络中心”，这是我们收集的所有漏洞信息的储存库。

亚历克斯·威廉姆斯:但是你是从你正在做的所有扫描图像中收集的？

莉丝·赖斯:是啊。从所有这些数据库、安全建议、发行版和供应商等等。

Alex Williams: 从你们多年的实践中，你们很清楚哪些是数据，以及如何构建这些数据？

莉斯·赖斯:是的。是啊。我们会不断更新这些资源。是啊。这正是我们的商业工具正在使用的网络中心，但是是免费的。

亚历克斯·威廉姆斯:对。好吧，我只是想，也许最后，大概了解一下你对我们将如何思考构建图像和 Kubernetes 的愿景是什么？

丽兹·赖斯:所以，我想在图像构建世界中，有一件事是肯定要进行的，那就是需要构建无特权的图像。因此，我们已经养成了使用工具的习惯(无意冒犯 Docker ),但是您不应该需要 root 权限来构建映像。我认为我们在这方面看到了很多活动。这将使集成到 CI/CD 管道变得更加容易，因为没有人想要 CI/CD 管道——他们不希望他们的 Jenkins 部署对他们的容器部署、他们的 Kubernetes 部署拥有 root 特权。因此，取消这些特权，将会使事情变得更加安全。情况正在好转。他们在进步。

**亚历克斯·威廉姆斯:**不错。那么，你希望看到开发的项目有哪些呢？我想应该是漂亮吧。我想还有 OPA。

莉斯·赖斯:是的。漂亮，开放的政策代理，Grafeas。我知道最近发生了一些和格拉夫阿斯有关的有趣的事情，我还没找到他们，所以-

Alex Williams: 好吧，我们得改天再聊 Grafeas，但是感谢 Liz 抽出时间和我们交谈，并祝贺这里的重大事件。

**莉丝赖斯:**谢谢。我很高兴进展得如此顺利。太好了。